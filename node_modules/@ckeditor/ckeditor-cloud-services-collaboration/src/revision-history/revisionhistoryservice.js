/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
'use strict';var __importDefault=this&&this['__importDefault']||function(_0x5a2184){return _0x5a2184&&_0x5a2184['__esModule']?_0x5a2184:{'default':_0x5a2184};},__importStar=this&&this['__importStar']||function(_0x274d77){if(_0x274d77&&_0x274d77['__esModule'])return _0x274d77;var _0x3f4335={};if(null!=_0x274d77)for(var _0x2fccb2 in _0x274d77)Object['hasOwnProperty']['call'](_0x274d77,_0x2fccb2)&&(_0x3f4335[_0x2fccb2]=_0x274d77[_0x2fccb2]);return _0x3f4335['default']=_0x274d77,_0x3f4335;};Object['defineProperty'](exports,'__esModule',{'value':!0x0});const utils_1=require('ckeditor5/src/utils'),messagescompressor_1=__importDefault(require('./../messagescompressor')),revisionhistorygetrevisionmessage_1=__importDefault(require('./messages/revisionhistorygetrevisionmessage')),revisionhistorygetrevisionresponse_1=__importDefault(require('./responses/revisionhistorygetrevisionresponse')),revisionhistoryupdaterevisionsmessage_1=__importDefault(require('./messages/revisionhistoryupdaterevisionsmessage')),revisionhistoryupdaterevisionsresponse_1=__importDefault(require('./responses/revisionhistoryupdaterevisionsresponse')),revisionhistoryconnectmessage_1=__importDefault(require('./messages/revisionhistoryconnectmessage')),revisionhistoryconnectresponse_1=__importDefault(require('./responses/revisionhistoryconnectresponse')),revisionhistoryreconnectmessage_1=__importDefault(require('./messages/revisionhistoryreconnectmessage')),ckeditorcloudserviceserror_1=__importDefault(require('../ckeditorcloudserviceserror')),websocketgateway_1=__importStar(require('../websocketgateway/websocketgateway')),ServiceNotConnectedError_1=__importDefault(require('../errors/ServiceNotConnectedError'));exports['_SERVICE']=0xc;class RevisionHistoryService{constructor(_0x4bbb27){this['_documentId']=_0x4bbb27,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}['connect'](_0x451650){return this['_isConnected']?Promise['resolve']():this['_connect'](_0x451650,new revisionhistoryconnectmessage_1['default'](this['_documentId']));}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}['reconnect'](_0x247ace,_0x460ec5){if(this['isConnected'])throw new ckeditorcloudserviceserror_1['default']('Cannot\x20reconnect\x20to\x20already\x20connected\x20service.',_0x247ace);return this['_connect'](_0x247ace,new revisionhistoryreconnectmessage_1['default'](this['_documentId'],_0x460ec5));}async['updateRevisions'](_0x105807,_0x492b04){const _0x537adc=revisionhistoryupdaterevisionsmessage_1['default']['create']({'documentId':this['_documentId'],'requestId':_0x492b04,'revisions':_0x105807}),_0x90e141=await this['_sendRequest'](revisionhistoryupdaterevisionsmessage_1['default']['TYPE'],_0x537adc),{requestId:requestId}=messagescompressor_1['default']['decode'](_0x90e141,revisionhistoryupdaterevisionsresponse_1['default']);return requestId;}async['getRevision'](_0x42df5d){const _0x35abaa=new revisionhistorygetrevisionmessage_1['default'](this['_documentId'],_0x42df5d),_0x314cca=await this['_sendRequest'](revisionhistorygetrevisionmessage_1['default']['TYPE'],_0x35abaa);return messagescompressor_1['default']['decode'](_0x314cca,revisionhistorygetrevisionresponse_1['default'])['toObject']();}async['_connect'](_0x33938b,_0x1677ca){if(_0x33938b['state']!==websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['CONNECTED'])throw new ckeditorcloudserviceserror_1['default']('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x33938b);this['_wsGateway']=_0x33938b,this['stopListening'](_0x33938b,'change:state');const _0x134b6d=await _0x33938b['_sendRequest'](exports['_SERVICE'],_0x1677ca['constructor']['TYPE'],messagescompressor_1['default']['encode'](_0x1677ca)),{channel:channel,requestId:requestId,revisions:revisions}=messagescompressor_1['default']['decode'](_0x134b6d,revisionhistoryconnectresponse_1['default'])['toObject']();return this['listenTo'](_0x33938b,'change:state',(_0x1c9484,_0x51ee32,_0xb97bd9)=>this['_onWsGatewayStateChange'](_0xb97bd9),{'priority':websocketgateway_1['default']['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x33938b,channel),this['_isConnected']=!0x0,this['fire']('connected'),{'revisions':revisions,'requestId':requestId};}['_connectToChannel'](_0x2a1b40,_0x4a7581){this['_channel']=_0x2a1b40['_getChannel'](RevisionHistoryService['_SERVICE'],_0x4a7581),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](revisionhistoryupdaterevisionsmessage_1['default']['TYPE']),(_0x10af01,_0x3c610c)=>{const {documentId:documentId,requestId:requestId,revisions:revisions}=messagescompressor_1['default']['decode'](_0x3c610c,revisionhistoryupdaterevisionsmessage_1['default'])['toObject']();this['fire']('revisionsUpdated',{'documentId':documentId,'requestId':requestId,'revisionsData':revisions});});}['_onWsGatewayStateChange'](_0x2c59f0){_0x2c59f0===websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x10dd6f,_0x385e2d){if(!this['_wsGateway']||!this['_isConnected'])throw new ServiceNotConnectedError_1['default']('Revision\x20History',this);return this['_wsGateway']['_sendRequest'](exports['_SERVICE'],_0x10dd6f,messagescompressor_1['default']['encode'](_0x385e2d));}}RevisionHistoryService['_SERVICE']=exports['_SERVICE'],utils_1['mix'](RevisionHistoryService,utils_1['EmitterMixin']),exports['default']=RevisionHistoryService;