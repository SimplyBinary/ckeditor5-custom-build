/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x3d7cea,_0x56f3bb,_0x1c9510,_0x2e1fae){void 0x0===_0x2e1fae&&(_0x2e1fae=_0x1c9510),Object['defineProperty'](_0x3d7cea,_0x2e1fae,{'enumerable':!0x0,'get':function(){return _0x56f3bb[_0x1c9510];}});}:function(_0x4e4c58,_0x25901f,_0x34785e,_0x8c3613){void 0x0===_0x8c3613&&(_0x8c3613=_0x34785e),_0x4e4c58[_0x8c3613]=_0x25901f[_0x34785e];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x43d00d,_0x470a67){Object['defineProperty'](_0x43d00d,'default',{'enumerable':!0x0,'value':_0x470a67});}:function(_0x5674f0,_0x6dd4d4){_0x5674f0['default']=_0x6dd4d4;}),__importStar=this&&this['__importStar']||function(_0x532f57){if(_0x532f57&&_0x532f57['__esModule'])return _0x532f57;var _0x48f638={};if(null!=_0x532f57)for(var _0x2c60c8 in _0x532f57)'default'!==_0x2c60c8&&Object['prototype']['hasOwnProperty']['call'](_0x532f57,_0x2c60c8)&&__createBinding(_0x48f638,_0x532f57,_0x2c60c8);return __setModuleDefault(_0x48f638,_0x532f57),_0x48f638;},__importDefault=this&&this['__importDefault']||function(_0xb3a06d){return _0xb3a06d&&_0xb3a06d['__esModule']?_0xb3a06d:{'default':_0xb3a06d};};Object['defineProperty'](exports,'__esModule',{'value':!0x0}),exports['_SERVICE']=void 0x0;const utils_1=require('ckeditor5/src/utils'),messagescompressor_1=__importDefault(require('./../messagescompressor')),revisionhistorygetrevisionmessage_1=__importDefault(require('./messages/revisionhistorygetrevisionmessage')),revisionhistorygetrevisionresponse_1=__importDefault(require('./responses/revisionhistorygetrevisionresponse')),revisionhistoryupdaterevisionsmessage_1=__importDefault(require('./messages/revisionhistoryupdaterevisionsmessage')),revisionhistoryupdaterevisionsresponse_1=__importDefault(require('./responses/revisionhistoryupdaterevisionsresponse')),revisionhistoryconnectmessage_1=__importDefault(require('./messages/revisionhistoryconnectmessage')),revisionhistoryconnectresponse_1=__importDefault(require('./responses/revisionhistoryconnectresponse')),revisionhistoryreconnectmessage_1=__importDefault(require('./messages/revisionhistoryreconnectmessage')),ckeditorcloudserviceserror_1=__importDefault(require('../ckeditorcloudserviceserror')),websocketgateway_1=__importStar(require('../websocketgateway/websocketgateway')),ServiceNotConnectedError_1=__importDefault(require('../errors/ServiceNotConnectedError'));exports['_SERVICE']=0xc;class RevisionHistoryService{constructor(_0x3bffb7){this['_documentId']=_0x3bffb7,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}['connect'](_0x43a299){return this['_isConnected']?Promise['resolve']():this['_connect'](_0x43a299,new revisionhistoryconnectmessage_1['default'](this['_documentId']));}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}['reconnect'](_0x2b21d1,_0x1b0f53){if(this['isConnected'])throw new ckeditorcloudserviceserror_1['default']('Cannot\x20reconnect\x20to\x20already\x20connected\x20service.',_0x2b21d1);return this['_connect'](_0x2b21d1,new revisionhistoryreconnectmessage_1['default'](this['_documentId'],_0x1b0f53));}async['updateRevisions'](_0x23d485,_0x168122){const _0x53be08=revisionhistoryupdaterevisionsmessage_1['default']['create']({'documentId':this['_documentId'],'requestId':_0x168122,'revisions':_0x23d485}),_0x51eca5=await this['_sendRequest'](revisionhistoryupdaterevisionsmessage_1['default']['TYPE'],_0x53be08),{requestId:requestId}=messagescompressor_1['default']['decode'](_0x51eca5,revisionhistoryupdaterevisionsresponse_1['default']);return requestId;}async['getRevision'](_0x33102d){const _0x185829=new revisionhistorygetrevisionmessage_1['default'](this['_documentId'],_0x33102d),_0x3af970=await this['_sendRequest'](revisionhistorygetrevisionmessage_1['default']['TYPE'],_0x185829);return messagescompressor_1['default']['decode'](_0x3af970,revisionhistorygetrevisionresponse_1['default'])['toObject']();}async['_connect'](_0x24b532,_0x43ac77){if(_0x24b532['state']!==websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['CONNECTED'])throw new ckeditorcloudserviceserror_1['default']('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x24b532);this['_wsGateway']=_0x24b532,this['stopListening'](_0x24b532,'change:state');const _0xa31ce0=await _0x24b532['_sendRequest'](exports['_SERVICE'],_0x43ac77['constructor']['TYPE'],messagescompressor_1['default']['encode'](_0x43ac77)),{channel:channel,requestId:requestId,revisions:revisions}=messagescompressor_1['default']['decode'](_0xa31ce0,revisionhistoryconnectresponse_1['default'])['toObject']();return this['listenTo'](_0x24b532,'change:state',(_0x4327b8,_0x205994,_0x433a17)=>this['_onWsGatewayStateChange'](_0x433a17),{'priority':websocketgateway_1['default']['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x24b532,channel),this['_isConnected']=!0x0,this['fire']('connected'),{'revisions':revisions,'requestId':requestId};}['_connectToChannel'](_0x38b762,_0x321c20){this['_channel']=_0x38b762['_getChannel'](RevisionHistoryService['_SERVICE'],_0x321c20),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](revisionhistoryupdaterevisionsmessage_1['default']['TYPE']),(_0x5c0ff9,_0x5478e0)=>{const {documentId:documentId,requestId:requestId,revisions:revisions}=messagescompressor_1['default']['decode'](_0x5478e0,revisionhistoryupdaterevisionsmessage_1['default'])['toObject']();this['fire']('revisionsUpdated',{'documentId':documentId,'requestId':requestId,'revisionsData':revisions});});}['_onWsGatewayStateChange'](_0x2aa57d){_0x2aa57d===websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x10d6ba,_0x4faa3b){if(!this['_wsGateway']||!this['_isConnected'])throw new ServiceNotConnectedError_1['default']('Revision\x20History',this);return this['_wsGateway']['_sendRequest'](exports['_SERVICE'],_0x10d6ba,messagescompressor_1['default']['encode'](_0x4faa3b));}}RevisionHistoryService['_SERVICE']=exports['_SERVICE'],(0x0,utils_1['mix'])(RevisionHistoryService,utils_1['EmitterMixin']),exports['default']=RevisionHistoryService;