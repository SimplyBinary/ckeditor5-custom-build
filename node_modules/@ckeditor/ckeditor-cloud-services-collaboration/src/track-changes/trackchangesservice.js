/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x3f0050,_0x3a4e14,_0x318aef,_0x49b8ab){void 0x0===_0x49b8ab&&(_0x49b8ab=_0x318aef),Object['defineProperty'](_0x3f0050,_0x49b8ab,{'enumerable':!0x0,'get':function(){return _0x3a4e14[_0x318aef];}});}:function(_0xf6e069,_0xb3b8c5,_0x349227,_0x1615b8){void 0x0===_0x1615b8&&(_0x1615b8=_0x349227),_0xf6e069[_0x1615b8]=_0xb3b8c5[_0x349227];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0xe778de,_0x158dd8){Object['defineProperty'](_0xe778de,'default',{'enumerable':!0x0,'value':_0x158dd8});}:function(_0x496327,_0x5c3674){_0x496327['default']=_0x5c3674;}),__importStar=this&&this['__importStar']||function(_0x2ffafe){if(_0x2ffafe&&_0x2ffafe['__esModule'])return _0x2ffafe;var _0x2854c3={};if(null!=_0x2ffafe)for(var _0x87aafb in _0x2ffafe)'default'!==_0x87aafb&&Object['prototype']['hasOwnProperty']['call'](_0x2ffafe,_0x87aafb)&&__createBinding(_0x2854c3,_0x2ffafe,_0x87aafb);return __setModuleDefault(_0x2854c3,_0x2ffafe),_0x2854c3;},__importDefault=this&&this['__importDefault']||function(_0x334899){return _0x334899&&_0x334899['__esModule']?_0x334899:{'default':_0x334899};};Object['defineProperty'](exports,'__esModule',{'value':!0x0}),exports['_SERVICE']=void 0x0;const utils_1=require('ckeditor5/src/utils'),messagescompressor_1=__importDefault(require('./../messagescompressor')),addsuggestionmessage_1=__importDefault(require('./messages/addsuggestionmessage')),addsuggestionresponse_1=__importDefault(require('./responses/addsuggestionresponse')),getsuggestionmessage_1=__importDefault(require('./messages/getsuggestionmessage')),getsuggestionresponse_1=__importDefault(require('./responses/getsuggestionresponse')),getallsuggestionsmessage_1=__importDefault(require('./messages/getallsuggestionsmessage')),getallsuggestionsresponse_1=__importDefault(require('./responses/getallsuggestionsresponse')),updatesuggestionmessage_1=__importDefault(require('./messages/updatesuggestionmessage')),connectmessage_1=__importDefault(require('./messages/connectmessage')),connectresponse_1=__importDefault(require('./responses/connectresponse')),ckeditorcloudserviceserror_1=__importDefault(require('../ckeditorcloudserviceserror')),websocketgateway_1=__importStar(require('../websocketgateway/websocketgateway')),ServiceNotConnectedError_1=__importDefault(require('../errors/ServiceNotConnectedError'));exports['_SERVICE']=0xa;class TrackChangesService{constructor(_0x25ba5f){this['_documentId']=_0x25ba5f,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x219ece){if(this['_isConnected'])return;if(_0x219ece['state']!==websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['CONNECTED'])throw new ckeditorcloudserviceserror_1['default']('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x219ece);const _0x5abcb3=new connectmessage_1['default'](this['_documentId']);this['_wsGateway']=_0x219ece,this['stopListening'](_0x219ece,'change:state');const _0x393238=await _0x219ece['_sendRequest'](exports['_SERVICE'],connectmessage_1['default']['TYPE'],messagescompressor_1['default']['encode'](_0x5abcb3)),_0x66e67d=messagescompressor_1['default']['decode'](_0x393238,connectresponse_1['default']);return this['listenTo'](_0x219ece,'change:state',(_0x375257,_0x4faa07,_0x187810)=>this['_onWsGatewayStateChange'](_0x187810),{'priority':websocketgateway_1['default']['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x219ece,_0x66e67d['channel']),this['_isConnected']=!0x0,this['fire']('connected'),_0x66e67d['suggestions'];}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['add'](_0x32d741,_0x586825,_0x5c9c92,_0x1b97ef=null,_0x140a7f){const _0x4d453e=new addsuggestionmessage_1['default'](_0x32d741,this['_documentId'],_0x586825,_0x5c9c92,_0x1b97ef,_0x140a7f),_0x3592f2=await this['_sendRequest'](addsuggestionmessage_1['default']['TYPE'],_0x4d453e);return messagescompressor_1['default']['decode'](_0x3592f2,addsuggestionresponse_1['default']);}async['get'](_0x54e73e,_0x4888e6=0x1){const _0x3935aa=new getsuggestionmessage_1['default'](_0x54e73e,this['_documentId']);try{const _0x20ec70=await this['_sendRequest'](getsuggestionmessage_1['default']['TYPE'],_0x3935aa);return messagescompressor_1['default']['decode'](_0x20ec70,getsuggestionresponse_1['default']);}catch(_0x4a5b54){if(_0x4a5b54 instanceof ckeditorcloudserviceserror_1['default']&&'404'===_0x4a5b54['code']&&_0x4888e6<0x5)return await(_0x45dba3=0x64*_0x4888e6,new Promise(_0x449092=>{setTimeout(_0x449092,_0x45dba3);})),this['get'](_0x54e73e,_0x4888e6+0x1);if(_0x4a5b54 instanceof ckeditorcloudserviceserror_1['default'])throw _0x4a5b54;throw new ckeditorcloudserviceserror_1['default'](_0x4a5b54['message'],this['_wsGateway']);}var _0x45dba3;}async['getAll'](){const _0x30d134=new getallsuggestionsmessage_1['default'](this['_documentId']),_0x2287e2=await this['_sendRequest'](getallsuggestionsmessage_1['default']['TYPE'],_0x30d134),{suggestions:suggestions}=messagescompressor_1['default']['decode'](_0x2287e2,getallsuggestionsresponse_1['default']);return suggestions;}async['update'](_0x2693b4,_0x2eae22={}){const {hasComments:hasComments,state:state,attributes:attributes}=_0x2eae22,_0x5c4437=void 0x0!==hasComments,_0x428882=new updatesuggestionmessage_1['default'](_0x2693b4,this['_documentId'],hasComments,_0x5c4437,state,attributes);await this['_sendRequest'](updatesuggestionmessage_1['default']['TYPE'],_0x428882);}['_connectToChannel'](_0x1c607c,_0x3ca358){this['_channel']=_0x1c607c['_getChannel'](TrackChangesService['_SERVICE'],_0x3ca358),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](updatesuggestionmessage_1['default']['TYPE']),(_0x4be50f,_0x1533d)=>{const _0x31958b=messagescompressor_1['default']['decode'](_0x1533d,updatesuggestionmessage_1['default']);this['fire']('suggestionUpdated',_0x31958b);});}['_onWsGatewayStateChange'](_0x47a6b6){_0x47a6b6===websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x3358e4,_0x4c57ed){if(!this['_wsGateway']||!this['_isConnected'])throw new ServiceNotConnectedError_1['default']('Track\x20Changes',this);return this['_wsGateway']['_sendRequest'](exports['_SERVICE'],_0x3358e4,messagescompressor_1['default']['encode'](_0x4c57ed));}}TrackChangesService['_SERVICE']=exports['_SERVICE'],(0x0,utils_1['mix'])(TrackChangesService,utils_1['EmitterMixin']),exports['default']=TrackChangesService;