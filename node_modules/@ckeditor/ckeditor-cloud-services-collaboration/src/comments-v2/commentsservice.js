/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
'use strict';var __importDefault=this&&this['__importDefault']||function(_0x285993){return _0x285993&&_0x285993['__esModule']?_0x285993:{'default':_0x285993};},__importStar=this&&this['__importStar']||function(_0x46c7db){if(_0x46c7db&&_0x46c7db['__esModule'])return _0x46c7db;var _0x523963={};if(null!=_0x46c7db)for(var _0x51e6c5 in _0x46c7db)Object['hasOwnProperty']['call'](_0x46c7db,_0x51e6c5)&&(_0x523963[_0x51e6c5]=_0x46c7db[_0x51e6c5]);return _0x523963['default']=_0x46c7db,_0x523963;};Object['defineProperty'](exports,'__esModule',{'value':!0x0});const utils_1=require('ckeditor5/src/utils'),messagescompressor_1=__importDefault(require('./../messagescompressor')),addcommentmessage_1=__importDefault(require('./messages/addcommentmessage')),addcommentresponse_1=__importDefault(require('./responses/addcommentresponse')),connectmessage_1=__importDefault(require('./messages/connectmessage')),connectresponse_1=__importDefault(require('./responses/connectresponse')),removecommentmessage_1=__importDefault(require('./messages/removecommentmessage')),removecommentthreadmessage_1=__importDefault(require('./messages/removecommentthreadmessage')),updatecommentmessage_1=__importDefault(require('./messages/updatecommentmessage')),getcommentthreadmessage_1=__importDefault(require('./messages/getcommentthreadmessage')),getcommentthreadresponse_1=__importDefault(require('./responses/getcommentthreadresponse')),getdocumentthreadsmessage_1=__importDefault(require('./messages/getdocumentthreadsmessage')),getdocumentthreadsresponse_1=__importDefault(require('./responses/getdocumentthreadsresponse')),websocketgateway_1=__importStar(require('./../websocketgateway/websocketgateway')),ckeditorcloudserviceserror_1=__importDefault(require('./../ckeditorcloudserviceserror')),sessions_1=__importDefault(require('../sessions/sessions')),ServiceNotConnectedError_1=__importDefault(require('../errors/ServiceNotConnectedError'));exports['_SERVICE']=0x9;class CommentsService{constructor(_0x40c6a2){this['_documentId']=_0x40c6a2,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x2b5730){if(this['_isConnected'])return;if(_0x2b5730['state']!==websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['CONNECTED'])throw new ckeditorcloudserviceserror_1['default']('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x2b5730);const _0x24c391=new connectmessage_1['default'](this['_documentId']);this['_wsGateway']=_0x2b5730,this['stopListening'](_0x2b5730,'change:state');const _0x243a16=await _0x2b5730['_sendRequest'](exports['_SERVICE'],connectmessage_1['default']['TYPE'],messagescompressor_1['default']['encode'](_0x24c391)),{channel:channel,threads:threads}=messagescompressor_1['default']['decode'](_0x243a16,connectresponse_1['default']);return this['listenTo'](_0x2b5730,'change:state',(_0xd23d9c,_0xc389ac,_0x48eba2)=>this['_onWsGatewayStateChange'](_0x48eba2),{'priority':websocketgateway_1['default']['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x2b5730,channel),this['_isConnected']=!0x0,this['fire']('connected'),threads;}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['_connectedSessions']&&(this['_connectedSessions']['disconnect'](),this['_connectedSessions']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['addComment'](_0x469112,_0x5e56e9,_0x4fa35a,_0x1fd6c7){const _0x540d1b=new addcommentmessage_1['default'](this['_documentId'],_0x469112,_0x4fa35a,_0x5e56e9,void 0x0,void 0x0,_0x1fd6c7),_0xefde92=await this['_sendRequest'](addcommentmessage_1['default']['TYPE'],_0x540d1b);return messagescompressor_1['default']['decode'](_0xefde92,addcommentresponse_1['default']);}async['updateComment'](_0xdb152b,_0x450c60,_0x41293f,_0x4c1b52){const _0x289c04=void 0x0!==_0x4c1b52,_0x56b10a=new updatecommentmessage_1['default'](this['_documentId'],_0xdb152b,_0x450c60,_0x41293f,_0x4c1b52,_0x289c04);await this['_sendRequest'](updatecommentmessage_1['default']['TYPE'],_0x56b10a);}async['removeComment'](_0x23c427,_0x3305de){const _0x139d8a=new removecommentmessage_1['default'](this['_documentId'],_0x23c427,_0x3305de);await this['_sendRequest'](removecommentmessage_1['default']['TYPE'],_0x139d8a);}async['removeCommentThread'](_0x59582a){const _0x32f5d9=new removecommentthreadmessage_1['default'](this['_documentId'],_0x59582a);await this['_sendRequest'](removecommentthreadmessage_1['default']['TYPE'],_0x32f5d9);}async['getCommentThread'](_0xeba709,_0x3b5c42=0x1){const _0x103a50=new getcommentthreadmessage_1['default'](_0xeba709,this['_documentId']);try{const _0x22e03a=await this['_sendRequest'](getcommentthreadmessage_1['default']['TYPE'],_0x103a50),{comments:comments,commentThreadId:commentThreadId}=messagescompressor_1['default']['decode'](_0x22e03a,getcommentthreadresponse_1['default']);return{'comments':comments,'commentThreadId':commentThreadId};}catch(_0xdb7700){if(_0xdb7700 instanceof ckeditorcloudserviceserror_1['default']&&'404'===_0xdb7700['code']&&_0x3b5c42<0x5)return await(_0x3d216d=0x64*_0x3b5c42,new Promise(_0x358c6d=>{setTimeout(_0x358c6d,_0x3d216d);})),this['getCommentThread'](_0xeba709,_0x3b5c42+0x1);if(_0xdb7700 instanceof ckeditorcloudserviceserror_1['default'])throw _0xdb7700;throw new ckeditorcloudserviceserror_1['default'](_0xdb7700['message'],this['_wsGateway']);}var _0x3d216d;}async['getDocumentThreads'](){const _0x19cdf2=new getdocumentthreadsmessage_1['default'](this['_documentId']),_0x55276f=await this['_sendRequest'](getdocumentthreadsmessage_1['default']['TYPE'],_0x19cdf2),{threads:threads}=messagescompressor_1['default']['decode'](_0x55276f,getdocumentthreadsresponse_1['default']);return{'threads':threads};}async['getConnectedSessions'](){if(!this['_isConnected'])throw new ServiceNotConnectedError_1['default']('Comments',this);return this['_connectedSessions']||(this['_connectedSessions']=await sessions_1['default']['getConnectedSessions'](this['_wsGateway'],this['_documentId'],exports['_SERVICE'])),this['_connectedSessions'];}['_connectToChannel'](_0x502096,_0x27c27c){this['_channel']=_0x502096['_getChannel'](CommentsService['_SERVICE'],_0x27c27c),this['_channel']&&(this['listenTo'](this['_channel'],this['_channel']['getEventName'](addcommentmessage_1['default']['TYPE']),(_0x5d491b,_0x11a7ce)=>{const _0x182deb=messagescompressor_1['default']['decode'](_0x11a7ce,addcommentmessage_1['default']);this['fire']('commentAdded',_0x182deb);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](removecommentmessage_1['default']['TYPE']),(_0x2875f2,_0x2dc0bf)=>{const _0x3f7254=messagescompressor_1['default']['decode'](_0x2dc0bf,removecommentmessage_1['default']);this['fire']('commentRemoved',_0x3f7254);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](updatecommentmessage_1['default']['TYPE']),(_0x502102,_0xa56cb7)=>{const _0x5153f7=messagescompressor_1['default']['decode'](_0xa56cb7,updatecommentmessage_1['default']);this['fire']('commentUpdated',_0x5153f7);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](removecommentthreadmessage_1['default']['TYPE']),(_0x2c2386,_0x575e6d)=>{const _0xd7481b=messagescompressor_1['default']['decode'](_0x575e6d,removecommentthreadmessage_1['default']);this['fire']('commentThreadRemoved',_0xd7481b);}));}['_onWsGatewayStateChange'](_0x35f5b1){_0x35f5b1===websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x149d72,_0x346d06){if(!this['_wsGateway']||!this['_isConnected'])throw new ServiceNotConnectedError_1['default']('Comments',this);return this['_wsGateway']['_sendRequest'](exports['_SERVICE'],_0x149d72,messagescompressor_1['default']['encode'](_0x346d06));}}CommentsService['_SERVICE']=exports['_SERVICE'],utils_1['mix'](CommentsService,utils_1['EmitterMixin']),exports['default']=CommentsService;