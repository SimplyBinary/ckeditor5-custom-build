/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x2a1336,_0x2c3c0f,_0x50cfca,_0x385f95){void 0x0===_0x385f95&&(_0x385f95=_0x50cfca),Object['defineProperty'](_0x2a1336,_0x385f95,{'enumerable':!0x0,'get':function(){return _0x2c3c0f[_0x50cfca];}});}:function(_0x335f49,_0x19babd,_0x597aee,_0x347185){void 0x0===_0x347185&&(_0x347185=_0x597aee),_0x335f49[_0x347185]=_0x19babd[_0x597aee];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x303b72,_0x44cb1a){Object['defineProperty'](_0x303b72,'default',{'enumerable':!0x0,'value':_0x44cb1a});}:function(_0x1a8796,_0xbaf089){_0x1a8796['default']=_0xbaf089;}),__importStar=this&&this['__importStar']||function(_0x239314){if(_0x239314&&_0x239314['__esModule'])return _0x239314;var _0x11d69b={};if(null!=_0x239314)for(var _0x1ca24e in _0x239314)'default'!==_0x1ca24e&&Object['prototype']['hasOwnProperty']['call'](_0x239314,_0x1ca24e)&&__createBinding(_0x11d69b,_0x239314,_0x1ca24e);return __setModuleDefault(_0x11d69b,_0x239314),_0x11d69b;},__importDefault=this&&this['__importDefault']||function(_0x19c7f5){return _0x19c7f5&&_0x19c7f5['__esModule']?_0x19c7f5:{'default':_0x19c7f5};};Object['defineProperty'](exports,'__esModule',{'value':!0x0}),exports['_SERVICE']=void 0x0;const utils_1=require('ckeditor5/src/utils'),messagescompressor_1=__importDefault(require('./../messagescompressor')),addcommentmessage_1=__importDefault(require('./messages/addcommentmessage')),addcommentresponse_1=__importDefault(require('./responses/addcommentresponse')),connectmessage_1=__importDefault(require('./messages/connectmessage')),connectresponse_1=__importDefault(require('./responses/connectresponse')),removecommentmessage_1=__importDefault(require('./messages/removecommentmessage')),removecommentthreadmessage_1=__importDefault(require('./messages/removecommentthreadmessage')),updatecommentmessage_1=__importDefault(require('./messages/updatecommentmessage')),getcommentthreadmessage_1=__importDefault(require('./messages/getcommentthreadmessage')),getcommentthreadresponse_1=__importDefault(require('./responses/getcommentthreadresponse')),getdocumentthreadsmessage_1=__importDefault(require('./messages/getdocumentthreadsmessage')),getdocumentthreadsresponse_1=__importDefault(require('./responses/getdocumentthreadsresponse')),websocketgateway_1=__importStar(require('./../websocketgateway/websocketgateway')),ckeditorcloudserviceserror_1=__importDefault(require('./../ckeditorcloudserviceserror')),sessions_1=__importDefault(require('../sessions/sessions')),ServiceNotConnectedError_1=__importDefault(require('../errors/ServiceNotConnectedError'));exports['_SERVICE']=0x9;class CommentsService{constructor(_0x4e9e93){this['_documentId']=_0x4e9e93,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x3b3a11){if(this['_isConnected'])return;if(_0x3b3a11['state']!==websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['CONNECTED'])throw new ckeditorcloudserviceserror_1['default']('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x3b3a11);const _0x43e59b=new connectmessage_1['default'](this['_documentId']);this['_wsGateway']=_0x3b3a11,this['stopListening'](_0x3b3a11,'change:state');const _0x2ecdb7=await _0x3b3a11['_sendRequest'](exports['_SERVICE'],connectmessage_1['default']['TYPE'],messagescompressor_1['default']['encode'](_0x43e59b)),{channel:channel,threads:threads}=messagescompressor_1['default']['decode'](_0x2ecdb7,connectresponse_1['default']);return this['listenTo'](_0x3b3a11,'change:state',(_0x263004,_0x378366,_0x25b6fa)=>this['_onWsGatewayStateChange'](_0x25b6fa),{'priority':websocketgateway_1['default']['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x3b3a11,channel),this['_isConnected']=!0x0,this['fire']('connected'),threads;}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['_connectedSessions']&&(this['_connectedSessions']['disconnect'](),this['_connectedSessions']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['addComment'](_0x488c40,_0x3a79ac,_0x295876,_0x20e9dc){const _0x309430=new addcommentmessage_1['default'](this['_documentId'],_0x488c40,_0x295876,_0x3a79ac,void 0x0,void 0x0,_0x20e9dc),_0x252639=await this['_sendRequest'](addcommentmessage_1['default']['TYPE'],_0x309430);return messagescompressor_1['default']['decode'](_0x252639,addcommentresponse_1['default']);}async['updateComment'](_0x34d978,_0x4b070a,_0x277c10,_0x128747){const _0x30ca56=void 0x0!==_0x128747,_0x14bbd3=new updatecommentmessage_1['default'](this['_documentId'],_0x34d978,_0x4b070a,_0x277c10,_0x128747,_0x30ca56);await this['_sendRequest'](updatecommentmessage_1['default']['TYPE'],_0x14bbd3);}async['removeComment'](_0x4fbfa4,_0x182512){const _0x289683=new removecommentmessage_1['default'](this['_documentId'],_0x4fbfa4,_0x182512);await this['_sendRequest'](removecommentmessage_1['default']['TYPE'],_0x289683);}async['removeCommentThread'](_0x40254f){const _0xd977d5=new removecommentthreadmessage_1['default'](this['_documentId'],_0x40254f);await this['_sendRequest'](removecommentthreadmessage_1['default']['TYPE'],_0xd977d5);}async['getCommentThread'](_0x482d7f,_0x556c45=0x1){const _0x5595d5=new getcommentthreadmessage_1['default'](_0x482d7f,this['_documentId']);try{const _0x2fd360=await this['_sendRequest'](getcommentthreadmessage_1['default']['TYPE'],_0x5595d5),{comments:comments,commentThreadId:_0x467e37}=messagescompressor_1['default']['decode'](_0x2fd360,getcommentthreadresponse_1['default']);return{'comments':comments,'commentThreadId':_0x467e37};}catch(_0x37e6ad){if(_0x37e6ad instanceof ckeditorcloudserviceserror_1['default']&&'404'===_0x37e6ad['code']&&_0x556c45<0x5)return await(_0x34fa7d=0x64*_0x556c45,new Promise(_0x326bb3=>{setTimeout(_0x326bb3,_0x34fa7d);})),this['getCommentThread'](_0x482d7f,_0x556c45+0x1);if(_0x37e6ad instanceof ckeditorcloudserviceserror_1['default'])throw _0x37e6ad;throw new ckeditorcloudserviceserror_1['default'](_0x37e6ad['message'],this['_wsGateway']);}var _0x34fa7d;}async['getDocumentThreads'](){const _0x5d33c3=new getdocumentthreadsmessage_1['default'](this['_documentId']),_0x270cdb=await this['_sendRequest'](getdocumentthreadsmessage_1['default']['TYPE'],_0x5d33c3),{threads:threads}=messagescompressor_1['default']['decode'](_0x270cdb,getdocumentthreadsresponse_1['default']);return{'threads':threads};}async['getConnectedSessions'](){if(!this['_isConnected'])throw new ServiceNotConnectedError_1['default']('Comments',this);return this['_connectedSessions']||(this['_connectedSessions']=await sessions_1['default']['getConnectedSessions'](this['_wsGateway'],this['_documentId'],exports['_SERVICE'])),this['_connectedSessions'];}['_connectToChannel'](_0x1c87aa,_0x326a22){this['_channel']=_0x1c87aa['_getChannel'](CommentsService['_SERVICE'],_0x326a22),this['_channel']&&(this['listenTo'](this['_channel'],this['_channel']['getEventName'](addcommentmessage_1['default']['TYPE']),(_0x4340b5,_0x383382)=>{const _0x370746=messagescompressor_1['default']['decode'](_0x383382,addcommentmessage_1['default']);this['fire']('commentAdded',_0x370746);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](removecommentmessage_1['default']['TYPE']),(_0x54a222,_0x11dc09)=>{const _0x58b7dc=messagescompressor_1['default']['decode'](_0x11dc09,removecommentmessage_1['default']);this['fire']('commentRemoved',_0x58b7dc);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](updatecommentmessage_1['default']['TYPE']),(_0x3e6b3b,_0x2b0f60)=>{const _0x3531e1=messagescompressor_1['default']['decode'](_0x2b0f60,updatecommentmessage_1['default']);this['fire']('commentUpdated',_0x3531e1);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](removecommentthreadmessage_1['default']['TYPE']),(_0x3a074b,_0x133125)=>{const _0x285c49=messagescompressor_1['default']['decode'](_0x133125,removecommentthreadmessage_1['default']);this['fire']('commentThreadRemoved',_0x285c49);}));}['_onWsGatewayStateChange'](_0x31c776){_0x31c776===websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x1ab6c6,_0x1ec397){if(!this['_wsGateway']||!this['_isConnected'])throw new ServiceNotConnectedError_1['default']('Comments',this);return this['_wsGateway']['_sendRequest'](exports['_SERVICE'],_0x1ab6c6,messagescompressor_1['default']['encode'](_0x1ec397));}}CommentsService['_SERVICE']=exports['_SERVICE'],(0x0,utils_1['mix'])(CommentsService,utils_1['EmitterMixin']),exports['default']=CommentsService;