/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x42d3=['restrictedEditingException','showRevisionViewerCallback','style','PaginationLookup','config','editor','concat','CommentsRepository','WebSocketGateway','set','numeric','get','change','function','includes','has','locale','constructor','_restoreRevision','addRevisionData','Annotations','Users','TrackChangesEditing','users','_closeRevisionViewer','toLocaleDateString','enableReadOnlyMode','push','repository','_enhanceShowRevisionViewerCallback','getMarkersGroup','removeMarker','RevisionViewer','extraPlugins','requires','adapter','toolbar','find','isReady','revisionHistory.restoreRevisionCallback','revision-history-viewer-opened','_showRevisionViewer','Restored','markers','revisionHistory.editorContainer','_viewerEditor','Autosave','pluginName','_update','RevisionHistory','display','revisionHistory.showRevisionViewerCallback','indexOf','RevisionsRepository','commands','from','every','filter','plugins','name','isReadOnly','_enhanceCloseRevisionViewerCallback','bind','then','define','revisionHistory.viewerContainer','disableReadOnlyMode','creator','isAnonymous','_recalculatePageBreaks','RestrictedEditingMode','map','getRevisions','revisionHistory','initialData','catch','toLocaleTimeString','long','createdAt','save','context','_getRevisionViewerEditorConfig','RevisionTracker','revisionHistory.closeRevisionViewerCallback','uiLanguage','isEnabled','getRevision','names','data','model','restoreRevision','getRevisionData'];(function(_0x4ee109,_0x42d32f){const _0x3952d7=function(_0x4c8cc9){while(--_0x4c8cc9){_0x4ee109['push'](_0x4ee109['shift']());}};_0x3952d7(++_0x42d32f);}(_0x42d3,0x1af));const _0x3952=function(_0x4ee109,_0x42d32f){_0x4ee109=_0x4ee109-0x0;let _0x3952d7=_0x42d3[_0x4ee109];return _0x3952d7;};import{Plugin as _0x5f55bb}from'ckeditor5/src/core';import{CKEditorError as _0x3fc622,uid as _0x503712}from'ckeditor5/src/utils';import _0x2bf713 from'./revisiontracker';import _0x19b527 from'./ui/revisionhistory/revisionhistoryui';import _0x5dab90 from'./revisionviewer';import _0x126f9b from'./ui/revisionviewer/revisionviewerui';import _0x4f9b59 from'./ui/revisionssidebar/revisionssidebar';import _0x279484 from'./editor/revisionviewereditor';import{getTranslation as _0x2601ea}from'./utils/common-translations';const g=['RevisionTracker','RevisionHistoryUI',_0x3952('0x25'),_0x3952('0x24'),_0x3952('0x33'),_0x3952('0x7'),_0x3952('0x4b')];export default class k extends _0x5f55bb{static get[_0x3952('0x4c')](){return _0x3952('0x4e');}static get['requires'](){return[_0x2bf713,_0x19b527];}constructor(..._0x5117ee){if(super(..._0x5117ee),!this[_0x3952('0x22')][_0x3952('0x21')]['get'](_0x3952('0xa')))throw new _0x3fc622('revision-history-missing-configuration',this);this['_viewerEditor']=null,this[_0x3952('0x22')][_0x3952('0x21')][_0x3952('0x1')](_0x3952('0x50'),_0x2f5241=>this[_0x3952('0x46')](_0x2f5241)),this[_0x3952('0x22')][_0x3952('0x21')][_0x3952('0x1')](_0x3952('0x14'),_0x301e33=>this[_0x3952('0x35')](_0x301e33)),this[_0x3952('0x22')][_0x3952('0x21')][_0x3952('0x1')](_0x3952('0x44'),_0x57f918=>this[_0x3952('0x2f')](_0x57f918)),this[_0x3952('0x3a')](),this[_0x3952('0x5a')]();}set[_0x3952('0x40')](_0x36b4c0){this['editor']['plugins'][_0x3952('0x28')](_0x3952('0x13'))['adapter']=_0x36b4c0;}get[_0x3952('0x40')](){return this[_0x3952('0x22')][_0x3952('0x57')][_0x3952('0x28')](_0x3952('0x13'))[_0x3952('0x40')];}['addRevisionData'](..._0x419692){return this[_0x3952('0x22')][_0x3952('0x57')]['get']('RevisionTracker')[_0x3952('0x30')](..._0x419692);}['getRevision'](..._0x45817d){return this[_0x3952('0x22')][_0x3952('0x57')][_0x3952('0x28')](_0x3952('0x52'))[_0x3952('0x17')](..._0x45817d);}['getRevisions'](..._0x23e855){return this['editor'][_0x3952('0x57')][_0x3952('0x28')]('RevisionsRepository')['getRevisions'](..._0x23e855);}[_0x3952('0x12')](){const _0x128e5c={},_0x414bdf=this[_0x3952('0x22')],_0x118561=_0x414bdf['plugins'][_0x3952('0x28')](_0x3952('0x13')),_0x27054c=_0x414bdf[_0x3952('0x57')][_0x3952('0x28')]('Users')[_0x3952('0x34')];for(const _0xd8b96d of _0x414bdf[_0x3952('0x21')][_0x3952('0x18')]())_0x128e5c[_0xd8b96d]=_0x414bdf['config'][_0x3952('0x28')](_0xd8b96d);delete _0x128e5c[_0x3952('0x11')],_0x128e5c[_0x3952('0xb')]='',_0x128e5c[_0x3952('0x41')]=['exitToEditing',_0x3952('0x1b'),'changesNavigation'];const _0x247788=this[_0x3952('0x22')][_0x3952('0x2e')]['builtinPlugins']||[],_0x3648bb=_0x128e5c[_0x3952('0x3e')]||[];delete _0x128e5c[_0x3952('0x3e')];const _0x5d3bf5=_0x247788[_0x3952('0x23')](_0x128e5c[_0x3952('0x57')])[_0x3952('0x23')](_0x3648bb)[_0x3952('0x8')](_0x110ed1=>'string'==typeof _0x110ed1?_0x247788[_0x3952('0x42')](_0x45475a=>_0x45475a[_0x3952('0x4c')]==_0x110ed1):_0x110ed1);return _0x128e5c[_0x3952('0x57')]=Array['from'](new Set(_0x5d3bf5))[_0x3952('0x56')](_0x328680=>C(_0x328680,_0x414bdf[_0x3952('0x57')],[])),(_0x128e5c[_0x3952('0x57')][_0x3952('0x38')](_0x5dab90,_0x126f9b,class extends _0x5f55bb{static get[_0x3952('0x3f')](){return[_0x5dab90,_0x3952('0x32')];}['init'](){const _0x11020c=this['editor'][_0x3952('0x57')][_0x3952('0x28')](_0x3952('0x32'));for(const _0x19c022 of _0x27054c)_0x19c022[_0x3952('0x5')]||_0x11020c['getUser'](_0x19c022['id'])||_0x11020c['addUser'](_0x19c022);const _0x3144d9=_0x118561['repository'][_0x3952('0x9')]();let _0x23610c=null;const _0xb50d87=this[_0x3952('0x22')]['plugins'][_0x3952('0x28')](_0x3952('0x3d'));_0xb50d87[_0x3952('0x40')]=_0x118561[_0x3952('0x40')],_0xb50d87[_0x3952('0x5b')]('isEnabled')['to'](_0x118561),this[_0x3952('0x22')][_0x3952('0x53')][_0x3952('0x28')](_0x3952('0x1b'))[_0x3952('0x5b')](_0x3952('0x16'))['to'](_0x414bdf,_0x3952('0x59'),_0x36c748=>!_0x36c748);for(const _0x12f18c of _0x3144d9){const _0x1d7e23=null===_0x12f18c[_0x3952('0x4')];if(_0x1d7e23&&_0x12f18c['toVersion']===_0x12f18c['fromVersion'])continue;const _0x52ccab=_0x12f18c['toJSON']();_0xb50d87['addRevisionData'](_0x52ccab,(_0x27ac34,_0x25def3,_0x5628ff)=>{if(_0x1d7e23){if(_0x23610c)_0x23610c[_0x3952('0x4d')](_0x27ac34,_0x25def3);else{if(!_0x25def3){const _0xd7a7d0=_0x5628ff['toJSON']();_0xd7a7d0['id']=_0x503712(),_0x118561['saveRevision'](_0xd7a7d0,_0x5628ff['toVersion'])[_0x3952('0x0')](_0x14790f=>{_0x23610c=_0x14790f;});}}}else _0x12f18c[_0x3952('0x4d')](_0x27ac34,_0x25def3);});}}},_0x4f9b59),_0x128e5c);}[_0x3952('0x3a')](){const _0x3870e9=this[_0x3952('0x22')][_0x3952('0x21')][_0x3952('0x28')](_0x3952('0xa'))[_0x3952('0x1e')];this[_0x3952('0x22')][_0x3952('0x21')][_0x3952('0x26')]('revisionHistory.showRevisionViewerCallback',async()=>{this['editor'][_0x3952('0x37')]('revision-history-viewer-opened');const _0x2edd02=this['editor'][_0x3952('0x57')][_0x3952('0x28')]('RevisionTracker');this[_0x3952('0x22')][_0x3952('0x57')]['has'](_0x3952('0x4b'))?await this['editor'][_0x3952('0x57')][_0x3952('0x28')](_0x3952('0x4b'))[_0x3952('0x10')]():await _0x2edd02['update'](),this[_0x3952('0x22')][_0x3952('0x57')]['has'](_0x3952('0x20'))&&this[_0x3952('0x22')][_0x3952('0x57')][_0x3952('0x28')](_0x3952('0x20'))[_0x3952('0x6')]();const _0xbedda5=this[_0x3952('0x12')]();return _0x3870e9(_0xbedda5)[_0x3952('0x0')](_0x4ea0e7=>{this['_viewerEditor']=_0x4ea0e7,this[_0x3952('0x22')]['plugins'][_0x3952('0x2c')](_0x3952('0x31'))&&this[_0x3952('0x22')][_0x3952('0x57')]['get']('Annotations')['refreshVisibility']();})[_0x3952('0xc')](_0x5e690f=>{console['error'](_0x5e690f),this[_0x3952('0x22')][_0x3952('0x3')]('revision-history-viewer-opened');});});}[_0x3952('0x5a')](){const _0x287cf6=this[_0x3952('0x22')][_0x3952('0x21')][_0x3952('0x28')](_0x3952('0xa'))['closeRevisionViewerCallback'];this['editor'][_0x3952('0x21')][_0x3952('0x26')](_0x3952('0x14'),()=>(this['editor'][_0x3952('0x57')][_0x3952('0x2c')](_0x3952('0x20'))&&this[_0x3952('0x22')][_0x3952('0x57')]['get'](_0x3952('0x20'))[_0x3952('0x6')](),_0x287cf6(this[_0x3952('0x4a')])['then'](()=>{this[_0x3952('0x22')][_0x3952('0x3')](_0x3952('0x45')),this[_0x3952('0x4a')]=null,this[_0x3952('0x22')][_0x3952('0x57')][_0x3952('0x2c')]('Annotations')&&(this['editor']['plugins'][_0x3952('0x28')](_0x3952('0x31'))['refreshVisibility'](),this[_0x3952('0x22')][_0x3952('0x57')][_0x3952('0x28')](_0x3952('0x31'))['refreshPositioning']());})));}[_0x3952('0x46')](_0x283f5f){const _0x2ae7d0=this[_0x3952('0x22')][_0x3952('0x21')][_0x3952('0x28')](_0x3952('0x49')),_0x7f9bb8=this[_0x3952('0x22')][_0x3952('0x21')][_0x3952('0x28')](_0x3952('0x2')),_0x303072=this[_0x3952('0x22')][_0x3952('0x21')]['get']('revisionHistory.viewerEditorElement');return _0x279484['create'](_0x303072,_0x283f5f)[_0x3952('0x0')](_0x5f355a=>(_0x7f9bb8[_0x3952('0x1f')][_0x3952('0x4f')]='block',_0x2ae7d0['style'][_0x3952('0x4f')]='none',_0x5f355a));}[_0x3952('0x35')](_0x3d474d){const _0x283628=this[_0x3952('0x22')][_0x3952('0x21')][_0x3952('0x28')](_0x3952('0x49'));return this[_0x3952('0x22')][_0x3952('0x21')][_0x3952('0x28')]('revisionHistory.viewerContainer')[_0x3952('0x1f')]['display']='none',_0x283628[_0x3952('0x1f')][_0x3952('0x4f')]='',_0x3d474d['destroy']();}async[_0x3952('0x2f')](_0x5cdf63){const _0x2ae946=this[_0x3952('0x22')],_0x2cc9b4=this['_viewerEditor']['plugins'][_0x3952('0x28')](_0x3952('0x3d')),_0x2bbe38=_0x2ae946[_0x3952('0x57')][_0x3952('0x28')](_0x3952('0x13')),_0x4d6a2f=_0x2cc9b4[_0x3952('0x39')][_0x3952('0x17')](_0x5cdf63);let _0x2f2b0c,_0x511c95;try{_0x2f2b0c=await _0x2cc9b4[_0x3952('0x1c')](_0x4d6a2f);}catch(_0x133796){return void console['error'](_0x133796);}_0x2ae946[_0x3952('0x1a')][_0x3952('0x29')](_0xb7f703=>{for(const _0x247ebb of Array[_0x3952('0x54')](_0x2ae946[_0x3952('0x1a')][_0x3952('0x48')][_0x3952('0x3b')](_0x3952('0x1d'))))_0xb7f703[_0x3952('0x3c')](_0x247ebb);}),_0x2cc9b4[_0x3952('0x43')]=!0x1,_0x2ae946[_0x3952('0x19')][_0x3952('0x26')](_0x2f2b0c,{'suppressErrorInCollaboration':!0x0});const _0xb1f2a0=_0x2601ea(_0x2ae946[_0x3952('0x2d')],_0x3952('0x47'));if(_0x4d6a2f[_0x3952('0x58')])_0x511c95=-0x1==_0x4d6a2f[_0x3952('0x58')][_0x3952('0x51')](_0xb1f2a0)?_0xb1f2a0+':\x20'+_0x4d6a2f[_0x3952('0x58')]:_0x4d6a2f[_0x3952('0x58')];else _0x511c95=_0xb1f2a0+':\x20'+(_0x4d6a2f[_0x3952('0xf')][_0x3952('0x36')](_0x2ae946['locale'][_0x3952('0x15')],{'month':_0x3952('0xe'),'day':_0x3952('0x27')})+',\x20'+_0x4d6a2f[_0x3952('0xf')][_0x3952('0xd')](_0x2ae946[_0x3952('0x2d')]['uiLanguage'],{'hour':_0x3952('0x27'),'minute':'numeric'}));return await _0x2bbe38['saveRevision']({'name':_0x511c95}),_0x2cc9b4[_0x3952('0x43')]=!0x0,_0x2ae946['config'][_0x3952('0x28')]('revisionHistory')['closeRevisionViewerCallback']();}}function C(_0x163f13,_0x3fb179,_0xf4ccb9){const _0x3d911f=_0x3952('0x2a')==typeof _0x163f13?_0x163f13['pluginName']||_0x163f13[_0x3952('0x58')]:_0x163f13;if(_0xf4ccb9['includes'](_0x3d911f))return!0x0;if(_0xf4ccb9[_0x3952('0x38')](_0x3d911f),g[_0x3952('0x2b')](_0x3d911f))return!0x1;const _0x12713d=((_0x3952('0x2a')==typeof _0x163f13?_0x163f13:_0x3fb179[_0x3952('0x2c')](_0x3d911f)?_0x3fb179[_0x3952('0x28')](_0x3d911f):{})[_0x3952('0x3f')]||[])[_0x3952('0x55')](_0x42725e=>C(_0x42725e,_0x3fb179,_0xf4ccb9));return _0x12713d||g[_0x3952('0x38')](_0x3d911f),_0x12713d;}