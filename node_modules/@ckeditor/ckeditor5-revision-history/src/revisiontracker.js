/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Users as _0x45751d}from'ckeditor5-collaboration/src/collaboration-core';import{Plugin as _0x1a385b,PendingActions as _0x1d8b4e}from'ckeditor5/src/core';import{uid as _0x46ee96}from'ckeditor5/src/utils';import{Position as _0x412a21,Range as _0x84246f,Element as _0xfad1d1,DocumentFragment as _0x32b4d2,ViewText as _0x43e399,ViewElement as _0x590964,ViewDocumentFragment as _0x3537ec}from'ckeditor5/src/engine';import _0x9cf00d from'./revisionsrepository';export default class l extends _0x1a385b{static get['pluginName'](){return'RevisionTracker';}static get['requires'](){return[_0x45751d,_0x9cf00d,_0x1d8b4e];}constructor(..._0x2ae0e6){super(..._0x2ae0e6),this['adapter']=null,this['set']('isReady',!0x1),this['set']('isEnabled',!0x0),this['currentRevision']=null;const _0x4ddbb2=_0x46ee96();this['_source']={'history':this['editor']['model']['document']['history'],'getLatestVersion':()=>Promise['resolve'](this['editor']['model']['document']['version']),'getCurrentRevisionId':()=>_0x4ddbb2},this['_revisionDataBuilder']=new P(this['editor']),this['_initialRevisionId']=this['editor']['config']['get']('collaboration.channelId')||'initial',this['set']('isPendingUpdate',!0x1),this['_bufferedUpdates']=new Map();}['init'](){this['repository']=this['editor']['plugins']['get']('RevisionsRepository'),this['_setConversion'](),this['editor']['data']['on']('ready',()=>{if(this['editor']['plugins']['has']('RealTimeCollaborationClient')){const _0x4f86cf=this['_source']['getCurrentRevisionId'](),_0x22cc2e=this['repository']['getRevision'](_0x4f86cf);this['_startingVersion']=_0x22cc2e?_0x22cc2e['fromVersion']:this['_source']['history']['_operations'][this['_source']['history']['_operations']['length']-0x1]['baseVersion']+0x1;}else{const _0x2b793d=this['repository']['getRevisions']()['find'](_0x185e6a=>null===_0x185e6a['creator']);if(_0x2b793d){if(this['editor']['model']['document']['version']=_0x2b793d['toVersion'],_0x2b793d['fromVersion']===_0x2b793d['toVersion'])this['_source']['getCurrentRevisionId']=()=>_0x2b793d['id'];else{const _0x2fec67=this['editor']['plugins']['get']('Users')['me'];_0x2b793d['creator']=_0x2fec67,_0x2b793d['_update']({'creatorId':_0x2fec67['id']});}}this['_startingVersion']=this['editor']['model']['document']['version'];}this['_revisionDataBuilder']['init'](this['_source']['history']),this['_createInitialRevision'](this['_startingVersion']),this['_createCurrentRevision'](this['_startingVersion']),this['adapter']&&this['sendBufferedUpdates']();}),this['bind']('isReady')['to'](this,'_isPendingUpdate',_0x542917=>!_0x542917);}['setSource'](_0x1be6f8){this['_source']=_0x1be6f8;}async['update'](){const _0x45ff59=await this['_source']['getLatestVersion']();if(_0x45ff59>this['currentRevision']['toVersion']){const _0x236a7e=this['buildRevisionData']({'revision':this['currentRevision'],'to':_0x45ff59});_0x236a7e['authors']=_0x236a7e['authorsIds']['map'](_0x32ce51=>this['editor']['plugins']['get']('Users')['getUser'](_0x32ce51)),this['currentRevision']['_update'](_0x236a7e);}}async['saveRevision'](_0x14d971={},_0x3280e4=null){const _0xad5902=[];if(_0x3280e4>this['currentRevision']['toVersion']&&(_0x3280e4=null),null===_0x3280e4&&(_0x3280e4=await this['_source']['getLatestVersion']()),this['currentRevision']['toVersion']<_0x3280e4){const _0x4dfa56=this['buildRevisionData']({'revision':this['currentRevision'],'from':_0x3280e4,'to':_0x3280e4});_0x4dfa56['authors']=[],_0x4dfa56['authorsIds']=[],_0x4dfa56['id']=this['currentRevision']['id'],this['currentRevision']['_update'](_0x4dfa56,!0x0),delete _0x4dfa56['authors'],_0xad5902['push'](_0x4dfa56);}const _0x19632f=this['editor']['plugins']['get']('Users')['me'],_0x518458=this['_getFromVersion'](_0x3280e4),_0x3457e0=this['buildRevisionData']({'from':_0x518458,'to':_0x3280e4});_0x14d971['creatorId']=_0x19632f['id'],_0x14d971['name']=_0x14d971['name']||null,_0x14d971['id']=_0x14d971['id']||_0x46ee96(),_0x14d971={..._0x14d971,..._0x3457e0};const _0x259dea=this['addRevisionData'](_0x14d971);_0xad5902['push'](_0x14d971);const _0x4557a0=this['repository']['getIndex'](_0x259dea);if(0x0!==_0x4557a0){const _0xa3dcaa=this['repository']['getRevision'](_0x4557a0-0x1);if(_0xa3dcaa['fromVersion']!==_0x3280e4){const _0x5ef7c4=this['_revisionDataBuilder']['getData'](_0x3280e4,_0xa3dcaa['toVersion']),_0x1aa0d9={'id':_0xa3dcaa['id'],'diffData':_0x5ef7c4['diffData'],'authorsIds':_0x5ef7c4['authorsIds'],'authors':_0x5ef7c4['authorsIds']['map'](_0x3f4dbc=>this['editor']['plugins']['get']('Users')['getUser'](_0x3f4dbc)),'fromVersion':_0x3280e4};_0xa3dcaa===this['currentRevision']&&(_0x1aa0d9['createdAt']=new Date(_0x14d971['createdAt']['getTime']()+0xa)),_0xa3dcaa['_update'](_0x1aa0d9,!0x0),delete _0x1aa0d9['authors'],_0xad5902['push'](_0x1aa0d9);}}if(this['adapter']){for(const _0x2f80fd of _0xad5902)this['_bufferUpdate'](_0x2f80fd['id'],_0x2f80fd,!0x0);this['sendBufferedUpdates']();}return _0x259dea;}['addRevisionData'](_0x26e9ab){const _0x13749b=this['repository']['createRevision'](_0x26e9ab);return this['adapter']&&_0x13749b['on']('_update',(_0x31f266,_0x7f8900,_0x3cd0ef)=>{_0x3cd0ef||(this['_bufferUpdate'](_0x7f8900['id'],_0x7f8900,!0x0),this['sendBufferedUpdates']());}),this['repository']['addRevision'](_0x13749b,this['_findInsertionIndex'](_0x13749b)),_0x13749b;}async['getRevisionDocumentData'](_0x31671d){await this['_loadRevisionData'](_0x31671d);const _0x100e14={};for(const _0x3bbc71 in _0x31671d['diffData']){const _0x520b1e=this['_removeRevisionMarkers'](JSON['parse'](_0x31671d['diffData'][_0x3bbc71]['insertions'])),_0x4ad4f1=this['editor']['editing']['view']['document'],_0x19d8b3=new _0x3537ec(_0x4ad4f1,_0x520b1e['map'](_0x3f0aff=>this['_getViewObj'](_0x3f0aff)));_0x100e14[_0x3bbc71]=this['editor']['data']['processor']['toData'](_0x19d8b3);}return _0x100e14;}['sendBufferedUpdates'](){if(0x0===this['_bufferedUpdates']['size'])return;if(this['_isPendingUpdate'])return;let _0xcfacc1=Array['from'](this['_bufferedUpdates']['values']());this['_bufferedUpdates']['clear']();for(let _0x3b3afb=0x0;_0x3b3afb<_0xcfacc1['length'];_0x3b3afb++){const _0x56a6f6=_0xcfacc1[_0x3b3afb];let _0x4dbdd5=!0x1;for(const _0x4d0d52 of Object['keys'](_0x56a6f6))void 0x0===_0x56a6f6[_0x4d0d52]?delete _0x56a6f6[_0x4d0d52]:'id'!==_0x4d0d52&&(_0x4dbdd5=!0x0);_0x4dbdd5||(_0xcfacc1[_0x3b3afb]=null);}if(_0xcfacc1=_0xcfacc1['filter'](_0x56e0f6=>null!==_0x56e0f6),!_0xcfacc1['length'])return;for(let _0x5109a7=0x0;_0x5109a7<_0xcfacc1['length'];_0x5109a7++){const _0x268de5=_0xcfacc1[_0x5109a7];void 0x0!==_0x268de5['fromVersion']&&void 0x0===_0x268de5['toVersion']&&(_0x268de5['toVersion']=this['repository']['getRevision'](_0x268de5['id'])['toVersion']),void 0x0!==_0x268de5['toVersion']&&void 0x0===_0x268de5['fromVersion']&&(_0x268de5['fromVersion']=this['repository']['getRevision'](_0x268de5['id'])['fromVersion']);}const _0x3795df=this['editor']['config']['get']('collaboration.channelId');this['_isPendingUpdate']=!0x0,this['_addPendingAction'](),this['adapter']['updateRevisions'](_0xcfacc1,_0x3795df)['finally'](()=>{this['_isPendingUpdate']=!0x1;})['then'](()=>{this['_removePendingAction'](),this['sendBufferedUpdates']();});}['_addPendingAction'](){const t=this['editor']['t'];if(!this['_pendingAction']){const _0xd4a6b=this['editor']['plugins']['get']('PendingActions');this['_pendingAction']=_0xd4a6b['add'](t({'string':'Unsaved\x20change\x20in\x20revision\x20history.','id':'PENDING_ACTION_REVISION_HISTORY'}));}}['_removePendingAction'](){this['_pendingAction']&&(this['editor']['plugins']['get']('PendingActions')['remove'](this['_pendingAction']),this['_pendingAction']=null);}['_findInsertionIndex'](_0x4a6fd1){const _0x272ac0=this['repository']['getRevisions']();_0x272ac0['reverse']();let _0x482cc7=0x0;for(;_0x482cc7<_0x272ac0['length'];){const _0x14d392=_0x272ac0[_0x482cc7];if(_0x14d392['id']===this['_initialRevisionId'])break;const _0x307f47=_0x4a6fd1['toVersion']-_0x14d392['toVersion']||_0x4a6fd1['fromVersion']-_0x14d392['fromVersion'];if(_0x307f47>0x0)break;if(_0x307f47<0x0)_0x482cc7++;else{if(!_0x4a6fd1['creator']&&_0x14d392['creator'])break;if(_0x14d392['creator']||!_0x4a6fd1['creator']){if(_0x4a6fd1['createdAt']>_0x14d392['createdAt'])break;_0x482cc7++;}else _0x482cc7++;}}return _0x482cc7;}['setRevisionData'](_0x547854){const _0x32a9ff=this['repository']['getRevision'](_0x547854['id']);if(_0x547854['createdAt']&&(_0x547854['createdAt']=new Date(_0x547854['createdAt'])),_0x547854['authorsIds']){const _0x5155eb=this['editor']['plugins']['get']('Users');_0x547854['authors']=_0x547854['authorsIds']['map'](_0x17be1d=>_0x5155eb['getUser'](_0x17be1d));}_0x32a9ff['_update'](_0x547854,!0x0);}['buildRevisionData']({revision:_0x138c45=null,from:_0x2ea330=null,to:_0x39bfb1=null}){_0x2ea330=null!==_0x2ea330?_0x2ea330:_0x138c45['fromVersion'],_0x39bfb1=null!==_0x39bfb1?_0x39bfb1:_0x138c45['toVersion'];const _0x152e5b=this['_revisionDataBuilder']['getData'](_0x2ea330,_0x39bfb1),_0xfd136a={'diffData':_0x152e5b['diffData'],'authorsIds':_0x152e5b['authorsIds'],'fromVersion':_0x2ea330,'toVersion':_0x39bfb1};return _0x138c45&&_0x39bfb1===_0x138c45['toVersion']||(_0xfd136a['createdAt']=new Date()),_0xfd136a;}['_loadRevisionData'](_0x15b676){if(!_0x15b676||_0x15b676['diffData'])return Promise['resolve']();{const _0x1a0661=this['editor']['config']['get']('collaboration.channelId');return this['adapter']['getRevision']({'channelId':_0x1a0661,'revisionId':_0x15b676['id']})['then'](_0x24e792=>{_0x15b676['diffData']=_0x24e792['diffData'];});}}['_bufferUpdate'](_0x38687c,_0x38ce55,_0xe56e87){if(this['_bufferedUpdates']['has'](_0x38687c)){const _0xe93907=this['_bufferedUpdates']['get'](_0x38687c);_0x38ce55=_0xe56e87?{..._0xe93907,..._0x38ce55}:{..._0x38ce55,..._0xe93907};}this['_bufferedUpdates']['set'](_0x38687c,_0x38ce55);}['_getFromVersion'](_0x47c899){const _0x377386=this['repository']['getRevisions']();_0x377386['reverse'](),_0x377386['shift']();const _0x4c16af=_0x377386['find'](_0x2dba82=>_0x2dba82['toVersion']<=_0x47c899)['toVersion'];return _0x4c16af<this['_startingVersion']?this['_startingVersion']:_0x4c16af;}['_createInitialRevision'](_0x2c4831){const _0x3bcc7e=this['repository']['getRevision'](this['repository']['length']-0x1);if(_0x3bcc7e)this['_initialRevisionId']=_0x3bcc7e['id'];else{const t=this['editor']['t'],_0x2e71f5=!this['editor']['model']['document']['roots']['find'](_0x9d4f65=>this['editor']['model']['hasContent'](_0x9d4f65)),_0x126412=this['editor']['plugins']['get']('Users')['me']['id'],_0x48c07a=t(_0x2e71f5?'Empty\x20document':'Initial\x20revision');this['_makeRevision']({'from':_0x2c4831,'to':_0x2c4831,'id':this['_initialRevisionId'],'name':_0x48c07a,'creatorId':_0x126412});}}['_createCurrentRevision'](_0x17c99c){const _0x4729af=this['_source']['getCurrentRevisionId']();this['currentRevision']=this['repository']['getRevision'](_0x4729af),this['currentRevision']||(this['currentRevision']=this['_makeRevision']({'from':_0x17c99c,'to':_0x17c99c,'id':_0x4729af}));}['_makeRevision']({name:_0x2f64e3,from:_0x121f7e,to:_0x34bbfa,creatorId:_0x20d437,id:_0x3947e2}){const _0x55e35c=this['buildRevisionData']({'from':_0x121f7e,'to':_0x34bbfa});_0x2f64e3&&(_0x55e35c['name']=_0x2f64e3),_0x20d437&&(_0x55e35c['creatorId']=_0x20d437),_0x55e35c['id']=_0x3947e2;const _0x492e7f=this['addRevisionData'](_0x55e35c);return this['adapter']&&this['_bufferUpdate'](_0x55e35c['id'],_0x55e35c,!0x0),_0x492e7f;}['_setConversion'](){this['editor']['conversion']['for']('dataDowncast')['markerToData']({'model':'revision'});}['_removeRevisionMarkers'](_0x5ea559){return(_0x5ea559=_0x5ea559['filter'](_0x53cfe5=>!_0x53cfe5['name']||'revision-start'!==_0x53cfe5['name']&&'revision-end'!==_0x53cfe5['name']))['forEach'](_0x1e8ab3=>{'string'!=typeof _0x1e8ab3&&(_0x1e8ab3['children']=this['_removeRevisionMarkers'](_0x1e8ab3['children']),_0x1e8ab3['attributes']=_0x1e8ab3['attributes']['filter'](_0x4fae24=>!_0x4fae24[0x0]['startsWith']('data-revision-')));}),_0x5ea559;}['_getViewObj'](_0x289134){const _0x824f60=this['editor']['editing']['view']['document'];if('string'==typeof _0x289134)return new _0x43e399(_0x824f60,_0x289134);{const _0x5e4231=_0x289134['children']['map'](_0x1e659a=>this['_getViewObj'](_0x1e659a));return new _0x590964(_0x824f60,_0x289134['name'],_0x289134['attributes'],_0x5e4231);}}}class P{constructor(_0x2cf67d){this['editor']=_0x2cf67d,this['_savedMetaData']=new Map(),this['_lastFrom']=-0x1,this['_lastTo']=-0x1,this['_markers']=new Map(),this['_diffRoots']=new Map(),this['_baseRoots']=new Map(),this['_idsRoots']=new Map(),this['_baseIdsRoots']=new Map(),this['_touched']=new Map(),this['_touchedMarkers']=new Map(),this['_revisionId']=0x1,this['_rootNames']=this['editor']['model']['document']['getRootNames'](),this['_rootNames']['push']('$graveyard');}['init'](_0x467dc6){this['source']=_0x467dc6;const _0xdc8211=new Map();for(const _0x31b6ed of this['_rootNames']){const _0x264d9c=V(this['editor']['model']['document']['getRoot'](_0x31b6ed));_0xdc8211['set'](_0x31b6ed,_0x264d9c);}const _0x4c7136=Array['from'](this['editor']['model']['markers'])['map'](_0x15a991=>[_0x15a991['name'],_0x15a991['getRange']()]),_0x350327=this['source']['_operations'][this['source']['_operations']['length']-0x1]['baseVersion']+0x1;this['_saveMetaData'](_0x350327,_0xdc8211,_0x4c7136),this['_startingRevisionId']=this['_revisionId'];}['getData'](_0x46dd26,_0x4e04b5){if(this['_lastFrom']===_0x46dd26&&this['_lastTo']<=_0x4e04b5)this['_savedMetaData']['size']>0x1&&this['_removeMetaData'](this['_lastTo']),this['_applyOperations'](this['_lastTo'],_0x4e04b5,!0x0);else{if(!this['_savedMetaData']['has'](_0x46dd26)){const _0x82415e=this['_getPreviousFrom'](_0x46dd26);this['_calculateMetaData'](_0x82415e,_0x46dd26,!0x1);}this['_calculateMetaData'](_0x46dd26,_0x4e04b5,!0x0);}return this['_lastFrom']=_0x46dd26,this['_lastTo']=_0x4e04b5,this['_getState']();}['_saveEmptyMetaData'](_0x1dd7af){const _0x54ec30=new Map();for(const _0x428b90 of this['_rootNames']){const _0x5ce421=new _0x32b4d2();_0x5ce421['rootName']=_0x428b90,_0x54ec30['set'](_0x428b90,_0x5ce421);}this['_saveMetaData'](_0x1dd7af,_0x54ec30,[]);}['_saveMetaData'](_0x2875c0,_0x1b7db2,_0x401670){const _0x24201e=new Map(_0x1b7db2),_0x47fd2c=new Map();for(const [_0x337623,_0x5b61d3]of _0x401670)_0x47fd2c['set'](_0x337623,{'start':_0x5b61d3['start']['clone'](),'end':_0x5b61d3['end']['clone'](),'rootName':_0x5b61d3['root']['rootName']});this['_savedMetaData']['set'](_0x2875c0,{'roots':_0x24201e,'markers':_0x47fd2c});}['_removeMetaData'](_0x5c3cbe){this['_savedMetaData']['delete'](_0x5c3cbe);}['reInit'](){this['_reset'](),this['_lastFrom']=-0x1,this['_lastTo']=-0x1,this['_savedMetaData']['clear'](),this['init'](this['source']);}['_reset'](){this['_touched']['clear'](),this['_touchedMarkers']['clear'](),this['_diffRoots']['clear'](),this['_baseRoots']['clear'](),this['_idsRoots']['clear'](),this['_baseIdsRoots']['clear'](),this['_markers']['clear'](),this['_revisionId']=0x1,this['_startingRevisionId']=this['_revisionId'];}['_makeIdsRoot'](_0x1f8f85,_0x47e79b=null){let _0x473c86=null;_0x1f8f85['is']('documentFragment')||(_0x473c86=new _0xfad1d1(_0x1f8f85['name'],{'vid_start':null===_0x47e79b?this['_revisionId']++:_0x47e79b++}));const _0x21a564=[];for(const _0x290ef7 of _0x1f8f85['getChildren']())if(_0x290ef7['is']('element')){_0x21a564['push'](this['_makeIdsRoot'](_0x290ef7,_0x47e79b));const _0x34c26f=_0x21a564[_0x21a564['length']-0x1];null!==_0x47e79b&&(_0x47e79b=_0x34c26f['is']('element','$text')?_0x34c26f['getAttribute']('vid')+0x1:_0x34c26f['getAttribute']('vid_end')+0x1);}else for(let _0xedb051=0x0;_0xedb051<_0x290ef7['offsetSize'];_0xedb051++)_0x21a564['push'](new _0xfad1d1('$text',{'vid':null===_0x47e79b?this['_revisionId']++:_0x47e79b++}));if(_0x1f8f85['is']('documentFragment')){const _0x3b2c63=new _0x32b4d2(_0x21a564);return _0x3b2c63['rootName']=_0x1f8f85['rootName'],_0x3b2c63;}return _0x473c86['_setAttribute']('vid_end',null===_0x47e79b?this['_revisionId']++:_0x47e79b++),_0x473c86['_insertChild'](0x0,_0x21a564),_0x473c86;}['_calculateMetaData'](_0x58650c,_0x527bf7,_0xb186f2){this['_reset']();const {roots:_0x7378cb,markers:_0x4d60c3}=this['_savedMetaData']['get'](_0x58650c);this['_baseRoots']=new Map(_0x7378cb);for(const [_0x143ab2,_0x158d29]of this['_baseRoots'])if('$graveyard'!==_0x143ab2&&(this['_diffRoots']['set'](_0x143ab2,V(_0x158d29)),_0xb186f2)){const _0x321437=this['_revisionId'];this['_idsRoots']['set'](_0x143ab2,this['_makeIdsRoot'](_0x158d29)),this['_baseIdsRoots']['set'](_0x143ab2,this['_makeIdsRoot'](_0x158d29,_0x321437));}this['_startingRevisionId']=this['_revisionId'],this['_diffRoots']['set']('$graveyard',V(this['_baseRoots']['get']('$graveyard'))),_0xb186f2&&this['_idsRoots']['set']('$graveyard',this['_makeIdsRoot'](this['_baseRoots']['get']('$graveyard')));for(const [_0x95e53c,_0x45a714]of _0x4d60c3){const _0x5f343c=this['_baseRoots']['get'](_0x45a714['rootName']),_0x2a9bb6=this['_diffRoots']['get'](_0x45a714['rootName']),_0x3626ed=new _0x84246f(this['_fixPosition'](_0x45a714['start'],_0x5f343c),this['_fixPosition'](_0x45a714['end'],_0x5f343c)),_0x52f352=this['_fixRange'](_0x3626ed,_0x2a9bb6);_0x5f343c['markers']['set'](_0x95e53c,_0x3626ed),this['_markers']['set'](_0x95e53c,_0x52f352);}this['_applyOperations'](_0x58650c,_0x527bf7,_0xb186f2);}['_applyOperations'](_0x8474ea,_0xefa603,_0x8e7247){for(const _0x136414 of this['source']['getOperations'](_0x8474ea,_0xefa603))this['_handleOperation'](_0x136414,_0x8e7247);for(const _0x115cb5 of this['_diffRoots']['values']())_0x115cb5['markers']['clear']();for(const [_0x36ed4b,_0x390a44]of this['_markers']){this['_diffRoots']['get'](_0x390a44['root']['rootName'])['markers']['set'](_0x36ed4b,_0x390a44['clone']());}this['_saveMetaData'](_0xefa603,Array['from'](this['_diffRoots'])['map'](([_0x36212d,_0x5729fc])=>[_0x36212d,V(_0x5729fc)]),this['_markers']);}['_getPreviousFrom'](_0x4e6d39){const _0x42a41b=Array['from'](this['_savedMetaData']['keys']());_0x42a41b['sort']((_0x180742,_0x288198)=>_0x180742-_0x288198),_0x42a41b['reverse']();for(const _0x33b909 of _0x42a41b)if(_0x33b909<_0x4e6d39)return _0x33b909;const _0x3f20a9=this['source']['_operations'][0x0]['baseVersion'];return this['_saveEmptyMetaData'](_0x3f20a9),_0x3f20a9;}['_copyMarkers'](_0x52d153,_0x2f69a0){const _0x44019a=Array['from'](_0x2f69a0['markers'])['map'](([_0x518bf8,_0x1732c1])=>[_0x518bf8,this['_fixRange'](_0x1732c1,_0x52d153)]);_0x52d153['markers']=new Map(_0x44019a);}['_transformMarkers'](_0x33b13c){for(const _0x107d97 of this['_markers']['values']()){const _0xfe8e7c=_0x107d97['getTransformedByOperation'](_0x33b13c),_0x377de5=_0x84246f['_createFromRanges'](_0xfe8e7c);_0x107d97['start']=_0x377de5['start'],_0x107d97['end']=_0x377de5['end'];}}['_handleOperation'](_0x3d2883,_0x139b3d){const _0xe2357=this['_cloneOperation'](_0x3d2883,this['_diffRoots']);if('marker'!==_0x3d2883['type']&&(_0xe2357['_execute'](),this['_transformMarkers'](_0xe2357)),_0x139b3d)switch(_0xe2357['type']){case'insert':this['_handleInsertOperation'](_0x3d2883);break;case'move':case'remove':case'reinsert':this['_handleMoveOperation'](_0x3d2883);break;case'merge':this['_handleMergeOperation'](_0x3d2883);break;case'split':this['_handleSplitOperation'](_0x3d2883);break;case'marker':this['_handleMarkerOperation'](_0x3d2883);}}['_cloneOperation'](_0xf16862,_0x27b77a){const _0x5b3bea=_0xf16862['clone']();return _0x5b3bea['_authorId']=_0xf16862['_authorId'],this['_fixOperation'](_0x5b3bea,_0x27b77a),_0x5b3bea;}['_getBaseVids'](_0x5b8679){return _0x5b8679['map'](_0x263f9f=>{const _0x392bc=this['_getVidAttributeName'](_0x263f9f);return Number(_0x263f9f['item']['getAttribute'](_0x392bc));});}['_generateTape'](_0x735e66,_0x1684fa){if(_0x735e66['is']('element','$text'))_0x1684fa['push']({'item':_0x735e66,'type':'text'});else{_0x735e66['is']('element')&&_0x1684fa['push']({'item':_0x735e66,'type':'elementStart'});for(const _0x509ece of _0x735e66['getChildren']())this['_generateTape'](_0x509ece,_0x1684fa);_0x735e66['is']('element')&&_0x1684fa['push']({'item':_0x735e66,'type':'elementEnd'});}return _0x1684fa;}['_getState'](){const _0xabd292=this['editor']['model']['document']['getRootNames'](),_0x36b277=new Map(this['_touched']),_0x1ab5c8=new Map(_0x36b277),_0x44f49b=new Map(),_0x437a29={'insertions':{},'deletions':{}},_0x45c6c2={'insertions':{},'deletions':{}},_0x197f0e=new Map();for(const _0x8c008b of _0xabd292){const _0xdfa59c=this['_diffRoots']['get'](_0x8c008b),_0x2a3210=this['_baseRoots']['get'](_0x8c008b);_0x437a29['insertions'][_0x8c008b]=V(_0xdfa59c),_0x437a29['deletions'][_0x8c008b]=V(_0x2a3210),this['_copyMarkers'](_0x437a29['deletions'][_0x8c008b],_0x2a3210),this['_copyMarkers'](_0x437a29['insertions'][_0x8c008b],_0xdfa59c),_0x45c6c2['insertions'][_0x8c008b]=this['_generateTape'](this['_idsRoots']['get'](_0x8c008b),[]),_0x45c6c2['deletions'][_0x8c008b]=this['_generateTape'](this['_baseIdsRoots']['get'](_0x8c008b),[]);}for(const _0x3563a3 of _0xabd292){const _0x273fe6=_0x45c6c2['insertions'][_0x3563a3];for(const _0x5d0b29 of _0x273fe6){const _0x483554=this['_getVidAttributeName'](_0x5d0b29),_0x5e7959=_0x5d0b29['item']['getAttribute'](_0x483554);_0x1ab5c8['delete'](_0x5e7959),_0x5e7959>=this['_startingRevisionId']&&_0x44f49b['set'](_0x5e7959,_0x36b277['get'](_0x5e7959));}}for(const _0x423253 of _0xabd292){const _0xe472a=_0x45c6c2['insertions'][_0x423253],_0x1b7576=this['_getBaseVids'](_0x45c6c2['deletions'][_0x423253]);let _0x266b32=0x0;for(const _0x44f65f of _0xe472a){const _0x92f1c=this['_getVidAttributeName'](_0x44f65f),_0x5ddea1=_0x44f65f['item']['getAttribute'](_0x92f1c);if(!_0x44f49b['has'](_0x5ddea1)&&!_0x197f0e['has'](_0x5ddea1)){if(_0x1ab5c8['has'](_0x5ddea1))_0x266b32++;else{if(_0x5ddea1!=_0x1b7576[_0x266b32]){const _0x62ab01=_0x36b277['get'](_0x5ddea1)||_0x36b277['get'](_0x1b7576[_0x266b32]);for(;_0x5ddea1!=_0x1b7576[_0x266b32];)_0x1ab5c8['has'](_0x1b7576[_0x266b32])||(_0x197f0e['set'](_0x1b7576[_0x266b32],_0x62ab01),_0x36b277['set'](_0x1b7576[_0x266b32],_0x62ab01)),_0x266b32++;}_0x266b32++;}}}}for(const _0x4bc2cb of _0xabd292){const _0x431ff3=_0x45c6c2['insertions'][_0x4bc2cb];for(const _0x220d37 of _0x431ff3){const _0x10c0a0=this['_getVidAttributeName'](_0x220d37),_0x41608c=_0x220d37['item']['getAttribute'](_0x10c0a0);if(_0x197f0e['has'](_0x41608c)){const _0x569c3d=_0x197f0e['get'](_0x41608c);_0x1ab5c8['has'](_0x41608c)||_0x1ab5c8['set'](_0x41608c,{..._0x569c3d}),_0x44f49b['set'](_0x41608c,{..._0x569c3d});}}}for(const _0x16d52e of _0x1ab5c8['keys']())_0x16d52e>=this['_startingRevisionId']&&_0x1ab5c8['delete'](_0x16d52e);const _0x504f1f=new Map();for(const _0x3e7f3b of _0xabd292){let _0x1c3417=_0x45c6c2['insertions'][_0x3e7f3b];for(const _0x2175e4 of _0x1c3417)if(_0x2175e4['item']['is']('element','tableCell')){const _0x3e592a=this['_getVidAttributeName'](_0x2175e4),_0x412aed=_0x2175e4['item']['getAttribute'](_0x3e592a);if(_0x44f49b['has'](_0x412aed)){const _0x16718c=_0x2175e4['item']['parent']['parent']['getAttribute']('vid_start'),_0x405c11=_0x504f1f['get'](_0x16718c)||new Set();_0x405c11['add'](_0x44f49b['get'](_0x412aed)['userId']),_0x504f1f['set'](_0x16718c,_0x405c11);}}_0x1c3417=_0x45c6c2['deletions'][_0x3e7f3b];for(const _0x53a8e9 of _0x1c3417)if(_0x53a8e9['item']['is']('element','tableCell')){const _0x52ebc7=this['_getVidAttributeName'](_0x53a8e9),_0x3dd686=_0x53a8e9['item']['getAttribute'](_0x52ebc7);if(_0x1ab5c8['has'](_0x3dd686)){const _0x3b64f4=_0x53a8e9['item']['parent']['parent']['getAttribute']('vid_start'),_0xa9e2d=_0x504f1f['get'](_0x3b64f4)||new Set();_0xa9e2d['add'](_0x1ab5c8['get'](_0x3dd686)['userId']),_0x504f1f['set'](_0x3b64f4,_0xa9e2d);}}for(const _0x44d5a0 of _0x504f1f['keys']())(_0x44f49b['has'](_0x44d5a0)||_0x1ab5c8['has'](_0x44d5a0))&&_0x504f1f['delete'](_0x44d5a0);}for(const _0x316a71 of _0xabd292){const _0x778dab=_0x45c6c2['insertions'][_0x316a71];let _0xecc387=null,_0x1e6d0c=null;for(const _0x288b04 of _0x778dab){const _0x2ba3d1=this['_getVidAttributeName'](_0x288b04),_0x33eb2e=_0x288b04['item']['getAttribute'](_0x2ba3d1),_0xf52a39=_0x504f1f['get'](_0x33eb2e);_0xf52a39&&'elementStart'==_0x288b04['type']&&(_0xecc387=Array['from'](_0xf52a39)[0x0],_0x1e6d0c=_0x288b04['item']['getAttribute']('vid_end')),_0xecc387&&(_0x1ab5c8['set'](_0x33eb2e,{'userId':_0xecc387}),_0x44f49b['set'](_0x33eb2e,{'userId':_0xecc387})),_0x33eb2e==_0x1e6d0c&&(_0xecc387=null,_0x1e6d0c=null);}}const _0x531ffe={},_0x23c60b=new Set();for(const _0x1dc80c of _0xabd292){const _0x5ac010=_0x437a29['deletions'][_0x1dc80c],_0x5c823c=_0x437a29['insertions'][_0x1dc80c];for(const {userId:_0xb297ba}of this['_touchedMarkers']['values']())null!==_0xb297ba&&_0x23c60b['add'](_0xb297ba);this['_markChanges'](_0x5c823c,_0x45c6c2['insertions'][_0x1dc80c],_0x44f49b,'insertion',_0x23c60b),this['_markChanges'](_0x5ac010,_0x45c6c2['deletions'][_0x1dc80c],_0x1ab5c8,'deletion',_0x23c60b),_0x531ffe[_0x1dc80c]={'insertions':this['_prepareViewToSave'](_0x5c823c),'deletions':this['_prepareViewToSave'](_0x5ac010)};}return{'diffData':_0x531ffe,'authorsIds':Array['from'](_0x23c60b)};}['_processRootBeforeSave'](_0x3947cd){for(const [,_0x838afe]of _0x3947cd['markers']){const _0x791195=_0x838afe['start']['getAncestors']()['filter'](_0x33dc60=>'tableCell'==_0x33dc60['name']);for(const _0x3d584e of _0x791195)0x1==_0x3d584e['childCount']&&_0x3d584e['getChild'](0x0)['is']('element','paragraph')&&_0x3d584e['getChild'](0x0)['_setAttribute']('keepParagraph',!0x0);}}['_prepareViewToSave'](_0x27c637){this['_processRootBeforeSave'](_0x27c637);const _0xccdca6=this['editor']['data']['toView'](_0x27c637,{}),_0x31e476=Array['from'](_0xccdca6['getChildren']())['map'](_0x5b7c7e=>this['_getViewObj'](_0x5b7c7e));return JSON['stringify'](_0x31e476);}['_getViewObj'](_0x4d5db3){return _0x4d5db3['is']('text')?_0x4d5db3['data']:{'name':_0x4d5db3['name'],'attributes':Array['from'](_0x4d5db3['getAttributes']()),'children':Array['from'](_0x4d5db3['getChildren']())['map'](_0x30dfcf=>this['_getViewObj'](_0x30dfcf))};}['_markChanges'](_0x3cf293,_0x4cbb9,_0x364b46,_0x3d308f,_0xea8634){let _0x358cf4=null,_0x4e3656=null,_0x5406c8=0x0;const _0xd6bb1c=this['editor']['model'];for(let _0x531822=0x0;_0x531822<_0x4cbb9['length'];_0x531822++){const _0x4d61cb=this['_getVidAttributeName'](_0x4cbb9[_0x531822]),_0x266665=_0x4cbb9[_0x531822]['item']['getAttribute'](_0x4d61cb),_0x3eb777=_0x364b46['get'](_0x266665),_0x35385e=_0x531822==_0x4cbb9['length']-0x1;(!_0x358cf4&&_0x3eb777&&(_0x358cf4=_0x3eb777,_0x4e3656=_0x4cbb9[_0x531822]),_0x358cf4&&(!_0x3eb777||_0x3eb777['userId']!=_0x358cf4['userId']))&&(_0x478a83(_0x3eb777,$(_0x4e3656,_0x3cf293,_0xd6bb1c),$(_0x4cbb9[_0x531822],_0x3cf293,_0xd6bb1c)),_0x358cf4=_0x3eb777||null,_0x4e3656=_0x3eb777?_0x4cbb9[_0x531822]:null),_0x358cf4&&_0x35385e&&_0x478a83(_0x3eb777,$(_0x4e3656,_0x3cf293,_0xd6bb1c),C(_0x4cbb9[_0x531822],_0x3cf293,_0xd6bb1c));}function _0x478a83(_0xb7f84e,_0x57f6b4,_0x32fd45){const _0x37e3bb=_0x358cf4['userId'],_0x4462d7='revision:'+_0x3d308f+':'+_0x37e3bb+':'+_0x5406c8++,_0x2146d9=_0xd6bb1c['createRange'](_0x57f6b4,_0x32fd45);_0x3cf293['markers']['set'](_0x4462d7,_0x2146d9),null!==_0x37e3bb&&_0xea8634['add'](_0x37e3bb);}}['_getVidAttributeName'](_0x2e9c49){switch(_0x2e9c49['type']){case'elementStart':return'vid_start';case'elementEnd':return'vid_end';default:return'vid';}}['_fixOperation'](_0x201572,_0xa0c9f){_0x201572['baseVersion']=null;for(const _0x5c258e in _0x201572){if(_0x201572[_0x5c258e]instanceof _0x412a21){const _0x1a4085=_0xa0c9f['get'](_0x201572[_0x5c258e]['root']['rootName']);_0x201572[_0x5c258e]=this['_fixPosition'](_0x201572[_0x5c258e],_0x1a4085);}if(_0x201572[_0x5c258e]instanceof _0x84246f){const _0x155d8f=_0xa0c9f['get'](_0x201572[_0x5c258e]['root']['rootName']);_0x201572[_0x5c258e]=this['_fixRange'](_0x201572[_0x5c258e],_0x155d8f);}}_0x201572['root']&&(_0x201572['root']=_0xa0c9f['get'](_0x201572['root']['rootName']));}['_fixRange'](_0x52ddaa,_0x2cb3d4){return this['editor']['model']['createRange'](this['_fixPosition'](_0x52ddaa['start'],_0x2cb3d4),this['_fixPosition'](_0x52ddaa['end'],_0x2cb3d4));}['_fixPosition'](_0x5a7703,_0x28a743){return this['editor']['model']['createPositionFromPath'](_0x28a743,_0x5a7703['path'],_0x5a7703['stickiness']);}['_handleInsertOperation'](_0x1528b3){const _0x5188ab=this['_idsRoots']['get'](_0x1528b3['position']['root']['rootName']),_0x4adbb5=this['_fixPosition'](_0x1528b3['position'],_0x5188ab),_0x5d47e3=null===_0x1528b3['_authorId']?null:_0x1528b3['_authorId']||this['editor']['plugins']['get']('Users')['me']['id'],_0x4775c3=_0x4adbb5['parent'],_0x4e1ec3=this['_revisionId'],_0x533d73=[];for(const _0x12177c of _0x1528b3['nodes'])if(_0x12177c['is']('element'))_0x533d73['push'](this['_makeIdsRoot'](_0x12177c));else for(let _0x57c70a=0x0;_0x57c70a<_0x12177c['offsetSize'];_0x57c70a++)_0x533d73['push'](new _0xfad1d1('$text',{'vid':this['_revisionId']++}));const _0x391989=this['_revisionId'];for(let _0x348a63=_0x4e1ec3;_0x348a63<_0x391989;_0x348a63++)this['_touched']['set'](_0x348a63,{'userId':_0x5d47e3});_0x4775c3['_insertChild'](_0x4adbb5['offset'],_0x533d73);}['_handleMoveOperation'](_0x413de7){(_0x413de7=this['_cloneOperation'](_0x413de7,this['_idsRoots']))['_execute']();const _0x1e2d6e=null===_0x413de7['_authorId']?null:_0x413de7['_authorId']||this['editor']['plugins']['get']('Users')['me']['id'],_0x523df3=_0x413de7['getMovedRangeStart'](),_0x357f7a=_0x523df3['parent'],_0x1ce6b6=_0x523df3['offset'];!function _0x125fe6(_0x8f1225,_0x54c1a1,_0x53bdb7,_0x38f6ab){for(let _0x3677ce=_0x53bdb7;_0x3677ce<_0x38f6ab;_0x3677ce++){const _0x5e15dc=_0x54c1a1['getChild'](_0x3677ce);_0x5e15dc['is']('element','$text')?_0x8f1225['set'](_0x5e15dc['getAttribute']('vid'),{'userId':_0x1e2d6e}):(_0x8f1225['set'](_0x5e15dc['getAttribute']('vid_start'),{'userId':_0x1e2d6e}),_0x125fe6(_0x8f1225,_0x5e15dc,0x0,_0x5e15dc['childCount']),_0x8f1225['set'](_0x5e15dc['getAttribute']('vid_end'),{'userId':_0x1e2d6e}));}}(this['_touched'],_0x357f7a,_0x1ce6b6,_0x1ce6b6+_0x413de7['howMany']);}['_handleMergeOperation'](_0x2a3b7a){const _0x44fc3e=null===(_0x2a3b7a=this['_cloneOperation'](_0x2a3b7a,this['_idsRoots']))['_authorId']?null:_0x2a3b7a['_authorId']||this['editor']['plugins']['get']('Users')['me']['id'],_0x1557e4=_0x2a3b7a['targetPosition']['parent'],_0x25edb5=_0x2a3b7a['sourcePosition']['parent'],_0x3f4a32=_0x1557e4['getAttribute']('vid_end'),_0x586929=_0x25edb5['getAttribute']('vid_start');_0x1557e4['_setAttribute']('vid_end',_0x25edb5['getAttribute']('vid_end')),_0x25edb5['_setAttribute']('vid_end',_0x3f4a32),this['_touched']['set'](_0x586929,{'userId':_0x44fc3e}),this['_touched']['set'](_0x3f4a32,{'userId':_0x44fc3e}),_0x2a3b7a['_execute']();}['_handleSplitOperation'](_0x154142){const _0x1d1c4e=null===(_0x154142=this['_cloneOperation'](_0x154142,this['_idsRoots']))['_authorId']?null:_0x154142['_authorId']||this['editor']['plugins']['get']('Users')['me']['id'],_0x42d820=_0x154142['graveyardPosition'],_0x2c77ff=_0x154142['splitPosition']['parent'];_0x154142['_execute']();const _0x52b668=_0x2c77ff['getAttribute']('vid_end'),_0x527bb8=_0x154142['insertionPosition']['nodeAfter'];if(_0x42d820){const _0xa161d0=_0x527bb8['getAttribute']('vid_end'),_0x2d926d=_0x2c77ff['getAttribute']('vid_end');_0x2c77ff['_setAttribute']('vid_end',_0xa161d0),_0x527bb8['_setAttribute']('vid_end',_0x2d926d),this['_touched']['set'](_0x2c77ff['getAttribute']('vid_end'),{'userId':_0x1d1c4e}),this['_touched']['set'](_0x527bb8['getAttribute']('vid_start'),{'userId':_0x1d1c4e});}else{const _0x9a5dad=this['_revisionId']++,_0x225b3c=this['_revisionId']++;_0x2c77ff['_setAttribute']('vid_end',_0x9a5dad),_0x527bb8['_setAttribute']('vid_start',_0x225b3c),_0x527bb8['_setAttribute']('vid_end',_0x52b668),this['_touched']['set'](_0x9a5dad,{'userId':_0x1d1c4e}),this['_touched']['set'](_0x225b3c,{'userId':_0x1d1c4e});}}['_handleMarkerOperation'](_0x588ee7){if(!_0x588ee7['affectsData'])return;const _0x4c3497=(_0x588ee7=this['_cloneOperation'](_0x588ee7,this['_diffRoots']))['oldRange']?_0x588ee7['oldRange']['root']:null,_0x1daacc=_0x588ee7['newRange']?_0x588ee7['newRange']['root']:null;_0x4c3497&&this['_markers']['delete'](_0x588ee7['name']),_0x1daacc&&this['_markers']['set'](_0x588ee7['name'],_0x588ee7['newRange']['clone']());const _0x5a9ad7=null===_0x588ee7['_authorId']?null:_0x588ee7['_authorId']||this['editor']['plugins']['get']('Users')['me']['id'],_0x3c5089=_0x588ee7['name'];if(!this['_touchedMarkers']['has'](_0x3c5089))return void this['_touchedMarkers']['set'](_0x3c5089,{'range':_0x588ee7['oldRange'],'userId':_0x5a9ad7});const _0x3768b1=this['_touchedMarkers']['get'](_0x3c5089),_0x51c3dd=_0x3768b1['range'],_0x5e24f2=_0x588ee7['newRange'];null==_0x51c3dd&&null==_0x5e24f2||_0x51c3dd&&_0x5e24f2&&_0x51c3dd['isEqual'](_0x5e24f2)?this['_touchedMarkers']['delete'](_0x588ee7['name']):_0x3768b1['userId']=_0x5a9ad7;}}function V(_0x15374b){const _0x465bbb=new _0x32b4d2();_0x465bbb['rootName']=_0x15374b['rootName'];for(const _0xa35818 of _0x15374b['getChildren']()){const _0x1ad296=_0xa35818['_clone'](!0x0);_0x465bbb['_appendChild'](_0x1ad296);}return _0x465bbb;}function $(_0x35fbb6,_0x4ce12c,_0x590847){const _0x4feaa4='elementEnd'==_0x35fbb6['type']?_0x590847['createPositionAt'](_0x35fbb6['item'],'end'):_0x590847['createPositionBefore'](_0x35fbb6['item']);return _0x4feaa4['root']=_0x4ce12c,_0x4feaa4;}function C(_0x1ee007,_0x10c0c6,_0x4e022a){const _0x5ec6ce='elementStart'==_0x1ee007['type']?_0x4e022a['createPositionAt'](_0x1ee007['item'],0x0):_0x4e022a['createPositionAfter'](_0x1ee007['item']);return _0x5ec6ce['root']=_0x10c0c6,_0x5ec6ce;}