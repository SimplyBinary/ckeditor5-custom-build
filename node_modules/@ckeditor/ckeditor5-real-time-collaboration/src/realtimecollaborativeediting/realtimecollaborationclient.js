/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x2f6393,PendingActions as _0xefef66}from'ckeditor5/src/core';import{CKEditorError as _0x2e7bb0,version as _0x5163e5,uid as _0xb413bf}from'ckeditor5/src/utils';import{transformSets as _0x2a2993,InsertOperation as _0x47480e,MarkerOperation as _0x3f44aa,OperationFactory as _0x2cb81c,History as _0x4de80a}from'ckeditor5/src/engine';import{Notification as _0x57f12c}from'ckeditor5/src/ui';import{Users as _0xd65c8a}from'ckeditor5-collaboration/src/collaboration-core';import _0xa729ca from'./websocketgateway';import _0x16f399 from'./sessions';import _0x15642b from'./usermarkers';import _0x2bd901 from'@ckeditor/ckeditor5-operations-compressor/src/compressor';import _0x36634c from'@ckeditor/ckeditor-cloud-services-collaboration/src/collaborativeeditingservice/collaborativeeditingservice';import _0x4bc824 from'@ckeditor/ckeditor-cloud-services-collaboration/src/users/user';let z=0x1;export default class l extends _0x2f6393{static get['requires'](){return[_0xa729ca,_0x16f399,_0x15642b,_0xefef66,_0xd65c8a,_0x57f12c];}static get['pluginName'](){return'RealTimeCollaborationClient';}get['cloudDocumentVersion'](){return this['_lastServerVersion']+this['_offset'];}get['_lastServerVersion'](){const _0x23500f=this['serverHistory']['_operations'];return _0x23500f['length']?_0x23500f[_0x23500f['length']-0x1]['baseVersion']+0x1-this['_offset']:0x0;}get['lastSyncVersion'](){const _0x461be5=this['serverHistory']['_operations'];let _0x4fb064=_0x461be5['length'];for(;_0x4fb064--;){const _0x2699c5=_0x461be5[_0x4fb064];if(!this['_disconnectionOperations']['has'](_0x2699c5))return _0x2699c5['baseVersion']+0x1-this['_offset'];}return 0x0;}['init'](){const _0x597f3d=this['editor'],_0x1d09cb=_0x597f3d['plugins']['get'](_0xd65c8a),_0x54dcb0=_0x597f3d['plugins']['get'](_0xa729ca);if(this['_offset']=0x0,this['sessionId']=null,this['serverHistory']=new _0x4de80a(),this['editor']['config']['define']('collaboration',{}),this['_channelId']=_0x597f3d['config']['get']('collaboration.channelId'),!this['_channelId'])throw new _0x2e7bb0('collaboration-missing-channelid',this);this['listenTo'](_0x1d09cb,'getOperationAuthor',(_0xb5d5b,_0x3e1d1c)=>{const _0xcd5f4f=_0x3e1d1c[0x0];_0xcd5f4f['_authorId']&&(_0xb5d5b['return']=_0x1d09cb['getUser'](_0xcd5f4f['_authorId']),_0xb5d5b['stop']()),null===_0xcd5f4f['_authorId']&&(_0xb5d5b['return']=null,_0xb5d5b['stop']());},{'priority':'high'});const _0x10d8d2=_0x597f3d['config']['get']('cloudServices.bundleVersion')||_0x5163e5;this['_service']=new l['CollaborativeEditingService'](_0x10d8d2,this['_channelId']),this['_document']=this['editor']['model']['document'],this['_compressor']=new _0x2bd901(),this['_bufferedOperations']=[],this['_knownOperations']=new WeakSet(),this['set']('_isPendingUpdate',!0x1),this['set']('_hasSynchronizationProblem',!0x1),this['_pendingAction']=null,this['_hasSelectionChanged']=!0x1,this['_sendBufferedOperationsDelayId']=null,this['_baseBufferDelay']=0x12c,this['_currentBufferDelay']=this['_baseBufferDelay'],this['_lastSyncedOperationId']=null,this['_disconnectionOperations']=new WeakSet(),this['_operationIdentifier']=new F(this['_disconnectionOperations']),this['listenTo'](_0x597f3d['model']['document']['selection'],'change:range',(_0x71b972,_0x52abde)=>{_0x52abde['directChange']&&this['_refreshUserSelectionMarkers']();}),this['listenTo'](_0x597f3d['editing']['view'],'change:hasDomSelection',()=>{this['_refreshUserSelectionMarkers']();}),this['_initThrowingOnDataSet'](),_0x597f3d['plugins']['get'](_0xa729ca)['addToReconnectionStack'](this),_0x597f3d['model']['on']('applyOperation',(_0x412d26,_0x390f01)=>{const _0x4d5a64=_0x390f01[0x0];_0x4d5a64['isDocumentOperation']&&(this['_saveOperationInBuffer'](_0x4d5a64),this['_shouldSendUpdate']()&&this['_sendBufferedOperationsDelayed']());}),this['_setUpDataInit'](),this['bind']('_isEditingAllowed')['to'](_0x54dcb0,'state',this,'_hasSynchronizationProblem',(_0x59d8ec,_0x7ada4d)=>'connected'===_0x59d8ec&&!_0x7ada4d),this['on']('change:_isEditingAllowed',()=>{this['_isEditingAllowed']?_0x597f3d['disableReadOnlyMode']('rtc-offline'):_0x597f3d['enableReadOnlyMode']('rtc-offline');}),this['_isEditingAllowed']?_0x597f3d['disableReadOnlyMode']('rtc-offline'):_0x597f3d['enableReadOnlyMode']('rtc-offline'),this['set']('_isConnected',!0x1);}async['reconnect'](){const _0x5020c5=this['editor']['plugins']['get'](_0x16f399),_0x405fa2=this['editor']['plugins']['get'](_0xa729ca);try{this['_isPendingUpdate']=!0x0,_0x5020c5['unregister'](this['_channelId']);const _0x2a1ac2=await this['_service']['reconnect'](_0x405fa2['connection'],this['lastSyncVersion']);await this['_handleReconnectionResponse'](_0x2a1ac2)&&(this['_isPendingUpdate']=!0x1,this['_clearPendingAction']());const _0x4a332a=await this['_service']['getConnectedSessions']();_0x5020c5['register'](this['_channelId'],_0x4a332a),this['_handleSendingSelectionMarkers'](),this['_isConnected']=!0x0;}catch(_0x50e21a){if(function(_0x4860ed){return'404'===_0x4860ed['code'];}(_0x50e21a)&&this['sessionId'])await this['_connectAfterSessionHasBeenFlushed']();else{if(function(_0x23cb61){return'409'===_0x23cb61['code'];}(_0x50e21a)){const _0x3b26be=(0x0,this['editor']['t'])('The\x20document\x20cannot\x20be\x20connected\x20back\x20to\x20the\x20server.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');this['_handleReconnectionError'](_0x3b26be);}else{if(!(_0x50e21a instanceof V))throw _0x50e21a;this['_handleReconnectionError']();}}}}['destroy'](){const _0x3e441a=this['editor']['plugins']['get'](_0xa729ca),_0x1a0c07=this['editor']['plugins']['get'](_0x16f399);this['editor']['enableReadOnlyMode']('rtc-destroyed'),_0x1a0c07['channelSessions']['has'](this['_channelId'])&&_0x1a0c07['unregister'](this['_channelId']),_0x3e441a['removeFromReconnectionStack'](this),this['_disconnectService'](),super['destroy']();}async['_handleReconnectionResponse'](_0x4dba02){if(this['sessionId']!==_0x4dba02['sessionId']&&this['_lastSyncedOperationId']!==_0x4dba02['lastOperationId'])throw new V();return this['sessionId']=_0x4dba02['sessionId'],this['_handleServerResponse']([],{..._0x4dba02,'wereChangesApplied':!0x1,'data':_0x4dba02['data']},'reconnect');}async['_connectService'](_0x4e1ecf,_0x8f03f2=!0x1){const {connection:_0x3fb4e2}=this['editor']['plugins']['get'](_0xa729ca);l['CollaborativeEditingService']['getConnectedSessions'](_0x3fb4e2,this['_channelId'])['then'](_0x208d06=>this['_initSessionsHandling'](_0x208d06))['catch'](_0x22af99=>{this['_crash']('realtimecollaborationclient-init-session-connection-error',_0x22af99);}),this['listenTo'](this['_service'],'operationsReceived',this['_handleReceivedOperations']['bind'](this)),this['listenTo'](this['_service'],'error',(_0xe3594d,_0x41086b)=>{this['_crash']('realtimecollaborationclient-initservice-internal-error',_0x41086b);}),this['listenTo'](this['_service'],'disconnected',()=>{this['_isConnected']=!0x1;});const _0x56f055=this['_operationIdentifier']['getIdOfTheLastOperation'](_0x4e1ecf),_0x215fdd=await this['_service']['connect'](_0x3fb4e2,this['_compressOperations'](_0x4e1ecf),_0x56f055);if(this['sessionId']=_0x215fdd['sessionId'],_0x215fdd['wereChangesApplied']&&(this['_isPendingUpdate']=!0x1,this['_clearPendingAction']()),_0x8f03f2){if(!_0x215fdd['wereChangesApplied'])return void this['_handleReconnectionError']();this['_offset']=_0x215fdd['offset'],this['serverHistory']['_operations']=[],await this['_handleServerResponse'](_0x4e1ecf,_0x215fdd,'reconnection:\x20flushed\x20session');}else await this['_handleConnectionData'](_0x215fdd,_0x4e1ecf);this['_handleSendingSelectionMarkers'](),this['_isConnected']=!0x0;}['_handleSendingSelectionMarkers'](){const _0x28cc80=this['editor']['plugins']['get'](_0x16f399),_0x51d097=_0x28cc80['channelSessions']['get'](this['_channelId']);_0x51d097&&_0x51d097['length']>0x1?(this['_hasSelectionChanged']=!0x0,this['_sendBufferedOperationsDelayed']()):this['listenTo'](_0x28cc80,'sessionAdd:'+this['_channelId'],_0x4fc18a=>{_0x28cc80['channelSessions']['get'](this['_channelId'])['length']>0x1&&(this['_hasSelectionChanged']=!0x0,this['_sendBufferedOperationsDelayed'](),_0x4fc18a['off']());});}async['_handleReceivedOperations'](_0x3cebf6,_0x1fac5b,_0x3e3c94,_0x1e9633){if(!this['_isPendingUpdate']&&this['_document']['version']==_0x1fac5b){const _0x46a914=this['_decompressOperations'](_0x3e3c94,_0x1e9633);await this['_fetchMissingUsers'](_0x46a914),this['_handleExternalOperations'](_0x46a914,_0x1fac5b,_0x3e3c94['lastOperationId'])||this['_crash']('realtimecollaborationclient-initservice-incorrect-server-operation');}}async['_connectAfterSessionHasBeenFlushed'](){this['_disconnectService']();const t=this['editor']['t'];let _0x532878;try{_0x532878=await this['_service']['getDocumentDetails']();}catch(_0x3e9c12){const _0x48028a=t('The\x20document\x20details\x20could\x20not\x20be\x20taken\x20during\x20the\x20reconnection.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');return void this['_handleReconnectionError'](_0x48028a);}const _0x24e394=_0x532878['currentDocumentSession']||_0x532878['lastDocumentSession'];if(this['_lastSyncedOperationId']===_0x24e394['lastOperationId'])await this['_connectService'](this['editor']['model']['document']['history']['getOperations'](),!0x0);else{const _0x1ff873=t('The\x20last\x20saved\x20version\x20of\x20the\x20document\x20does\x20not\x20match\x20the\x20local\x20version.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');this['_handleReconnectionError'](_0x1ff873);}}['_disconnectService'](){this['_service']['disconnect'](),this['_bufferedOperations']=[],clearTimeout(this['_sendBufferedOperationsDelay']),this['stopListening'](this['_service']);}['_initSessionsHandling'](_0x3c38de){const _0x255e90=this['editor']['plugins']['get'](_0x16f399);this['listenTo'](_0x255e90,'sessionAdd:'+this['_channelId'],(_0x1e6539,{session:_0x21ec20})=>{if(_0x21ec20['id']===_0x255e90['mySessionId']){_0x1e6539['off']();const _0x5177ae=this['editor']['plugins']['has']('CommentsOnly')&&this['editor']['plugins']['get']('CommentsOnly');let _0x56aaab=_0x21ec20['permissions'];_0x5177ae&&_0x5177ae['isEnabled']&&(_0x56aaab=_0x56aaab['filter'](_0x3acc48=>'document:write'!==_0x3acc48)),this['editor']['plugins']['get']('Permissions')['setPermissions'](_0x56aaab,this['_channelId']);}}),_0x255e90['register'](this['_channelId'],_0x3c38de);}['_initThrowingOnDataSet'](){const _0x4e3b93=this['editor']['data']['set'];this['editor']['data']['set']=(..._0xc7773)=>{if(!_0xc7773[_0xc7773['length']-0x1]['suppressErrorInCollaboration'])throw new _0x2e7bb0('realtimecollaborationclient-editor-setdata-and-editor-data-set-are-forbidden-in-real-time-collaboration',this);_0x4e3b93['apply'](this['editor']['data'],_0xc7773);};}['_setUpDataInit'](){this['editor']['data']['on']('init',(_0x57bc3f,[_0xf632ee])=>{if(this['_document']['version'])throw new _0x2e7bb0('realtimecollaborationclient-init-document-already-initialized',this);_0x57bc3f['stop'](),this['_setPendingAction']();const _0x38b87c=this['_getOperationsFromInitData'](_0xf632ee);_0x57bc3f['return']=this['_connectService'](_0x38b87c)['then'](()=>{this['editor']['data']['fire']('ready');})['catch'](_0x27e08a=>this['_crash']('realtimecollaborationclient-init-connection-failed',_0x27e08a))['finally'](()=>this['_clearPendingAction']());},{'priority':'high'});}['_fetchMissingUsers'](_0x20423c){const _0x187d57=this['editor']['plugins']['get'](_0xd65c8a),{connection:_0x50f36e}=this['editor']['plugins']['get'](_0xa729ca),_0x16986d=new Set();for(const _0x5bed31 of _0x20423c)_0x598960(_0x5bed31['_authorId']);return Promise['all'](Array['from'](_0x16986d,async _0x3a20eb=>{const _0x3aa9fe=await _0x4bc824['get'](_0x50f36e,_0x3a20eb);_0x187d57['getUser'](_0x3a20eb)||_0x187d57['addUser'](_0x3aa9fe);}));function _0x598960(_0x23c39b){_0x23c39b&&!_0x187d57['getUser'](_0x23c39b)&&_0x16986d['add'](_0x23c39b);}}['_getOperationsFromInitData'](_0x2717cf){const _0x590bb3=this['editor']['model'],_0x2acd72=[];let _0x221edd=0x0;const _0x1af906='string'==typeof _0x2717cf?{'main':_0x2717cf}:_0x2717cf;for(const _0x2d070c of Object['keys'](_0x1af906)){if(!this['_document']['roots']['has'](_0x2d070c))throw new _0x2e7bb0('realtimecollaborationclient-init-non-existent-root',this);const _0x23d855=this['editor']['data']['parse'](_0x1af906[_0x2d070c]),_0xd9304a=this['_document']['getRoot'](_0x2d070c),_0x27583f=new _0x47480e(_0x590bb3['createPositionAt'](_0xd9304a,0x0),_0x23d855,_0x221edd++);_0x2acd72['push'](_0x27583f);for(const [_0x54e3b2,_0x488240]of _0x23d855['markers']){const _0x4863dd=_0x590bb3['createRange'](_0x590bb3['createPositionFromPath'](_0xd9304a,_0x488240['start']['path']['slice']()),_0x590bb3['createPositionFromPath'](_0xd9304a,_0x488240['end']['path']['slice']())),_0x5d8cb3=new _0x3f44aa(_0x54e3b2,null,_0x4863dd,_0x590bb3['markers'],!0x0,_0x221edd++);_0x2acd72['push'](_0x5d8cb3);}}return _0x2acd72;}async['_handleConnectionData'](_0x59703c,_0x2f6a91){let _0x14ae8d;this['_offset']=_0x59703c['offset'];const _0x4a5b9b=_0x59703c['wereChangesApplied']&&!_0x59703c['initData'];if(_0x4a5b9b)_0x14ae8d=_0x2f6a91;else{if(_0x59703c['initData']){const _0x2fdb34=this['_getOperationsFromInitData'](_0x59703c['initData']);this['_document']['version']=-_0x2fdb34['length'],_0x2fdb34['forEach'](_0x2095c0=>{_0x2095c0['baseVersion']-=_0x2fdb34['length'];}),this['_applyOperationsSet'](_0x2fdb34,!0x0),this['_updateServerHistory'](_0x2fdb34);}this['_document']['version']=_0x59703c['data']['baseVersion'],_0x14ae8d=this['_decompressOperations'](_0x59703c['data'],_0x59703c['metadata']),await this['_fetchMissingUsers'](_0x14ae8d);}_0x59703c['lastOperationId']&&(this['_operationIdentifier']['setIdForTheLastOperation'](_0x14ae8d,_0x59703c['lastOperationId']),this['_lastSyncedOperationId']=_0x59703c['lastOperationId']),this['_applyOperationsSet'](_0x14ae8d,_0x4a5b9b),this['_updateServerHistory'](_0x14ae8d);}['_crash'](_0x78660b,_0x457e27){throw this['_isPendingUpdate']=!0x0,_0x457e27&&console['error'](_0x457e27),new _0x2e7bb0(_0x78660b,this['editor']);}['_saveOperationInBuffer'](_0x2229cf){this['_knownOperations']['has'](_0x2229cf)||(this['_knownOperations']['add'](_0x2229cf),this['_bufferedOperations']['push'](_0x2229cf),this['_pendingAction']||'marker'==_0x2229cf['type']&&!_0x2229cf['affectsData']||this['_setPendingAction']());}['_sendBufferedOperationsDelayed'](_0x2d0d6c=!0x1){!_0x2d0d6c&&this['_isPendingUpdate']||(this['_isPendingUpdate']=!0x0,clearTimeout(this['_sendBufferedOperationsDelayId']),this['_sendBufferedOperationsDelayId']=setTimeout(()=>{this['_sendBufferedOperations']()['then'](_0x2790fd=>{_0x2790fd&&(this['_clearPendingAction'](),this['_isPendingUpdate']=!0x1);})['catch'](_0xab2630=>{if(this['_clearPendingAction'](),this['_isPendingUpdate']=!0x1,!function(_0x48c012){return _0x48c012['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x48c012['message']['startsWith']('cloud-services-internal-error:\x20Collaborative\x20Editing\x20Service\x20is\x20not\x20connected.')||_0x48c012['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.');}(_0xab2630))throw _0xab2630;});},this['_currentBufferDelay']));}async['_sendBufferedOperations'](){const _0x444360=this['editor']['plugins']['get'](_0x15642b);if(this['_shouldSendSelectionUpdate']()&&(_0x444360['createUserMarkerOperations'](),this['_hasSelectionChanged']=!0x1),!this['_shouldSendUpdate']())return!0x0;const _0x49485e=[...this['_bufferedOperations']];for(const _0x2438d6 of _0x49485e)_0x2438d6['wasUndone']=this['_document']['history']['isUndoneOperation'](_0x2438d6);const _0x401ff1=this['_operationIdentifier']['getIdOfTheLastOperation'](_0x49485e),_0xeaf572=z++,_0x2b21ad=this['_compressOperations'](_0x49485e),_0x2e5d42=await this['_service']['sendOperations'](_0x2b21ad,_0x2b21ad['baseVersion'],_0x401ff1);try{return await this['_handleServerResponse'](_0x49485e,_0x2e5d42,_0xeaf572);}catch(_0x37b23a){return this['_crash']('realtimecollaborationclient-sendbufferedoperations',_0x37b23a);}}async['_handleServerResponse'](_0x470cdd,_0x5f37d5,_0x2d6f82){if(_0x5f37d5['error'])throw _0x5f37d5['error'];let _0x1353ec=!0x1;if(_0x5f37d5['wereChangesApplied'])this['_bufferedOperations']=this['_bufferedOperations']['filter'](_0x3c6479=>!_0x470cdd['includes'](_0x3c6479)),this['_lastSyncedOperationId']=_0x5f37d5['lastOperationId'],this['_updateServerHistory'](_0x470cdd),_0x1353ec=!0x0,this['_currentBufferDelay']=this['_baseBufferDelay'];else{const _0x391b7c=this['_decompressOperations'](_0x5f37d5['data'],_0x5f37d5['metadata'])['filter'](_0x53c41a=>_0x53c41a['baseVersion']>=this['_lastServerVersion']);await this['_fetchMissingUsers'](_0x391b7c),_0x1353ec=this['_handleExternalOperations'](_0x391b7c,_0x5f37d5['version'],_0x5f37d5['lastOperationId']),this['_currentBufferDelay']=Math['round'](this['_currentBufferDelay']/0x2);}return _0x1353ec?!this['_shouldSendUpdate']()||(this['_sendBufferedOperationsDelayed'](!0x0),!0x1):this['_crash']('realtimecollaborationclient-handleserverresponse');}['_handleExternalOperations'](_0x1e691c,_0x6ec619,_0x1b66f6){try{const _0x31a127={'document':this['_document'],'useRelations':!0x1,'padWithNoOps':!0x0},{operationsA:_0x36e3b9,operationsB:_0x5ddcf0,originalOperations:_0x35ab88}=_0x2a2993(_0x1e691c,this['_bufferedOperations'],_0x31a127);W(_0x36e3b9,this['_document']['version']),W(_0x5ddcf0,_0x6ec619);for(const _0x451a4a of _0x36e3b9){const _0x3a4b44=_0x35ab88['get'](_0x451a4a);_0x451a4a['_authorId']=_0x3a4b44?_0x3a4b44['_authorId']:null;}this['_lastSyncedOperationId']=_0x1b66f6,this['_operationIdentifier']['setIdForTheLastOperation'](_0x1e691c,_0x1b66f6),this['_bufferedOperations']=[..._0x5ddcf0],this['_applyOperationsSet'](_0x36e3b9),this['_updateServerHistory'](_0x1e691c);}catch(_0x45a907){return console['error'](_0x45a907),!0x1;}return!0x0;}['_applyOperationsSet'](_0x3098f1,_0x3e4bb3=!0x1){this['editor']['model']['enqueueChange']({'isUndoable':!0x1,'isLocal':!0x1},_0xa58d9b=>{for(const _0x12fd0a of _0x3098f1)this['_knownOperations']['add'](_0x12fd0a),_0xa58d9b['batch']['addOperation'](_0x12fd0a),this['editor']['model']['applyOperation'](_0x12fd0a);});}['_updateServerHistory'](_0x1bcd2f){_0x1bcd2f['forEach'](_0x5610fe=>{const _0x2afa98=_0x5610fe['clone']();_0x2afa98['_authorId']=_0x5610fe['_authorId'],_0x2afa98['baseVersion']+=this['_offset'],_0x5610fe['isDisconnection']&&this['_disconnectionOperations']['add'](_0x2afa98),this['serverHistory']['addOperation'](_0x2afa98);});}['_handleReconnectionError'](_0x1c776b){const _0x26f684=this['editor']['plugins']['get']('Notification'),t=this['editor']['t'];_0x1c776b||(_0x1c776b=t('The\x20local\x20document\x20and\x20server\x20document\x20differ\x20and\x20merging\x20them\x20can\x20cause\x20unexpected\x20behavior.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.')),_0x26f684['showWarning'](_0x1c776b,{'title':t('Synchronization\x20issue'),'namespace':'real-time-collaboration'}),this['_hasSynchronizationProblem']=!0x0,clearTimeout(this['_sendBufferedOperationsDelayId']),this['_bufferedOperations']=[],this['editor']['plugins']['get'](_0xa729ca)['destroy']();}['_setPendingAction'](){if(!this['_pendingAction']){const {t:t}=this['editor']['locale'];this['_pendingAction']=this['editor']['plugins']['get'](_0xefef66)['add'](t({'string':'Sending\x20data\x20to\x20the\x20server.','id':'PENDING_ACTION_SENDING_DATA'}));}}['_clearPendingAction'](){this['_pendingAction']&&(this['editor']['plugins']['get'](_0xefef66)['remove'](this['_pendingAction']),this['_pendingAction']=null);}['_compressOperations'](_0x4925f9){const _0x250270=_0x4925f9['map'](_0x5e07e6=>_0x5e07e6['toJSON']());return this['_compressor']['compress'](_0x250270);}['_decompressOperations'](_0x18c504,_0x2973f3){const _0x1a857f=this['_compressor']['decompress'](_0x18c504)['map']((_0x73d905,_0x18feac)=>{const _0x2c137e=_0x2cb81c['fromJSON'](_0x73d905,this['_document']);return _0x2c137e['wasUndone']=_0x73d905['wasUndone'],'cs:removeUser'===_0x2973f3[_0x18feac]['type']&&(_0x2c137e['isDisconnection']=!0x0),_0x2c137e;});return this['_assignOperationAuthors'](_0x1a857f,_0x2973f3),_0x1a857f;}['_assignOperationAuthors'](_0xdcb08d,_0x7961aa){for(let _0xfca7d4=0x0;_0xfca7d4<_0xdcb08d['length'];_0xfca7d4++)'init'!=_0x7961aa[_0xfca7d4]['type']?_0xdcb08d[_0xfca7d4]['_authorId']=_0x7961aa[_0xfca7d4]['userId']:_0xdcb08d[_0xfca7d4]['_authorId']=null;}['_refreshUserSelectionMarkers'](){this['_hasSelectionChanged']=!0x0,this['_shouldSendSelectionUpdate']()&&this['_sendBufferedOperationsDelayed']();}['_shouldSendSelectionUpdate'](){const _0x543381=this['editor']['plugins']['get'](_0x16f399)['channelSessions']['get'](this['_channelId']);return!this['editor']['isReadOnly']&&_0x543381&&_0x543381['length']>0x1&&this['_hasSelectionChanged'];}['_shouldSendUpdate'](){return this['_bufferedOperations']['length']>0x0||this['_shouldSendSelectionUpdate']();}}class V extends Error{}function W(_0x1ecadb,_0x18fb4d){for(const _0x45d3a0 of _0x1ecadb)_0x45d3a0['baseVersion']=_0x18fb4d++;}l['CollaborativeEditingService']=_0x36634c;class F{constructor(_0x45d3d9){this['_ignoredOperations']=_0x45d3d9,this['_operationToId']=new WeakMap();}['getIdOfTheLastOperation'](_0x4ed2e5){let _0x3c970c=_0x4ed2e5['length'];for(;_0x3c970c--;){const _0xa86898=_0x4ed2e5[_0x3c970c];if(!this['_ignoredOperations']['has'](_0xa86898)){if(!this['_operationToId']['has'](_0xa86898)){const _0x3b449b=_0xb413bf()['slice'](0x1,0x12);this['_operationToId']['set'](_0xa86898,_0x3b449b);}return this['_operationToId']['get'](_0xa86898);}}}['setIdForTheLastOperation'](_0x125d2d,_0x4f4dc2){if(!_0x4f4dc2)return;let _0x35caeb=_0x125d2d['length'];for(;_0x35caeb--;){const _0x3b2f71=_0x125d2d[_0x35caeb];this['_ignoredOperations']['has'](_0x3b2f71)||this['_operationToId']['set'](_0x3b2f71,_0x4f4dc2);}}}