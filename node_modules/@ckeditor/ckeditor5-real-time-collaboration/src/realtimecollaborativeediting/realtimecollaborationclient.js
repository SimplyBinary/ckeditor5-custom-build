/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x19de=['from','apply','collaboration.channelId','enableReadOnlyMode','_currentBufferDelay','_hasSynchronizationProblem','_crash','disconnect','createUserMarkerOperations','realtimecollaborationclient-initservice-incorrect-server-operation','_shouldSendUpdate','_connectService','getOperationAuthor','_saveOperationInBuffer','_updateServerHistory','editor','_lastServerVersion','_handleExternalOperations','_initThrowingOnDataSet','_isConnected','The\x20last\x20saved\x20version\x20of\x20the\x20document\x20does\x20not\x20match\x20the\x20local\x20version.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.','_knownOperations','_setUpDataInit','_ignoredOperations','compress','permissions','version','_operationIdentifier','_handleServerResponse','_shouldSendSelectionUpdate','code','sendOperations','change:_isEditingAllowed','high','_handleSendingSelectionMarkers','mySessionId','unregister','realtimecollaborationclient-handleserverresponse','markers','sessionId','Synchronization\x20issue','reconnect','lastOperationAcceptedAt','round','CollaborativeEditingService','wereChangesApplied','The\x20document\x20details\x20could\x20not\x20be\x20taken\x20during\x20the\x20reconnection.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.','RealTimeCollaborationClient','off','_applyOperationsSet','offset','getOperations','suppressErrorInCollaboration','sessionCreatedAt','parse','has','_channelId','plugins','message','getUser','_isInit','real-time-collaboration','getConnectedSessions','then','disableReadOnlyMode','_refreshUserSelectionMarkers','config','_sendBufferedOperationsDelayId','_fetchMissingUsers','length','cloudDocumentVersion','_compressOperations','_offset','lastDocumentSession','map','realtimecollaborationclient-init-session-connection-error','_isPendingUpdate','initData','history','409','Notification','change:range','baseVersion','wasUndone','fromJSON','enqueueChange','disconnected','model','register','_service','serverHistory','_disconnectionOperations','_disconnectService','createPositionFromPath','type','document:write','isReadOnly','rtc-offline','sessionAdd:','lastSyncVersion','realtimecollaborationclient-init-connection-failed','applyOperation','_handleReconnectionResponse','CommentsOnly','currentDocumentSession','cloud-services-internal-error:\x20Not\x20connected.','forEach','_pendingAction','createPositionAt','_bufferedOperations','fire','remove','_connectAfterSessionHasBeenFlushed','PENDING_ACTION_SENDING_DATA','_setPendingAction','filter','realtimecollaborationclient-sendbufferedoperations','_operationToId','_lastSyncedOperationId','_assignOperationsMetaData','cloud-services-internal-error:\x20Collaborative\x20Editing\x20Service\x20is\x20not\x20connected.','listenTo','_sendBufferedOperations','_hasSelectionChanged','document','init','requires','removeFromReconnectionStack','end','_decompressOperations','reset','userId','isEnabled','setIdForTheLastOperation','includes','slice','collaboration','_sendBufferedOperationsDelayed','isUndoneOperation','string','catch','clone','start','batch','_isEditingAllowed','get','_handleInitialConnectionData','cloudServices.bundleVersion','_isDisconnection','channelSessions','_compressor','The\x20document\x20cannot\x20be\x20connected\x20back\x20to\x20the\x20server.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.','lastOperationId','reconnection:\x20flushed\x20session','_authorId','showWarning','path','_handleReceivedOperations','_getOperationsFromInitData','locale','_document','define','stop','realtimecollaborationclient-init-non-existent-root','_initSessionsHandling','addToReconnectionStack','_clearPendingAction','connection','_handleReconnectionError','connect','editing','add','view','data','_sendBufferedOperationsDelay','selection','rtc-destroyed','toJSON','_baseBufferDelay','createdAt','error','decompress','all','change:hasDomSelection','affectsData','metadata','set','addOperation','return','stopListening','bind','The\x20local\x20document\x20and\x20server\x20document\x20differ\x20and\x20merging\x20them\x20can\x20cause\x20unexpected\x20behavior.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.','startsWith','destroy','push','getIdOfTheLastOperation','keys'];(function(_0x3d23af,_0x19dee2){const _0x3d5ac6=function(_0xca9f99){while(--_0xca9f99){_0x3d23af['push'](_0x3d23af['shift']());}};_0x3d5ac6(++_0x19dee2);}(_0x19de,0x165));const _0x3d5a=function(_0x3d23af,_0x19dee2){_0x3d23af=_0x3d23af-0x0;let _0x3d5ac6=_0x19de[_0x3d23af];return _0x3d5ac6;};import{Plugin as _0x58cdf9,PendingActions as _0x59d552}from'ckeditor5/src/core';import{CKEditorError as _0x4c4a96,version as _0x321831,uid as _0x4441a3}from'ckeditor5/src/utils';import{transformSets as _0x78c8c8,InsertOperation as _0x341c7a,MarkerOperation as _0x482fae,OperationFactory as _0x333c15,History as _0x350269}from'ckeditor5/src/engine';import{Notification as _0x4097ba}from'ckeditor5/src/ui';import{Users as _0xec304a}from'ckeditor5-collaboration/src/collaboration-core';import _0x5936d9 from'./websocketgateway';import _0x2d0edd from'./sessions';import _0x1bba0d from'./usermarkers';import{getTranslation as _0x3f0415}from'../common-translations';import _0x34e791 from'@ckeditor/ckeditor5-operations-compressor/src/compressor';import _0x743d35 from'@ckeditor/ckeditor-cloud-services-collaboration/src/collaborativeeditingservice/collaborativeeditingservice';import _0x27d0f5 from'@ckeditor/ckeditor-cloud-services-collaboration/src/users/user';let Q=0x1;export default class l extends _0x58cdf9{static get[_0x3d5a('0xa3')](){return[_0x5936d9,_0x2d0edd,_0x1bba0d,_0x59d552,_0xec304a,_0x4097ba];}static get['pluginName'](){return _0x3d5a('0x54');}get[_0x3d5a('0x6b')](){return this[_0x3d5a('0x35')]+this['_offset'];}get[_0x3d5a('0x35')](){return this['serverHistory'][_0x3d5a('0x3f')]-this[_0x3d5a('0x6d')];}get['lastSyncVersion'](){const _0x54ac98=this[_0x3d5a('0x7f')][_0x3d5a('0x58')]();for(let _0x26d73b=_0x54ac98[_0x3d5a('0x6a')]-0x1;_0x26d73b>=0x0;_0x26d73b--){const _0x423dc8=_0x54ac98[_0x26d73b];if(!this[_0x3d5a('0x80')][_0x3d5a('0x5c')](_0x423dc8))return _0x423dc8[_0x3d5a('0x77')]+0x1-this[_0x3d5a('0x6d')];}return 0x0;}[_0x3d5a('0xa2')](){const _0x46bedd=this[_0x3d5a('0x34')],_0x27415e=_0x46bedd['plugins'][_0x3d5a('0xb6')](_0xec304a),_0x4e303e=_0x46bedd['plugins'][_0x3d5a('0xb6')](_0x5936d9);if(this[_0x3d5a('0x6d')]=0x0,this[_0x3d5a('0x4c')]=null,this['serverHistory']=new _0x350269(),this[_0x3d5a('0x34')][_0x3d5a('0x67')][_0x3d5a('0x1')](_0x3d5a('0xad'),{}),this[_0x3d5a('0x5d')]=_0x46bedd[_0x3d5a('0x67')][_0x3d5a('0xb6')](_0x3d5a('0x27')),!this[_0x3d5a('0x5d')])throw new _0x4c4a96('collaboration-missing-channelid',this);this[_0x3d5a('0x9e')](_0x27415e,_0x3d5a('0x31'),(_0x29f14d,_0x59d318)=>{const _0x171aa0=_0x59d318[0x0];_0x171aa0[_0x3d5a('0xbf')]&&(_0x29f14d['return']=_0x27415e[_0x3d5a('0x60')](_0x171aa0[_0x3d5a('0xbf')]),_0x29f14d[_0x3d5a('0x2')]()),null===_0x171aa0['_authorId']&&(_0x29f14d[_0x3d5a('0x1c')]=null,_0x29f14d[_0x3d5a('0x2')]());},{'priority':_0x3d5a('0x46')});const _0x38c937=_0x46bedd[_0x3d5a('0x67')][_0x3d5a('0xb6')](_0x3d5a('0xb8'))||_0x321831;this[_0x3d5a('0x7e')]=new l[(_0x3d5a('0x51'))](_0x38c937,this[_0x3d5a('0x5d')]),this[_0x3d5a('0x0')]=this['editor'][_0x3d5a('0x7c')][_0x3d5a('0xa1')],this[_0x3d5a('0xbb')]=new _0x34e791(),this['_bufferedOperations']=[],this['_knownOperations']=new WeakSet(),this[_0x3d5a('0x1a')](_0x3d5a('0x71'),!0x1),this[_0x3d5a('0x1a')]('_hasSynchronizationProblem',!0x1),this[_0x3d5a('0x90')]=null,this[_0x3d5a('0xa0')]=!0x1,this['_sendBufferedOperationsDelayId']=null,this[_0x3d5a('0x12')]=0x12c,this[_0x3d5a('0x29')]=this[_0x3d5a('0x12')],this['_lastSyncedOperationId']=null,this['_disconnectionOperations']=new WeakSet(),this[_0x3d5a('0x40')]=new Z(this[_0x3d5a('0x80')]),this['listenTo'](_0x46bedd[_0x3d5a('0x7c')][_0x3d5a('0xa1')][_0x3d5a('0xf')],_0x3d5a('0x76'),(_0x5f7217,_0xb28d12)=>{_0xb28d12['directChange']&&this[_0x3d5a('0x66')]();}),this[_0x3d5a('0x9e')](_0x46bedd[_0x3d5a('0xa')][_0x3d5a('0xc')],_0x3d5a('0x17'),()=>{this['_refreshUserSelectionMarkers']();}),this['_initThrowingOnDataSet'](),_0x46bedd[_0x3d5a('0x5e')][_0x3d5a('0xb6')](_0x5936d9)[_0x3d5a('0x5')](this),_0x46bedd['model']['on'](_0x3d5a('0x8a'),(_0x53e987,_0x42d478)=>{const _0x262abe=_0x42d478[0x0];_0x262abe['isDocumentOperation']&&(this[_0x3d5a('0x32')](_0x262abe),this[_0x3d5a('0x2f')]()&&this[_0x3d5a('0xae')]());}),this[_0x3d5a('0x3b')](),this[_0x3d5a('0x1e')](_0x3d5a('0xb5'))['to'](_0x4e303e,'state',this,_0x3d5a('0x2a'),(_0x1cf9ea,_0x24ab78)=>'connected'===_0x1cf9ea&&!_0x24ab78),this['on'](_0x3d5a('0x45'),()=>{this[_0x3d5a('0xb5')]?_0x46bedd[_0x3d5a('0x65')](_0x3d5a('0x86')):_0x46bedd[_0x3d5a('0x28')]('rtc-offline');}),this[_0x3d5a('0xb5')]?_0x46bedd[_0x3d5a('0x65')](_0x3d5a('0x86')):_0x46bedd['enableReadOnlyMode']('rtc-offline'),this[_0x3d5a('0x1a')]('_isConnected',!0x1);}async['reconnect'](){const _0x166ef2=this['editor']['plugins']['get'](_0x2d0edd),_0x37ad36=this['editor'][_0x3d5a('0x5e')][_0x3d5a('0xb6')](_0x5936d9);try{this['_isPendingUpdate']=!0x0,_0x166ef2[_0x3d5a('0x49')](this[_0x3d5a('0x5d')]);const _0x130afc=await this['_service'][_0x3d5a('0x4e')](_0x37ad36[_0x3d5a('0x7')],this[_0x3d5a('0x88')]);await this[_0x3d5a('0x8b')](_0x130afc)&&(this[_0x3d5a('0x71')]=!0x1,this[_0x3d5a('0x6')]());const _0x5c300b=await this['_service'][_0x3d5a('0x63')]();_0x166ef2[_0x3d5a('0x7d')](this[_0x3d5a('0x5d')],_0x5c300b),this[_0x3d5a('0x47')](),this[_0x3d5a('0x38')]=!0x0;}catch(_0x378ab2){if(function(_0x5b78d2){return'404'===_0x5b78d2[_0x3d5a('0x43')];}(_0x378ab2)&&this[_0x3d5a('0x4c')])await this[_0x3d5a('0x95')]();else{if(function(_0x3c210a){return _0x3d5a('0x74')===_0x3c210a[_0x3d5a('0x43')];}(_0x378ab2)){const _0x4a11cf=_0x3f0415(this[_0x3d5a('0x34')]['locale'],_0x3d5a('0xbc'));this[_0x3d5a('0x8')](_0x4a11cf);}else{if(!(_0x378ab2 instanceof X))throw _0x378ab2;this[_0x3d5a('0x8')]();}}}}['destroy'](){const _0x1739f2=this[_0x3d5a('0x34')][_0x3d5a('0x5e')]['get'](_0x5936d9),_0x457545=this['editor'][_0x3d5a('0x5e')][_0x3d5a('0xb6')](_0x2d0edd);this[_0x3d5a('0x34')][_0x3d5a('0x28')](_0x3d5a('0x10')),_0x457545['channelSessions'][_0x3d5a('0x5c')](this['_channelId'])&&_0x457545['unregister'](this[_0x3d5a('0x5d')]),_0x1739f2[_0x3d5a('0xa4')](this),this[_0x3d5a('0x81')](),super[_0x3d5a('0x21')]();}async['_handleReconnectionResponse'](_0x20bd6c){if(this['sessionId']!==_0x20bd6c['sessionId']&&this[_0x3d5a('0x9b')]!==_0x20bd6c[_0x3d5a('0xbd')])throw new X();return this['sessionId']=_0x20bd6c[_0x3d5a('0x4c')],this[_0x3d5a('0x41')]([],{..._0x20bd6c,'wereChangesApplied':!0x1,'data':_0x20bd6c[_0x3d5a('0xd')]},_0x3d5a('0x4e'));}async[_0x3d5a('0x30')](_0x5c6045,_0x333c32=!0x1){const {connection:_0x4a0670}=this[_0x3d5a('0x34')]['plugins'][_0x3d5a('0xb6')](_0x5936d9);l['CollaborativeEditingService'][_0x3d5a('0x63')](_0x4a0670,this[_0x3d5a('0x5d')])[_0x3d5a('0x64')](_0x18b35c=>this[_0x3d5a('0x4')](_0x18b35c))['catch'](_0x453fbb=>{this[_0x3d5a('0x2b')](_0x3d5a('0x70'),_0x453fbb);}),this['listenTo'](this['_service'],'operationsReceived',this[_0x3d5a('0xc2')][_0x3d5a('0x1e')](this)),this['listenTo'](this['_service'],_0x3d5a('0x14'),(_0x28f04f,_0x4cd8c4)=>{this[_0x3d5a('0x2b')]('realtimecollaborationclient-initservice-internal-error',_0x4cd8c4);}),this['listenTo'](this[_0x3d5a('0x7e')],_0x3d5a('0x7b'),()=>{this[_0x3d5a('0x38')]=!0x1;});const _0x4b84e7=this[_0x3d5a('0x40')]['getIdOfTheLastOperation'](_0x5c6045),_0xa97591=await this['_service'][_0x3d5a('0x9')](_0x4a0670,this[_0x3d5a('0x6c')](_0x5c6045),_0x4b84e7);if(this[_0x3d5a('0x4c')]=_0xa97591[_0x3d5a('0x4c')],_0xa97591[_0x3d5a('0x52')]&&(this[_0x3d5a('0x71')]=!0x1,this[_0x3d5a('0x6')]()),_0x333c32){if(!_0xa97591[_0x3d5a('0x52')])return void this['_handleReconnectionError']();this['serverHistory'][_0x3d5a('0xa7')](),this[_0x3d5a('0x6d')]=_0xa97591[_0x3d5a('0x57')],this[_0x3d5a('0x7f')][_0x3d5a('0x3f')]=this[_0x3d5a('0x6d')],await this['_handleServerResponse'](_0x5c6045,_0xa97591,_0x3d5a('0xbe'));}else await this[_0x3d5a('0xb7')](_0xa97591,_0x5c6045);this[_0x3d5a('0x47')](),this[_0x3d5a('0x38')]=!0x0;}[_0x3d5a('0x47')](){const _0x3f01a8=this[_0x3d5a('0x34')][_0x3d5a('0x5e')]['get'](_0x2d0edd),_0x3b7524=_0x3f01a8[_0x3d5a('0xba')][_0x3d5a('0xb6')](this[_0x3d5a('0x5d')]);_0x3b7524&&_0x3b7524[_0x3d5a('0x6a')]>0x1?(this[_0x3d5a('0xa0')]=!0x0,this[_0x3d5a('0xae')]()):this[_0x3d5a('0x9e')](_0x3f01a8,_0x3d5a('0x87')+this[_0x3d5a('0x5d')],_0x5e93be=>{_0x3f01a8[_0x3d5a('0xba')][_0x3d5a('0xb6')](this[_0x3d5a('0x5d')])[_0x3d5a('0x6a')]>0x1&&(this[_0x3d5a('0xa0')]=!0x0,this['_sendBufferedOperationsDelayed'](),_0x5e93be['off']());});}async['_handleReceivedOperations'](_0x553bb0,_0x109e0f,_0x35bfac,_0x3d58a6){if(!this['_isPendingUpdate']&&this[_0x3d5a('0x0')][_0x3d5a('0x3f')]==_0x109e0f){const _0x50faa=this[_0x3d5a('0xa6')](_0x35bfac,_0x3d58a6);await this['_fetchMissingUsers'](_0x50faa),this[_0x3d5a('0x36')](_0x50faa,_0x109e0f,_0x35bfac[_0x3d5a('0xbd')])||this[_0x3d5a('0x2b')](_0x3d5a('0x2e'));}}async[_0x3d5a('0x95')](){this['_disconnectService']();const {locale:_0xa38b33}=this[_0x3d5a('0x34')];let _0x3678d;try{_0x3678d=await this['_service']['getDocumentDetails']();}catch(_0x569a37){const _0xa8a046=_0x3f0415(_0xa38b33,_0x3d5a('0x53'));return void this[_0x3d5a('0x8')](_0xa8a046);}const _0x12845b=_0x3678d[_0x3d5a('0x8d')]||_0x3678d[_0x3d5a('0x6e')];if(this[_0x3d5a('0x9b')]===_0x12845b['lastOperationId'])await this['_connectService'](this['editor']['model'][_0x3d5a('0xa1')]['history'][_0x3d5a('0x58')](),!0x0);else{const _0x4d7905=_0x3f0415(_0xa38b33,_0x3d5a('0x39'));this['_handleReconnectionError'](_0x4d7905);}}[_0x3d5a('0x81')](){this[_0x3d5a('0x7e')][_0x3d5a('0x2c')](),this['_bufferedOperations']=[],clearTimeout(this[_0x3d5a('0xe')]),this[_0x3d5a('0x1d')](this[_0x3d5a('0x7e')]);}[_0x3d5a('0x4')](_0x1f0096){const _0x21867d=this[_0x3d5a('0x34')][_0x3d5a('0x5e')][_0x3d5a('0xb6')](_0x2d0edd);this[_0x3d5a('0x9e')](_0x21867d,'sessionAdd:'+this['_channelId'],(_0x2b11c9,{session:_0x572845})=>{if(_0x572845['id']===_0x21867d[_0x3d5a('0x48')]){_0x2b11c9[_0x3d5a('0x55')]();const _0x363667=this[_0x3d5a('0x34')][_0x3d5a('0x5e')]['has'](_0x3d5a('0x8c'))&&this[_0x3d5a('0x34')][_0x3d5a('0x5e')][_0x3d5a('0xb6')](_0x3d5a('0x8c'));let _0x545af4=_0x572845[_0x3d5a('0x3e')];_0x363667&&_0x363667[_0x3d5a('0xa9')]&&(_0x545af4=_0x545af4[_0x3d5a('0x98')](_0x552438=>_0x3d5a('0x84')!==_0x552438)),this['editor'][_0x3d5a('0x5e')]['get']('Permissions')['setPermissions'](_0x545af4,this[_0x3d5a('0x5d')]);}}),_0x21867d['register'](this[_0x3d5a('0x5d')],_0x1f0096);}[_0x3d5a('0x37')](){const _0x441025=this[_0x3d5a('0x34')][_0x3d5a('0xd')][_0x3d5a('0x1a')];this[_0x3d5a('0x34')][_0x3d5a('0xd')][_0x3d5a('0x1a')]=(..._0x2fc0a9)=>{if(!_0x2fc0a9[_0x2fc0a9['length']-0x1][_0x3d5a('0x59')])throw new _0x4c4a96('realtimecollaborationclient-editor-setdata-and-editor-data-set-are-forbidden-in-real-time-collaboration',this);_0x441025[_0x3d5a('0x26')](this[_0x3d5a('0x34')][_0x3d5a('0xd')],_0x2fc0a9);};}['_setUpDataInit'](){this['editor'][_0x3d5a('0xd')]['on']('init',(_0x3c9837,[_0xe37df8])=>{if(this[_0x3d5a('0x0')]['version'])throw new _0x4c4a96('realtimecollaborationclient-init-document-already-initialized',this);_0x3c9837[_0x3d5a('0x2')](),this['_setPendingAction']();const _0x2added=this[_0x3d5a('0xc3')](_0xe37df8);_0x3c9837[_0x3d5a('0x1c')]=this[_0x3d5a('0x30')](_0x2added)[_0x3d5a('0x64')](()=>{this['editor'][_0x3d5a('0xd')][_0x3d5a('0x93')]('ready');})[_0x3d5a('0xb1')](_0x497ab7=>this[_0x3d5a('0x2b')](_0x3d5a('0x89'),_0x497ab7))['finally'](()=>this[_0x3d5a('0x6')]());},{'priority':_0x3d5a('0x46')});}[_0x3d5a('0x69')](_0x5acf4a){const _0x2bac26=this['editor'][_0x3d5a('0x5e')][_0x3d5a('0xb6')](_0xec304a),{connection:_0x4bd42b}=this[_0x3d5a('0x34')][_0x3d5a('0x5e')][_0x3d5a('0xb6')](_0x5936d9),_0x4bd2bf=new Set();for(const _0x1ffb7f of _0x5acf4a)_0x3d7738(_0x1ffb7f[_0x3d5a('0xbf')]);return Promise[_0x3d5a('0x16')](Array[_0x3d5a('0x25')](_0x4bd2bf,async _0x1784b5=>{const _0x4f740f=await _0x27d0f5[_0x3d5a('0xb6')](_0x4bd42b,_0x1784b5);_0x2bac26[_0x3d5a('0x60')](_0x1784b5)||_0x2bac26['addUser'](_0x4f740f);}));function _0x3d7738(_0x425de5){_0x425de5&&!_0x2bac26[_0x3d5a('0x60')](_0x425de5)&&_0x4bd2bf[_0x3d5a('0xb')](_0x425de5);}}[_0x3d5a('0xc3')](_0x580de8){const _0x7c8d01=this[_0x3d5a('0x34')][_0x3d5a('0x7c')],_0xec8297=[];let _0x23f97=0x0;const _0xfab42d=_0x3d5a('0xb0')==typeof _0x580de8?{'main':_0x580de8}:_0x580de8;for(const _0x33f228 of Object[_0x3d5a('0x24')](_0xfab42d)){if(!this[_0x3d5a('0x0')]['roots'][_0x3d5a('0x5c')](_0x33f228))throw new _0x4c4a96(_0x3d5a('0x3'),this);const _0x59a23e=this['editor'][_0x3d5a('0xd')][_0x3d5a('0x5b')](_0xfab42d[_0x33f228]),_0x50c1f2=this[_0x3d5a('0x0')]['getRoot'](_0x33f228),_0x333e9a=new _0x341c7a(_0x7c8d01[_0x3d5a('0x91')](_0x50c1f2,0x0),_0x59a23e,_0x23f97++);_0xec8297['push'](_0x333e9a);for(const [_0xc6456c,_0x234c4b]of _0x59a23e[_0x3d5a('0x4b')]){const _0x4f3789=_0x7c8d01['createRange'](_0x7c8d01[_0x3d5a('0x82')](_0x50c1f2,_0x234c4b[_0x3d5a('0xb3')][_0x3d5a('0xc1')][_0x3d5a('0xac')]()),_0x7c8d01[_0x3d5a('0x82')](_0x50c1f2,_0x234c4b[_0x3d5a('0xa5')][_0x3d5a('0xc1')][_0x3d5a('0xac')]())),_0x37188d=new _0x482fae(_0xc6456c,null,_0x4f3789,_0x7c8d01[_0x3d5a('0x4b')],!0x0,_0x23f97++);_0xec8297[_0x3d5a('0x22')](_0x37188d);}}return _0xec8297;}async[_0x3d5a('0xb7')](_0x19ec08,_0x4a182c){let _0x5110d4;this[_0x3d5a('0x6d')]=_0x19ec08[_0x3d5a('0x57')];const _0x1a938b=_0x19ec08[_0x3d5a('0x52')]&&!_0x19ec08[_0x3d5a('0x72')],_0x55bee7=_0x1a938b?0x0:_0x19ec08[_0x3d5a('0xd')][_0x3d5a('0x77')];if(_0x1a938b)_0x5110d4=_0x4a182c,_0x5110d4[_0x3d5a('0x8f')](_0x17efc2=>{_0x17efc2[_0x3d5a('0x13')]=_0x19ec08[_0x3d5a('0x5a')],_0x17efc2[_0x3d5a('0x61')]=!0x0,_0x17efc2[_0x3d5a('0xbf')]=null;}),this['_applyOperationsSet'](_0x5110d4,_0x1a938b);else{if(_0x19ec08['initData']){const _0x2bd19d=this['_getOperationsFromInitData'](_0x19ec08[_0x3d5a('0x72')]);this[_0x3d5a('0x0')]['history'][_0x3d5a('0x3f')]=-_0x2bd19d['length'],_0x2bd19d['forEach'](_0x223ed5=>{_0x223ed5['baseVersion']-=_0x2bd19d['length'],_0x223ed5[_0x3d5a('0x13')]=_0x19ec08[_0x3d5a('0x5a')],_0x223ed5[_0x3d5a('0x61')]=!0x0,_0x223ed5['_authorId']=null;}),this['_applyOperationsSet'](_0x2bd19d,!0x0),this[_0x3d5a('0x7f')][_0x3d5a('0x3f')]=-_0x2bd19d['length']+this[_0x3d5a('0x6d')],this[_0x3d5a('0x33')](_0x2bd19d);}this[_0x3d5a('0x0')]['history'][_0x3d5a('0x3f')]=_0x55bee7,_0x5110d4=this[_0x3d5a('0xa6')](_0x19ec08[_0x3d5a('0xd')],_0x19ec08[_0x3d5a('0x19')]),await this[_0x3d5a('0x69')](_0x5110d4),this['_applyOperationsSet'](_0x5110d4,_0x1a938b);}_0x19ec08[_0x3d5a('0xbd')]&&(this[_0x3d5a('0x40')]['setIdForTheLastOperation'](_0x5110d4,_0x19ec08['lastOperationId']),this[_0x3d5a('0x9b')]=_0x19ec08[_0x3d5a('0xbd')]),this[_0x3d5a('0x7f')]['version']=_0x55bee7+this[_0x3d5a('0x6d')],this['_updateServerHistory'](_0x5110d4);}['_crash'](_0x23f183,_0x263761){throw this[_0x3d5a('0x71')]=!0x0,_0x263761&&console[_0x3d5a('0x14')](_0x263761),new _0x4c4a96(_0x23f183,this['editor']);}[_0x3d5a('0x32')](_0x23176b){this['_knownOperations'][_0x3d5a('0x5c')](_0x23176b)||(this['_knownOperations']['add'](_0x23176b),this['_bufferedOperations'][_0x3d5a('0x22')](_0x23176b),this[_0x3d5a('0x90')]||'marker'==_0x23176b[_0x3d5a('0x83')]&&!_0x23176b[_0x3d5a('0x18')]||this[_0x3d5a('0x97')]());}['_sendBufferedOperationsDelayed'](_0x2f6747=!0x1){!_0x2f6747&&this['_isPendingUpdate']||(this['_isPendingUpdate']=!0x0,clearTimeout(this[_0x3d5a('0x68')]),this[_0x3d5a('0x68')]=setTimeout(()=>{this[_0x3d5a('0x9f')]()[_0x3d5a('0x64')](_0x45442f=>{_0x45442f&&(this[_0x3d5a('0x6')](),this[_0x3d5a('0x71')]=!0x1);})[_0x3d5a('0xb1')](_0x3ab6c7=>{if(this['_clearPendingAction'](),this[_0x3d5a('0x71')]=!0x1,!function(_0x2b904d){return _0x2b904d[_0x3d5a('0x5f')][_0x3d5a('0x20')](_0x3d5a('0x8e'))||_0x2b904d['message'][_0x3d5a('0x20')](_0x3d5a('0x9d'))||_0x2b904d['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.');}(_0x3ab6c7))throw _0x3ab6c7;});},this[_0x3d5a('0x29')]));}async[_0x3d5a('0x9f')](){const _0x56dc8f=this['editor'][_0x3d5a('0x5e')][_0x3d5a('0xb6')](_0x1bba0d);if(this[_0x3d5a('0x42')]()&&(_0x56dc8f[_0x3d5a('0x2d')](),this[_0x3d5a('0xa0')]=!0x1),!this['_shouldSendUpdate']())return!0x0;const _0xd2ac90=[...this[_0x3d5a('0x92')]];for(const _0x347a91 of _0xd2ac90)_0x347a91[_0x3d5a('0x78')]=this[_0x3d5a('0x0')][_0x3d5a('0x73')][_0x3d5a('0xaf')](_0x347a91);const _0xdf6d3c=this['_operationIdentifier']['getIdOfTheLastOperation'](_0xd2ac90),_0x4752a4=Q++,_0x2939ca=this['_compressOperations'](_0xd2ac90),_0xfe6323=await this['_service'][_0x3d5a('0x44')](_0x2939ca,_0x2939ca['baseVersion'],_0xdf6d3c);try{return await this['_handleServerResponse'](_0xd2ac90,_0xfe6323,_0x4752a4);}catch(_0x3a6c36){return this['_crash'](_0x3d5a('0x99'),_0x3a6c36);}}async[_0x3d5a('0x41')](_0x918e0f,_0x1319db,_0x1f3f38){if(_0x1319db[_0x3d5a('0x14')])throw _0x1319db['error'];let _0x83b6e7=!0x1;if(_0x1319db[_0x3d5a('0x52')]){_0x1319db[_0x3d5a('0xbd')]&&(this[_0x3d5a('0x9b')]=_0x1319db['lastOperationId']),this[_0x3d5a('0x92')]=this[_0x3d5a('0x92')]['filter'](_0x5dabaf=>!_0x918e0f[_0x3d5a('0xab')](_0x5dabaf));for(const _0x50460e of _0x918e0f)_0x50460e[_0x3d5a('0x13')]=_0x1319db[_0x3d5a('0x4f')];this[_0x3d5a('0x33')](_0x918e0f),_0x83b6e7=!0x0,this[_0x3d5a('0x29')]=this[_0x3d5a('0x12')];}else{const _0x5f3567=this[_0x3d5a('0xa6')](_0x1319db[_0x3d5a('0xd')],_0x1319db[_0x3d5a('0x19')])[_0x3d5a('0x98')](_0x44faec=>_0x44faec[_0x3d5a('0x77')]>=this[_0x3d5a('0x35')]);await this[_0x3d5a('0x69')](_0x5f3567),_0x83b6e7=this[_0x3d5a('0x36')](_0x5f3567,_0x1319db[_0x3d5a('0x3f')],_0x1319db['lastOperationId']),this[_0x3d5a('0x29')]=Math[_0x3d5a('0x50')](this[_0x3d5a('0x29')]/0x2);}return _0x83b6e7?!this[_0x3d5a('0x2f')]()||(this['_sendBufferedOperationsDelayed'](!0x0),!0x1):this[_0x3d5a('0x2b')](_0x3d5a('0x4a'));}[_0x3d5a('0x36')](_0x311599,_0x46f149,_0x1babd8){try{const _0x55d457={'document':this['_document'],'useRelations':!0x1,'padWithNoOps':!0x0},{operationsA:_0x54f139,operationsB:_0xb7eedb,originalOperations:_0x2cb409}=_0x78c8c8(_0x311599,this[_0x3d5a('0x92')],_0x55d457);Y(_0x54f139,this[_0x3d5a('0x0')][_0x3d5a('0x3f')]),Y(_0xb7eedb,_0x46f149);for(const _0xa56243 of _0x54f139){const _0x31c286=_0x2cb409[_0x3d5a('0xb6')](_0xa56243);_0xa56243[_0x3d5a('0xbf')]=_0x31c286?_0x31c286['_authorId']:null;}_0x1babd8&&(this[_0x3d5a('0x40')][_0x3d5a('0xaa')](_0x311599,_0x1babd8),this[_0x3d5a('0x9b')]=_0x1babd8),this[_0x3d5a('0x92')]=[..._0xb7eedb],this[_0x3d5a('0x56')](_0x54f139),this[_0x3d5a('0x33')](_0x311599);}catch(_0x4159f7){return console[_0x3d5a('0x14')](_0x4159f7),!0x1;}return!0x0;}[_0x3d5a('0x56')](_0x38f4d5,_0x1db95c=!0x1){this[_0x3d5a('0x34')][_0x3d5a('0x7c')][_0x3d5a('0x7a')]({'isUndoable':!0x1,'isLocal':!0x1},_0x32aa42=>{for(const _0x576200 of _0x38f4d5)this[_0x3d5a('0x3a')]['add'](_0x576200),_0x32aa42[_0x3d5a('0xb4')][_0x3d5a('0x1b')](_0x576200),this[_0x3d5a('0x34')][_0x3d5a('0x7c')]['applyOperation'](_0x576200);});}['_updateServerHistory'](_0x1349d3){_0x1349d3[_0x3d5a('0x8f')](_0x220427=>{const _0x33280f=_0x220427[_0x3d5a('0xb2')]();_0x33280f[_0x3d5a('0xbf')]=_0x220427[_0x3d5a('0xbf')],_0x33280f['_isInit']=!!_0x220427['_isInit'],_0x33280f[_0x3d5a('0x13')]=_0x220427[_0x3d5a('0x13')],_0x33280f['baseVersion']+=this[_0x3d5a('0x6d')],_0x220427[_0x3d5a('0xb9')]&&this['_disconnectionOperations'][_0x3d5a('0xb')](_0x33280f),this[_0x3d5a('0x7f')][_0x3d5a('0x1b')](_0x33280f);});}[_0x3d5a('0x8')](_0xa3fe0){const _0x33f3c4=this[_0x3d5a('0x34')]['plugins'][_0x3d5a('0xb6')](_0x3d5a('0x75')),_0x358868=this[_0x3d5a('0x34')][_0x3d5a('0xc4')];_0xa3fe0||(_0xa3fe0=_0x3f0415(_0x358868,_0x3d5a('0x1f'))),_0x33f3c4[_0x3d5a('0xc0')](_0xa3fe0,{'title':_0x3f0415(_0x358868,_0x3d5a('0x4d')),'namespace':_0x3d5a('0x62')}),this[_0x3d5a('0x2a')]=!0x0,clearTimeout(this[_0x3d5a('0x68')]),this[_0x3d5a('0x92')]=[],this['editor'][_0x3d5a('0x5e')]['get'](_0x5936d9)[_0x3d5a('0x21')]();}[_0x3d5a('0x97')](){this[_0x3d5a('0x90')]||(this['_pendingAction']=this[_0x3d5a('0x34')][_0x3d5a('0x5e')][_0x3d5a('0xb6')](_0x59d552)[_0x3d5a('0xb')](_0x3f0415(this['editor'][_0x3d5a('0xc4')],_0x3d5a('0x96'))));}['_clearPendingAction'](){this[_0x3d5a('0x90')]&&(this[_0x3d5a('0x34')][_0x3d5a('0x5e')][_0x3d5a('0xb6')](_0x59d552)[_0x3d5a('0x94')](this[_0x3d5a('0x90')]),this['_pendingAction']=null);}['_compressOperations'](_0x487278){const _0x226157=_0x487278['map'](_0x1695e3=>_0x1695e3[_0x3d5a('0x11')]());return this[_0x3d5a('0xbb')][_0x3d5a('0x3d')](_0x226157);}['_decompressOperations'](_0x8b1ed0,_0x398ae4){const _0x2d9477=this[_0x3d5a('0xbb')][_0x3d5a('0x15')](_0x8b1ed0)[_0x3d5a('0x6f')]((_0x334baa,_0xca7bb1)=>{const _0x18d868=_0x333c15[_0x3d5a('0x79')](_0x334baa,this[_0x3d5a('0x0')]);return _0x18d868['wasUndone']=_0x334baa[_0x3d5a('0x78')],'cs:removeUser'===_0x398ae4[_0xca7bb1][_0x3d5a('0x83')]&&(_0x18d868['_isDisconnection']=!0x0),_0x18d868;});return this[_0x3d5a('0x9c')](_0x2d9477,_0x398ae4),_0x2d9477;}[_0x3d5a('0x9c')](_0x21f6d1,_0x3f8bd4){for(let _0x48ec86=0x0;_0x48ec86<_0x21f6d1[_0x3d5a('0x6a')];_0x48ec86++)_0x3d5a('0xa2')==_0x3f8bd4[_0x48ec86][_0x3d5a('0x83')]?(_0x21f6d1[_0x48ec86][_0x3d5a('0x61')]=!0x0,_0x21f6d1[_0x48ec86][_0x3d5a('0xbf')]=null):(_0x21f6d1[_0x48ec86][_0x3d5a('0x61')]=!0x1,_0x21f6d1[_0x48ec86][_0x3d5a('0xbf')]=_0x3f8bd4[_0x48ec86][_0x3d5a('0xa8')]),_0x21f6d1[_0x48ec86][_0x3d5a('0x13')]=_0x3f8bd4[_0x48ec86]['createdAt'];}[_0x3d5a('0x66')](){this['_hasSelectionChanged']=!0x0,this[_0x3d5a('0x42')]()&&this[_0x3d5a('0xae')]();}[_0x3d5a('0x42')](){const _0x1dbaee=this[_0x3d5a('0x34')][_0x3d5a('0x5e')][_0x3d5a('0xb6')](_0x2d0edd)[_0x3d5a('0xba')][_0x3d5a('0xb6')](this[_0x3d5a('0x5d')]);return!this[_0x3d5a('0x34')][_0x3d5a('0x85')]&&_0x1dbaee&&_0x1dbaee[_0x3d5a('0x6a')]>0x1&&this[_0x3d5a('0xa0')];}['_shouldSendUpdate'](){return this[_0x3d5a('0x92')]['length']>0x0||this[_0x3d5a('0x42')]();}}class X extends Error{}function Y(_0x5e0d4d,_0xb8c09){for(const _0x4597c2 of _0x5e0d4d)_0x4597c2['baseVersion']=_0xb8c09++;}l[_0x3d5a('0x51')]=_0x743d35;class Z{constructor(_0x3a4755){this[_0x3d5a('0x3c')]=_0x3a4755,this[_0x3d5a('0x9a')]=new WeakMap();}[_0x3d5a('0x23')](_0x569af5){let _0x218f29=_0x569af5[_0x3d5a('0x6a')];for(;_0x218f29--;){const _0x24b73d=_0x569af5[_0x218f29];if(!this['_ignoredOperations'][_0x3d5a('0x5c')](_0x24b73d)){if(!this['_operationToId'][_0x3d5a('0x5c')](_0x24b73d)){const _0x65927=_0x4441a3()[_0x3d5a('0xac')](0x1,0x12);this['_operationToId'][_0x3d5a('0x1a')](_0x24b73d,_0x65927);}return this['_operationToId']['get'](_0x24b73d);}}}[_0x3d5a('0xaa')](_0x362d1c,_0x486729){if(!_0x486729)return;let _0x2db588=_0x362d1c[_0x3d5a('0x6a')];for(;_0x2db588--;){const _0xffabf2=_0x362d1c[_0x2db588];this[_0x3d5a('0x3c')][_0x3d5a('0x5c')](_0xffabf2)||this[_0x3d5a('0x9a')]['set'](_0xffabf2,_0x486729);}}}