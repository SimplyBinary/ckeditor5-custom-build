/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x2eef=['init','allConnectedUsers','fire','clear','listenTo','context','sessionAdd:','getUserSessions','pluginName','has','change:state','sessions-register-already-registered','_handleSessionAdd','values','delete','forEach','channelConnectedUsers','_registeredSessions','_handleSessionRemove','user','channelSessions','getUser','state','Sessions','role','connection','size','unregister','connected','get','requires','defineMe','assign','register','getUserBySessionId','set','orderNumber','addUser','plugins','_users','remove','_createUser','_uniqueUsersCount','sessions-unregister-not-exist','mySessionId','add','sessionId'];(function(_0x3b4eec,_0x2eef20){const _0x1a18cc=function(_0x2da274){while(--_0x2da274){_0x3b4eec['push'](_0x3b4eec['shift']());}};_0x1a18cc(++_0x2eef20);}(_0x2eef,0x15d));const _0x1a18=function(_0x3b4eec,_0x2eef20){_0x3b4eec=_0x3b4eec-0x0;let _0x1a18cc=_0x2eef[_0x3b4eec];return _0x1a18cc;};import{ContextPlugin as _0x3a924f}from'ckeditor5/src/core';import{Collection as _0x59dc38,CKEditorError as _0x390a1d}from'ckeditor5/src/utils';import _0x18628a from'./websocketgateway';import{Users as _0x91c82d}from'ckeditor5-collaboration/src/collaboration-core';export default class r extends _0x3a924f{static get[_0x1a18('0x23')](){return _0x1a18('0x3');}static get[_0x1a18('0xa')](){return[_0x18628a,_0x91c82d];}[_0x1a18('0x1b')](){const _0x5223b2=this[_0x1a18('0x20')],_0xf60271=_0x5223b2[_0x1a18('0x12')][_0x1a18('0x9')](_0x18628a);this[_0x1a18('0x0')]=new Map(),this[_0x1a18('0x2b')]=new Map(),this[_0x1a18('0x1c')]=new _0x59dc38(),this[_0x1a18('0x2c')]=new Map(),this[_0x1a18('0x16')]=0x0,this['_users']=_0x5223b2[_0x1a18('0x12')][_0x1a18('0x9')](_0x91c82d),this[_0x1a18('0x1f')](_0xf60271,_0x1a18('0x25'),(_0x4eaac9,_0x335f05,_0x46aefc)=>{if(_0x1a18('0x8')!==_0x46aefc)this[_0x1a18('0x0')][_0x1a18('0x2a')](_0x5b974=>_0x5b974[_0x1a18('0x1e')]()),this[_0x1a18('0x2b')]['forEach'](_0x239dae=>_0x239dae[_0x1a18('0x1e')]()),this['allConnectedUsers'][_0x1a18('0x1e')]();else for(const [_0x597907,_0x347a9f]of this[_0x1a18('0x2c')])for(const _0x15059a of _0x347a9f)this[_0x1a18('0x27')](_0x597907,_0x15059a);}),this[_0x1a18('0x15')](_0xf60271[_0x1a18('0x5')]['me'],!0x0);}[_0x1a18('0xd')](_0x4674b6,_0x1dfbd8){if(this[_0x1a18('0x2c')][_0x1a18('0x24')](_0x4674b6))throw new _0x390a1d(_0x1a18('0x26'),null,{'channelId':_0x4674b6});this[_0x1a18('0x2c')]['set'](_0x4674b6,_0x1dfbd8),this[_0x1a18('0x0')][_0x1a18('0xf')](_0x4674b6,new _0x59dc38()),this[_0x1a18('0x2b')]['set'](_0x4674b6,new _0x59dc38()),this['listenTo'](_0x1dfbd8,_0x1a18('0x19'),(_0x114535,_0x40bb62)=>this[_0x1a18('0x27')](_0x4674b6,_0x40bb62)),this[_0x1a18('0x1f')](_0x1dfbd8,_0x1a18('0x14'),(_0x3f8d02,_0x476c53)=>this[_0x1a18('0x2d')](_0x4674b6,_0x476c53));for(const _0xc603c8 of _0x1dfbd8)this[_0x1a18('0x27')](_0x4674b6,_0xc603c8);}[_0x1a18('0x7')](_0xe1afa3){if(!this[_0x1a18('0x2c')][_0x1a18('0x24')](_0xe1afa3))throw new _0x390a1d(_0x1a18('0x17'),null,{'channelId':_0xe1afa3});const _0x31c1be=this['_registeredSessions'][_0x1a18('0x9')](_0xe1afa3);this['stopListening'](_0x31c1be);for(const _0x21c29f of _0x31c1be)_0x1a18('0x8')===this[_0x1a18('0x20')][_0x1a18('0x12')][_0x1a18('0x9')](_0x18628a)['state']&&this[_0x1a18('0x2d')](_0xe1afa3,_0x21c29f);this[_0x1a18('0x2c')][_0x1a18('0x29')](_0xe1afa3),this[_0x1a18('0x0')][_0x1a18('0x29')](_0xe1afa3),this['channelConnectedUsers'][_0x1a18('0x29')](_0xe1afa3);}get[_0x1a18('0x18')](){return this[_0x1a18('0x20')][_0x1a18('0x12')]['get'](_0x18628a)['connection'][_0x1a18('0x1a')];}[_0x1a18('0xe')](_0x2c303f){for(const _0x1098ac of this[_0x1a18('0x0')]['values']())for(const _0x45bfd2 of _0x1098ac)if(_0x45bfd2['id']===_0x2c303f)return _0x45bfd2[_0x1a18('0x2e')];}['getUserSessions'](_0x1468a1,_0x3d73f8){const _0x2e4608=_0x3d73f8?[this[_0x1a18('0x0')][_0x1a18('0x9')](_0x3d73f8)]:this[_0x1a18('0x0')][_0x1a18('0x28')](),_0x33cde7=new Set();for(const _0x48cd5a of _0x2e4608)for(const _0x133a8d of _0x48cd5a)_0x133a8d[_0x1a18('0x2e')]['id']===_0x1468a1['id']&&_0x33cde7[_0x1a18('0x19')](_0x133a8d['id']);return _0x33cde7;}['getUserRole'](_0x4a3eb8){for(const _0x5a415b of this['channelSessions']['values']())for(const _0x48995e of _0x5a415b)if(_0x48995e[_0x1a18('0x2e')]===_0x4a3eb8)return _0x48995e[_0x1a18('0x4')];}[_0x1a18('0x27')](_0x2c6f44,_0x304207){if(_0x1a18('0x8')!==this[_0x1a18('0x20')][_0x1a18('0x12')][_0x1a18('0x9')](_0x18628a)[_0x1a18('0x2')])return;const _0x52c2da=_0x304207[_0x1a18('0x2e')],_0x365d22=this['_users'][_0x1a18('0x1')](_0x52c2da['id'])||this[_0x1a18('0x15')](_0x52c2da),_0x5e3884=Object[_0x1a18('0xc')]({},_0x304207,{'user':_0x365d22});this['channelSessions'][_0x1a18('0x9')](_0x2c6f44)[_0x1a18('0x19')](_0x5e3884);const _0x203937=this[_0x1a18('0x2b')][_0x1a18('0x9')](_0x2c6f44);_0x203937['has'](_0x365d22['id'])||_0x203937[_0x1a18('0x19')](_0x365d22),this[_0x1a18('0x1c')][_0x1a18('0x24')](_0x365d22['id'])||this[_0x1a18('0x1c')]['add'](_0x365d22),this[_0x1a18('0x1d')](_0x1a18('0x21')+_0x2c6f44,{'channelId':_0x2c6f44,'session':_0x5e3884});}[_0x1a18('0x2d')](_0x3f58b5,_0x21eaea){if('connected'!==this[_0x1a18('0x20')][_0x1a18('0x12')][_0x1a18('0x9')](_0x18628a)[_0x1a18('0x2')])return;const _0x335ff2=this[_0x1a18('0x2b')]['get'](_0x3f58b5),_0x288360=_0x21eaea[_0x1a18('0x2e')];this[_0x1a18('0x0')][_0x1a18('0x9')](_0x3f58b5)['remove'](_0x21eaea['id']),_0x335ff2[_0x1a18('0x24')](_0x288360['id'])&&!this['getUserSessions'](_0x288360,_0x3f58b5)[_0x1a18('0x6')]&&_0x335ff2[_0x1a18('0x14')](_0x288360['id']),this[_0x1a18('0x1c')]['get'](_0x288360['id'])&&!this[_0x1a18('0x22')](_0x288360)[_0x1a18('0x6')]&&this[_0x1a18('0x1c')]['remove'](_0x288360['id']);}[_0x1a18('0x15')](_0x18cf9f,_0x39c017){const _0x1c3f91=this[_0x1a18('0x13')][_0x1a18('0x11')](_0x18cf9f);return _0x39c017&&this['_users'][_0x1a18('0xb')](_0x18cf9f['id']),_0x1c3f91[_0x1a18('0x10')]=this[_0x1a18('0x16')]++,_0x1c3f91;}}