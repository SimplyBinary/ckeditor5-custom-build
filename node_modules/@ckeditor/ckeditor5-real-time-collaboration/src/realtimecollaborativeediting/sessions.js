/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x4c3e=['channelSessions','sessionId','stopListening','sessions-register-already-registered','channelConnectedUsers','_handleSessionAdd','state','user','mySessionId','defineMe','set','orderNumber','plugins','Sessions','delete','context','getUserSessions','connected','_uniqueUsersCount','sessions-unregister-not-exist','getUserRole','get','init','_registeredSessions','size','_users','allConnectedUsers','add','assign','listenTo','unregister','_createUser','change:state','connection','forEach','addUser','getUser','values','_handleSessionRemove','clear','remove','has','requires'];(function(_0x26fde3,_0x4c3e30){const _0x51b21a=function(_0x5e6aa7){while(--_0x5e6aa7){_0x26fde3['push'](_0x26fde3['shift']());}};_0x51b21a(++_0x4c3e30);}(_0x4c3e,0x6e));const _0x51b2=function(_0x26fde3,_0x4c3e30){_0x26fde3=_0x26fde3-0x0;let _0x51b21a=_0x4c3e[_0x26fde3];return _0x51b21a;};import{ContextPlugin as _0x51966b}from'ckeditor5/src/core';import{Collection as _0x54d632,CKEditorError as _0x14b217}from'ckeditor5/src/utils';import _0x698c6a from'./websocketgateway';import{Users as _0x3aaf51}from'ckeditor5-collaboration/src/collaboration-core';export default class r extends _0x51966b{static get['pluginName'](){return _0x51b2('0x20');}static get[_0x51b2('0x12')](){return[_0x698c6a,_0x3aaf51];}[_0x51b2('0x29')](){const _0x2083b4=this[_0x51b2('0x22')],_0x5c4842=_0x2083b4[_0x51b2('0x1f')][_0x51b2('0x28')](_0x698c6a);this[_0x51b2('0x13')]=new Map(),this[_0x51b2('0x17')]=new Map(),this[_0x51b2('0x2')]=new _0x54d632(),this[_0x51b2('0x2a')]=new Map(),this[_0x51b2('0x25')]=0x0,this[_0x51b2('0x1')]=_0x2083b4[_0x51b2('0x1f')][_0x51b2('0x28')](_0x3aaf51),this[_0x51b2('0x5')](_0x5c4842,_0x51b2('0x8'),(_0x353d74,_0x456e42,_0xb5afeb)=>{if(_0x51b2('0x24')!==_0xb5afeb)this['channelSessions'][_0x51b2('0xa')](_0x31bd26=>_0x31bd26[_0x51b2('0xf')]()),this[_0x51b2('0x17')][_0x51b2('0xa')](_0x2ab292=>_0x2ab292[_0x51b2('0xf')]()),this[_0x51b2('0x2')][_0x51b2('0xf')]();else for(const [_0x4388af,_0x3bdd02]of this[_0x51b2('0x2a')])for(const _0x367db2 of _0x3bdd02)this[_0x51b2('0x18')](_0x4388af,_0x367db2);}),this[_0x51b2('0x7')](_0x5c4842[_0x51b2('0x9')]['me'],!0x0);}['register'](_0x309e42,_0x1f6ef3){if(this['_registeredSessions'][_0x51b2('0x11')](_0x309e42))throw new _0x14b217(_0x51b2('0x16'),null,{'channelId':_0x309e42});this['_registeredSessions']['set'](_0x309e42,_0x1f6ef3),this[_0x51b2('0x13')]['set'](_0x309e42,new _0x54d632()),this['channelConnectedUsers'][_0x51b2('0x1d')](_0x309e42,new _0x54d632()),this['listenTo'](_0x1f6ef3,_0x51b2('0x3'),(_0x3c326c,_0x1b0f56)=>this[_0x51b2('0x18')](_0x309e42,_0x1b0f56)),this['listenTo'](_0x1f6ef3,_0x51b2('0x10'),(_0x1a8dc4,_0x390157)=>this[_0x51b2('0xe')](_0x309e42,_0x390157));for(const _0x2a92d3 of _0x1f6ef3)this['_handleSessionAdd'](_0x309e42,_0x2a92d3);}[_0x51b2('0x6')](_0x978542){if(!this[_0x51b2('0x2a')]['has'](_0x978542))throw new _0x14b217(_0x51b2('0x26'),null,{'channelId':_0x978542});const _0x4ad976=this[_0x51b2('0x2a')]['get'](_0x978542);this[_0x51b2('0x15')](_0x4ad976);for(const _0x1a2977 of _0x4ad976)_0x51b2('0x24')===this[_0x51b2('0x22')]['plugins'][_0x51b2('0x28')](_0x698c6a)['state']&&this[_0x51b2('0xe')](_0x978542,_0x1a2977);this[_0x51b2('0x2a')][_0x51b2('0x21')](_0x978542),this[_0x51b2('0x13')][_0x51b2('0x21')](_0x978542),this[_0x51b2('0x17')][_0x51b2('0x21')](_0x978542);}get[_0x51b2('0x1b')](){return this[_0x51b2('0x22')][_0x51b2('0x1f')][_0x51b2('0x28')](_0x698c6a)[_0x51b2('0x9')][_0x51b2('0x14')];}['getUserBySessionId'](_0x25ea5f){for(const _0x2077a7 of this[_0x51b2('0x13')][_0x51b2('0xd')]())for(const _0x54c968 of _0x2077a7)if(_0x54c968['id']===_0x25ea5f)return _0x54c968[_0x51b2('0x1a')];}['getUserSessions'](_0x1d8285,_0x349472){const _0x48a65d=_0x349472?[this[_0x51b2('0x13')][_0x51b2('0x28')](_0x349472)]:this[_0x51b2('0x13')][_0x51b2('0xd')](),_0x175453=new Set();for(const _0x1b29cb of _0x48a65d)for(const _0x216096 of _0x1b29cb)_0x216096[_0x51b2('0x1a')]['id']===_0x1d8285['id']&&_0x175453[_0x51b2('0x3')](_0x216096['id']);return _0x175453;}[_0x51b2('0x27')](_0x2cd0fb){for(const _0x2a284b of this['channelSessions']['values']())for(const _0x49ccdb of _0x2a284b)if(_0x49ccdb['user']===_0x2cd0fb)return _0x49ccdb['role'];}['_handleSessionAdd'](_0x32e15c,_0xa2fbe8){if(_0x51b2('0x24')!==this[_0x51b2('0x22')][_0x51b2('0x1f')][_0x51b2('0x28')](_0x698c6a)[_0x51b2('0x19')])return;const _0x16551d=_0xa2fbe8[_0x51b2('0x1a')],_0x1570ff=this[_0x51b2('0x1')][_0x51b2('0xc')](_0x16551d['id'])||this[_0x51b2('0x7')](_0x16551d),_0x3f258f=Object[_0x51b2('0x4')]({},_0xa2fbe8,{'user':_0x1570ff});this[_0x51b2('0x13')][_0x51b2('0x28')](_0x32e15c)[_0x51b2('0x3')](_0x3f258f);const _0xd2c4b9=this[_0x51b2('0x17')]['get'](_0x32e15c);_0xd2c4b9['has'](_0x1570ff['id'])||_0xd2c4b9[_0x51b2('0x3')](_0x1570ff),this[_0x51b2('0x2')][_0x51b2('0x11')](_0x1570ff['id'])||this[_0x51b2('0x2')][_0x51b2('0x3')](_0x1570ff),this['fire']('sessionAdd:'+_0x32e15c,{'channelId':_0x32e15c,'session':_0x3f258f});}['_handleSessionRemove'](_0x5cc9f3,_0x5f1bb3){if(_0x51b2('0x24')!==this[_0x51b2('0x22')][_0x51b2('0x1f')]['get'](_0x698c6a)[_0x51b2('0x19')])return;const _0x3dd047=this[_0x51b2('0x17')][_0x51b2('0x28')](_0x5cc9f3),_0x3fe75f=_0x5f1bb3[_0x51b2('0x1a')];this['channelSessions'][_0x51b2('0x28')](_0x5cc9f3)[_0x51b2('0x10')](_0x5f1bb3['id']),_0x3dd047['has'](_0x3fe75f['id'])&&!this[_0x51b2('0x23')](_0x3fe75f,_0x5cc9f3)[_0x51b2('0x0')]&&_0x3dd047[_0x51b2('0x10')](_0x3fe75f['id']),this['allConnectedUsers'][_0x51b2('0x28')](_0x3fe75f['id'])&&!this[_0x51b2('0x23')](_0x3fe75f)[_0x51b2('0x0')]&&this[_0x51b2('0x2')][_0x51b2('0x10')](_0x3fe75f['id']);}[_0x51b2('0x7')](_0x4a40d9,_0x182589){const _0x3d51cc=this[_0x51b2('0x1')][_0x51b2('0xb')](_0x4a40d9);return _0x182589&&this[_0x51b2('0x1')][_0x51b2('0x1c')](_0x4a40d9['id']),_0x3d51cc[_0x51b2('0x1e')]=this['_uniqueUsersCount']++,_0x3d51cc;}}