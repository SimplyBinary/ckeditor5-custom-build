/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x3512=['attributes','getSuggestion','find','cloud-services-internal-error:\x20Not\x20connected.','init','_fetchMissingUsersForThreads','adapter','_trackChangesService','TrackChangesService','type','all','get','getUser','_waitForServiceReady','state','_saved','values','data','then','requires','editor','isConnected','connect','message','add','delete','addToReconnectionStack','collaboration.channelId','hasSuggestion','set','catch','_bufferedRequests','cloud-services-internal-error:\x20Request\x20timeout.','reconnect','plugins','listenTo','startsWith','addSuggestionData','connection','TrackChangesEditing','off'];(function(_0x48a1cd,_0x3512b0){const _0x266d50=function(_0x430c1f){while(--_0x430c1f){_0x48a1cd['push'](_0x48a1cd['shift']());}};_0x266d50(++_0x3512b0);}(_0x3512,0x195));const _0x266d=function(_0x48a1cd,_0x3512b0){_0x48a1cd=_0x48a1cd-0x0;let _0x266d50=_0x3512[_0x48a1cd];return _0x266d50;};import{Plugin as _0x21c8de}from'ckeditor5/src/core';import _0x3f851a from'@ckeditor/ckeditor-cloud-services-collaboration/src/track-changes/trackchangesservice';import _0x32211c from'../realtimecollaborativeediting/websocketgateway';import _0x1f0bc2 from'../realtimecollaborativecomments/cloudservicescommentsadapter';import _0x49af0f from'@ckeditor/ckeditor-cloud-services-collaboration/src/users/user';import{Users as _0x1c5e23}from'ckeditor5-collaboration/src/collaboration-core';export default class g extends _0x21c8de{static get[_0x266d('0x18')](){return[_0x1f0bc2,_0x266d('0x3'),_0x32211c];}constructor(_0xda66e8){super(_0xda66e8),this[_0x266d('0x24')]=new Map();}[_0x266d('0x9')](){const _0x1b3b3a=this[_0x266d('0x19')][_0x266d('0x27')][_0x266d('0x10')](_0x32211c),_0x52e977=this[_0x266d('0x19')][_0x266d('0x27')]['get'](_0x266d('0x3')),_0x383719=this[_0x266d('0x19')]['config'][_0x266d('0x10')](_0x266d('0x20'));return _0x1b3b3a[_0x266d('0x1f')](this),this[_0x266d('0xc')]=new g['TrackChangesService'](_0x383719),_0x52e977[_0x266d('0xb')]={'getSuggestion':async _0x3a23c3=>{await this['_waitForServiceReady']();const _0xf8b2f9=await this[_0x266d('0xc')]['get'](_0x3a23c3)[_0x266d('0x23')](R);return await this[_0x266d('0xa')]([_0xf8b2f9]),_0xf8b2f9;},'addSuggestion':async({id:_0x2714cf,type:_0x3ec37d,data:_0x42f77b,originalSuggestionId:_0x3b37b6,attributes:_0x3fed4e})=>{await this['_waitForServiceReady']();const _0x20ec3a={'id':_0x2714cf,'type':_0x3ec37d,'data':_0x42f77b,'originalSuggestionId':_0x3b37b6,'attributes':_0x3fed4e},_0x7052d4=await this['_trackChangesService'][_0x266d('0x1d')](_0x2714cf,_0x3ec37d,_0x42f77b,_0x3b37b6,_0x3fed4e)[_0x266d('0x23')](_0x2c5369=>{if(P(_0x2c5369))return new Promise(_0x389f27=>{this[_0x266d('0x24')][_0x266d('0x22')](_0x2714cf,{'resolve':_0x389f27,'suggestionData':_0x20ec3a});});throw _0x2c5369;});return this[_0x266d('0x24')][_0x266d('0x1e')](_0x2714cf),_0x7052d4;},'updateSuggestion':async(_0x20bde3,_0x40fc3a)=>{if(await this[_0x266d('0x12')](),'open'!==_0x40fc3a[_0x266d('0x13')])return this[_0x266d('0xc')]['update'](_0x20bde3,_0x40fc3a)[_0x266d('0x23')](R);}},this[_0x266d('0x28')](this[_0x266d('0xc')],'suggestionUpdated',(_0x180e02,_0x2628a9)=>{_0x52e977[_0x266d('0x21')](_0x2628a9['id'])&&(_0x52e977[_0x266d('0x6')](_0x2628a9['id'])[_0x266d('0x5')]=_0x2628a9[_0x266d('0x5')]);}),this[_0x266d('0xc')][_0x266d('0x1b')](_0x1b3b3a[_0x266d('0x2')])[_0x266d('0x17')](_0x23e4c1=>this['_fetchMissingUsersForThreads'](_0x23e4c1)[_0x266d('0x17')](()=>{for(const _0xe1e5ad of _0x23e4c1){_0x52e977['addSuggestionData'](_0xe1e5ad)[_0x266d('0x14')]=!0x0;}}));}async[_0x266d('0x26')](){const _0x1925d4=this['editor'][_0x266d('0x27')][_0x266d('0x10')]('TrackChangesEditing'),{connection:_0x1a7094}=this[_0x266d('0x19')][_0x266d('0x27')][_0x266d('0x10')](_0x32211c),_0x13fc24=await this[_0x266d('0xc')]['connect'](_0x1a7094);await this[_0x266d('0xa')](_0x13fc24);for(const {suggestionData:_0x2f5b8d,resolve:_0x2ec964}of this[_0x266d('0x24')][_0x266d('0x15')]()){let _0x4c6661=_0x13fc24[_0x266d('0x7')](_0xfff153=>_0xfff153['id']===_0x2f5b8d['id']);_0x4c6661||(_0x4c6661=await this[_0x266d('0xc')][_0x266d('0x1d')](_0x2f5b8d['id'],_0x2f5b8d[_0x266d('0xe')],_0x2f5b8d[_0x266d('0x16')],_0x2f5b8d['originalSuggestionId'])),_0x2ec964(_0x4c6661);}for(const _0x5d7bd0 of _0x13fc24)_0x1925d4[_0x266d('0x21')](_0x5d7bd0['id'])||_0x1925d4[_0x266d('0x1')](_0x5d7bd0);}async[_0x266d('0x12')](){this[_0x266d('0xc')][_0x266d('0x1a')]||await new Promise(_0x526415=>{this[_0x266d('0x28')](this['_trackChangesService'],'connected',_0x3523a9=>{_0x3523a9[_0x266d('0x4')](),_0x526415();});});}[_0x266d('0xa')](_0x2bdd52){const _0x4dc455=this['editor']['plugins'][_0x266d('0x10')](_0x1c5e23),{connection:_0x30944b}=this[_0x266d('0x19')][_0x266d('0x27')][_0x266d('0x10')](_0x32211c),_0x5b862d=new Set();for(const {authorId:_0x4f5c8f}of _0x2bdd52)_0x4dc455['getUser'](_0x4f5c8f)||_0x5b862d['add'](_0x4f5c8f);return Promise[_0x266d('0xf')](Array['from'](_0x5b862d)['map'](_0x35377a=>_0x49af0f[_0x266d('0x10')](_0x30944b,_0x35377a)[_0x266d('0x17')](_0x4b4b7e=>{_0x4dc455[_0x266d('0x11')](_0x35377a)||_0x4dc455['addUser'](_0x4b4b7e);})));}}function R(_0x5f2799){if(P(_0x5f2799))return new Promise(()=>{});throw _0x5f2799;}function P(_0x5937b7){return _0x5937b7[_0x266d('0x1c')][_0x266d('0x0')](_0x266d('0x8'))||_0x5937b7[_0x266d('0x1c')][_0x266d('0x0')](_0x266d('0x25'));}g[_0x266d('0xd')]=_0x3f851a;