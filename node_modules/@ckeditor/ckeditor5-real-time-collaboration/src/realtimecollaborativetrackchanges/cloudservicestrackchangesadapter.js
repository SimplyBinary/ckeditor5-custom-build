/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x3b8c=['state','originalSuggestionId','find','map','type','connect','connection','message','startsWith','init','requires','get','reconnect','suggestionUpdated','_trackChangesService','_waitForServiceReady','TrackChangesService','plugins','getUser','addSuggestionData','then','_bufferedRequests','hasSuggestion','collaboration.channelId','editor','cloud-services-internal-error:\x20Request\x20timeout.','add','open','all','update','catch','from','addToReconnectionStack','_fetchMissingUsersForThreads','delete','addUser','config','off','_saved','listenTo','isConnected','connected','data','attributes','TrackChangesEditing'];(function(_0x24deb0,_0x3b8c76){const _0x39ad27=function(_0x49c729){while(--_0x49c729){_0x24deb0['push'](_0x24deb0['shift']());}};_0x39ad27(++_0x3b8c76);}(_0x3b8c,0xff));const _0x39ad=function(_0x24deb0,_0x3b8c76){_0x24deb0=_0x24deb0-0x0;let _0x39ad27=_0x3b8c[_0x24deb0];return _0x39ad27;};import{Plugin as _0x5d0233}from'ckeditor5/src/core';import _0x50f59a from'@ckeditor/ckeditor-cloud-services-collaboration/src/track-changes/trackchangesservice';import _0x37bf95 from'../realtimecollaborativeediting/websocketgateway';import _0x245d23 from'../realtimecollaborativecomments/cloudservicescommentsadapter';import _0x373076 from'@ckeditor/ckeditor-cloud-services-collaboration/src/users/user';import{Users as _0x431b32}from'ckeditor5-collaboration/src/collaboration-core';export default class g extends _0x5d0233{static get[_0x39ad('0x19')](){return[_0x245d23,'TrackChangesEditing',_0x37bf95];}constructor(_0x96f16f){super(_0x96f16f),this[_0x39ad('0x24')]=new Map();}[_0x39ad('0x18')](){const _0x32fb62=this[_0x39ad('0x27')][_0x39ad('0x20')][_0x39ad('0x1a')](_0x37bf95),_0x5004ab=this[_0x39ad('0x27')][_0x39ad('0x20')][_0x39ad('0x1a')](_0x39ad('0xe')),_0x6dee45=this[_0x39ad('0x27')][_0x39ad('0x6')]['get'](_0x39ad('0x26'));return _0x32fb62[_0x39ad('0x2')](this),this[_0x39ad('0x1d')]=new g[(_0x39ad('0x1f'))](_0x6dee45),_0x5004ab['adapter']={'getSuggestion':async _0x49872c=>{await this[_0x39ad('0x1e')]();const _0x4e0572=await this[_0x39ad('0x1d')][_0x39ad('0x1a')](_0x49872c)[_0x39ad('0x0')](Q);return await this[_0x39ad('0x3')]([_0x4e0572]),_0x4e0572;},'addSuggestion':async({id:_0x3d31c8,type:_0x2c8ca2,data:_0x5f0d74,originalSuggestionId:_0x2272b8,attributes:_0x781b5f})=>{await this[_0x39ad('0x1e')]();const _0x3afd5d={'id':_0x3d31c8,'type':_0x2c8ca2,'data':_0x5f0d74,'originalSuggestionId':_0x2272b8,'attributes':_0x781b5f},_0x340fad=await this[_0x39ad('0x1d')][_0x39ad('0x29')](_0x3d31c8,_0x2c8ca2,_0x5f0d74,_0x2272b8,_0x781b5f)[_0x39ad('0x0')](_0x2e4e2e=>{if(it(_0x2e4e2e))return new Promise(_0x400ab1=>{this[_0x39ad('0x24')]['set'](_0x3d31c8,{'resolve':_0x400ab1,'suggestionData':_0x3afd5d});});throw _0x2e4e2e;});return this['_bufferedRequests'][_0x39ad('0x4')](_0x3d31c8),_0x340fad;},'updateSuggestion':async(_0x5b3324,_0x412f7)=>{if(await this[_0x39ad('0x1e')](),_0x39ad('0x2a')!==_0x412f7[_0x39ad('0xf')])return this[_0x39ad('0x1d')][_0x39ad('0x2c')](_0x5b3324,_0x412f7)[_0x39ad('0x0')](Q);}},this[_0x39ad('0x9')](this[_0x39ad('0x1d')],_0x39ad('0x1c'),(_0x30fbe0,_0x3ff794)=>{_0x5004ab[_0x39ad('0x25')](_0x3ff794['id'])&&(_0x5004ab['getSuggestion'](_0x3ff794['id'])['attributes']=_0x3ff794[_0x39ad('0xd')]);}),this[_0x39ad('0x1d')][_0x39ad('0x14')](_0x32fb62[_0x39ad('0x15')])[_0x39ad('0x23')](_0x406186=>this['_fetchMissingUsersForThreads'](_0x406186)[_0x39ad('0x23')](()=>{for(const _0x24ca40 of _0x406186){_0x5004ab[_0x39ad('0x22')](_0x24ca40)[_0x39ad('0x8')]=!0x0;}}));}async[_0x39ad('0x1b')](){const _0x288bbb=this[_0x39ad('0x27')][_0x39ad('0x20')][_0x39ad('0x1a')](_0x39ad('0xe')),{connection:_0x38a2f8}=this[_0x39ad('0x27')]['plugins']['get'](_0x37bf95),_0x25ef48=await this['_trackChangesService'][_0x39ad('0x14')](_0x38a2f8);await this[_0x39ad('0x3')](_0x25ef48);for(const {suggestionData:_0x30d630,resolve:_0x2a593b}of this[_0x39ad('0x24')]['values']()){let _0x33c728=_0x25ef48[_0x39ad('0x11')](_0x11e59d=>_0x11e59d['id']===_0x30d630['id']);_0x33c728||(_0x33c728=await this[_0x39ad('0x1d')][_0x39ad('0x29')](_0x30d630['id'],_0x30d630[_0x39ad('0x13')],_0x30d630[_0x39ad('0xc')],_0x30d630[_0x39ad('0x10')])),_0x2a593b(_0x33c728);}for(const _0x5242a3 of _0x25ef48)_0x288bbb[_0x39ad('0x25')](_0x5242a3['id'])||_0x288bbb['addSuggestionData'](_0x5242a3);}async[_0x39ad('0x1e')](){this[_0x39ad('0x1d')][_0x39ad('0xa')]||await new Promise(_0x5e54e5=>{this[_0x39ad('0x9')](this[_0x39ad('0x1d')],_0x39ad('0xb'),_0x4aae87=>{_0x4aae87[_0x39ad('0x7')](),_0x5e54e5();});});}['_fetchMissingUsersForThreads'](_0x1de25e){const _0x41ad7f=this[_0x39ad('0x27')][_0x39ad('0x20')][_0x39ad('0x1a')](_0x431b32),{connection:_0x200f38}=this[_0x39ad('0x27')]['plugins']['get'](_0x37bf95),_0x45a9cb=new Set();for(const {authorId:_0x28211b}of _0x1de25e)_0x41ad7f[_0x39ad('0x21')](_0x28211b)||_0x45a9cb[_0x39ad('0x29')](_0x28211b);return Promise[_0x39ad('0x2b')](Array[_0x39ad('0x1')](_0x45a9cb)[_0x39ad('0x12')](_0x15b219=>_0x373076['get'](_0x200f38,_0x15b219)[_0x39ad('0x23')](_0x2f33dc=>{_0x41ad7f['getUser'](_0x15b219)||_0x41ad7f[_0x39ad('0x5')](_0x2f33dc);})));}}function Q(_0x33580d){if(it(_0x33580d))return new Promise(()=>{});throw _0x33580d;}function it(_0x3500b9){return _0x3500b9['message'][_0x39ad('0x17')]('cloud-services-internal-error:\x20Not\x20connected.')||_0x3500b9[_0x39ad('0x16')][_0x39ad('0x17')](_0x39ad('0x28'));}g[_0x39ad('0x1f')]=_0x50f59a;