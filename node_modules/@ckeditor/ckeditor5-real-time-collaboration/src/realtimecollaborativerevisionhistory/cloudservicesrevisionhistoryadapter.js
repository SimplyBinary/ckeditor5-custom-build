/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x2a62=['_createCurrentRevision','diffData','_fetchMissingUsers','adapter','_revisions','change:_isPendingUpdate','once','addRevisionData','getOperations','_fixRevision','_bufferUpdate','_preventResendingRevisionData','plugins','init','config','authorsIds','getUser','_domEmitter','marker','isEmptyCurrent','_offset','message','get','RevisionHistoryService','connect','_oldOffset','_isConnected','then','isBundleUploaded','remove','_handleReconnectionError','_revisionDataBuilder','_isEditorInitialDataDifferent','change:_isConnected','length','stopListening','authors','_lastRequestId','serverHistory','fromVersion','getRevision','_waitForServiceReady','sessionId','reconnect','createdAt','map','affectsData','addUser','RevisionTracker','cloudServices.bundleVersion','revisionsUpdated','connected','toVersion','requires','destroy','catch','off','all','listenTo','set','buildRevisionData','max','updateRevisions','repository','_getLatestVersion','collaboration.channelId','_getLatestVersionFromServerOperations','_revisionHistoryService','currentRevision','has','wrongRequestId','creatorId','initialData','editor','cloud-services-internal-error:\x20Revision\x20History\x20Service\x20is\x20not\x20connected.','isConnected','_bufferedUpdates','_update','editor-initial-data-replaced-with-revision-data','cloud-services-internal-error:\x20Request\x20timeout.','_revisionTracker','connection','_handleRevisionsUpdate','setRevisionData','add','getRevisionDocumentData','baseVersion','bind','startsWith','from'];(function(_0x5e0940,_0x2a62ba){const _0x5167cc=function(_0x341cf6){while(--_0x341cf6){_0x5e0940['push'](_0x5e0940['shift']());}};_0x5167cc(++_0x2a62ba);}(_0x2a62,0x7c));const _0x5167=function(_0x5e0940,_0x2a62ba){_0x5e0940=_0x5e0940-0x0;let _0x5167cc=_0x2a62[_0x5e0940];return _0x5167cc;};import{Plugin as _0x6e0de2}from'ckeditor5/src/core';import{logWarning as _0x351d46,version as _0x328af7}from'ckeditor5/src/utils';import{Users as _0x37d9d7}from'ckeditor5-collaboration/src/collaboration-core';import _0x4aabdf from'../realtimecollaborativeediting/realtimecollaborationclient';import _0x342a31 from'../realtimecollaborativeediting/websocketgateway';import _0x18383d from'../realtimecollaborativeediting/sessions';import _0x2e2a2c from'@ckeditor/ckeditor-cloud-services-collaboration/src/users/user';import _0x289288 from'@ckeditor/ckeditor-cloud-services-collaboration/src/revision-history/revisionhistoryservice';import _0x44154f from'@ckeditor/ckeditor-cloud-services-collaboration/src/editor/editorservice';export default class v extends _0x6e0de2{static get[_0x5167('0x13')](){return[_0x342a31,_0x4aabdf,_0x5167('0xe'),_0x18383d,_0x37d9d7];}async[_0x5167('0x45')](){this['_lastRequestId']=null,this['_revisionTracker']=this[_0x5167('0x27')]['plugins'][_0x5167('0x4e')]('RevisionTracker');const _0x1a8136=this[_0x5167('0x27')][_0x5167('0x44')][_0x5167('0x4e')](_0x4aabdf),_0xf7a871=_0x1a8136[_0x5167('0x4')],_0x3970bb=this[_0x5167('0x27')][_0x5167('0x44')][_0x5167('0x4e')](_0x342a31);_0x3970bb['addToReconnectionStack'](this);const _0x53be2f=this[_0x5167('0x27')][_0x5167('0x46')][_0x5167('0x4e')](_0x5167('0x1f'));this[_0x5167('0x21')]=new v[(_0x5167('0x4f'))](_0x53be2f),this[_0x5167('0x2e')]['setSource']({'history':_0xf7a871,'getLatestVersion':()=>this[_0x5167('0x1e')](),'getCurrentRevisionId':()=>_0x1a8136[_0x5167('0x8')]});const _0x2e6b6e=this[_0x5167('0x27')][_0x5167('0x46')][_0x5167('0x4e')](_0x5167('0xf'))||_0x328af7,_0x4b0404=await _0x44154f[_0x5167('0x54')](_0x3970bb['connection'],_0x2e6b6e);this[_0x5167('0x2e')][_0x5167('0x3b')]={'getRevision':async({revisionId:_0x543b07})=>(await this['_waitForServiceReady'](),await this[_0x5167('0x21')][_0x5167('0x6')](_0x543b07)),'updateRevisions':async _0x3ebf48=>{await this[_0x5167('0x7')]();const _0xa72e5b=this['_revisionTracker'][_0x5167('0x22')];if(_0x4b0404){if(0x0===(_0x3ebf48=_0x3ebf48['filter'](_0x8dc922=>_0x8dc922['id']!==_0xa72e5b['id']))['length'])return;}else for(const _0x3df8dc of _0x3ebf48)_0x3df8dc['id']===_0xa72e5b['id']&&(_0x3df8dc[_0x5167('0x4b')]=_0x3df8dc['fromVersion']===_0x3df8dc[_0x5167('0x12')]);return this[_0x5167('0x21')][_0x5167('0x1c')](_0x3ebf48,this['_lastRequestId'])[_0x5167('0x53')](_0x2c7349=>{this[_0x5167('0x3')]=_0x2c7349;})[_0x5167('0x15')](_0x53ad78=>{if(!(P(_0x53ad78)||'400'===_0x53ad78['code']&&void 0x0!==_0x53ad78['data'][_0x5167('0x24')]))throw _0x53ad78;for(const _0x394a9f of _0x3ebf48){!this['_revisionTracker'][_0x5167('0x1d')][_0x5167('0x6')](_0x394a9f['id'])||this['_revisionTracker'][_0x5167('0x42')](_0x394a9f['id'],_0x394a9f,!0x1);}if(P(_0x53ad78))throw _0x53ad78;});}},this[_0x5167('0x18')](this[_0x5167('0x21')],_0x5167('0x10'),(_0x4720f7,{revisionsData:_0x5eca40,requestId:_0x277ef0})=>{Math[_0x5167('0x1b')](..._0x5eca40[_0x5167('0xb')](_0x3b2d92=>_0x3b2d92['toVersion']))>this[_0x5167('0x20')]()-0x1?this[_0x5167('0x1e')]()[_0x5167('0x53')](()=>{this[_0x5167('0x30')](_0x5eca40,_0x277ef0);}):this[_0x5167('0x30')](_0x5eca40,_0x277ef0);});const {revisions:_0xdc2475,requestId:_0x38da20}=await this[_0x5167('0x21')][_0x5167('0x50')](_0x3970bb[_0x5167('0x2f')]);this['_lastRequestId']=_0x38da20,await this[_0x5167('0x3a')](_0xdc2475);for(const _0x1487fc of _0xdc2475)this[_0x5167('0x2e')][_0x5167('0x3f')](_0x1487fc);if(_0xdc2475['length']>0x0){const _0xc80700=this[_0x5167('0x2e')][_0x5167('0x1d')]['getRevision'](0x0),_0x260a33=await this['_revisionTracker'][_0x5167('0x33')](_0xc80700);this[_0x5167('0x58')](this['editor'],_0x260a33)&&(_0x351d46(_0x5167('0x2c')),this[_0x5167('0x27')]['config'][_0x5167('0x19')](_0x5167('0x26'),_0x260a33));}this[_0x5167('0x18')](_0x1a8136,_0x5167('0x59'),(_0x27efa8,_0x471123,_0x51da52)=>{_0x51da52&&(this[_0x5167('0x51')]=_0x1a8136[_0x5167('0x4c')],_0x27efa8['off']());}),this['_revisionTracker'][_0x5167('0x35')]('isEnabled')['to'](_0x3970bb,'state',_0x5c0128=>_0x5167('0x11')===_0x5c0128);}async[_0x5167('0x9')](){const _0x525c04=this['editor'][_0x5167('0x44')][_0x5167('0x4e')](_0x342a31),_0x1c2823=this[_0x5167('0x27')][_0x5167('0x44')][_0x5167('0x4e')](_0x4aabdf),_0x3b3c21=async()=>{const _0x25a7a4=this[_0x5167('0x2e')][_0x5167('0x22')],_0x5c6f4c=_0x25a7a4['id'],_0x3d3278=_0x5c6f4c!==_0x1c2823[_0x5167('0x8')];if(_0x3d3278){const _0x178ee6=_0x1c2823['_offset']-this[_0x5167('0x51')],_0x24b823=this[_0x5167('0x20')]();this[_0x5167('0x2e')][_0x5167('0x57')]['reInit']();if(_0x25a7a4[_0x5167('0x12')]+_0x178ee6!==_0x24b823){const _0x525878=_0x25a7a4[_0x5167('0x5')]+_0x178ee6,_0x15e2b4=this[_0x5167('0x27')][_0x5167('0x44')][_0x5167('0x4e')]('Users'),_0x3bc68e=this['_revisionTracker'][_0x5167('0x1a')]({'currentRevision':_0x25a7a4,'from':_0x525878,'to':_0x24b823});_0x3bc68e['id']=_0x25a7a4['id'];const _0x23688f=_0x3bc68e[_0x5167('0x47')][_0x5167('0xb')](_0x4b6786=>_0x15e2b4['getUser'](_0x4b6786));_0x25a7a4[_0x5167('0x2b')]({..._0x3bc68e,'authors':_0x23688f},!0x0),this[_0x5167('0x2e')][_0x5167('0x42')](_0x25a7a4['id'],_0x3bc68e,!0x0);}this[_0x5167('0x2e')]['_startingVersion']=_0x24b823,(_0x25a7a4[_0x5167('0x12')]===_0x25a7a4[_0x5167('0x5')]&&!this[_0x5167('0x2e')][_0x5167('0x2a')][_0x5167('0x23')](_0x5c6f4c)&&this[_0x5167('0x2e')][_0x5167('0x1d')][_0x5167('0x3c')][_0x5167('0x55')](_0x5c6f4c),this[_0x5167('0x2e')][_0x5167('0x38')](_0x24b823));}const {revisions:_0x7ea425,requestId:_0x3bfbe9}=await this[_0x5167('0x21')]['reconnect'](_0x525c04[_0x5167('0x2f')],this[_0x5167('0x3')]);_0x3d3278&&_0x7ea425['length']>0x0?_0x1c2823[_0x5167('0x56')]():(await this[_0x5167('0x3a')](_0x7ea425),this[_0x5167('0x30')](_0x7ea425,_0x3bfbe9),this[_0x5167('0x2e')]['sendBufferedUpdates']());};return _0x1c2823[_0x5167('0x52')]?_0x3b3c21():new Promise((_0x2c1787,_0x349a63)=>{_0x1c2823[_0x5167('0x3e')](_0x5167('0x59'),()=>{_0x3b3c21()[_0x5167('0x53')](_0x2c1787)['catch'](_0x349a63);});});}['destroy'](){this[_0x5167('0x49')]&&this[_0x5167('0x49')][_0x5167('0x1')](),super[_0x5167('0x14')]();}async[_0x5167('0x7')](){this[_0x5167('0x21')][_0x5167('0x29')]||await new Promise(_0x5597eb=>{this[_0x5167('0x18')](this[_0x5167('0x21')],_0x5167('0x11'),_0xf5e4f8=>{_0xf5e4f8[_0x5167('0x16')](),_0x5597eb();});});}['_getLatestVersionFromServerOperations'](){const _0x436214=this[_0x5167('0x27')][_0x5167('0x44')][_0x5167('0x4e')](_0x4aabdf)[_0x5167('0x4')];for(const _0x519d39 of _0x436214[_0x5167('0x40')]()['reverse']())if(_0x5167('0x4a')!==_0x519d39['type']||_0x519d39[_0x5167('0xc')])return _0x519d39[_0x5167('0x34')]+0x1;}['_isEditorInitialDataDifferent'](_0x316a47,_0x469fd4){let _0x5bcd3e=_0x316a47[_0x5167('0x46')][_0x5167('0x4e')](_0x5167('0x26'));if(void 0x0===_0x5bcd3e)return!0x1;'string'==typeof _0x5bcd3e&&(_0x5bcd3e={'main':_0x5bcd3e});for(const _0xf6ed17 of Object['keys'](_0x469fd4))if(''!==_0x5bcd3e[_0xf6ed17]['trim']()&&_0x5bcd3e[_0xf6ed17]!==_0x469fd4[_0xf6ed17])return!0x0;return!0x1;}[_0x5167('0x1e')](){const _0x41d04b=this['editor'][_0x5167('0x44')]['get'](_0x4aabdf);return new Promise(_0x594e8c=>{_0x41d04b['_isPendingUpdate']?_0x41d04b[_0x5167('0x3e')](_0x5167('0x3d'),()=>{_0x594e8c(this['_getLatestVersionFromServerOperations']());}):_0x594e8c(this[_0x5167('0x20')]());});}['_handleRevisionsUpdate'](_0x342d7d,_0x5b32db){const _0x162275=this['_revisionTracker'][_0x5167('0x1d')];this[_0x5167('0x3')]=_0x5b32db;for(const _0x3c9628 of _0x342d7d){const _0x48dce5=_0x162275[_0x5167('0x6')](_0x3c9628['id']);if(_0x48dce5){if((_0x3c9628[_0x5167('0x5')]||_0x3c9628[_0x5167('0x12')])&&(_0x3c9628[_0x5167('0x39')]=null),_0x48dce5===this['_revisionTracker']['currentRevision']){const _0xf51f0f=Math[_0x5167('0x1b')](_0x48dce5[_0x5167('0x12')],_0x3c9628['toVersion']),_0x9c5ef6=Math[_0x5167('0x1b')](_0x48dce5[_0x5167('0x5')],_0x3c9628[_0x5167('0x5')]);let _0x2bc613;_0x48dce5['toVersion']===_0x3c9628[_0x5167('0x12')]&&_0x48dce5[_0x5167('0x5')]===_0x3c9628[_0x5167('0x5')]?(_0x2bc613=!0x0,this['_preventResendingRevisionData'](_0x3c9628)):_0x3c9628['toVersion']===_0xf51f0f&&_0x3c9628[_0x5167('0x5')]===_0x9c5ef6?_0x2bc613=!0x1:(_0x48dce5[_0x5167('0x12')]===_0xf51f0f&&_0x48dce5[_0x5167('0x5')]===_0x9c5ef6||this[_0x5167('0x41')]({'revision':_0x48dce5,'from':_0x9c5ef6,'to':_0xf51f0f}),_0x2bc613=!0x0),_0x2bc613&&(delete _0x3c9628[_0x5167('0x5')],delete _0x3c9628[_0x5167('0x12')],delete _0x3c9628['diffData'],delete _0x3c9628[_0x5167('0xa')],delete _0x3c9628[_0x5167('0x47')]);}this['_revisionTracker'][_0x5167('0x31')](_0x3c9628),this[_0x5167('0x43')](_0x3c9628);}else this[_0x5167('0x2e')][_0x5167('0x3f')](_0x3c9628);}const _0x19235e=_0x162275['getRevisions']();_0x19235e['reverse']();for(let _0x4d9a1e=0x0;_0x4d9a1e<_0x19235e[_0x5167('0x0')]-0x1;_0x4d9a1e++){const _0x43c3a1=_0x19235e[_0x4d9a1e],_0x24454b=_0x19235e[_0x4d9a1e+0x1];if(_0x43c3a1[_0x5167('0x5')]<_0x24454b[_0x5167('0x12')]){const _0x37d371=_0x24454b[_0x5167('0x12')],_0x2deac3=Math[_0x5167('0x1b')](_0x37d371,_0x43c3a1['toVersion']);this['_fixRevision']({'revision':_0x43c3a1,'from':_0x37d371,'to':_0x2deac3});}}}['_fixRevision']({revision:_0x4ada47,from:_0x458d27,to:_0x121c5f}={}){const _0x5902c2=this[_0x5167('0x27')]['plugins']['get']('Users'),_0x37d434=this[_0x5167('0x2e')]['buildRevisionData']({'revision':_0x4ada47,'from':_0x458d27,'to':_0x121c5f});_0x37d434[_0x5167('0x2')]=_0x37d434[_0x5167('0x47')][_0x5167('0xb')](_0x2d63fc=>_0x5902c2['getUser'](_0x2d63fc)),_0x4ada47[_0x5167('0x2b')](_0x37d434);}[_0x5167('0x43')](_0x363ac4){const _0x5a4555={};_0x5a4555['id']=_0x363ac4['id'];for(const _0x230f26 of Object['keys'](_0x363ac4))'id'!==_0x230f26&&(_0x5a4555[_0x230f26]=void 0x0);this['_revisionTracker'][_0x5167('0x42')](_0x5a4555['id'],_0x5a4555,!0x0);}[_0x5167('0x3a')](_0x5ec6b1){const _0x3ec92a=this[_0x5167('0x27')][_0x5167('0x44')][_0x5167('0x4e')](_0x37d9d7),{connection:_0x389bf8}=this['editor'][_0x5167('0x44')][_0x5167('0x4e')](_0x342a31),_0x36323d=new Set();for(const _0xbaf60e of _0x5ec6b1){for(const _0x1e9f21 of _0xbaf60e[_0x5167('0x47')])_0x5dc402(_0x1e9f21);_0xbaf60e[_0x5167('0x25')]&&_0x5dc402(_0xbaf60e[_0x5167('0x25')]);}return Promise[_0x5167('0x17')](Array[_0x5167('0x37')](_0x36323d,async _0x3177f8=>{const _0x360daf=await _0x2e2a2c[_0x5167('0x4e')](_0x389bf8,_0x3177f8);_0x3ec92a[_0x5167('0x48')](_0x3177f8)||_0x3ec92a[_0x5167('0xd')](_0x360daf);}));function _0x5dc402(_0x596804){_0x3ec92a[_0x5167('0x48')](_0x596804)||_0x36323d[_0x5167('0x32')](_0x596804);}}}function P(_0x10fc34){return _0x10fc34[_0x5167('0x4d')][_0x5167('0x36')](_0x5167('0x28'))||_0x10fc34[_0x5167('0x4d')][_0x5167('0x36')]('cloud-services-internal-error:\x20Not\x20connected.')||_0x10fc34[_0x5167('0x4d')][_0x5167('0x36')](_0x5167('0x2d'));}v[_0x5167('0x4f')]=_0x289288;