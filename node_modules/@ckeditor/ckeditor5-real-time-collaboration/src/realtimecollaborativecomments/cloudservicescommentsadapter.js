/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x34c2=['assign','cloud-services-internal-error:\x20Not\x20connected.','addComment','commentThreadId','cloud-services-internal-error:\x20Request\x20timeout.','register','commentAdded','setPermissions','unregister','cloudservicescommentsadapter-disconnect-not-exist','plugins','addToReconnectionStack','addCommentThread','connect','_connectService','removeComment','has','_terminateService','catch','init','destroy','comments','context','getComment','cloud-services-internal-error:\x20Comments\x20Service\x20is\x20not\x20connected.','_fetchMissingUsersForThreads','hasCommentThread','mySessionId','getCommentThread','_setUpService','_getService','requires','CommentsService','attributes','disconnect','sessionAdd:','adapter','set','commentId','getConnectedSessions','cloudservicescommentsadapter-connect-already-connected','delete','listenTo','config','removeCommentThread','update','commentRemoved','startsWith','CommentsRepository','getCommentThreads','content','commentUpdated','map','collaboration.channelId','Permissions','createdAt','remove','reconnect','message','code','_services','getUser','get','userId','from'];(function(_0x236d45,_0x34c212){const _0x3d824e=function(_0x278ce8){while(--_0x278ce8){_0x236d45['push'](_0x236d45['shift']());}};_0x3d824e(++_0x34c212);}(_0x34c2,0xf8));const _0x3d82=function(_0x236d45,_0x34c212){_0x236d45=_0x236d45-0x0;let _0x3d824e=_0x34c2[_0x236d45];return _0x3d824e;};import{Context as _0x5d4cc6,ContextPlugin as _0xaffab3}from'ckeditor5/src/core';import{CKEditorError as _0x1a77a7}from'ckeditor5/src/utils';import{Users as _0x33f2e4}from'ckeditor5-collaboration/src/collaboration-core';import _0x13953c from'@ckeditor/ckeditor-cloud-services-collaboration/src/users/user';import _0x50c9c7 from'@ckeditor/ckeditor-cloud-services-collaboration/src/comments-v2/commentsservice';import _0x2c7be5 from'../realtimecollaborativeediting/websocketgateway';import _0x27dc55 from'../realtimecollaborativeediting/sessions';export default class a extends _0xaffab3{static get[_0x3d82('0x2b')](){return[_0x2c7be5,_0x3d82('0x3c'),_0x27dc55,_0x33f2e4];}constructor(_0x5276f4){super(_0x5276f4),this[_0x3d82('0x7')]=new Map();}async[_0x3d82('0x1f')](){const _0x27514a=this[_0x3d82('0x22')],_0x3207a1=_0x27514a[_0x3d82('0x16')][_0x3d82('0x9')](_0x3d82('0x3c'));if(_0x27514a[_0x3d82('0x16')][_0x3d82('0x9')](_0x2c7be5)[_0x3d82('0x17')](this),_0x3207a1[_0x3d82('0x30')]={'getCommentThread':async({channelId:_0x32071b,threadId:_0x1025d7})=>{const _0x5c1023=await this['_getService'](_0x32071b)[_0x3d82('0x28')](_0x1025d7)[_0x3d82('0x1e')](Q);return await this['_fetchMissingUsersForThreads']([_0x5c1023]),{'threadId':_0x5c1023[_0x3d82('0xf')],'comments':_0x5c1023[_0x3d82('0x21')][_0x3d82('0x40')](X)};},'removeCommentThread':({channelId:_0x30a948,threadId:_0x5d5158})=>this[_0x3d82('0x2a')](_0x30a948)[_0x3d82('0x38')](_0x5d5158)['catch'](K)['catch'](Q),'addComment':({channelId:_0x57811a,threadId:_0x363b45,commentId:_0x5040e8,content:_0x445383,attributes:_0x19fa16})=>this['_getService'](_0x57811a)[_0x3d82('0xe')](_0x363b45,_0x5040e8,_0x445383,_0x19fa16)[_0x3d82('0x1e')](Q),'updateComment':({channelId:_0x2e61f6,threadId:_0x10d041,commentId:_0xd8cec3,content:_0x4a2699,attributes:_0x4d944f})=>this[_0x3d82('0x2a')](_0x2e61f6)['updateComment'](_0x10d041,_0xd8cec3,_0x4a2699,_0x4d944f)['catch'](K)[_0x3d82('0x1e')](Q),'removeComment':({channelId:_0x3adf2b,threadId:_0x467f96,commentId:_0x4b5e52})=>this[_0x3d82('0x2a')](_0x3adf2b)[_0x3d82('0x1b')](_0x467f96,_0x4b5e52)['catch'](K)[_0x3d82('0x1e')](Q)},_0x27514a instanceof _0x5d4cc6){const _0x5deb7a=_0x27514a[_0x3d82('0x37')][_0x3d82('0x9')](_0x3d82('0x0')),_0x21d22d=_0x27514a['plugins'][_0x3d82('0x9')](_0x27dc55);await this[_0x3d82('0x29')](_0x5deb7a);const _0x33519f=await this[_0x3d82('0x7')]['get'](_0x5deb7a)[_0x3d82('0x33')]();this[_0x3d82('0x36')](_0x21d22d,_0x3d82('0x2f')+_0x5deb7a,(_0x1bc847,{session:_0x59be2d})=>{_0x59be2d['id']===_0x21d22d[_0x3d82('0x27')]&&(_0x1bc847['off'](),this[_0x3d82('0x22')][_0x3d82('0x16')]['get'](_0x3d82('0x1'))[_0x3d82('0x13')](_0x59be2d['permissions'],_0x5deb7a));}),_0x21d22d[_0x3d82('0x11')](_0x5deb7a,_0x33519f);}}async['_setUpService'](_0x566873){if(this[_0x3d82('0x7')][_0x3d82('0x1c')](_0x566873))throw new _0x1a77a7(_0x3d82('0x34'),null,{'channelId':_0x566873});const _0x405e1e=this[_0x3d82('0x22')][_0x3d82('0x16')][_0x3d82('0x9')](_0x3d82('0x3c')),_0xfe0185=new a[(_0x3d82('0x2c'))](_0x566873);this[_0x3d82('0x7')][_0x3d82('0x31')](_0x566873,_0xfe0185),this[_0x3d82('0x36')](_0xfe0185,'commentThreadRemoved',(_0x5343ab,{commentThreadId:_0x21da0c})=>{const _0x110cce=_0x405e1e[_0x3d82('0x28')](_0x21da0c);_0x110cce&&_0x110cce[_0x3d82('0x3')]({'isFromAdapter':!0x0});}),this[_0x3d82('0x36')](_0xfe0185,_0x3d82('0x12'),(_0x2b932b,_0x5ce007)=>{const _0x405a30=_0x5ce007[_0x3d82('0xf')];_0x405e1e[_0x3d82('0x26')](_0x405a30)||_0x405e1e[_0x3d82('0x18')]({'channelId':_0x566873,'threadId':_0x405a30,'isFromAdapter':!0x0});const _0x2e129f=_0x405e1e[_0x3d82('0x28')](_0x405a30);_0x2e129f&&_0x2e129f['addComment'](Object[_0x3d82('0xc')](X(_0x5ce007),{'isFromAdapter':!0x0}));}),this[_0x3d82('0x36')](_0xfe0185,_0x3d82('0x3f'),(_0x40d14c,{commentThreadId:_0x57f8ec,commentId:_0x4f7575,content:_0x4098a9,attributes:_0x308dc1})=>{const _0x52d0de=_0x405e1e[_0x3d82('0x28')](_0x57f8ec);if(_0x52d0de){const _0x2f328a=_0x52d0de[_0x3d82('0x23')](_0x4f7575);_0x2f328a&&_0x2f328a['update']({'content':_0x4098a9,'attributes':_0x308dc1,'isFromAdapter':!0x0});}}),this[_0x3d82('0x36')](_0xfe0185,_0x3d82('0x3a'),(_0x275fec,{commentThreadId:_0x21af4b,commentId:_0x57319d})=>{const _0x5afb12=_0x405e1e['getCommentThread'](_0x21af4b);if(_0x5afb12){const _0x55f760=_0x5afb12[_0x3d82('0x23')](_0x57319d);_0x55f760&&_0x55f760[_0x3d82('0x3')]({'isFromAdapter':!0x0});}}),await this['_connectService'](_0x566873);}[_0x3d82('0x20')](){if(this[_0x3d82('0x22')]instanceof _0x5d4cc6){const _0x32b561=this[_0x3d82('0x22')][_0x3d82('0x37')][_0x3d82('0x9')]('collaboration.channelId');this[_0x3d82('0x1d')](_0x32b561);}}[_0x3d82('0x1d')](_0x14eebb){if(!this[_0x3d82('0x7')][_0x3d82('0x1c')](_0x14eebb))throw new _0x1a77a7(_0x3d82('0x15'),null,{'channelId':_0x14eebb});this['_getService'](_0x14eebb)[_0x3d82('0x2e')](),this[_0x3d82('0x7')][_0x3d82('0x35')](_0x14eebb);}async[_0x3d82('0x4')](){for(const _0x48561b of this[_0x3d82('0x7')]['keys']())await this[_0x3d82('0x1a')](_0x48561b);if(this['context']instanceof _0x5d4cc6){const _0x539935=this[_0x3d82('0x22')][_0x3d82('0x37')]['get'](_0x3d82('0x0')),_0x42d3cc=this[_0x3d82('0x22')][_0x3d82('0x16')][_0x3d82('0x9')](_0x27dc55);_0x42d3cc[_0x3d82('0x14')](_0x539935);const _0x3c3a71=await this['_services'][_0x3d82('0x9')](_0x539935)[_0x3d82('0x33')]();_0x42d3cc[_0x3d82('0x11')](_0x539935,_0x3c3a71);}}async[_0x3d82('0x1a')](_0x1be28d){const {connection:_0x5bf766}=this[_0x3d82('0x22')][_0x3d82('0x16')]['get'](_0x2c7be5),_0xcd7035=this[_0x3d82('0x22')][_0x3d82('0x16')][_0x3d82('0x9')]('CommentsRepository'),_0x50c4ae=this[_0x3d82('0x7')][_0x3d82('0x9')](_0x1be28d),_0x24ec16=await _0x50c4ae[_0x3d82('0x19')](_0x5bf766);await this[_0x3d82('0x25')](_0x24ec16);const _0x564a55=new Set(Array[_0x3d82('0xb')](_0xcd7035[_0x3d82('0x3d')]({'channelId':_0x1be28d}),_0x3fd82f=>_0x3fd82f['id']));for(const _0x654846 of _0x24ec16)_0x564a55[_0x3d82('0x35')](_0x654846['commentThreadId']);for(const _0x2aa5b3 of _0x564a55)_0xcd7035[_0x3d82('0x28')](_0x2aa5b3)[_0x3d82('0x3')]({'isFromAdapter':!0x0});for(const _0xaf8658 of _0x24ec16){let _0x5a3874=_0xcd7035[_0x3d82('0x28')](_0xaf8658[_0x3d82('0xf')]);_0x5a3874||(_0x5a3874=_0xcd7035[_0x3d82('0x18')]({'channelId':_0x1be28d,'threadId':_0xaf8658['commentThreadId'],'isFromAdapter':!0x0}));const _0x4c88f6=new Set(Array[_0x3d82('0xb')](_0x5a3874[_0x3d82('0x21')],_0x28259b=>_0x28259b['id']));for(const _0xfc5b4c of _0xaf8658[_0x3d82('0x21')])_0x4c88f6['delete'](_0xfc5b4c[_0x3d82('0x32')]);for(const _0x2c8bb9 of _0x4c88f6)_0x5a3874[_0x3d82('0x23')](_0x2c8bb9)[_0x3d82('0x3')]({'isFromAdapter':!0x0});for(const _0x3da444 of _0xaf8658['comments']){const _0x31d691=_0x5a3874[_0x3d82('0x23')](_0x3da444[_0x3d82('0x32')]);_0x31d691?_0x31d691[_0x3d82('0x3e')]!==_0x3da444['content']&&_0x31d691[_0x3d82('0x39')]({'content':_0x3da444[_0x3d82('0x3e')],'isFromAdapter':!0x0}):_0x5a3874[_0x3d82('0xe')](Object['assign'](X(_0x3da444),{'isFromAdapter':!0x0}));}}}[_0x3d82('0x2a')](_0x313793){if(!this[_0x3d82('0x7')]['has'](_0x313793))throw new _0x1a77a7('cloudservicescommentsadapter-service-not-exist',null,{'channelId':_0x313793});return this[_0x3d82('0x7')][_0x3d82('0x9')](_0x313793);}[_0x3d82('0x25')](_0x5d0214){const _0x574dbd=this['context'][_0x3d82('0x16')][_0x3d82('0x9')](_0x33f2e4),{connection:_0x490238}=this[_0x3d82('0x22')][_0x3d82('0x16')]['get'](_0x2c7be5),_0x35e5b2=new Set();for(const {comments:_0x345302}of _0x5d0214)for(const {userId:_0x20f8ac}of _0x345302)_0x574dbd[_0x3d82('0x8')](_0x20f8ac)||_0x35e5b2['add'](_0x20f8ac);return Promise['all'](Array[_0x3d82('0xb')](_0x35e5b2,async _0x4ef629=>{const _0x387ad7=await _0x13953c[_0x3d82('0x9')](_0x490238,_0x4ef629);_0x574dbd[_0x3d82('0x8')](_0x4ef629)||_0x574dbd['addUser'](_0x387ad7);}));}}async function K(_0x21c97e){if('404'!==_0x21c97e[_0x3d82('0x6')])throw _0x21c97e;}function Q(_0x31ffc3){if((_0x23c4d1=_0x31ffc3)['message'][_0x3d82('0x3b')](_0x3d82('0x24'))||_0x23c4d1[_0x3d82('0x5')][_0x3d82('0x3b')](_0x3d82('0xd'))||_0x23c4d1[_0x3d82('0x5')][_0x3d82('0x3b')](_0x3d82('0x10')))return new Promise(()=>{});var _0x23c4d1;throw _0x31ffc3;}function X(_0x2b13bc){return{'threadId':_0x2b13bc[_0x3d82('0xf')],'commentId':_0x2b13bc[_0x3d82('0x32')],'content':_0x2b13bc[_0x3d82('0x3e')],'createdAt':_0x2b13bc[_0x3d82('0x2')],'authorId':_0x2b13bc[_0x3d82('0xa')],'attributes':_0x2b13bc[_0x3d82('0x2d')]};}a[_0x3d82('0x2c')]=_0x50c9c7;