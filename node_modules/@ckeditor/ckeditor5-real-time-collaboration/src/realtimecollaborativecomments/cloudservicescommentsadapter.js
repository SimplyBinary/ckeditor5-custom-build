/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x5e13=['catch','remove','from','sessionAdd:','requires','unregister','hasCommentThread','content','_terminateService','startsWith','getComment','attributes','getConnectedSessions','commentThreadId','addUser','commentId','commentThreadRemoved','Permissions','all','add','cloud-services-internal-error:\x20Comments\x20Service\x20is\x20not\x20connected.','commentUpdated','adapter','message','updateComment','comments','cloudservicescommentsadapter-disconnect-not-exist','has','collaboration.channelId','init','setPermissions','_services','get','reconnect','createdAt','plugins','getCommentThread','404','map','_setUpService','_getService','cloud-services-internal-error:\x20Not\x20connected.','removeComment','destroy','cloudservicescommentsadapter-connect-already-connected','assign','removeCommentThread','_fetchMissingUsersForThreads','context','update','commentAdded','_connectService','set','connect','config','addComment','listenTo','addCommentThread','mySessionId','disconnect','keys','code','CommentsService','CommentsRepository','delete','getUser'];(function(_0xf6a37b,_0x5e1369){const _0x3d4f96=function(_0x54dd59){while(--_0x54dd59){_0xf6a37b['push'](_0xf6a37b['shift']());}};_0x3d4f96(++_0x5e1369);}(_0x5e13,0xa4));const _0x3d4f=function(_0xf6a37b,_0x5e1369){_0xf6a37b=_0xf6a37b-0x0;let _0x3d4f96=_0x5e13[_0xf6a37b];return _0x3d4f96;};import{Context as _0x5af091,ContextPlugin as _0x31e83f}from'ckeditor5/src/core';import{CKEditorError as _0x53dbeb}from'ckeditor5/src/utils';import{Users as _0x5f1bab}from'ckeditor5-collaboration/src/collaboration-core';import _0x1c2940 from'@ckeditor/ckeditor-cloud-services-collaboration/src/users/user';import _0x13dd61 from'@ckeditor/ckeditor-cloud-services-collaboration/src/comments-v2/commentsservice';import _0xdf21e3 from'../realtimecollaborativeediting/websocketgateway';import _0xaf9713 from'../realtimecollaborativeediting/sessions';export default class a extends _0x31e83f{static get[_0x3d4f('0x26')](){return[_0xdf21e3,_0x3d4f('0x1f'),_0xaf9713,_0x5f1bab];}constructor(_0xc5dfe){super(_0xc5dfe),this[_0x3d4f('0x41')]=new Map();}async[_0x3d4f('0x3f')](){const _0x383dfb=this[_0x3d4f('0x10')],_0x1d2527=_0x383dfb[_0x3d4f('0x3')][_0x3d4f('0x0')](_0x3d4f('0x1f'));if(_0x383dfb['plugins'][_0x3d4f('0x0')](_0xdf21e3)['addToReconnectionStack'](this),_0x1d2527[_0x3d4f('0x38')]={'getCommentThread':async({channelId:_0x28cb23,threadId:_0x263781})=>{const _0xf13d6a=await this[_0x3d4f('0x8')](_0x28cb23)[_0x3d4f('0x4')](_0x263781)[_0x3d4f('0x22')](R);return await this['_fetchMissingUsersForThreads']([_0xf13d6a]),{'threadId':_0xf13d6a[_0x3d4f('0x2f')],'comments':_0xf13d6a['comments'][_0x3d4f('0x6')](T)};},'removeCommentThread':({channelId:_0x2e2867,threadId:_0x48cf20})=>this['_getService'](_0x2e2867)[_0x3d4f('0xe')](_0x48cf20)[_0x3d4f('0x22')](S)[_0x3d4f('0x22')](R),'addComment':({channelId:_0x5d376f,threadId:_0x4237db,commentId:_0x16d7a0,content:_0x12cb25,attributes:_0x3cf488})=>this[_0x3d4f('0x8')](_0x5d376f)[_0x3d4f('0x17')](_0x4237db,_0x16d7a0,_0x12cb25,_0x3cf488)[_0x3d4f('0x22')](R),'updateComment':({channelId:_0x5ba47f,threadId:_0xe4fcd7,commentId:_0x513a53,content:_0x304a92,attributes:_0x429972})=>this[_0x3d4f('0x8')](_0x5ba47f)[_0x3d4f('0x3a')](_0xe4fcd7,_0x513a53,_0x304a92,_0x429972)['catch'](S)[_0x3d4f('0x22')](R),'removeComment':({channelId:_0x593b6a,threadId:_0x1b39cd,commentId:_0x2bc103})=>this['_getService'](_0x593b6a)[_0x3d4f('0xa')](_0x1b39cd,_0x2bc103)[_0x3d4f('0x22')](S)[_0x3d4f('0x22')](R)},_0x383dfb instanceof _0x5af091){const _0x4eb949=_0x383dfb[_0x3d4f('0x16')][_0x3d4f('0x0')]('collaboration.channelId'),_0xcee023=_0x383dfb['plugins']['get'](_0xaf9713);await this[_0x3d4f('0x7')](_0x4eb949);const _0x2c1911=await this[_0x3d4f('0x41')][_0x3d4f('0x0')](_0x4eb949)[_0x3d4f('0x2e')]();this[_0x3d4f('0x18')](_0xcee023,_0x3d4f('0x25')+_0x4eb949,(_0x279cef,{session:_0x59af35})=>{_0x59af35['id']===_0xcee023[_0x3d4f('0x1a')]&&(_0x279cef['off'](),this[_0x3d4f('0x10')][_0x3d4f('0x3')]['get'](_0x3d4f('0x33'))[_0x3d4f('0x40')](_0x59af35['permissions'],_0x4eb949));}),_0xcee023['register'](_0x4eb949,_0x2c1911);}}async[_0x3d4f('0x7')](_0x3baf4a){if(this['_services'][_0x3d4f('0x3d')](_0x3baf4a))throw new _0x53dbeb(_0x3d4f('0xc'),null,{'channelId':_0x3baf4a});const _0x2f246d=this[_0x3d4f('0x10')][_0x3d4f('0x3')][_0x3d4f('0x0')](_0x3d4f('0x1f')),_0x21d08f=new a['CommentsService'](_0x3baf4a);this[_0x3d4f('0x41')][_0x3d4f('0x14')](_0x3baf4a,_0x21d08f),this['listenTo'](_0x21d08f,_0x3d4f('0x32'),(_0x384941,{commentThreadId:_0x2c90f2})=>{const _0x531d45=_0x2f246d[_0x3d4f('0x4')](_0x2c90f2);_0x531d45&&_0x531d45['remove']({'isFromAdapter':!0x0});}),this['listenTo'](_0x21d08f,_0x3d4f('0x12'),(_0x49f760,_0x5f25a2)=>{const _0x314c05=_0x5f25a2[_0x3d4f('0x2f')];_0x2f246d[_0x3d4f('0x28')](_0x314c05)||_0x2f246d[_0x3d4f('0x19')]({'channelId':_0x3baf4a,'threadId':_0x314c05,'isFromAdapter':!0x0});const _0x40f8b9=_0x2f246d[_0x3d4f('0x4')](_0x314c05);_0x40f8b9&&_0x40f8b9['addComment'](Object[_0x3d4f('0xd')](T(_0x5f25a2),{'isFromAdapter':!0x0}));}),this[_0x3d4f('0x18')](_0x21d08f,_0x3d4f('0x37'),(_0x2ffb16,{commentThreadId:_0x1d7361,commentId:_0x331e06,content:_0x37f542,attributes:_0x107e95})=>{const _0x9592b=_0x2f246d[_0x3d4f('0x4')](_0x1d7361);if(_0x9592b){const _0x58ce37=_0x9592b[_0x3d4f('0x2c')](_0x331e06);_0x58ce37&&_0x58ce37[_0x3d4f('0x11')]({'content':_0x37f542,'attributes':_0x107e95,'isFromAdapter':!0x0});}}),this[_0x3d4f('0x18')](_0x21d08f,'commentRemoved',(_0x47b204,{commentThreadId:_0x39484e,commentId:_0x4d32c8})=>{const _0x21ecd0=_0x2f246d[_0x3d4f('0x4')](_0x39484e);if(_0x21ecd0){const _0x53350a=_0x21ecd0[_0x3d4f('0x2c')](_0x4d32c8);_0x53350a&&_0x53350a[_0x3d4f('0x23')]({'isFromAdapter':!0x0});}}),await this[_0x3d4f('0x13')](_0x3baf4a);}[_0x3d4f('0xb')](){if(this['context']instanceof _0x5af091){const _0x34e28b=this[_0x3d4f('0x10')][_0x3d4f('0x16')][_0x3d4f('0x0')](_0x3d4f('0x3e'));this[_0x3d4f('0x2a')](_0x34e28b);}}[_0x3d4f('0x2a')](_0x3de736){if(!this['_services'][_0x3d4f('0x3d')](_0x3de736))throw new _0x53dbeb(_0x3d4f('0x3c'),null,{'channelId':_0x3de736});this[_0x3d4f('0x8')](_0x3de736)[_0x3d4f('0x1b')](),this[_0x3d4f('0x41')][_0x3d4f('0x20')](_0x3de736);}async[_0x3d4f('0x1')](){for(const _0x1f60f1 of this[_0x3d4f('0x41')][_0x3d4f('0x1c')]())await this['_connectService'](_0x1f60f1);if(this[_0x3d4f('0x10')]instanceof _0x5af091){const _0x3a5adb=this[_0x3d4f('0x10')][_0x3d4f('0x16')][_0x3d4f('0x0')]('collaboration.channelId'),_0x93709e=this[_0x3d4f('0x10')]['plugins'][_0x3d4f('0x0')](_0xaf9713);_0x93709e[_0x3d4f('0x27')](_0x3a5adb);const _0x152dd2=await this[_0x3d4f('0x41')][_0x3d4f('0x0')](_0x3a5adb)['getConnectedSessions']();_0x93709e['register'](_0x3a5adb,_0x152dd2);}}async['_connectService'](_0x5b65b6){const {connection:_0x2877f8}=this[_0x3d4f('0x10')][_0x3d4f('0x3')][_0x3d4f('0x0')](_0xdf21e3),_0x1088db=this[_0x3d4f('0x10')][_0x3d4f('0x3')][_0x3d4f('0x0')](_0x3d4f('0x1f')),_0x553633=this[_0x3d4f('0x41')][_0x3d4f('0x0')](_0x5b65b6),_0x3562f0=await _0x553633[_0x3d4f('0x15')](_0x2877f8);await this['_fetchMissingUsersForThreads'](_0x3562f0);const _0x5d3d77=new Set(Array[_0x3d4f('0x24')](_0x1088db['getCommentThreads']({'channelId':_0x5b65b6}),_0x4f8eff=>_0x4f8eff['id']));for(const _0x50c589 of _0x3562f0)_0x5d3d77[_0x3d4f('0x20')](_0x50c589['commentThreadId']);for(const _0x15e9de of _0x5d3d77)_0x1088db['getCommentThread'](_0x15e9de)[_0x3d4f('0x23')]({'isFromAdapter':!0x0});for(const _0x690bb of _0x3562f0){let _0x4618fc=_0x1088db[_0x3d4f('0x4')](_0x690bb[_0x3d4f('0x2f')]);_0x4618fc||(_0x4618fc=_0x1088db[_0x3d4f('0x19')]({'channelId':_0x5b65b6,'threadId':_0x690bb[_0x3d4f('0x2f')],'isFromAdapter':!0x0}));const _0x4b3ceb=new Set(Array[_0x3d4f('0x24')](_0x4618fc[_0x3d4f('0x3b')],_0x4289e8=>_0x4289e8['id']));for(const _0x15f938 of _0x690bb[_0x3d4f('0x3b')])_0x4b3ceb['delete'](_0x15f938[_0x3d4f('0x31')]);for(const _0x11fa47 of _0x4b3ceb)_0x4618fc[_0x3d4f('0x2c')](_0x11fa47)[_0x3d4f('0x23')]({'isFromAdapter':!0x0});for(const _0x251dee of _0x690bb[_0x3d4f('0x3b')]){const _0x346f83=_0x4618fc['getComment'](_0x251dee[_0x3d4f('0x31')]);_0x346f83?_0x346f83[_0x3d4f('0x29')]!==_0x251dee[_0x3d4f('0x29')]&&_0x346f83[_0x3d4f('0x11')]({'content':_0x251dee[_0x3d4f('0x29')],'isFromAdapter':!0x0}):_0x4618fc[_0x3d4f('0x17')](Object[_0x3d4f('0xd')](T(_0x251dee),{'isFromAdapter':!0x0}));}}}['_getService'](_0x4760c5){if(!this[_0x3d4f('0x41')][_0x3d4f('0x3d')](_0x4760c5))throw new _0x53dbeb('cloudservicescommentsadapter-service-not-exist',null,{'channelId':_0x4760c5});return this[_0x3d4f('0x41')][_0x3d4f('0x0')](_0x4760c5);}[_0x3d4f('0xf')](_0x445751){const _0x3c03a0=this[_0x3d4f('0x10')][_0x3d4f('0x3')]['get'](_0x5f1bab),{connection:_0x30fbc9}=this[_0x3d4f('0x10')]['plugins'][_0x3d4f('0x0')](_0xdf21e3),_0x27a7ba=new Set();for(const {comments:_0x16a591}of _0x445751)for(const {userId:_0x347ccb}of _0x16a591)_0x3c03a0[_0x3d4f('0x21')](_0x347ccb)||_0x27a7ba[_0x3d4f('0x35')](_0x347ccb);return Promise[_0x3d4f('0x34')](Array['from'](_0x27a7ba,async _0x41d0ba=>{const _0x48fb0a=await _0x1c2940[_0x3d4f('0x0')](_0x30fbc9,_0x41d0ba);_0x3c03a0[_0x3d4f('0x21')](_0x41d0ba)||_0x3c03a0[_0x3d4f('0x30')](_0x48fb0a);}));}}async function S(_0x4846e5){if(_0x3d4f('0x5')!==_0x4846e5[_0x3d4f('0x1d')])throw _0x4846e5;}function R(_0x1fdecb){if((_0x53894e=_0x1fdecb)[_0x3d4f('0x39')]['startsWith'](_0x3d4f('0x36'))||_0x53894e['message'][_0x3d4f('0x2b')](_0x3d4f('0x9'))||_0x53894e[_0x3d4f('0x39')][_0x3d4f('0x2b')]('cloud-services-internal-error:\x20Request\x20timeout.'))return new Promise(()=>{});var _0x53894e;throw _0x1fdecb;}function T(_0x87398e){return{'threadId':_0x87398e['commentThreadId'],'commentId':_0x87398e[_0x3d4f('0x31')],'content':_0x87398e[_0x3d4f('0x29')],'createdAt':_0x87398e[_0x3d4f('0x2')],'authorId':_0x87398e['userId'],'attributes':_0x87398e[_0x3d4f('0x2d')]};}a[_0x3d4f('0x1e')]=_0x13dd61;