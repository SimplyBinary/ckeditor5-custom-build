/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x382f2c}from'ckeditor5/src/core';import _0x5907d2 from'./commentsrepository';import _0x539fb6 from'./commentsediting';import _0x3d8537 from'../annotations/editorannotations';import{ButtonView as mt}from'ckeditor5/src/ui';import at from'../../theme/icons/add-comment.svg';import _0x73c543 from'../annotations/annotations';import ct from'./ui/view/commentslistview';import dt from'./ui/view/commentthreadinputview';export default class n extends _0x382f2c{static get['pluginName'](){return'CommentsUI';}static get['requires'](){return[_0x5907d2,_0x539fb6,_0x3d8537,_0x73c543];}get['CommentsListView'](){return ct;}get['CommentThreadInputView'](){return dt;}['init'](){const _0x662852=this['editor'],_0x5a1e62=_0x662852['plugins']['get'](_0x5907d2),_0x39ac91=_0x662852['plugins']['get'](_0x539fb6),_0x4a1c6a=_0x662852['plugins']['get'](_0x73c543),_0x5e73e9=_0x662852['plugins']['get'](_0x3d8537);_0x662852['ui']['componentFactory']['add']('comment',()=>this['_createUIButton']()),_0x5e73e9['addSourceCollector'](()=>{const _0x5c4bd3=[];for(const [_0x173691,_0x1eeca8]of _0x5a1e62['_threadToController']){const _0x46b91d=_0x39ac91['getAllMarkersForId'](_0x173691['id']),_0x402643=_0x46b91d['map'](_0x3dc3e8=>_0x3dc3e8['getRange']());_0x46b91d['length']>0x0&&_0x5c4bd3['push']([_0x1eeca8['view'],_0x402643]);}return _0x5c4bd3;}),this['listenTo'](_0x4a1c6a,'change:activeAnnotations',(_0x31f9c5,_0x34b146,_0x3bf392)=>{const _0x420251=Array['from'](_0x3bf392)['map'](_0x26677a=>_0x26677a['innerView'])['find'](_0x32ae83=>_0x5a1e62['_viewToController']['has'](_0x32ae83));if(!_0x420251)return void(_0x39ac91['activeMarker']=null);const _0x54e74d=_0x5a1e62['_viewToController']['get'](_0x420251)['model']['id'],_0x3dc210='comment:'+_0x54e74d;_0x39ac91['hasMarkerForId'](_0x54e74d)?_0x39ac91['activeMarker']=_0x3dc210:_0x39ac91['activeMarker']&&(_0x39ac91['activeMarker']=null);}),this['listenTo'](_0x5a1e62,'removeCommentThread',(_0x3eb061,{threadId:_0x121325,isFromAdapter:_0x420349})=>{!_0x420349&&_0x662852['ui']['focusTracker']['isFocused']&&_0x39ac91['hasMarkerForId'](_0x121325)&&_0x662852['editing']['view']['focus']();},{'priority':'highest'}),this['listenTo'](_0x5a1e62,'addComment',(_0xa8271b,{threadId:_0x22ae59,isFromAdapter:_0x589583})=>{if(_0x589583||!_0x39ac91['hasMarkerForId'](_0x22ae59)||!_0x5a1e62['hasCommentThread'](_0x22ae59))return;0x1===_0x5a1e62['getCommentThread'](_0x22ae59)['length']&&(_0x662852['editing']['view']['focus'](),_0xa8271b['stop']());},{'priority':'low'});}['_createUIButton'](){const _0x14575f=this['editor'],_0x35ec17=new mt(_0x14575f['locale']),_0x43333d=_0x14575f['commands']['get']('addCommentThread'),{t:t}=this['editor']['locale'];return _0x35ec17['label']=t('Comment'),_0x35ec17['tooltip']=t('Comment'),_0x35ec17['icon']=at,_0x35ec17['bind']('isEnabled')['to'](_0x43333d),this['listenTo'](_0x35ec17,'execute',()=>_0x43333d['execute']()),_0x35ec17;}}