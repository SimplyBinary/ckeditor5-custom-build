/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x4998=['isObject','isEqual','top','_attachThreadToMarker','markerToData','_initializeMarkerConverters','createPositionBefore','fetchCommentThread','addComment','destroyed','createElement','_threads','collaboration.channelId','text','add','config','has','change:isReadOnly','conversion','_attachedThreads','addCommentThread','switchReadOnly','hasCommentThread','CommentsRepository','change:activeMarker','left','delete','getChangedMarkers','ready','getCommentThread','activeMarker','registerPostFixer','start','render','markers','set','stop','createRange','getMarkersGroup','differ','upcast','_detachCommentThread','for','length','size','document','getCommentThreads','ck-comment-marker','split','then','removeMarker','plugins','high','editing','newRange','model','dataDowncast','dataToMarker','pluginName','$marker','map','openNewCommentThread','view','comment:','destroy','hasMarkerForId','getAllMarkersForId','change','sort','push','editingDowncast','low','isCollapsed','listenTo','ck-comment-marker--active','schema','managedUsingOperations','markerName','reconvertMarker','init','affectsData','updateMarker','_handleMarkerAddAndRemove','editor','hasContent','comment','root','get'];(function(_0x52520b,_0x4998d6){const _0x569a97=function(_0x28a949){while(--_0x28a949){_0x52520b['push'](_0x52520b['shift']());}};_0x569a97(++_0x4998d6);}(_0x4998,0x1be));const _0x569a=function(_0x52520b,_0x4998d6){_0x52520b=_0x52520b-0x0;let _0x569a97=_0x4998[_0x52520b];return _0x569a97;};import{Plugin as _0x2589ea}from'ckeditor5/src/core';import{Rect as _0x226e55}from'ckeditor5/src/utils';import _0xbdfbc5 from'./commentsrepository';import _0x10e4f4 from'./addcommentthreadcommand';import{getMarkerDomElement as _0x141831}from'ckeditor5-collaboration/src/collaboration-core';import _0x40e1e5 from'./integrations/commentsrestrictededitingmode';import'../../theme/commentmarker.css';export default class r extends _0x2589ea{static get['requires'](){return[_0xbdfbc5,_0x40e1e5];}static get[_0x569a('0x34')](){return'CommentsEditing';}constructor(_0x417a3f){super(_0x417a3f),this[_0x569a('0x1d')]('isThreadsLoadingPaused',!0x0),_0x417a3f['data']['once'](_0x569a('0x16'),()=>this['isThreadsLoadingPaused']=!0x1),this[_0x569a('0x1d')](_0x569a('0x18'),null),this['on'](_0x569a('0x12'),(_0x2c3f2e,_0x424143,_0x1e8855,_0x484980)=>{_0x417a3f['model'][_0x569a('0x3d')](()=>{if(_0x1e8855){const {id:_0x37e1de}=G(_0x1e8855),_0x15e741=this['getAllMarkersForId'](_0x37e1de);for(const _0x51782d of _0x15e741)_0x417a3f[_0x569a('0x2f')][_0x569a('0x48')](_0x51782d);}if(_0x484980){const {id:_0x3ae01d}=G(_0x484980),_0x5a1c12=this['getAllMarkersForId'](_0x3ae01d);for(const _0x192f01 of _0x5a1c12)_0x417a3f['editing'][_0x569a('0x48')](_0x192f01);}});}),this['_attachedThreads']=new Set();}[_0x569a('0x49')](){const _0x532019=this['editor'],_0xa47d4c=_0x532019[_0x569a('0x2d')][_0x569a('0x51')]('CommentsRepository'),_0x43a74b=_0x532019[_0x569a('0x9')][_0x569a('0x51')](_0x569a('0x6'));_0x532019['commands']['add'](_0x569a('0xe'),new _0x10e4f4(_0x532019)),this[_0x569a('0x43')](_0x532019,_0x569a('0xb'),(_0x2aafab,_0x2c82ab,_0x5275de)=>{_0xa47d4c[_0x569a('0xf')](_0x5275de,_0x532019[_0x569a('0x9')]['get'](_0x569a('0x6')));}),this[_0x569a('0x43')](_0xa47d4c,q('removeCommentThread',_0x43a74b),(_0x316007,{threadId:_0x8615fb})=>{_0x532019[_0x569a('0x31')][_0x569a('0x3d')](_0x12d375=>{for(const _0x44e71e of this[_0x569a('0x3c')](_0x8615fb))_0x12d375[_0x569a('0x2c')](_0x44e71e);});const _0x35ae81=_0xa47d4c[_0x569a('0x17')](_0x8615fb);_0xa47d4c[_0x569a('0x10')](_0x8615fb)&&!_0x35ae81[_0x569a('0x25')]||_0x316007[_0x569a('0x1e')]();},{'priority':_0x569a('0x2e')}),this[_0x569a('0x43')](_0xa47d4c,q(_0x569a('0x2'),_0x43a74b),(_0x5c5bcc,{threadId:_0xa9c6fd,isFromAdapter:_0x2b13e2})=>{const _0x4593e2=this[_0x569a('0x3c')](_0xa9c6fd);if(_0x2b13e2||0x0==_0x4593e2[_0x569a('0x25')]||!_0xa47d4c[_0x569a('0x10')](_0xa9c6fd))return;0x1===_0xa47d4c[_0x569a('0x17')](_0xa9c6fd)['length']&&_0x532019['model'][_0x569a('0x3d')](_0x5c1100=>{for(const _0x27028d of _0x4593e2)_0x5c1100['updateMarker'](_0x27028d,{'usingOperation':!0x0,'affectsData':!0x0});});},{'priority':_0x569a('0x41')}),this[_0x569a('0x57')](),this[_0x569a('0x4c')]();}[_0x569a('0x3a')](){const _0x499d49=this[_0x569a('0x4d')][_0x569a('0x2d')][_0x569a('0x51')](_0x569a('0x11')),_0x1ed106=this[_0x569a('0x4d')]['config'][_0x569a('0x51')](_0x569a('0x6'));for(const _0x3300db of _0x499d49[_0x569a('0x28')]({'channelId':_0x1ed106}))_0x499d49[_0x569a('0x23')](_0x3300db['id']),_0x499d49[_0x569a('0x5')][_0x569a('0x14')](_0x3300db['id']);super[_0x569a('0x3a')]();}[_0x569a('0x3b')](_0x5f202c){return this[_0x569a('0x3c')](_0x5f202c)['length']>0x0;}[_0x569a('0x3c')](_0x1d0991){const _0x2b3ea8=this[_0x569a('0x4d')]['model'][_0x569a('0x1c')][_0x569a('0x51')](_0x569a('0x39')+_0x1d0991);return _0x2b3ea8?[_0x2b3ea8]:Array['from'](this['editor'][_0x569a('0x31')][_0x569a('0x1c')][_0x569a('0x20')](_0x569a('0x39')+_0x1d0991));}[_0x569a('0x57')](){const _0x407d57=this[_0x569a('0x4d')];_0x407d57[_0x569a('0xc')][_0x569a('0x24')](_0x569a('0x40'))['markerToHighlight']({'model':_0x569a('0x4f'),'view':_0x55729e=>{const {id:_0x38de79}=G(_0x55729e[_0x569a('0x47')]),_0x315d9f=[_0x569a('0x29')];return this['activeMarker']&&G(this[_0x569a('0x18')])['id']===_0x38de79&&_0x315d9f[_0x569a('0x3f')](_0x569a('0x44')),{'classes':_0x315d9f,'attributes':{'data-comment':_0x38de79}};}}),_0x407d57[_0x569a('0xc')][_0x569a('0x24')](_0x569a('0x32'))[_0x569a('0x56')]({'model':_0x569a('0x4f'),'view':_0x389057=>{const _0x3a37bc=_0x407d57[_0x569a('0x31')][_0x569a('0x1c')][_0x569a('0x51')](_0x389057),{id:_0x5efc2c,part:_0x3ff2af}=G(_0x389057);return _0x3a37bc&&!_0x3a37bc[_0x569a('0x4a')]?null:{'group':_0x569a('0x4f'),'name':_0x3ff2af?_0x5efc2c+':'+_0x3ff2af:_0x5efc2c};}}),_0x407d57[_0x569a('0xc')][_0x569a('0x24')](_0x569a('0x22'))['elementToElement']({'view':{'name':_0x569a('0x4f'),'attribute':{'id':/^\w/}},'model':(_0x351038,{writer:_0x6d7650})=>_0x6d7650[_0x569a('0x4')](_0x569a('0x35'),{'data-name':'comment:'+_0x351038['getAttribute']('id')})}),_0x407d57[_0x569a('0xc')][_0x569a('0x24')](_0x569a('0x22'))[_0x569a('0x33')]({'view':_0x569a('0x4f')});}[_0x569a('0x4c')](){const _0x106a80=this['editor'],_0x25d0dd=_0x106a80[_0x569a('0x2d')][_0x569a('0x51')](_0x569a('0x11')),_0x4dc6d7=new Set();_0x106a80[_0x569a('0x31')][_0x569a('0x27')][_0x569a('0x19')](_0x3440b3=>{let _0x574cb1=!0x1;for(const {name:_0x88931d,data:_0x319039}of _0x106a80[_0x569a('0x31')]['document'][_0x569a('0x21')][_0x569a('0x15')]()){const {group:_0x384456,id:_0x5e0c4b}=G(_0x88931d);let _0x2dbf50=_0x319039[_0x569a('0x30')];if('comment'!==_0x384456||!_0x2dbf50)continue;const _0x4dc5fd='$graveyard'===_0x2dbf50[_0x569a('0x50')]['rootName'];_0x4dc5fd||(_0x2dbf50=J(_0x2dbf50,_0x106a80[_0x569a('0x31')]),!_0x2dbf50||_0x2dbf50[_0x569a('0x53')](_0x319039[_0x569a('0x30')]))?!_0x2dbf50||!_0x106a80[_0x569a('0x31')][_0x569a('0x4e')](_0x2dbf50)||this[_0x569a('0xd')][_0x569a('0xa')](_0x5e0c4b)&&_0x4dc5fd?(_0x3440b3[_0x569a('0x2c')](_0x88931d),_0x574cb1=!0x0):_0x4dc5fd||(this['isThreadsLoadingPaused']?_0x4dc6d7[_0x569a('0x8')](_0x5e0c4b):this['_attachThreadToMarker'](_0x5e0c4b)):(_0x3440b3[_0x569a('0x4b')](_0x88931d,{'range':_0x2dbf50}),_0x574cb1=!0x0);}return _0x574cb1;}),this['on']('change:isThreadsLoadingPaused',(_0x2c0e67,_0x38921b,_0x1d98b8)=>{if(!_0x1d98b8&&_0x4dc6d7[_0x569a('0x26')])for(const _0x2dc331 of _0x4dc6d7)this[_0x569a('0x55')](_0x2dc331),_0x4dc6d7[_0x569a('0x14')](_0x2dc331);}),this[_0x569a('0x43')](_0x106a80[_0x569a('0x31')][_0x569a('0x1c')],'update:comment',(_0x558389,_0x2fb3d4,_0x1e4067,_0x4ce864)=>{if(_0x4ce864)return;const {id:_0x3136fb}=G(_0x2fb3d4['name']),_0x48c16d=_0x106a80[_0x569a('0x2d')][_0x569a('0x51')](_0x569a('0x11'))[_0x569a('0x17')](_0x3136fb);_0x4dc6d7['delete'](_0x3136fb),_0x48c16d&&!this[_0x569a('0x3b')](_0x3136fb)&&(this[_0x569a('0xd')][_0x569a('0x14')](_0x3136fb),_0x25d0dd[_0x569a('0x23')](_0x3136fb));});}[_0x569a('0x55')](_0x474b21){if(this[_0x569a('0xd')][_0x569a('0xa')](_0x474b21))return;this[_0x569a('0xd')][_0x569a('0x8')](_0x474b21);const _0x2ed2cb=this[_0x569a('0x4d')],_0x590c7b=_0x2ed2cb['plugins'][_0x569a('0x51')](_0x569a('0x11')),_0x439c83=_0x2ed2cb[_0x569a('0x9')][_0x569a('0x51')]('collaboration.channelId'),_0x10d319=()=>{const _0x204583=this['getAllMarkersForId'](_0x474b21);if(0x0==_0x204583[_0x569a('0x25')])return null;const _0x1ef15a=_0x204583[_0x569a('0x36')](_0x19dd09=>_0x141831(_0x2ed2cb[_0x569a('0x2f')],_0x19dd09));return _0x1ef15a[_0x569a('0x3e')]((_0x5bad4e,_0x16d5be)=>{const _0x4e0dcd=new _0x226e55(_0x5bad4e),_0x41439c=new _0x226e55(_0x16d5be),_0x261626=_0x4e0dcd[_0x569a('0x54')]-_0x41439c['top'];return 0x0==_0x261626?_0x4e0dcd[_0x569a('0x13')]-_0x41439c[_0x569a('0x13')]:_0x261626;}),_0x1ef15a[0x0];};!this[_0x569a('0x3c')](_0x474b21)[0x0][_0x569a('0x46')]?_0x2ed2cb[_0x569a('0x2f')][_0x569a('0x38')]['once'](_0x569a('0x1b'),()=>{_0x590c7b[_0x569a('0x37')]({'channelId':_0x439c83,'threadId':_0x474b21,'target':_0x10d319});},{'priority':_0x569a('0x41')}):_0x590c7b[_0x569a('0x1')]({'channelId':_0x439c83,'threadId':_0x474b21})[_0x569a('0x2b')](_0x52aeb2=>{if(_0x569a('0x3')!==_0x2ed2cb['state']){if(_0x52aeb2)_0x52aeb2['attachTo'](_0x10d319);else{const _0xa0dc9=this[_0x569a('0x3c')](_0x474b21);_0x2ed2cb[_0x569a('0x31')][_0x569a('0x3d')](_0x348364=>{for(const _0xa7f2f of _0xa0dc9)_0x348364[_0x569a('0x2c')](_0xa7f2f);});}}});}}function q(_0x35af8a,_0x4b7225){return _0x4b7225?_0x35af8a+':'+_0x4b7225:_0x35af8a;}function G(_0x389759){const _0x1f59f4=_0x389759[_0x569a('0x2a')](':');return{'group':_0x1f59f4[0x0],'id':_0x1f59f4[0x1],'part':_0x1f59f4[0x2]};}function J(_0x15ce98,_0x54aa1f){const _0x33fb25=_0x54aa1f[_0x569a('0x45')],_0x3fb16f=_0x54aa1f[_0x569a('0x1f')](_0x15ce98[_0x569a('0x1a')]);for(const _0x8913b5 of _0x15ce98['getWalker']()){const {type:_0x53579c,item:_0x2c2916,nextPosition:_0xad707d}=_0x8913b5;if(_0x569a('0x7')===_0x53579c||_0x33fb25[_0x569a('0x52')](_0x2c2916)){const _0x2d336e=_0x54aa1f[_0x569a('0x0')](_0x2c2916);_0x3fb16f['isCollapsed']&&(_0x3fb16f[_0x569a('0x1a')]=_0x2d336e),_0x3fb16f['end']=_0xad707d;}}return _0x3fb16f[_0x569a('0x42')]?null:_0x3fb16f;}