/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x8627=['left','view','registerPostFixer','markers','split','createElement','length','document','ck-comment-marker','destroyed','_attachedThreads','affectsData','comment:','activeMarker','isObject','updateMarker','model','rootName','destroy','fetchCommentThread','state','isThreadsLoadingPaused','pluginName','getAllMarkersForId','$graveyard','start','elementToElement','from','editor','has','CommentsRepository','dataToMarker','ck-comment-marker--active','change','ready','markerName','switchReadOnly','requires','editingDowncast','_initializeMarkerConverters','_attachThreadToMarker','hasMarkerForId','createRange','end','config','then','listenTo','upcast','set','add','change:isReadOnly','delete','newRange','_threads','push','once','name','_handleMarkerAddAndRemove','addCommentThread','managedUsingOperations','isCollapsed','editing','removeMarker','getMarkersGroup','root','createPositionBefore','data','isEqual','markerToData','getWalker','_detachCommentThread','hasContent','get','conversion','top','addComment','high','low','getCommentThread','plugins','for','getAttribute','markerToHighlight','hasCommentThread','change:activeMarker','text','getCommentThreads','openNewCommentThread','reconvertMarker','getChangedMarkers','collaboration.channelId','stop','CommentsEditing','comment'];(function(_0x254eab,_0x862765){const _0x3cb2ef=function(_0x21210e){while(--_0x21210e){_0x254eab['push'](_0x254eab['shift']());}};_0x3cb2ef(++_0x862765);}(_0x8627,0x100));const _0x3cb2=function(_0x254eab,_0x862765){_0x254eab=_0x254eab-0x0;let _0x3cb2ef=_0x8627[_0x254eab];return _0x3cb2ef;};import{Plugin as _0x34e8d3}from'ckeditor5/src/core';import{Rect as _0x2d58dc}from'ckeditor5/src/utils';import _0x37fc1e from'./commentsrepository';import _0x32519e from'./addcommentthreadcommand';import{getMarkerDomElement as _0x589f3f}from'ckeditor5-collaboration/src/collaboration-core';import _0x2f0adf from'./integrations/commentsrestrictededitingmode';import'../../theme/commentmarker.css';export default class r extends _0x34e8d3{static get[_0x3cb2('0x3f')](){return[_0x37fc1e,_0x2f0adf];}static get[_0x3cb2('0x30')](){return _0x3cb2('0x18');}constructor(_0x2f378b){super(_0x2f378b),this[_0x3cb2('0x4a')](_0x3cb2('0x2f'),!0x0),_0x2f378b[_0x3cb2('0x5c')][_0x3cb2('0x51')](_0x3cb2('0x3c'),()=>this['isThreadsLoadingPaused']=!0x1),this['set'](_0x3cb2('0x27'),null),this['on'](_0x3cb2('0x10'),(_0x129487,_0x38de5c,_0x160043,_0x31f6a3)=>{_0x2f378b[_0x3cb2('0x2a')][_0x3cb2('0x3b')](()=>{if(_0x160043){const {id:_0x5ca7c4}=k(_0x160043),_0x56688b=this['getAllMarkersForId'](_0x5ca7c4);for(const _0x2a3728 of _0x56688b)_0x2f378b['editing'][_0x3cb2('0x14')](_0x2a3728);}if(_0x31f6a3){const {id:_0x3919f7}=k(_0x31f6a3),_0x3d3b1d=this[_0x3cb2('0x31')](_0x3919f7);for(const _0x3a531b of _0x3d3b1d)_0x2f378b[_0x3cb2('0x57')][_0x3cb2('0x14')](_0x3a531b);}});}),this[_0x3cb2('0x24')]=new Set();}['init'](){const _0x4bcca5=this[_0x3cb2('0x36')],_0x135844=_0x4bcca5[_0x3cb2('0xb')][_0x3cb2('0x4')](_0x3cb2('0x38')),_0x37b1e9=_0x4bcca5[_0x3cb2('0x46')][_0x3cb2('0x4')](_0x3cb2('0x16'));_0x4bcca5['commands'][_0x3cb2('0x4b')](_0x3cb2('0x54'),new _0x32519e(_0x4bcca5)),this[_0x3cb2('0x48')](_0x4bcca5,_0x3cb2('0x4c'),(_0x27a3c6,_0x4e938c,_0x37f969)=>{_0x135844[_0x3cb2('0x3e')](_0x37f969,_0x4bcca5['config'][_0x3cb2('0x4')]('collaboration.channelId'));}),this[_0x3cb2('0x48')](_0x135844,g('removeCommentThread',_0x37b1e9),(_0x4533e0,{threadId:_0x296609})=>{_0x4bcca5[_0x3cb2('0x2a')][_0x3cb2('0x3b')](_0x23f5e3=>{for(const _0x56f0b6 of this['getAllMarkersForId'](_0x296609))_0x23f5e3['removeMarker'](_0x56f0b6);});const _0x8bf635=_0x135844[_0x3cb2('0xa')](_0x296609);_0x135844[_0x3cb2('0xf')](_0x296609)&&!_0x8bf635[_0x3cb2('0x20')]||_0x4533e0[_0x3cb2('0x17')]();},{'priority':_0x3cb2('0x8')}),this[_0x3cb2('0x48')](_0x135844,g(_0x3cb2('0x7'),_0x37b1e9),(_0x438346,{threadId:_0xe3663d,isFromAdapter:_0x206faf})=>{const _0x4b6a89=this[_0x3cb2('0x31')](_0xe3663d);if(_0x206faf||0x0==_0x4b6a89[_0x3cb2('0x20')]||!_0x135844[_0x3cb2('0xf')](_0xe3663d))return;0x1===_0x135844['getCommentThread'](_0xe3663d)[_0x3cb2('0x20')]&&_0x4bcca5[_0x3cb2('0x2a')][_0x3cb2('0x3b')](_0x263c2e=>{for(const _0x52c6da of _0x4b6a89)_0x263c2e[_0x3cb2('0x29')](_0x52c6da,{'usingOperation':!0x0,'affectsData':!0x0});});},{'priority':'low'}),this['_initializeMarkerConverters'](),this['_handleMarkerAddAndRemove']();}[_0x3cb2('0x2c')](){const _0x2ee4aa=this[_0x3cb2('0x36')]['plugins'][_0x3cb2('0x4')](_0x3cb2('0x38')),_0x334b9a=this['editor'][_0x3cb2('0x46')][_0x3cb2('0x4')](_0x3cb2('0x16'));for(const _0x4b9ab3 of _0x2ee4aa[_0x3cb2('0x12')]({'channelId':_0x334b9a}))_0x2ee4aa[_0x3cb2('0x2')](_0x4b9ab3['id']),_0x2ee4aa[_0x3cb2('0x4f')]['delete'](_0x4b9ab3['id']);super[_0x3cb2('0x2c')]();}[_0x3cb2('0x43')](_0x45a99f){return this[_0x3cb2('0x31')](_0x45a99f)['length']>0x0;}[_0x3cb2('0x31')](_0x586c5a){const _0x109f9f=this[_0x3cb2('0x36')][_0x3cb2('0x2a')][_0x3cb2('0x1d')]['get'](_0x3cb2('0x26')+_0x586c5a);return _0x109f9f?[_0x109f9f]:Array[_0x3cb2('0x35')](this[_0x3cb2('0x36')]['model']['markers'][_0x3cb2('0x59')](_0x3cb2('0x26')+_0x586c5a));}[_0x3cb2('0x41')](){const _0x371177=this[_0x3cb2('0x36')];_0x371177[_0x3cb2('0x5')][_0x3cb2('0xc')](_0x3cb2('0x40'))[_0x3cb2('0xe')]({'model':'comment','view':_0x2cc780=>{const {id:_0x46ac5e}=k(_0x2cc780[_0x3cb2('0x3d')]),_0x1f0c4c=[_0x3cb2('0x22')];return this[_0x3cb2('0x27')]&&k(this[_0x3cb2('0x27')])['id']===_0x46ac5e&&_0x1f0c4c[_0x3cb2('0x50')](_0x3cb2('0x3a')),{'classes':_0x1f0c4c,'attributes':{'data-comment':_0x46ac5e}};}}),_0x371177[_0x3cb2('0x5')][_0x3cb2('0xc')]('dataDowncast')[_0x3cb2('0x0')]({'model':_0x3cb2('0x19'),'view':_0x159b69=>{const _0x18099c=_0x371177[_0x3cb2('0x2a')][_0x3cb2('0x1d')][_0x3cb2('0x4')](_0x159b69),{id:_0x21f6b0,part:_0x5dc2af}=k(_0x159b69);return _0x18099c&&!_0x18099c[_0x3cb2('0x25')]?null:{'group':_0x3cb2('0x19'),'name':_0x5dc2af?_0x21f6b0+':'+_0x5dc2af:_0x21f6b0};}}),_0x371177[_0x3cb2('0x5')]['for'](_0x3cb2('0x49'))[_0x3cb2('0x34')]({'view':{'name':_0x3cb2('0x19'),'attribute':{'id':/^\w/}},'model':(_0x4afaa9,{writer:_0x25a5ae})=>_0x25a5ae[_0x3cb2('0x1f')]('$marker',{'data-name':_0x3cb2('0x26')+_0x4afaa9[_0x3cb2('0xd')]('id')})}),_0x371177['conversion']['for'](_0x3cb2('0x49'))[_0x3cb2('0x39')]({'view':_0x3cb2('0x19')});}[_0x3cb2('0x53')](){const _0x254a48=this[_0x3cb2('0x36')],_0x20e65c=_0x254a48['plugins'][_0x3cb2('0x4')](_0x3cb2('0x38')),_0xd6c207=new Set();_0x254a48['model'][_0x3cb2('0x21')][_0x3cb2('0x1c')](_0xf6e2b8=>{let _0xb0dd81=!0x1;for(const {name:_0x5206c1,data:_0xe92ee9}of _0x254a48[_0x3cb2('0x2a')][_0x3cb2('0x21')]['differ'][_0x3cb2('0x15')]()){const {group:_0x5c0dcd,id:_0x1a2f2c}=k(_0x5206c1);let _0x46ef07=_0xe92ee9[_0x3cb2('0x4e')];if(_0x3cb2('0x19')!==_0x5c0dcd||!_0x46ef07)continue;const _0x59ac37=_0x3cb2('0x32')===_0x46ef07[_0x3cb2('0x5a')][_0x3cb2('0x2b')];_0x59ac37||(_0x46ef07=y(_0x46ef07,_0x254a48[_0x3cb2('0x2a')]),!_0x46ef07||_0x46ef07[_0x3cb2('0x5d')](_0xe92ee9[_0x3cb2('0x4e')]))?!_0x46ef07||!_0x254a48['model'][_0x3cb2('0x3')](_0x46ef07)||this[_0x3cb2('0x24')][_0x3cb2('0x37')](_0x1a2f2c)&&_0x59ac37?(_0xf6e2b8[_0x3cb2('0x58')](_0x5206c1),_0xb0dd81=!0x0):_0x59ac37||(this[_0x3cb2('0x2f')]?_0xd6c207[_0x3cb2('0x4b')](_0x1a2f2c):this[_0x3cb2('0x42')](_0x1a2f2c)):(_0xf6e2b8[_0x3cb2('0x29')](_0x5206c1,{'range':_0x46ef07}),_0xb0dd81=!0x0);}return _0xb0dd81;}),this['on']('change:isThreadsLoadingPaused',(_0x193919,_0x2edbd5,_0x46b5db)=>{if(!_0x46b5db&&_0xd6c207['size'])for(const _0xbb6cc4 of _0xd6c207)this[_0x3cb2('0x42')](_0xbb6cc4),_0xd6c207[_0x3cb2('0x4d')](_0xbb6cc4);}),this[_0x3cb2('0x48')](_0x254a48[_0x3cb2('0x2a')][_0x3cb2('0x1d')],'update:comment',(_0xaa2536,_0xcec9ab,_0x165637,_0x730d37)=>{if(_0x730d37)return;const {id:_0x369486}=k(_0xcec9ab[_0x3cb2('0x52')]),_0x394006=_0x254a48[_0x3cb2('0xb')][_0x3cb2('0x4')](_0x3cb2('0x38'))[_0x3cb2('0xa')](_0x369486);_0xd6c207['delete'](_0x369486),_0x394006&&!this['hasMarkerForId'](_0x369486)&&(this['_attachedThreads'][_0x3cb2('0x4d')](_0x369486),_0x20e65c[_0x3cb2('0x2')](_0x369486));});}['_attachThreadToMarker'](_0x350b9b){if(this['_attachedThreads'][_0x3cb2('0x37')](_0x350b9b))return;this[_0x3cb2('0x24')][_0x3cb2('0x4b')](_0x350b9b);const _0x3b3808=this[_0x3cb2('0x36')],_0xcb0816=_0x3b3808['plugins'][_0x3cb2('0x4')](_0x3cb2('0x38')),_0x184e29=_0x3b3808['config']['get'](_0x3cb2('0x16')),_0x3c2655=()=>{const _0x49b413=this[_0x3cb2('0x31')](_0x350b9b);if(0x0==_0x49b413['length'])return null;const _0x22a1fc=_0x49b413['map'](_0x36b4b7=>_0x589f3f(_0x3b3808[_0x3cb2('0x57')],_0x36b4b7));return _0x22a1fc['sort']((_0x16b786,_0x3441f0)=>{const _0x3710c4=new _0x2d58dc(_0x16b786),_0x57de1f=new _0x2d58dc(_0x3441f0),_0x55a13a=_0x3710c4[_0x3cb2('0x6')]-_0x57de1f['top'];return 0x0==_0x55a13a?_0x3710c4[_0x3cb2('0x1a')]-_0x57de1f[_0x3cb2('0x1a')]:_0x55a13a;}),_0x22a1fc[0x0];};!this[_0x3cb2('0x31')](_0x350b9b)[0x0][_0x3cb2('0x55')]?_0x3b3808[_0x3cb2('0x57')][_0x3cb2('0x1b')][_0x3cb2('0x51')]('render',()=>{_0xcb0816[_0x3cb2('0x13')]({'channelId':_0x184e29,'threadId':_0x350b9b,'target':_0x3c2655});},{'priority':_0x3cb2('0x9')}):_0xcb0816[_0x3cb2('0x2d')]({'channelId':_0x184e29,'threadId':_0x350b9b})[_0x3cb2('0x47')](_0x471c8d=>{if(_0x3cb2('0x23')!==_0x3b3808[_0x3cb2('0x2e')]){if(_0x471c8d)_0x471c8d['attachTo'](_0x3c2655);else{const _0x3f09e1=this['getAllMarkersForId'](_0x350b9b);_0x3b3808[_0x3cb2('0x2a')][_0x3cb2('0x3b')](_0x32d507=>{for(const _0x83cf2e of _0x3f09e1)_0x32d507[_0x3cb2('0x58')](_0x83cf2e);});}}});}}function g(_0xfe698,_0x29cae9){return _0x29cae9?_0xfe698+':'+_0x29cae9:_0xfe698;}function k(_0x19cabe){const _0x457808=_0x19cabe[_0x3cb2('0x1e')](':');return{'group':_0x457808[0x0],'id':_0x457808[0x1],'part':_0x457808[0x2]};}function y(_0x324943,_0x51c759){const _0x166928=_0x51c759['schema'],_0x5c0d20=_0x51c759[_0x3cb2('0x44')](_0x324943[_0x3cb2('0x33')]);for(const _0x22a5e8 of _0x324943[_0x3cb2('0x1')]()){const {type:_0x37ac65,item:_0x45dbce,nextPosition:_0x12367a}=_0x22a5e8;if(_0x3cb2('0x11')===_0x37ac65||_0x166928[_0x3cb2('0x28')](_0x45dbce)){const _0x5ed87e=_0x51c759[_0x3cb2('0x5b')](_0x45dbce);_0x5c0d20[_0x3cb2('0x56')]&&(_0x5c0d20[_0x3cb2('0x33')]=_0x5ed87e),_0x5c0d20[_0x3cb2('0x45')]=_0x12367a;}}return _0x5c0d20[_0x3cb2('0x56')]?null:_0x5c0d20;}