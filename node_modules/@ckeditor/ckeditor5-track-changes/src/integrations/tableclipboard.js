/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x3d7cdb}from'ckeditor5/src/core';import ot from'./table';import{uid as _0x3f5be4,priorities as _0x33f962}from'ckeditor5/src/utils';const ne=['tableCellBorderWidth','tableCellBorderColor','tableCellBorderStyle','tableCellHorizontalAlignment','tableCellVerticalAlignment','tableCellBackgroundColor','tableCellPadding'],oe=Object['fromEntries'](ne['map'](_0x45ce69=>[_0x45ce69,null]));export default class ct extends _0x3d7cdb{static get['requires'](){return[ot];}['afterInit'](){const _0x3fb620=this['editor'];if(!_0x3fb620['plugins']['has']('TableClipboard'))return;const {t:t}=_0x3fb620['locale'],_0x22fb9e=_0x3fb620['plugins']['get']('TrackChangesEditing'),_0x79d9b=_0x3fb620['plugins']['get']('TableUtils'),_0x460385=_0x3fb620['plugins']['get'](ot),_0xf4d5d3=_0x3fb620['plugins']['get']('TableClipboard');_0x460385['_tablePostFixingSubtypes']['push']('tablePasteRow','tablePasteColumn'),_0x3fb620['model']['schema']['register']('tableCellSuggestion',{'allowIn':'tableCell','allowContentOf':'tableCell','isLimit':!0x0}),_0x3fb620['conversion']['elementToElement']({'model':'tableCellSuggestion','view':'suggestion-td'});let _0x453ac9=null;_0x3fb620['model']['on']('insertContent',(_0x33c02a,_0x5e689e)=>{const [_0xc584d7,_0x4a8be4]=_0x5e689e,_0xa79e1b=_0x5e689e[_0x5e689e['length']-0x1];_0xa79e1b&&_0xa79e1b['forceDefaultExecution']||_0x22fb9e['_isForcedDefaultExecutionBlock']||this['editor']['commands']['get']('trackChanges')['value']&&function(_0x8855c6,_0x2bdfa0,_0x596830,_0x945f63,_0x1a554e){if(_0x2bdfa0&&!_0x2bdfa0['is']('documentSelection'))return!0x1;const _0x411438=_0x1a554e['getTableIfOnlyTableInContent'](_0x8855c6,_0x596830);if(!_0x411438||!se(_0x411438,null,_0x945f63))return!0x1;const _0x528766=_0x945f63['getSelectionAffectedTableCells'](_0x596830['document']['selection']);if(!_0x528766['length'])return!0x1;const _0x14c534=_0x528766[0x0]['findAncestor']('table'),_0x517912=_0x945f63['getRowIndexes'](_0x528766),_0x2b8d19=_0x945f63['getColumnIndexes'](_0x528766),_0x1c11cd={'startRow':_0x517912['first'],'endRow':_0x517912['last'],'startColumn':_0x2b8d19['first'],'endColumn':_0x2b8d19['last']};return 0x1==_0x528766['length']&&(_0x1c11cd['endRow']+=_0x945f63['getRows'](_0x411438)-0x1,_0x1c11cd['endColumn']+=_0x945f63['getColumns'](_0x411438)-0x1),se(_0x14c534,_0x1c11cd,_0x945f63);}(_0xc584d7,_0x4a8be4,_0x3fb620['model'],_0x79d9b,_0xf4d5d3)&&(_0x33c02a['stop'](),_0x453ac9={'cells':[],'insertionRanges':[],'deletionRanges':[],'rowInsertionRanges':[],'rowInsertionIndexes':[],'columnInsertionRanges':[],'columnInsertionIndexes':[]},_0x3fb620['model']['change'](()=>{_0x3fb620['model']['insertContent'](_0x5e689e[0x0],_0x5e689e[0x1],_0x5e689e[0x2],_0x5e689e[0x3],{'forceDefaultExecution':!0x0});const _0x5776b3=_0x3f5be4(),{rowInsertionRanges:_0x64817e,columnInsertionRanges:_0x43fd65,insertionRanges:_0x36e18c,deletionRanges:_0x1c2b40,cells:_0x582797}=_0x453ac9;_0x64817e['length']&&_0x22fb9e['markMultiRangeInsertion'](_0x64817e,'tablePasteRow',{'tablePasteChainId':_0x5776b3}),_0x43fd65['length']&&_0x22fb9e['markMultiRangeInsertion'](_0x43fd65,'tablePasteColumn',{'tablePasteChainId':_0x5776b3}),_0x36e18c['length']&&_0x22fb9e['markMultiRangeInsertion'](_0x36e18c,'tablePaste',{'tablePasteChainId':_0x5776b3,'skipNestingCheck':!0x0}),_0x1c2b40['length']&&_0x22fb9e['markMultiRangeDeletion'](_0x1c2b40,'tablePaste',{'tablePasteChainId':_0x5776b3,'skipNestingCheck':!0x0});const _0x41bed7=_0x22fb9e['markMultiRangeBlockFormat'](_0x582797['map'](({element:_0x3cddc2})=>_0x3cddc2),{'formatGroupId':_0x3f5be4()},[],'tablePasteCell',{'tablePasteChainId':_0x5776b3});if(_0x41bed7){const _0x2cb378=_0x41bed7['getMarkers'](),_0x27dc23=[];for(const {element:_0x3721c7,attributes:_0x428540}of _0x582797){if(!_0x428540)continue;const _0xd72fd9=_0x3fb620['model']['createRangeOn'](_0x3721c7),_0x119676=_0x2cb378['find'](_0x308e8b=>_0x308e8b['getRange']()['isEqual'](_0xd72fd9));_0x119676&&_0x27dc23['push']([_0x119676['name'],_0x428540]);}_0x27dc23['length']&&_0x41bed7['setAttribute']('markerAttributes',Object['fromEntries'](_0x27dc23));}_0x453ac9=null;}));},{'priority':_0x33f962['high']+0xa}),_0x3fb620['plugins']['get']('TableClipboard')['on']('_replaceTableSlotCell',(_0x115b62,_0x4cc9f7)=>{const [_0x4de270,_0x52e52d,,_0x5534f8]=_0x4cc9f7;if(!_0x453ac9)return;_0x115b62['stop']();const _0x37e9a0=_0x4de270['cell'],_0x651152=_0x52e52d,_0xb789bb=le(_0x37e9a0),_0x555fcb=le(_0x651152);_0x115b62['return']=_0x37e9a0;let _0x296fe7=null,_0xa094a4=null;if(_0x555fcb||_0xb789bb){if(_0xb789bb&&!_0x555fcb){_0x5534f8['remove'](_0x37e9a0['getChild'](0x0));for(const _0x408d1e of Array['from'](_0x651152['getChildren']()))_0x5534f8['insert'](_0x408d1e,_0x37e9a0,'end');const _0xa19dea=_0x453ac9['rowInsertionIndexes']['includes'](_0x4de270['row']),_0x43cc03=_0x453ac9['columnInsertionIndexes']['includes'](_0x4de270['column']);_0xa19dea||_0x43cc03||(_0x296fe7=_0x5534f8['createRangeIn'](_0x37e9a0));}else _0x555fcb&&!_0xb789bb&&(_0xa094a4=_0x5534f8['createRangeIn'](_0x37e9a0));}else{const _0x18c58b=_0x5534f8['createElement']('tableCellSuggestion'),_0x4c4971=_0x5534f8['createElement']('tableCellSuggestion');_0x5534f8['wrap'](_0x5534f8['createRangeIn'](_0x37e9a0),_0x4c4971),_0x5534f8['insert'](_0x18c58b,_0x37e9a0,0x0);for(const _0x27b692 of Array['from'](_0x651152['getChildren']()))_0x5534f8['insert'](_0x27b692,_0x18c58b,'end');_0x296fe7=_0x5534f8['createRangeOn'](_0x18c58b),_0xa094a4=_0x5534f8['createRangeOn'](_0x4c4971);}const _0x1949b6=Array['from'](_0x651152['getAttributes']())['filter'](([_0xe92bbd])=>ne['includes'](_0xe92bbd));_0x453ac9['cells']['push']({'element':_0x37e9a0,'attributes':_0x1949b6['length']?Object['fromEntries'](_0x1949b6):null}),_0x296fe7&&_0x453ac9['insertionRanges']['push'](_0x296fe7),_0xa094a4&&_0x453ac9['deletionRanges']['push'](_0xa094a4);},{'priority':'high'}),_0x79d9b['on']('insertColumns',(_0x43accc,_0x4846a1)=>{const [_0x498fdd,_0x541720={}]=_0x4846a1;if(!_0x453ac9)return;const _0x2d2f43=_0x541720['at']||0x0,_0xaa0513=_0x541720['columns']||0x1;_0x453ac9['columnInsertionIndexes']=new Array(_0xaa0513)['fill'](_0x2d2f43)['map']((_0xc1ca2,_0x4e88ce)=>_0xc1ca2+_0x4e88ce);for(const {cell:_0x300d07}of _0x79d9b['createTableWalker'](_0x498fdd,{'startColumn':_0x2d2f43,'endColumn':_0x2d2f43+_0xaa0513-0x1}))_0x453ac9['columnInsertionRanges']['push'](_0x3fb620['model']['createRangeOn'](_0x300d07));},{'priority':'low'}),_0x79d9b['on']('insertRows',(_0x21abfe,_0x3ba5c3)=>{const [_0x4a5ebe,_0x379142={}]=_0x3ba5c3;if(!_0x453ac9)return;const _0x487c91=_0x379142['at']||0x0,_0x217485=_0x379142['rows']||0x1;_0x453ac9['rowInsertionIndexes']=new Array(_0x217485)['fill'](_0x487c91)['map']((_0x305ff6,_0x456658)=>_0x305ff6+_0x456658);for(const {cell:_0x5a317d}of _0x79d9b['createTableWalker'](_0x4a5ebe,{'startRow':_0x487c91,'endRow':_0x487c91+_0x217485-0x1}))_0x453ac9['rowInsertionRanges']['push'](_0x3fb620['model']['createRangeOn'](_0x5a317d));},{'priority':'low'}),_0x22fb9e['_descriptionFactory']['registerDescriptionCallback'](_0x1d660e=>{if(_0x1d660e['subType']&&_0x1d660e['subType']['startsWith']('tablePaste'))return _0x1d660e['previous']?{}:{'type':'insertion','content':t('*Replace\x20table\x20cells*')};});const _0x7d92b2=()=>{};for(const _0x1e91dd of['tablePaste','tablePasteColumn','tablePasteRow','tablePasteCell'])_0x22fb9e['_suggestionFactory']['registerCustomCallback']('insertion',_0x1e91dd,'join',_0x7d92b2),_0x22fb9e['_suggestionFactory']['registerCustomCallback']('deletion',_0x1e91dd,'join',_0x7d92b2);_0x22fb9e['_suggestionFactory']['registerCustomCallback']('formatBlock','tablePasteCell','discard',_0x7d92b2),_0x22fb9e['_suggestionFactory']['registerCustomCallback']('formatBlock','tablePasteCell','accept',(_0x1d7d10,_0x447937,_0x5d87d8)=>{const _0x4c1007=_0x1d7d10['map'](_0x4683a9=>_0x4683a9['getContainedElement']())['filter'](_0x31ef67=>_0x31ef67),_0x5390cb=new Map(_0x4c1007['map'](_0x235fbb=>[_0x235fbb,null]));if(_0x453ac9)for(const {element:_0x559ad8,attributes:_0x4cfcaa}of _0x453ac9['cells'])_0x4cfcaa&&_0x5390cb['set'](_0x559ad8,_0x4cfcaa);else{if(_0x5d87d8&&_0x5d87d8['markerAttributes'])for(const [_0x14135,_0xd8c2ec]of Object['entries'](_0x5d87d8['markerAttributes'])){const _0x4b6c19=_0x3fb620['model']['markers']['get'](_0x14135),_0x4086c2=_0x4b6c19?_0x4b6c19['getRange']()['getContainedElement']():null;_0x4086c2&&_0x5390cb['set'](_0x4086c2,_0xd8c2ec);}}_0x3fb620['model']['change'](_0x5ae6ea=>{for(const [_0x17a6c4,_0x17ba87]of _0x5390cb)_0x5ae6ea['setAttributes']({...oe,..._0x17ba87},_0x17a6c4);});});const _0x177a80=(_0x6e09c4,_0x136a97)=>{_0x22fb9e['_suggestionFactory']['registerCustomCallback'](_0x6e09c4,'tablePaste',_0x136a97,(_0x5a86c4,_0x56b4e0,_0x1ce978)=>{_0x3fb620['model']['change'](_0x408896=>{const _0x30788c=[];for(const _0x444fce of _0x5a86c4){const _0x4e203=_0x444fce['start']['nodeAfter'];_0x4e203['is']('element','tableCellSuggestion')&&_0x30788c['push'](_0x4e203);}_0x22fb9e['_suggestionFactory']['getSuggestionCallback'](_0x6e09c4,null,_0x136a97)(_0x5a86c4,_0x56b4e0,_0x1ce978);for(const _0x5e6c59 of _0x30788c)'$graveyard'!=_0x5e6c59['root']['rootName']&&_0x408896['unwrap'](_0x5e6c59);});});};_0x177a80('insertion','accept'),_0x177a80('insertion','discard'),_0x177a80('deletion','accept'),_0x177a80('deletion','discard'),_0x22fb9e['_suggestionFactory']['registerCustomCallback']('insertion','tablePasteRow','discard',_0x29bb38=>{const _0x327d09=_0x29bb38['map'](_0x2a2bbd=>_0x2a2bbd['getContainedElement']()),_0x4fb17b=_0x327d09[0x0]['findAncestor']('table'),{minRow:_0x19fb68,maxRow:_0x2eb807}=_0x460385['_getCoordsForCells'](_0x327d09);_0x79d9b['removeRows'](_0x4fb17b,{'at':_0x19fb68,'rows':_0x2eb807-_0x19fb68+0x1});}),_0x22fb9e['_suggestionFactory']['registerCustomCallback']('insertion','tablePasteColumn','discard',_0x3ea0c0=>{const _0x326f2d=_0x3ea0c0['map'](_0x237b3b=>_0x237b3b['getContainedElement']()),_0x28c2e3=_0x326f2d[0x0]['findAncestor']('table'),{minColumn:_0x21a3dc,maxColumn:_0x1c484c}=_0x460385['_getCoordsForCells'](_0x326f2d);_0x79d9b['removeColumns'](_0x28c2e3,{'at':_0x21a3dc,'columns':_0x1c484c-_0x21a3dc+0x1});});const _0x3208a7=(_0x57b8f,_0x2fff17)=>{if(!_0x2fff17['subType']||!_0x2fff17['subType']['startsWith']('tablePaste'))return;const _0x2a75d1=_0x2fff17['attributes']['tablePasteChainId'],_0xa59393=_0x22fb9e['getSuggestions']()['filter'](_0x19c72d=>_0x19c72d['isInContent']&&_0x19c72d['attributes']&&_0x19c72d['attributes']['tablePasteChainId']==_0x2a75d1);_0xa59393['length']&&_0x2fff17['getAllAdjacentSuggestions']()['length']!=_0xa59393['length']&&_0xa59393['reduce']((_0x19af44,_0xc46a0a)=>(_0x19af44['next']=_0xc46a0a,_0xc46a0a['previous']=_0x19af44,_0xc46a0a));};function _0x2f9d52(_0x34a502,{showActiveMarker:_0x5ce816=!0x0}={}){const {id:_0x32a8e4}=_0x22fb9e['_splitMarkerName'](_0x34a502['markerName']),_0x2b3432=['ck-suggestion-marker','ck-suggestion-marker-insertion'],_0x1a886f=_0x22fb9e['activeMarkers']['includes'](_0x34a502['markerName']);return _0x1a886f&&_0x2b3432['push']('ck-suggestion-marker--active'),{'classes':_0x2b3432,'attributes':{'data-suggestion':_0x32a8e4},'priority':_0x1a886f&&_0x5ce816?0xbc2:0xbb8};}_0x22fb9e['on']('suggestionLoaded',_0x3208a7,{'priority':'high'}),_0x22fb9e['on']('suggestionUnloaded',_0x3208a7,{'priority':'high'}),_0x3fb620['model']['document']['registerPostFixer'](()=>{let _0x58b7cd=!0x1;const _0x4d13ac=Array['from'](_0x3fb620['model']['document']['differ']['getChangedMarkers']());for(const {name:_0x195bd8,data:_0x26c4e4}of _0x4d13ac){const {group:_0x1472e9,type:_0x1a0ad4,id:_0x40a01e}=_0x22fb9e['_splitMarkerName'](_0x195bd8);if('suggestion'!=_0x1472e9||'deletion'!=_0x1a0ad4||_0x26c4e4['oldRange'])continue;if(!_0x22fb9e['hasSuggestion'](_0x40a01e))continue;const _0x561181=_0x22fb9e['getSuggestion'](_0x40a01e)['getRanges'](),_0x5443cf=_0x3fb620['plugins']['get']('Users')['me'];for(const _0x3f84e6 of _0x22fb9e['getSuggestions']()){if(!_0x3f84e6['isInContent']||_0x3f84e6['author']!=_0x5443cf)continue;if('formatBlock'!=_0x3f84e6['type']||'tablePasteCell'!=_0x3f84e6['subType'])continue;if(_0x3f84e6['getRanges']()['every'](_0x5f144a=>_0x561181['some'](_0x4347b8=>_0x4347b8['containsRange'](_0x5f144a,!0x0))))for(const _0x155a94 of _0x3f84e6['getAllAdjacentSuggestions']())_0x155a94['isInContent']&&(_0x155a94['discard'](),_0x58b7cd=!0x0);}}return _0x58b7cd;}),_0x3fb620['model']['document']['registerPostFixer'](_0x5781f4=>{const _0x297b85=_0x3fb620['commands']['get']('redo');if(!_0x297b85||!_0x297b85['_createdBatches']['has'](_0x5781f4['batch']))return!0x1;let _0x2deb51=!0x1;const _0x5676da=_0x3fb620['plugins']['get']('Users')['me'],_0x1a7ce1=_0x3fb620['model']['document']['differ']['getChanges'](),_0x775876=Array['from'](_0x3fb620['model']['document']['differ']['getChangedMarkers']())['filter'](({name:_0x31ccab,data:_0x19ac2d})=>{const {group:_0x55385c,subType:_0x52189f,authorId:_0x49c0d1}=_0x22fb9e['_splitMarkerName'](_0x31ccab);return'suggestion'==_0x55385c&&'tablePaste'==_0x52189f&&_0x49c0d1==_0x5676da['id']&&!_0x19ac2d['oldRange'];});for(const _0x9115e7 of _0x1a7ce1){if('insert'!=_0x9115e7['type']||'tableCellSuggestion'!=_0x9115e7['name']||0x1!=_0x9115e7['length'])continue;const _0x571716=_0x5781f4['createRange'](_0x9115e7['position'],_0x9115e7['position']['getShiftedBy'](0x1));if(!_0x775876['find'](({data:_0xd33b6c})=>_0xd33b6c['newRange']['isEqual'](_0x571716)))for(const {name:_0x11ea2a,data:_0x117b8a}of _0x775876)if(_0x571716['containsRange'](_0x117b8a['newRange'])){_0x5781f4['updateMarker'](_0x11ea2a,{'range':_0x571716}),_0x2deb51=!0x0;break;}}return _0x2deb51;}),_0x3fb620['model']['document']['registerPostFixer'](_0x319224=>{let _0x21032e=!0x1;const _0x209645=_0x3fb620['plugins']['get']('Users')['me'],_0x3bbcd0=_0x22fb9e['getSuggestions']()['filter'](_0x21a052=>_0x21a052['isInContent']&&_0x21a052['author']==_0x209645),_0x4706d0=new Set(),_0x4d83e9=new Set();for(const _0xee0849 of _0x3bbcd0)if('tablePaste'==_0xee0849['subType'])for(const _0x3693fd of _0xee0849['getMarkers']()){const _0x2b25af=_0x3693fd['getRange']()['getContainedElement']();if(_0x2b25af){if(_0x2b25af['is']('element','tableCellSuggestion')&&le(_0x2b25af)){_0xee0849['removeMarker'](_0x3693fd['name']),_0x4706d0['add'](_0x2b25af),_0x21032e=!0x0;const _0x5c5579=_0x2b25af['nextSibling'],_0x514c9b=_0x2b25af['previousSibling'],_0x2daea8=_0x5c5579&&_0x5c5579['is']('element','tableCellSuggestion'),_0x38f361=_0x514c9b&&_0x514c9b['is']('element','tableCellSuggestion');_0x2daea8&&!_0x4706d0['has'](_0x5c5579)&&_0x4d83e9['add'](_0x5c5579),_0x38f361&&!_0x4706d0['has'](_0x514c9b)&&_0x4d83e9['add'](_0x514c9b);}else _0x2b25af['is']('element','paragraph')&&_0x2b25af['isEmpty']&&(_0xee0849['removeMarker'](_0x3693fd['name']),_0x21032e=!0x0);}}else{if('tablePasteCell'==_0xee0849['subType']){if(!_0xee0849['attributes']||!_0xee0849['attributes']['tablePasteChainId'])continue;const _0x2cd95c=_0xee0849['attributes']['markerAttributes'];if(_0x2cd95c&&Object['keys'](_0x2cd95c)['length'])continue;const _0x4da79d=_0xee0849['attributes']['tablePasteChainId'];let _0x20aeae=!0x0,_0x37770c=!0x0;for(const _0x10f012 of _0x3bbcd0)if(_0x10f012['subType']&&_0x10f012['subType']['startsWith']('tablePaste')){if(!_0x10f012['attributes']['tablePasteChainId']){_0x37770c=!0x1;break;}if(_0x10f012['id']!=_0xee0849['id']&&_0x10f012['attributes']['tablePasteChainId']==_0x4da79d){_0x20aeae=!0x1;break;}}_0x37770c&&_0x20aeae&&(_0xee0849['removeMarkers'](),_0x21032e=!0x0);}}for(const _0x1e695d of _0x4706d0)_0x319224['remove'](_0x1e695d);for(const _0x546de3 of _0x4d83e9)_0x319224['unwrap'](_0x546de3);return _0x21032e;}),_0x3fb620['conversion']['for']('editingDowncast')['markerToHighlight']({'model':'suggestion:formatBlock:tablePasteCell','view':_0x2f9d52,'converterPriority':'high'}),_0x3fb620['conversion']['for']('dataDowncast')['markerToHighlight']({'model':'suggestion:formatBlock:tablePasteCell','view':(_0x4f18bc,_0x4f60ea)=>{if(_0x4f60ea['options']['showSuggestionHighlights'])return _0x2f9d52(_0x4f18bc,{'showActiveMarker':!0x1});},'converterPriority':'high'});const _0x22f0ab=_0x3fb620['editing']['view'];this['listenTo'](_0x22f0ab['document'],'clipboardOutput',(_0x3edcde,_0xa0e3cb)=>{const _0x218fdd=[];for(const _0x1c00d9 of _0x22f0ab['createRangeIn'](_0xa0e3cb['content'])['getItems']())_0x1c00d9['is']('element','suggestion-td')&&_0x218fdd['push'](_0x1c00d9);_0x22f0ab['change'](_0x3de092=>{for(const _0xb0eee2 of _0x218fdd)_0x3de092['move'](_0x3de092['createRangeIn'](_0xb0eee2),_0x3de092['createPositionBefore'](_0xb0eee2)),_0x3de092['remove'](_0xb0eee2);});});}}function le(_0x24ae51){if(_0x24ae51['isEmpty'])return!0x0;const _0x549ce3=_0x24ae51['getChild'](0x0);return _0x549ce3['is']('element','paragraph')&&_0x549ce3['isEmpty'];}function se(_0x5c674a,_0x8f5de0={},_0x42bde0){for(const {isAnchor:_0x1690dc,cellHeight:_0x2afb44,cellWidth:_0x3ef75c}of _0x42bde0['createTableWalker'](_0x5c674a,{'includeAllSlots':!0x0,..._0x8f5de0}))if(!_0x1690dc||0x1!=_0x2afb44||0x1!=_0x3ef75c)return!0x1;return!0x0;}