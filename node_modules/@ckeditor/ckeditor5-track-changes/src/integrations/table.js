/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x2684b7}from'ckeditor5/src/core';import{LiveRange as _0x174ec1}from'ckeditor5/src/engine';import{setHighlightHandling as $t}from'ckeditor5/src/widget';export default class ot extends _0x2684b7{constructor(_0x16ce4b){super(_0x16ce4b),this['_tablePostFixingSubtypes']=['tableRow','tableColumn'];}['afterInit'](){const _0x282822=this['editor'],_0xd17a20=_0x282822['model']['document']['selection'];if(!_0x282822['plugins']['has']('TableEditing'))return;const {t:t}=_0x282822['locale'],_0x1804fa=_0x282822['plugins']['get']('TrackChangesEditing'),_0x5eabde=_0x282822['plugins']['get']('TableUtils');_0x1804fa['_descriptionFactory']['registerElementLabel']('table',_0x217638=>t({'string':'table','plural':'%0\x20tables','id':'ELEMENT_TABLE'},_0x217638)),this['_setupColumnsRowsFixing'](),_0x1804fa['enableCommand']('insertTable'),_0x1804fa['enableCommand']('selectTableRow'),_0x1804fa['enableCommand']('selectTableColumn');for(const _0x273c74 of['insertTableRowAbove','insertTableRowBelow']){const _0x4fd8f3=_0x282822['commands']['get'](_0x273c74);_0x1804fa['enableCommand'](_0x273c74,_0x264d49=>{_0x282822['model']['change'](_0x321f33=>{_0x264d49();const _0x496ee5='above'===_0x4fd8f3['order'],_0x18afab=_0x5eabde['getSelectionAffectedTableCells'](_0xd17a20),_0x3af80d=_0x5eabde['getRowIndexes'](_0x18afab),_0x4576d0=_0x496ee5?_0x3af80d['first']-0x1:_0x3af80d['last']+0x1,_0x2acda0=_0x18afab[0x0]['findAncestor']('table'),_0x318c2e=_0x5eabde['createTableWalker'](_0x2acda0,{'startRow':_0x4576d0,'endRow':_0x4576d0}),_0x2ea205=Array['from'](_0x318c2e)['map'](_0xc5df9d=>_0x321f33['createRangeOn'](_0xc5df9d['cell']));_0x1804fa['markMultiRangeInsertion'](_0x2ea205,'tableRow');});});}for(const _0x3f2223 of['insertTableColumnLeft','insertTableColumnRight']){const _0x1b9533=_0x282822['commands']['get'](_0x3f2223);_0x1804fa['enableCommand'](_0x3f2223,_0x256f13=>{_0x282822['model']['change'](_0x204c74=>{_0x256f13();const _0x18e968='left'===_0x1b9533['order'],_0x142619=_0x5eabde['getSelectionAffectedTableCells'](_0xd17a20),_0x3334ce=_0x5eabde['getColumnIndexes'](_0x142619),_0x1ba40c=_0x18e968?_0x3334ce['first']-0x1:_0x3334ce['last']+0x1,_0x374816=_0x142619[0x0]['findAncestor']('table'),_0x24d047=_0x5eabde['createTableWalker'](_0x374816,{'startRow':0x0,'column':_0x1ba40c,'includeAllSlots':!0x1}),_0x2074f7=Array['from'](_0x24d047)['map'](_0x1ac653=>_0x204c74['createRangeOn'](_0x1ac653['cell']));_0x1804fa['markMultiRangeInsertion'](_0x2074f7,'tableColumn');});});}for(const _0x14d4ee of['removeTableRow','removeTableColumn']){const _0x9a53e6=_0x14d4ee['substr'](0xb),_0x5340de=_0x9a53e6['toLowerCase'](),_0x5bd142=_0x5340de['substr'](0x0,0x3)+'span',_0x239144='table'+_0x9a53e6,_0x1f011c='min'+_0x9a53e6,_0x4cd827='max'+_0x9a53e6;_0x1804fa['enableCommand'](_0x14d4ee,()=>{_0x282822['model']['change'](_0x7590fa=>{const _0x2d3e6b=_0x5eabde['getSelectionAffectedTableCells'](_0xd17a20),_0x2879b5=_0x2d3e6b[0x0]['findAncestor']('table');let _0x3828c6;if('removeTableRow'==_0x14d4ee){const _0x5bcf30=_0x5eabde['getRowIndexes'](_0x2d3e6b);_0x3828c6={'startRow':_0x5bcf30['first'],'endRow':_0x5bcf30['last'],'includeAllSlots':!0x0};}else{const _0x2cbcae=_0x5eabde['getColumnIndexes'](_0x2d3e6b);_0x3828c6={'startColumn':_0x2cbcae['first'],'endColumn':_0x2cbcae['last'],'includeAllSlots':!0x0};}const _0x4ffa00=_0x5eabde['createTableWalker'](_0x2879b5,_0x3828c6),_0x57e889=Array['from'](_0x4ffa00)['map'](({cell:_0x38b238})=>_0x38b238),_0x4dbc5f=Wt(_0x57e889['filter'](_0xd9df76=>_0xd9df76['hasAttribute'](_0x5bd142))),_0x581160=Wt(_0x57e889['filter'](_0x49d84e=>!_0x49d84e['hasAttribute'](_0x5bd142)))['map'](_0x448930=>_0x7590fa['createRangeOn'](_0x448930)),_0x2052be=_0x1804fa['markMultiRangeDeletion'](_0x581160,_0x239144);if(_0x2052be&&('tableRow'==_0x2052be['subType']||'tableColumn'==_0x2052be['subType'])){const _0x1d6113=this['_getSuggestionCoords'](_0x2052be);for(const _0xa1b43d of _0x4dbc5f){const _0x310e97=_0x7590fa['createRangeOn'](_0xa1b43d),_0x31e99d=_0x5eabde['getCellLocation'](_0xa1b43d),_0x1179cb=_0xa1b43d['getAttribute'](_0x5bd142)-0x1,_0x243fb6=_0x1d6113[_0x1f011c],_0x4d0577=_0x1d6113[_0x4cd827];_0x243fb6<=_0x31e99d[_0x5340de]&&_0x31e99d[_0x5340de]+_0x1179cb<=_0x4d0577&&_0x2052be['addRange'](_0x310e97);}}});});}function _0x12d1b6(_0x3cf696){const _0x3d40f6=Array['from'](_0xd17a20['getRanges']())['map'](_0x310009=>_0x174ec1['fromRange'](_0x310009));_0x282822['model']['change'](_0x4dac26=>{const _0x709b8=_0x4dac26['batch'];_0x3cf696=_0x3cf696['filter'](_0x4b5899=>'$graveyard'!=_0x4b5899['root']['rootName']),_0x4dac26['setSelection'](_0x3cf696),_0x282822['commands']['get']('removeTableRow')['refresh'](),_0x282822['execute']('removeTableRow',{'forceDefaultExecution':!0x0}),_0x282822['model']['enqueueChange'](()=>{_0x282822['model']['enqueueChange'](_0x709b8,_0xa9212d=>{const _0x944b56=_0x3d40f6['filter'](_0x44b1f7=>'$graveyard'!=_0x44b1f7['root']['rootName']);_0x944b56['length']>0x0&&_0xa9212d['setSelection'](_0x944b56);for(const _0x3726a4 of _0x3d40f6)_0x3726a4['detach']();});});});}function _0x415f41(_0x46bbc8){_0x282822['model']['change'](_0xb8096c=>{const _0x47dde1=Array['from'](_0xd17a20['getRanges']())['map'](_0x160bd9=>_0x174ec1['fromRange'](_0x160bd9)),_0x224f28=[];for(const _0x723459 of _0x46bbc8)for(const _0x43302a of _0x723459['getItems']({'shallow':!0x0}))_0x224f28['push'](_0x43302a);for(const _0x4b4422 of _0x224f28)'$graveyard'!=_0x4b4422['root']['rootName']&&(_0xb8096c['setSelection'](_0xb8096c['createPositionAt'](_0x4b4422,0x0)),_0x282822['commands']['get']('removeTableColumn')['refresh'](),_0x282822['execute']('removeTableColumn',{'forceDefaultExecution':!0x0}));const _0x5c6871=_0x47dde1['filter'](_0x5c21e9=>'$graveyard'!=_0x5c21e9['root']['rootName']);_0x5c6871['length']>0x0&&_0xb8096c['setSelection'](_0x5c6871);for(const _0x2ed090 of _0x47dde1)_0x2ed090['detach']();});}function _0x9b7d57(_0x231b53,_0x46f4a8){return _0x46f4a8['every'](_0x5efb38=>_0x231b53['some'](_0x59468a=>_0x59468a['end']['isEqual'](_0x5efb38['start'])||_0x5efb38['end']['isEqual'](_0x59468a['start'])));}function _0x5a8c2e(_0xe4e72,_0x486097){return _0xe4e72['some'](_0x3d55da=>_0x486097['some'](_0xef789c=>_0x3d55da['end']['isTouching'](_0xef789c['start'])));}_0x282822['data']['downcastDispatcher']['on']('addMarker:suggestion',(_0x1d1774,_0x15753f,_0x255de2)=>{if(!_0x255de2['options']['showSuggestionHighlights'])return;const _0x629306=_0x15753f['item'];if(!_0x629306)return;const _0x155bc0=_0x255de2['mapper']['toViewElement'](_0x629306);function _0x1a7247(_0x34ac1c){return Array['isArray'](_0x34ac1c)?_0x34ac1c:[_0x34ac1c];}_0x155bc0&&'tableCell'===_0x629306['name']&&$t(_0x155bc0,_0x255de2['writer'],(_0x3efc26,_0x112ddd,_0x17b65a)=>_0x17b65a['addClass'](_0x1a7247(_0x112ddd['classes']),_0x3efc26),(_0x329d02,_0x3a6bca,_0x36fc01)=>_0x36fc01['removeClass'](_0x1a7247(_0x3a6bca['classes']),_0x329d02));},{'priority':'highest'}),_0x1804fa['_descriptionFactory']['registerDescriptionCallback'](_0xe2ca76=>{if('insertion'!=_0xe2ca76['type']&&'deletion'!=_0xe2ca76['type'])return;const _0x363683=_0xe2ca76['getContainedElement']();if(null!=_0x363683&&_0x363683['is']('element','table')){if('insertion'==_0xe2ca76['type']){const _0x2f047d=_0xe2ca76['getItems']()['filter'](_0x272e26=>_0x272e26['is']('textProxy'))['map'](_0x4474ec=>_0x4474ec['data']);if(_0x2f047d['length'])return{'type':'insertion','content':t('*Insert:*\x20%0',t({'string':'table\x20*with\x20text*\x20%0','id':'ELEMENT_TABLE_WITH_TEXT'},'\x22'+_0x2f047d['join']('\x20')+'\x22'))};}if('deletion'==_0xe2ca76['type']){const _0x292584=_0xe2ca76['getItems']()['filter'](_0x5f7763=>_0x5f7763['is']('textProxy'))['map'](_0x229652=>_0x229652['data']);if(_0x292584['length'])return{'type':'deletion','content':t('*Remove:*\x20%0',t({'string':'table\x20*with\x20text*\x20%0','id':'ELEMENT_TABLE_WITH_TEXT'},'\x22'+_0x292584['join']('\x20')+'\x22'))};}}}),_0x1804fa['_descriptionFactory']['registerDescriptionCallback'](_0x1e8f8a=>{if('tableRow'==_0x1e8f8a['subType']){const _0x1b5409=_0x1e8f8a['getItems']()['filter'](_0x180c4c=>_0x180c4c['is']('textProxy'))['map'](_0x9271f=>_0x9271f['data']),_0x5a6251=this['_getSuggestionCoords'](_0x1e8f8a),_0x263d4d=_0x5a6251['maxRow']-_0x5a6251['minRow']+0x1;if('insertion'==_0x1e8f8a['type'])return _0x1b5409['length']?{'type':'insertion','content':t('*Insert:*\x20%0',t({'string':'table\x20row\x20*with\x20text*\x20%1','plural':'%0\x20table\x20rows\x20*with\x20text*\x20%1','id':'ELEMENT_TABLE_ROW_WITH_TEXT'},[_0x263d4d,'\x22'+_0x1b5409['join']('\x20')+'\x22']))}:{'type':'insertion','content':t('*Insert:*\x20%0',t({'string':'table\x20row','plural':'%0\x20table\x20rows','id':'ELEMENT_TABLE_ROW'},_0x263d4d))};if('deletion'==_0x1e8f8a['type'])return _0x1b5409['length']?{'type':'deletion','content':t('*Remove:*\x20%0',t({'string':'table\x20row\x20*with\x20text*\x20%1','plural':'%0\x20table\x20rows\x20*with\x20text*\x20%1','id':'ELEMENT_TABLE_ROW_WITH_TEXT'},[_0x263d4d,'\x22'+_0x1b5409['join']('\x20')+'\x22']))}:{'type':'deletion','content':t('*Remove:*\x20%0',t({'string':'table\x20row','plural':'%0\x20table\x20rows','id':'ELEMENT_TABLE_ROW'},_0x263d4d))};}if('tableColumn'==_0x1e8f8a['subType']){const _0xd8543d=_0x1e8f8a['getItems']()['filter'](_0x3e8068=>_0x3e8068['is']('textProxy'))['map'](_0x186aa3=>_0x186aa3['data']),_0x195b5e=this['_getSuggestionCoords'](_0x1e8f8a),_0x58344a=_0x195b5e['maxColumn']-_0x195b5e['minColumn']+0x1;if('insertion'==_0x1e8f8a['type'])return _0xd8543d['length']?{'type':'insertion','content':t('*Insert:*\x20%0',t({'string':'table\x20column\x20*with\x20text*\x20%1','plural':'%0\x20table\x20columns\x20*with\x20text*\x20%1','id':'ELEMENT_TABLE_COLUMN_WITH_TEXT'},[_0x58344a,'\x22'+_0xd8543d['join']('\x20')+'\x22']))}:{'type':'insertion','content':t('*Insert:*\x20%0',t({'string':'table\x20column','plural':'%0\x20table\x20columns','id':'ELEMENT_TABLE_COLUMN'},_0x58344a))};if('deletion'==_0x1e8f8a['type'])return _0xd8543d['length']?{'type':'deletion','content':t('*Remove:*\x20%0',t({'string':'table\x20column\x20*with\x20text*\x20%1','plural':'%0\x20table\x20columns\x20*with\x20text*\x20%1','id':'ELEMENT_TABLE_COLUMN_WITH_TEXT'},[_0x58344a,'\x22'+_0xd8543d['join']('\x20')+'\x22']))}:{'type':'deletion','content':t('*Remove:*\x20%0',t({'string':'table\x20column','plural':'%0\x20table\x20columns','id':'ELEMENT_TABLE_COLUMN'},_0x58344a))};}}),_0x1804fa['_suggestionFactory']['registerCustomCallback']('insertion','tableRow','discard',_0x12d1b6),_0x1804fa['_suggestionFactory']['registerCustomCallback']('deletion','tableRow','accept',_0x12d1b6),_0x1804fa['_suggestionFactory']['registerCustomCallback']('insertion','tableColumn','discard',_0x415f41),_0x1804fa['_suggestionFactory']['registerCustomCallback']('deletion','tableColumn','accept',_0x415f41),_0x1804fa['_suggestionFactory']['registerCustomCallback']('insertion','tableColumn','join',_0x9b7d57),_0x1804fa['_suggestionFactory']['registerCustomCallback']('deletion','tableColumn','join',_0x9b7d57),_0x1804fa['_suggestionFactory']['registerCustomCallback']('insertion','tableRow','join',_0x5a8c2e),_0x1804fa['_suggestionFactory']['registerCustomCallback']('deletion','tableRow','join',_0x5a8c2e);}['_acceptFormatSuggestionCallbackFactory'](){const _0x4dde7a=this['editor'],_0x48db5e=_0x4dde7a['model']['document']['selection'];return(_0x363b09,_0x25b295)=>{_0x4dde7a['model']['change'](_0x573ed7=>{const {commandName:_0x251e4d,commandParams:_0x17dd60}=_0x25b295;let _0x2c1a11=_0x363b09[0x0]['end']['nodeBefore'];_0x17dd60&&_0x17dd60[0x0]&&!0x1===_0x17dd60[0x0]['forceValue']&&(_0x2c1a11=_0x363b09[0x0]['start']['nodeAfter']);const _0x3a83c5=_0x573ed7['createRangeIn'](_0x2c1a11);if('$graveyard'==_0x3a83c5['root']['rootName'])return;const _0x2a233d=Array['from'](_0x48db5e['getRanges']())['map'](_0x4f76df=>_0x174ec1['fromRange'](_0x4f76df));_0x573ed7['setSelection'](_0x3a83c5),_0x4dde7a['commands']['get'](_0x251e4d)['refresh'](),_0x17dd60['push']({'forceDefaultExecution':!0x0}),_0x4dde7a['execute'](_0x251e4d,..._0x17dd60);const _0x4568e9=_0x2a233d['filter'](_0x49ff6b=>'$graveyard'!=_0x49ff6b['root']['rootName']);_0x4568e9['length']>0x0&&_0x573ed7['setSelection'](_0x4568e9);for(const _0xd5d2b6 of _0x2a233d)_0xd5d2b6['detach']();});};}['_getCoordsForCells'](_0x330038){const _0x1afe5f=this['editor']['plugins']['get']('TableUtils');let _0x48810f=Number['MAX_SAFE_INTEGER'],_0x54d0f3=Number['MIN_SAFE_INTEGER'],_0x30b5ac=Number['MAX_SAFE_INTEGER'],_0x1f308d=Number['MIN_SAFE_INTEGER'];for(const _0x2179bd of _0x330038){if('$graveyard'==_0x2179bd['root']['rootName'])continue;const {row:_0x84808,column:_0x5356dc}=_0x1afe5f['getCellLocation'](_0x2179bd),_0x3807d8=_0x2179bd['hasAttribute']('rowspan')?_0x2179bd['getAttribute']('rowspan')-0x1:0x0,_0x110a04=_0x2179bd['hasAttribute']('colspan')?_0x2179bd['getAttribute']('colspan')-0x1:0x0;_0x48810f=_0x84808<_0x48810f?_0x84808:_0x48810f,_0x54d0f3=_0x84808+_0x3807d8>_0x54d0f3?_0x84808+_0x3807d8:_0x54d0f3,_0x30b5ac=_0x5356dc<_0x30b5ac?_0x5356dc:_0x30b5ac,_0x1f308d=_0x5356dc+_0x110a04>_0x1f308d?_0x5356dc+_0x110a04:_0x1f308d;}return{'minRow':_0x48810f,'maxRow':_0x54d0f3,'minColumn':_0x30b5ac,'maxColumn':_0x1f308d};}['_setupColumnsRowsFixing'](){const _0xf73a75=this['editor'],_0x502c28=_0xf73a75['plugins']['get']('TrackChangesEditing'),_0x63af48=_0xf73a75['plugins']['get']('TableUtils');this['_tableSuggestions']=new Set(),_0xf73a75['model']['document']['on']('change:data',()=>{const _0x53c07b=Array['from'](_0xf73a75['model']['document']['differ']['getChangedMarkers']());for(const {name:_0x44188e,data:_0x18a445}of _0x53c07b){const {group:_0x67cb28,id:_0x462807,subType:_0x53519a}=_0x502c28['_splitMarkerName'](_0x44188e);if('suggestion'!=_0x67cb28)continue;if(null!=_0x18a445['oldRange'])continue;const _0x1a8bc2=_0x502c28['getSuggestion'](_0x462807);this['_tablePostFixingSubtypes']['includes'](_0x53519a)&&this['_tableSuggestions']['add'](_0x1a8bc2);}},{'priority':'low'});const _0x1784f0=(_0x4b5056,_0x805f44)=>{let _0x4544fe=!0x1;const _0x318bd5=_0x805f44['createRangeOn'](_0x4b5056),_0x44c04a=_0x4b5056['findAncestor']('table'),_0x44a66f=_0x63af48['getCellLocation'](_0x4b5056);for(const _0x3d0551 of this['_tableSuggestions']){const _0x121662=_0x3d0551['subType'],_0x2ed3ef=_0x121662['startsWith']('tablePaste'),_0x3a5494=_0x121662['substr'](_0x2ed3ef?0xa:0x5),_0x4c8edf=_0x3a5494['toLowerCase'](),_0x4243a2=_0x4c8edf['substr'](0x0,0x3)+'span',_0x2c0298='min'+_0x3a5494,_0x295355='max'+_0x3a5494;if(!_0x3d0551['isInContent'])continue;if(_0x44c04a!=_0x3d0551['getFirstRange']()['start']['findAncestor']('table'))continue;if(_0x3d0551['isIntersectingWithRange'](_0x318bd5))continue;const _0x2a847b=_0x4b5056['hasAttribute'](_0x4243a2)?_0x4b5056['getAttribute'](_0x4243a2)-0x1:0x0,_0x4c60bd=this['_getSuggestionCoords'](_0x3d0551),_0x1a1a7b=_0x4c60bd[_0x2c0298],_0x212deb=_0x4c60bd[_0x295355];_0x1a1a7b<=_0x44a66f[_0x4c8edf]&&_0x44a66f[_0x4c8edf]+_0x2a847b<=_0x212deb&&(_0x3d0551['addRange'](_0x318bd5),_0x4544fe=!0x0);}return _0x4544fe;};_0xf73a75['model']['document']['registerPostFixer'](_0x54e986=>{let _0x1443d=!0x1;for(const _0x448f4a of _0xf73a75['model']['document']['differ']['getChanges']())if('insert'==_0x448f4a['type']){if('tableRow'==_0x448f4a['name'])for(const _0x2caf7a of _0x448f4a['position']['nodeAfter']['getChildren']())_0x1443d=_0x1443d||_0x1784f0(_0x2caf7a,_0x54e986);else'tableCell'==_0x448f4a['name']&&(_0x1443d=_0x1443d||_0x1784f0(_0x448f4a['position']['nodeAfter'],_0x54e986));}return _0x1443d;});}['_getSuggestionCoords'](_0x3bca3b){return this['_getCoordsForCells'](_0x3bca3b['getRanges']()['map'](_0xf2ab0=>_0xf2ab0['start']['nodeAfter']));}}function Wt(_0x1e6aaa){return Array['from'](new Set(_0x1e6aaa)['values']());}