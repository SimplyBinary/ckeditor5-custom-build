/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x3abc38}from'ckeditor5/src/core';import{LivePosition as te}from'ckeditor5/src/engine';import{uid as _0xe2a4f5}from'ckeditor5/src/utils';export default class z extends _0x3abc38{['afterInit'](){const _0x5d1fb1=this['editor'];if(!_0x5d1fb1['plugins']['has']('ImageEditing'))return;const _0x29a2c7=_0x5d1fb1['plugins']['get']('TrackChangesEditing'),_0x54c22e=_0x5d1fb1['plugins']['get']('ImageUtils'),_0x337e07={},{t:t}=_0x5d1fb1['locale'];if(_0x29a2c7['enableCommand']('insertImage'),_0x29a2c7['_descriptionFactory']['registerElementLabel']('imageBlock',_0x2c88fb=>t({'string':'image','plural':'%0\x20images','id':'ELEMENT_IMAGE'},_0x2c88fb)),_0x29a2c7['_descriptionFactory']['registerElementLabel']('imageInline',_0x4a0123=>t({'string':'image','plural':'%0\x20images','id':'ELEMENT_INLINE_IMAGE'},_0x4a0123)),_0x29a2c7['_descriptionFactory']['registerElementLabel']('caption',t({'string':'caption','id':'ELEMENT_CAPTION'})),_0x5d1fb1['plugins']['has']('ImageUploadEditing')&&_0x29a2c7['enableCommand']('uploadImage'),_0x5d1fb1['plugins']['has']('ImageBlockEditing')&&_0x5d1fb1['plugins']['has']('ImageInlineEditing')&&(_0x29a2c7['enableCommand']('imageTypeInline',(_0xd929e2,_0x4a27fe)=>{const _0x5057dd=_0x54c22e['getClosestSelectedImageElement'](_0x5d1fb1['model']['document']['selection']);_0x5d1fb1['model']['change'](()=>{_0x29a2c7['markBlockFormat'](_0x5057dd,{'commandName':'imageTypeInline','commandParams':[_0x4a27fe]},[],'convertBlockImageToInline');});}),_0x29a2c7['enableCommand']('imageTypeBlock',(_0xefaade,_0x5b6531)=>{_0x5d1fb1['model']['change'](_0x49fd41=>{let _0x198628=_0x54c22e['getClosestSelectedImageElement'](_0x5d1fb1['model']['document']['selection']),_0x14ead2=_0x49fd41['createRangeOn'](_0x198628);const _0x493104=te['fromPosition'](_0x14ead2['start'],'toPrevious'),_0xd94499=te['fromPosition'](_0x14ead2['end'],'toNext');_0x29a2c7['forceDefaultExecution'](()=>_0xefaade(_0x5b6531)),_0x198628=_0x54c22e['getClosestSelectedImageElement'](_0x5d1fb1['model']['document']['selection']),_0x14ead2=_0x49fd41['createRangeOn'](_0x198628);const _0x2fb690=_0x49fd41['createRange'](_0x493104,_0xd94499);_0x493104['detach'](),_0xd94499['detach'](),_0x29a2c7['markBlockFormat'](_0x198628,{'commandName':'imageTypeInline'},[],'convertInlineImageToBlock'),_0x2fb690['start']['isBefore'](_0x14ead2['start'])&&_0x29a2c7['markInsertion'](_0x49fd41['createRange'](_0x2fb690['start'],_0x14ead2['start']),'convertInlineImageToBlock'),_0x14ead2['end']['isBefore'](_0x2fb690['end'])&&_0x29a2c7['markInsertion'](_0x49fd41['createRange'](_0x14ead2['end'],_0x2fb690['end']),'convertInlineImageToBlock');});}),_0x29a2c7['_suggestionFactory']['registerCustomCallback']('formatBlock','convertInlineImageToBlock','join',()=>{}),_0x29a2c7['_suggestionFactory']['registerCustomCallback']('formatBlock','convertInlineImageToBlock','accept',()=>{}),_0x29a2c7['_suggestionFactory']['registerCustomCallback']('formatBlock','convertInlineImageToBlock','discard',_0x29a2c7['_suggestionFactory']['getSuggestionCallback']('formatBlock','','accept')),_0x29a2c7['_suggestionFactory']['registerCustomCallback']('insertion','convertInlineImageToBlock','join',()=>{}),_0x29a2c7['_suggestionFactory']['registerCustomCallback']('insertion','convertInlineImageToBlock','discard',([_0x129576])=>{const _0x3f7636=_0x29a2c7['_suggestionFactory']['getSuggestionCallback']('insertion','','discard');let _0x1da999=_0x129576['start'],_0x1efad2=_0x129576['end'];const _0x38c554=_0x5d1fb1['model']['schema']['getNearestSelectionRange'](_0x1da999,'backward'),_0x1455a8=_0x5d1fb1['model']['schema']['getNearestSelectionRange'](_0x1efad2,'forward');_0x38c554['isCollapsed']&&(_0x1da999=_0x38c554['start']),_0x1455a8['isCollapsed']&&(_0x1efad2=_0x1455a8['end']),_0x3f7636([_0x5d1fb1['model']['createRange'](_0x1da999,_0x1efad2)]);}),_0x29a2c7['_suggestionFactory']['registerCustomCallback']('formatBlock','convertInlineImageToBlock','chain',_0x417d1f),_0x29a2c7['_suggestionFactory']['registerCustomCallback']('insertion','convertInlineImageToBlock','chain',_0x417d1f)),_0x5d1fb1['plugins']['has']('ImageCaptionEditing')&&(_0x29a2c7['enableCommand']('toggleImageCaption',(_0x2f86e8,_0x675b84)=>{const _0x236cbe=_0x5d1fb1['plugins']['get']('ImageCaptionUtils');let _0x5eaa06=_0x54c22e['getClosestSelectedImageElement'](_0x5d1fb1['model']['document']['selection']),_0x585ff7=_0x236cbe['getCaptionFromImageModelElement'](_0x5eaa06);_0x5d1fb1['model']['change'](()=>{if(_0x585ff7)return void _0x29a2c7['markDeletion'](_0x5d1fb1['model']['createRangeOn'](_0x585ff7));const _0x22b52f=_0x54c22e['isBlockImage'](_0x5eaa06);_0x2f86e8(_0x675b84),_0x5eaa06=_0x54c22e['getClosestSelectedImageElement'](_0x5d1fb1['model']['document']['selection']),_0x585ff7=_0x236cbe['getCaptionFromImageModelElement'](_0x5eaa06),_0x29a2c7['markInsertion'](_0x5d1fb1['model']['createRangeOn'](_0x585ff7),_0x22b52f?null:'imageCaption');});}),_0x29a2c7['_suggestionFactory']['registerCustomCallback']('insertion','imageCaption','chain',_0x417d1f)),_0x5d1fb1['plugins']['has']('ImageStyleEditing')){_0x29a2c7['enableCommand']('imageStyle',(_0x442579,_0xcc67e1)=>{const _0x248006=_0x5d1fb1['plugins']['get']('Users')['me'],_0x49e9a1=_0x5d1fb1['commands']['get']('imageStyle');let _0x2c414a=_0x54c22e['getClosestSelectedImageElement'](_0x5d1fb1['model']['document']['selection']),_0x1d6940=_0x5d1fb1['model']['createRangeOn'](_0x2c414a),_0x256d12=_0x49e9a1['value'];if(_0x256d12==_0xcc67e1['value'])return;const _0x28d9c6={'commandName':'imageStyle','commandParams':[_0xcc67e1],'formatGroupId':_0xe2a4f5()};_0x5d1fb1['model']['change'](()=>{if(_0x29a2c7['getSuggestions']()['filter'](_0x4884e0=>_0x4884e0['isInContent']&&_0x248006==_0x4884e0['author']&&('formatBlock'==_0x4884e0['type']||'formatInline'==_0x4884e0['type'])&&('imageStylePreApply'==_0x4884e0['subType']||'imageStylePostApply'==_0x4884e0['subType'])&&_0x4884e0['getFirstRange']()['isEqual'](_0x1d6940))['forEach'](_0x1a737a=>_0x29a2c7['discardSuggestion'](_0x1a737a['head'])),_0x2c414a=_0x54c22e['getClosestSelectedImageElement'](_0x5d1fb1['model']['document']['selection']),_0x1d6940=_0x5d1fb1['model']['createRangeOn'](_0x2c414a),_0x49e9a1['refresh'](),_0x5d1fb1['commands']['get']('imageTypeInline')['refresh'](),_0x5d1fb1['commands']['get']('imageTypeBlock')['refresh'](),_0x256d12=_0x49e9a1['value'],_0x256d12!=_0xcc67e1['value'])return _0x54c22e['isInlineImage'](_0x2c414a)&&_0x49e9a1['shouldConvertImageType'](_0xcc67e1['value'],_0x2c414a)?(_0x442579(_0xcc67e1),_0x2c414a=_0x54c22e['getClosestSelectedImageElement'](_0x5d1fb1['model']['document']['selection']),void _0x29a2c7['markBlockFormat'](_0x2c414a,{..._0x28d9c6,'commandReversedParams':[{'value':_0x256d12||null}]},[],'imageStylePreApply')):void(_0x54c22e['isBlockImage'](_0x2c414a)?_0x29a2c7['markBlockFormat'](_0x2c414a,_0x28d9c6,[],'imageStylePostApply'):_0x29a2c7['markInlineFormat'](_0x1d6940,_0x28d9c6,'imageStylePostApply'));});});for(const _0x582f24 of _0x5d1fb1['plugins']['get']('ImageStyleEditing')['normalizedStyles'])_0x337e07[_0x582f24['name']]=_0x582f24['title']['toLowerCase']();_0x29a2c7['_suggestionFactory']['registerCustomCallback']('formatBlock','imageStylePreApply','join',()=>{}),_0x29a2c7['_suggestionFactory']['registerCustomCallback']('formatBlock','imageStylePostApply','join',()=>{}),_0x29a2c7['_suggestionFactory']['registerCustomCallback']('formatInline','imageStylePostApply','join',()=>{}),_0x29a2c7['_suggestionFactory']['registerCustomCallback']('formatBlock','imageStylePreApply','accept',()=>{}),_0x29a2c7['_suggestionFactory']['registerCustomCallback']('formatBlock','imageStylePreApply','discard',(_0x52c507,_0x4326cc)=>{_0x29a2c7['_suggestionFactory']['getSuggestionCallback']('formatBlock','','accept')(_0x52c507,{'commandName':_0x4326cc['commandName'],'commandParams':_0x4326cc['commandReversedParams']});}),_0x29a2c7['_suggestionFactory']['registerCustomCallback']('formatBlock','imageStylePreApply','chain',_0x417d1f);}const _0x12c528=[{'type':'formatBlock','subType':'imageStylePreApply'},{'type':'insertion','subType':'imageCaption'},{'type':'formatBlock','subType':'convertInlineImageToBlock'},{'type':'insertion','subType':'convertInlineImageToBlock'}];function _0x29c753(_0x11b565,_0x341fa7){const _0x5ba78a=_0x12c528['findIndex'](({type:_0x5ad095,subType:_0x2aed18})=>_0x11b565['type']==_0x5ad095&&_0x11b565['subType']==_0x2aed18),_0x399544=_0x12c528['findIndex'](({type:_0x43af76,subType:_0x15dd46})=>_0x341fa7['type']==_0x43af76&&_0x341fa7['subType']==_0x15dd46);if(_0x5ba78a<0x0||_0x399544<0x0)return!0x1;const _0x1cd459=_0x11b565['getFirstRange'](),_0x14fafe=_0x341fa7['getFirstRange']();if((0x0==_0x5ba78a||0x1==_0x5ba78a)&&0x2==_0x399544&&_0x1cd459['isIntersecting'](_0x14fafe))return!0x0;if(0x2==_0x5ba78a&&0x3==_0x399544){const _0x31e85c=_0x29a2c7['_findSuggestions'](_0x1cd459,'insertion')['filter'](({suggestion:_0x1705d0,meta:_0x5adc4c})=>_0x5adc4c['isOwn']&&'convertInlineImageToBlock'==_0x1705d0['subType']);if(_0x31e85c['length']>0x1&&_0x14fafe['end']['isEqual'](_0x1cd459['start']))return!0x0;if(0x1==_0x31e85c['length']&&(_0x1cd459['start']['isEqual'](_0x14fafe['end'])||_0x1cd459['end']['isEqual'](_0x14fafe['start'])))return!0x0;}if(0x3==_0x5ba78a&&0x3==_0x399544&&_0x1cd459['start']['isBefore'](_0x14fafe['start'])){const _0x4119bc=_0x1cd459['end']['nodeAfter'],_0x5d026c=_0x14fafe['start']['nodeBefore'];return _0x54c22e['isBlockImage'](_0x4119bc)&&_0x4119bc===_0x5d026c;}return!0x1;}function _0x417d1f(_0xa7326b,_0x5198c9){return _0x29c753(_0xa7326b,_0x5198c9)?[_0xa7326b,_0x5198c9]:_0x29c753(_0x5198c9,_0xa7326b)?[_0x5198c9,_0xa7326b]:null;}_0x5d1fb1['model']['document']['registerPostFixer'](()=>{let _0x517576=!0x1;const _0xeb9d42=Array['from'](_0x5d1fb1['model']['document']['differ']['getChangedMarkers']());for(const {name:_0x5b0e64,data:_0x4d3ee2}of _0xeb9d42){const {group:_0x28368f,type:_0x4713d4,subType:_0x504fa6,id:_0x259c1}=_0x29a2c7['_splitMarkerName'](_0x5b0e64);if('suggestion'==_0x28368f&&_0x29a2c7['hasSuggestion'](_0x259c1)){if('formatBlock'==_0x4713d4&&('imageStylePreApply'==_0x504fa6||'imageStylePostApply'==_0x504fa6)){const _0x41663f=_0x29a2c7['getSuggestion'](_0x259c1);if(_0x4d3ee2['newRange']){const _0x172a95=_0x41663f['getFirstRange']()['getContainedElement']();if(_0x54c22e['isBlockImage'](_0x172a95))continue;_0x29a2c7['discardSuggestion'](_0x41663f),_0x517576=!0x0;}}if('insertion'==_0x4713d4&&'imageCaption'==_0x504fa6&&!_0x4d3ee2['newRange']){const _0x1a98e6=_0x29a2c7['getSuggestion'](_0x259c1);_0x1a98e6['next']&&_0x1a98e6['next']['isInContent']&&(_0x29a2c7['discardSuggestion'](_0x1a98e6['next']),_0x517576=!0x0);}}}return _0x517576;}),_0x5d1fb1['plugins']['has']('ImageResize')&&_0x29a2c7['enableCommand']('resizeImage',(_0x4610ef,_0x1f13c9)=>{const _0x213768=_0x54c22e['getClosestSelectedImageElement'](_0x5d1fb1['model']['document']['selection']);_0x213768['getAttribute']('width')!=_0x1f13c9['width']&&_0x5d1fb1['model']['change'](()=>{_0x29a2c7['markBlockFormat'](_0x213768,{'commandName':'resizeImage','commandParams':[_0x1f13c9]});});}),_0x5d1fb1['plugins']['has']('ImageTextAlternativeEditing')&&_0x29a2c7['enableCommand']('imageTextAlternative',(_0x3e0083,_0x76156e)=>{const _0x552f0d=_0x54c22e['getClosestSelectedImageElement'](_0x5d1fb1['model']['document']['selection']);(_0x552f0d['hasAttribute']('alt')?_0x552f0d['getAttribute']('alt'):'')!=_0x76156e['newValue']&&_0x5d1fb1['model']['change'](()=>{_0x29a2c7['markBlockFormat'](_0x552f0d,{'commandName':'imageTextAlternative','commandParams':[_0x76156e]});});}),_0x29a2c7['_descriptionFactory']['registerDescriptionCallback'](_0x18e722=>{if(!!_0x12c528['find'](({type:_0x5e6aca,subType:_0x36ed65})=>_0x18e722['type']==_0x5e6aca&&_0x18e722['subType']==_0x36ed65))return _0x18e722['previous']?{}:void 0x0;}),_0x29a2c7['_descriptionFactory']['registerDescriptionCallback'](_0xd79365=>{if('insertion'==_0xd79365['type']||'deletion'==_0xd79365['type']){const _0x3b061a=_0xd79365['getContainedElement']();if(_0x3b061a&&_0x3b061a['is']('element','caption'))return{'type':'insertion'==_0xd79365['type']?'addObject':'removeObject','name':_0x3b061a['name'],'quantity':0x1};}}),_0x29a2c7['_descriptionFactory']['registerDescriptionCallback'](_0xea92c7=>'formatBlock'==_0xea92c7['type']&&'convertInlineImageToBlock'==_0xea92c7['subType']?{'type':'format','content':'Inline\x20image\x20to\x20block\x20image'}:'formatBlock'==_0xea92c7['type']&&'convertBlockImageToInline'==_0xea92c7['subType']?{'type':'format','content':'Block\x20image\x20to\x20inline\x20image'}:void 0x0),_0x29a2c7['_descriptionFactory']['registerDescriptionCallback'](_0x3b22a5=>{const {data:_0x2bad7e}=_0x3b22a5;if(_0x2bad7e){if('imageStyle'==_0x2bad7e['commandName']){const _0x31fb45=_0x2bad7e['commandParams'][0x0]['value'];return _0x5a057a('side'===_0x31fb45?t({'string':'side\x20image','id':'FORMAT_SIDE_IMAGE'}):_0x337e07[_0x31fb45]||_0x31fb45);}if('imageTextAlternative'==_0x2bad7e['commandName']){const _0x13be7f=_0x2bad7e['commandParams'][0x0]['newValue'];return _0x13be7f?{'type':'format','content':t('*Set\x20image\x20text\x20alternative:*\x20%0','\x22'+_0x13be7f+'\x22')}:{'type':'format','content':t('*Remove\x20image\x20text\x20alternative*')};}if('resizeImage'==_0x2bad7e['commandName']){const _0x377b08=_0x2bad7e['commandParams'][0x0]['width'];return _0x377b08?{'type':'format','content':t('*Set\x20image\x20width:*\x20%0',_0x377b08)}:{'type':'format','content':t('*Reset\x20image\x20width*')};}}function _0x5a057a(_0x932066){return{'type':'format','content':t('*Format:*\x20%0',_0x932066)};}});}}