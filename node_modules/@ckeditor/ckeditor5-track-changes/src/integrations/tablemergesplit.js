/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x12c901}from'ckeditor5/src/core';import ot from'./table';import{LiveRange as _0x37ab5a}from'ckeditor5/src/engine';export default class rt extends _0x12c901{static get['requires'](){return[ot];}['afterInit'](){const _0x5728da=this['editor'],_0x46aa5c=_0x5728da['model']['document']['selection'];if(!_0x5728da['plugins']['has']('TableEditing'))return;const {t:t}=_0x5728da['locale'],_0x389463=_0x5728da['plugins']['get']('TrackChangesEditing'),_0x45bb7a=_0x5728da['plugins']['get']('TableUtils'),_0x37ba51=_0x5728da['plugins']['get'](ot);_0x37ba51['_tablePostFixingSubtypes']['push']('mergeTableCells'),_0x389463['enableCommand']('mergeTableCells',()=>{const _0x5be023=_0x45bb7a['getSelectionAffectedTableCells'](_0x5728da['model']['document']['selection']);_0x5728da['model']['change'](()=>{_0x389463['markMultiRangeBlockFormat'](_0x5be023,{'commandName':'mergeTableCells','commandParams':[]},[],'mergeTableCells');});}),_0x5728da['commands']['get']('mergeTableCells')['on']('execute',(_0x59a1a8,_0x3c789a)=>{_0x5728da['commands']['get']('trackChanges')['value']&&(_0x3c789a['length']>0x0&&_0x3c789a[_0x3c789a['length']-0x1]&&_0x3c789a[_0x3c789a['length']-0x1]['forceDefaultExecution']||_0x389463['_isForcedDefaultExecutionBlock']||this['_areSelectedCellsMergable']()||_0x59a1a8['stop']());},{'priority':'highest'});for(const _0x8e4c29 of['mergeTableCellUp','mergeTableCellRight','mergeTableCellDown','mergeTableCellLeft']){const _0x599827=_0x5728da['commands']['get'](_0x8e4c29);_0x389463['enableCommand'](_0x8e4c29,()=>{const _0x132a57=_0x5728da['model']['document']['selection']['getFirstPosition']()['getAncestors']()['find'](_0x346831=>_0x346831['is']('element','tableCell')),_0x2c00aa=_0x599827['value'];_0x5728da['model']['change'](()=>{_0x389463['markMultiRangeBlockFormat']([_0x132a57,_0x2c00aa],{'commandName':'mergeTableCells','commandParams':[]},[],'mergeTableCells');});});}for(const _0x36a437 of['splitTableCellVertically','splitTableCellHorizontally']){const _0x4ca09f=_0x5728da['commands']['get'](_0x36a437);_0x389463['enableCommand'](_0x36a437,()=>{const _0x1e840d=_0x45bb7a['getSelectionAffectedTableCells'](_0x5728da['model']['document']['selection'])[0x0],_0x5d0bae=_0x1e840d['findAncestor']('table'),{column:_0x5a8a0d,row:_0x53957a}=_0x45bb7a['getCellLocation'](_0x1e840d);let _0x4f049f=[];if('horizontally'==_0x4ca09f['direction']){const _0x58a128=_0x45bb7a['createTableWalker'](_0x5d0bae,{'startRow':_0x53957a,'endRow':_0x53957a,'includeAllSlots':!0x0});_0x4f049f=Array['from'](_0x58a128)['map'](_0xdf3f83=>_0xdf3f83['cell']);}else{const _0x2e80d1=_0x45bb7a['createTableWalker'](_0x5d0bae,{'column':_0x5a8a0d,'includeAllSlots':!0x0});_0x4f049f=Array['from'](_0x2e80d1)['map'](_0x4417df=>_0x4417df['cell']);}_0x5728da['model']['change'](_0x3c645c=>{_0x389463['markBlockFormat'](_0x3c645c['createRangeOn'](_0x1e840d),{'commandName':_0x36a437,'commandParams':[]},_0x4f049f,_0x36a437);});});}_0x389463['_descriptionFactory']['registerDescriptionCallback'](_0x5acfb1=>{const {data:_0x4eb240}=_0x5acfb1;if(_0x4eb240)return'mergeTableCells'==_0x4eb240['commandName']?{'type':'format','content':t('*Merge\x20cells*')}:void 0x0;}),_0x389463['_descriptionFactory']['registerDescriptionCallback'](_0x4bde9b=>{const {data:_0x59f402}=_0x4bde9b;if(_0x59f402)return'splitTableCellVertically'==_0x59f402['commandName']?{'type':'format','content':t('*Split\x20cell:*\x20vertically')}:'splitTableCellHorizontally'==_0x59f402['commandName']?{'type':'format','content':t('*Split\x20cell:*\x20horizontally')}:void 0x0;});const _0x5a3d07=_0x37ba51['_acceptFormatSuggestionCallbackFactory']();for(const _0x2c7a4e of['mergeTableCellUp','mergeTableCellRight','mergeTableCellDown','mergeTableCellLeft'])_0x389463['_suggestionFactory']['registerCustomCallback']('formatBlock',_0x2c7a4e,'accept',_0x5a3d07);for(const _0x2136d3 of['splitTableCellVertically','splitTableCellHorizontally'])_0x389463['_suggestionFactory']['registerCustomCallback']('formatBlock',_0x2136d3,'accept',_0x5a3d07);_0x389463['_suggestionFactory']['registerCustomCallback']('formatBlock','mergeTableCells','accept',_0x598811=>{_0x5728da['model']['change'](_0x4702e2=>{const _0x26f498=Array['from'](_0x46aa5c['getRanges']())['map'](_0x52a77e=>_0x37ab5a['fromRange'](_0x52a77e));_0x4702e2['setSelection'](_0x598811),_0x5728da['commands']['get']('mergeTableCells')['refresh'](),_0x5728da['execute']('mergeTableCells',{'forceDefaultExecution':!0x0});const _0x133b95=_0x26f498['filter'](_0x4afa1f=>'$graveyard'!=_0x4afa1f['root']['rootName']);_0x133b95['length']>0x0&&_0x4702e2['setSelection'](_0x133b95);for(const _0x169992 of _0x26f498)_0x169992['detach']();});});for(const _0x1144d6 of['mergeTableCellUp','mergeTableCellDown','mergeTableCellLeft','mergeTableCellRight']){const _0x419c87=_0x5728da['commands']['get'](_0x1144d6);_0x419c87['on']('set:isEnabled',(_0x505d51,_0x280506,_0x23b6eb)=>{if(_0x23b6eb){const _0xb07b67=_0x5728da['model']['document']['selection']['getFirstPosition']()['getAncestors']()['find'](_0x16a5f7=>_0x16a5f7['is']('element','tableCell'));this['_areMergableCells'](_0x419c87['value'],_0xb07b67)||(_0x505d51['return']=!0x1,_0x505d51['stop']());}},{'priority':'low'});}}['_areSelectedCellsMergable'](){const _0x3e36c9=this['editor']['commands']['get']('mergeTableCells'),_0x4f6289=this['editor']['plugins']['get']('TableUtils');if(!_0x3e36c9['isEnabled'])return!0x1;const _0x59e400=_0x4f6289['getSelectionAffectedTableCells'](this['editor']['model']['document']['selection']);for(const _0x4cf4bf of _0x59e400)for(const _0x2de6b3 of _0x59e400)if(_0x4cf4bf!=_0x2de6b3&&!this['_areMergableCells'](_0x4cf4bf,_0x2de6b3))return!0x1;return!0x0;}['_areMergableCells'](_0x76cfd7,_0x5a6a7f){const _0x39ac19=this['editor']['plugins']['get']('TrackChangesEditing'),_0x46e06c=this['editor']['model']['createRangeOn'](_0x76cfd7),_0x40cba6=this['editor']['model']['createRangeOn'](_0x5a6a7f),_0x3eedd6=new Set(),_0x5aa415=new Set();for(const _0x8830e9 of _0x39ac19['getSuggestions']())if(('insertion'==_0x8830e9['type']||'deletion'==_0x8830e9['type']||'mergeTableCells'==_0x8830e9['subType'])&&_0x8830e9['isInContent'])for(const _0x47aca6 of _0x8830e9['getRanges']())_0x47aca6['containsRange'](_0x46e06c,!0x0)&&_0x3eedd6['add'](_0x8830e9['type']+':'+_0x8830e9['author']['id']),_0x47aca6['containsRange'](_0x40cba6,!0x0)&&_0x5aa415['add'](_0x8830e9['type']+':'+_0x8830e9['author']['id']);if(_0x3eedd6['size']!=_0x5aa415['size'])return!0x1;for(const _0x2d1567 of _0x3eedd6)if(!_0x5aa415['has'](_0x2d1567))return!0x1;return!0x0;}}