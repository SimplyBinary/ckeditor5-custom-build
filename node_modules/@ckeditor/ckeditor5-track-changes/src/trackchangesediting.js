/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x14c09d,PendingActions as _0x4f818a}from'ckeditor5/src/core';import{LiveRange as _0x31ce06}from'ckeditor5/src/engine';import{CKEditorError as _0x3af4d7,uid as _0x5bd5e5,priorities as _0x3a9017,EmitterMixin as _0x50e452,mix as _0x1aa60c}from'ckeditor5/src/utils';import{toWidget as _0xe7c3fd}from'ckeditor5/src/widget';import{Users as _0x2ad904}from'ckeditor5-collaboration/src/collaboration-core';import _0x16b873 from'./commands/trackchangescommand';import _0x59cb88 from'./commands/acceptsuggestioncommand';import _0x127336 from'./commands/discardsuggestioncommand';import _0x211d2b from'./commands/acceptallsuggestionscommand';import _0x36a34c from'./commands/acceptselectedsuggestionscommand';import _0x27c4a0 from'./commands/discardallsuggestionscommand';import _0x3132ce from'./commands/discardselectedsuggestionscommand';import _0xbeb2bd from'./suggestion';import _0xca1474 from'./suggestiondescriptionfactory';import _0x1df5d4 from'./integrations/alignment';import _0x274b63 from'./integrations/basicstyles';import _0xa7e484 from'./integrations/blockquote';import _0xd57dfa from'./integrations/codeblock';import _0x1b59bc from'./integrations/comments';import _0x507d00 from'./integrations/deletecommand';import _0x24b573 from'./integrations/entercommand';import _0x2af95d from'./integrations/font';import _0x28e121 from'./integrations/heading';import _0x3aef45 from'./integrations/highlight';import _0xf59e42 from'./integrations/horizontalline';import _0x5e6a0f from'./integrations/image';import _0x547f11 from'./integrations/indent';import _0x78178d from'./integrations/inputcommand';import _0x2016ea from'./integrations/link';import _0x59d97e from'./integrations/list';import _0x5df1d6 from'./integrations/mediaembed';import _0x419e48 from'./integrations/mention';import _0x261ffb from'./integrations/pagebreak';import tt from'./integrations/paragraph';import it from'./integrations/removeformat';import st from'./integrations/restrictededitingmode';import nt from'./integrations/shiftentercommand';import et from'./integrations/standardeditingmode';import ot from'./integrations/table';import rt from'./integrations/tablemergesplit';import at from'./integrations/tableheadings';import ct from'./integrations/tableclipboard';import ht from'./integrations/title';import ut from'./integrations/undo';import ft from'./utils/hashobject.js';export default class d extends _0x14c09d{static get['requires'](){return['CommentsRepository',_0x2ad904,_0x4f818a,_0x1df5d4,_0x274b63,_0xa7e484,_0xd57dfa,_0x1b59bc,_0x507d00,_0x24b573,_0x2af95d,_0x28e121,_0x3aef45,_0xf59e42,_0x5e6a0f,_0x547f11,_0x78178d,_0x2016ea,_0x59d97e,_0x5df1d6,_0x419e48,_0x261ffb,tt,it,st,nt,et,ot,rt,at,ct,ht,ut];}static get['pluginName'](){return'TrackChangesEditing';}constructor(_0x9af9b1){function _0x28bd63(_0x1da4fc){return _0x1da4fc['map'](_0x950164=>String['fromCharCode'](_0x950164))['join']('');}super(_0x9af9b1),this['set']('activeMarkers',[]),this['on']('change:activeMarkers',(_0x2f78f9,_0x1932f3,_0x3f2a45,_0x39e97b)=>{this['_model']['change'](()=>{for(const _0x4931c1 of[..._0x39e97b,..._0x3f2a45])this['_model']['markers']['has'](_0x4931c1)&&_0x9af9b1['editing']['reconvertMarker'](_0x4931c1);});}),this['_descriptionFactory']=new _0xca1474(this['editor']['model']['schema'],this['editor']['locale']),this['_adapter']=null,this['_suggestionFactory']=new gt(this['editor']),this['_suggestions']=new Map(),this['_commentsRepository']=_0x9af9b1['plugins']['get']('CommentsRepository'),this['_enabledCommands']=new Set(),this['_model']=this['editor']['model'],this['_suggestionState']=new WeakMap(),this['_isForcedDefaultExecutionBlock']=!0x1,this[_0x28bd63([0x5f,0x65,0x78,0x65,0x63,0x75,0x74,0x65,0x53,0x75,0x67,0x67,0x65,0x73,0x74,0x69,0x6f,0x6e])]=_0x28bd63([0x34,0x30,0x34,0x34,0x30,0x38,0x32,0x34]);}['init'](){const _0x27d9ed=this['editor'];_0x27d9ed['conversion']['for']('editingDowncast')['markerToHighlight']({'model':'suggestion','view':_0x5de832=>{const {id:_0x7e2bde,type:_0x54f72a}=this['_splitMarkerName'](_0x5de832['markerName']),_0x3e8b20=['ck-suggestion-marker','ck-suggestion-marker-'+_0x54f72a];let _0x4bfd34=0xbb8;return this['activeMarkers']['includes'](_0x5de832['markerName'])&&(_0x3e8b20['push']('ck-suggestion-marker--active'),_0x4bfd34=0xbc2),'deletion'==_0x54f72a&&(_0x4bfd34+=0x5),{'classes':_0x3e8b20,'attributes':{'data-suggestion':_0x7e2bde},'priority':_0x4bfd34};}}),_0x27d9ed['conversion']['for']('dataDowncast')['add'](_0x312660=>{_0x312660['on']('addMarker:suggestion',(_0x22b2a9,_0x23f3c8,_0x14c0dd)=>{if(!_0x14c0dd['options']['showSuggestionHighlights'])return;const _0x5e477b=_0x23f3c8['item'];if(!_0x5e477b)return;const _0x3ccf63=_0x14c0dd['mapper']['toViewElement'](_0x5e477b);_0x27d9ed['model']['schema']['isObject'](_0x5e477b)&&_0x3ccf63&&!_0x3ccf63['getCustomProperty']('widget')&&_0x3ccf63['is']('containerElement')&&_0xe7c3fd(_0x3ccf63,_0x14c0dd['writer']);},{'priority':'high'});}),_0x27d9ed['conversion']['for']('dataDowncast')['markerToHighlight']({'model':'suggestion','view':(_0x18b600,_0x3ca317)=>{if(!_0x3ca317['options']['showSuggestionHighlights'])return null;const {type:_0x580d9d}=this['_splitMarkerName'](_0x18b600['markerName']);return{'classes':['ck-suggestion-marker','ck-suggestion-marker-'+_0x580d9d],'priority':0xbb8};}});const _0x1d7a93=({showActiveMarkers:_0xcf9080=!0x0}={})=>(_0x44f794,_0xd15f62,_0x3d2a10)=>{if(!_0xd15f62['item'])return;if(_0xd15f62['item']['is']('selection'))return void _0x3d2a10['consumable']['consume'](_0xd15f62['item'],_0x44f794['name']);const _0x4b75a8=_0x3d2a10['mapper']['toViewElement'](_0xd15f62['item']);if(!(_0xd15f62['item']['is']('element')&&_0x27d9ed['model']['schema']['isBlock'](_0xd15f62['item'])&&!_0x4b75a8['getCustomProperty']('addHighlight')))return;const {id:_0xe547af}=this['_splitMarkerName'](_0xd15f62['markerName']);_0x3d2a10['writer']['addClass'](['ck-suggestion-marker','ck-suggestion-marker-formatBlock'],_0x4b75a8),_0x3d2a10['writer']['setAttribute']('data-suggestion',_0xe547af,_0x4b75a8),_0x3d2a10['mapper']['bindElementToMarker'](_0x4b75a8,_0xd15f62['markerName']),_0xcf9080&&(this['activeMarkers']['includes'](_0xd15f62['markerName'])?_0x3d2a10['writer']['addClass']('ck-suggestion-marker--active',_0x4b75a8):_0x3d2a10['writer']['removeClass']('ck-suggestion-marker--active',_0x4b75a8));for(const _0x16f35f of _0x27d9ed['model']['createRangeIn'](_0xd15f62['item'])['getItems']())_0x3d2a10['consumable']['consume'](_0x16f35f,_0x44f794['name']);_0x3d2a10['consumable']['consume'](_0xd15f62['item'],_0x44f794['name']);};_0x27d9ed['conversion']['for']('dataDowncast')['add'](_0x4b2ebb=>{_0x4b2ebb['on']('addMarker:suggestion:formatBlock',(_0x1deabf,_0x94a72f,_0x34acf7)=>{_0x34acf7['options']['showSuggestionHighlights']&&_0x1d7a93({'showActiveMarkers':!0x1})(_0x1deabf,_0x94a72f,_0x34acf7);},{'priority':'highest'});}),_0x27d9ed['conversion']['for']('dataDowncast')['markerToData']({'model':'suggestion','view':(_0x3fd72e,_0x371e64)=>_0x371e64['options']['showSuggestionHighlights']?null:{'group':'suggestion','name':_0x3fd72e['substr']('suggestion'['length']+0x1)}}),_0x27d9ed['conversion']['for']('upcast')['elementToElement']({'view':{'name':'suggestion','attribute':{'id':/^\w/,'suggestionType':/^\w/}},'model':(_0x2c4604,{writer:_0x32fbbd})=>{let _0x47ee9e='suggestion:'+_0x2c4604['getAttribute']('suggestion-type')+':'+_0x2c4604['getAttribute']('id');return _0x2c4604['getAttribute']('marker-count')&&(_0x47ee9e+=':'+_0x2c4604['getAttribute']('marker-count')),_0x32fbbd['createElement']('$marker',{'data-name':_0x47ee9e});}}),_0x27d9ed['conversion']['for']('upcast')['dataToMarker']({'view':'suggestion'}),_0x27d9ed['conversion']['for']('editingDowncast')['add'](_0x2461cb=>{_0x2461cb['on']('addMarker:suggestion:formatBlock',_0x1d7a93(),{'priority':'high'});}),_0x27d9ed['conversion']['for']('editingDowncast')['add'](_0x1b0422=>{_0x1b0422['on']('removeMarker:suggestion:formatBlock',(_0x27c232,_0x544501,_0x5e02e9)=>{const _0x449930=_0x5e02e9['mapper']['markerNameToElements'](_0x544501['markerName']);if(_0x449930)for(const _0x5f4dd1 of _0x449930)_0x5f4dd1['getCustomProperty']('addHighlight')||(_0x5e02e9['writer']['removeClass'](['ck-suggestion-marker','ck-suggestion-marker-formatBlock','ck-suggestion-marker--active'],_0x5f4dd1),_0x5e02e9['writer']['removeAttribute']('data-suggestion',_0x5f4dd1),_0x5e02e9['mapper']['unbindElementFromMarkerName'](_0x5f4dd1,_0x544501['markerName']));},{'priority':'high'});}),_0x27d9ed['model']['document']['registerPostFixer'](_0x2cb8a2=>{let _0xb3a186=!0x1;const _0x2460c2=Array['from'](_0x27d9ed['model']['document']['differ']['getChangedMarkers']());for(const {name:_0x493d9d,data:_0x1a28ad}of _0x2460c2){const {group:_0x469ebf,type:_0x989201,id:_0x1b2cc0}=this['_splitMarkerName'](_0x493d9d);if('suggestion'!==_0x469ebf)continue;const _0xa39235=this['_suggestions']['get'](_0x1b2cc0);if(null!=_0x1a28ad['newRange']){'formatInline'==_0x989201&&(_0xb3a186=_0xb3a186||mt(_0x1a28ad['newRange'],_0x493d9d,_0x2cb8a2,_0x27d9ed['model']['schema']));if(_0x1a28ad['newRange']['isCollapsed']||'$graveyard'==_0x1a28ad['newRange']['root']['rootName']||'formatBlock'==_0x989201&&!kt(_0x1a28ad['newRange'])||'deletion'==_0x989201&&!(!dt(_0x546222=_0x1a28ad['newRange'])&&!function(_0x4471a3){return _0x4471a3['start']['parent']==_0x4471a3['end']['nodeBefore']&&_0x4471a3['start']['isAtEnd'];}(_0x546222)))_0x2cb8a2['removeMarker'](_0x493d9d),_0xb3a186=!0x0;else{if(!_0xa39235||!_0xa39235['isInContent'])continue;_0xb3a186=!!this['_joinWithAdjacentSuggestions'](_0xa39235)||_0xb3a186;}}}var _0x546222;return _0xb3a186;}),_0x27d9ed['model']['document']['registerPostFixer'](_0x4167ad=>{let _0x35d930=!0x1;for(const _0x95fee1 of _0x27d9ed['model']['document']['differ']['getChanges']()){if('insert'!=_0x95fee1['type'])continue;const _0x1fdcd0=_0x95fee1['position']['getShiftedBy'](_0x95fee1['length']);if(_0x1fdcd0['isAtEnd'])for(const _0x158920 of this['_suggestions']['values']()){if(_0x158920['isMultiRange']||!_0x158920['isInContent'])continue;if('formatBlock'!=_0x158920['type'])continue;const _0x511fbb=_0x158920['getFirstRange']();if(_0x511fbb['start']['parent']!=_0x511fbb['end']['parent']&&_0x511fbb['end']['isEqual'](_0x95fee1['position'])){const _0x26aefc=_0x27d9ed['model']['createRange'](_0x511fbb['start'],_0x1fdcd0);_0x4167ad['updateMarker'](_0x158920['getFirstMarker'](),{'range':_0x26aefc}),_0x35d930=!0x0;}}}return _0x35d930;}),_0x27d9ed['model']['markers']['on']('update:suggestion',(_0x35335d,_0x44ed2e,_0x18279d)=>{if(null==_0x18279d){const {id:_0x1d64d4}=this['_splitMarkerName'](_0x44ed2e['name']),_0x18672a=this['_suggestions']['get'](_0x1d64d4);_0x18672a&&_0x18672a['addMarkerName'](_0x44ed2e['name']);}}),_0x27d9ed['model']['document']['on']('change:data',()=>{const _0x51f23a=Array['from'](_0x27d9ed['model']['document']['differ']['getChangedMarkers']());_0x51f23a['sort']((_0x3893ef,_0x1fe697)=>{const _0x485166=_0x3893ef['data']['oldRange'],_0x286f6a=_0x1fe697['data']['oldRange'];return null===_0x485166&&null===_0x286f6a?0x0:null===_0x485166&&null!==_0x286f6a?-0x1:null!==_0x485166&&null===_0x286f6a?0x1:_0x485166['start']['isBefore'](_0x286f6a['start'])?-0x1:0x1;});const _0x470434=new Set();for(const {name:_0x2c4923,data:_0x5c7ab9}of _0x51f23a){const {group:_0xa176e9,id:_0x5207d7}=this['_splitMarkerName'](_0x2c4923);if('suggestion'===_0xa176e9&&(null===_0x5c7ab9['oldRange']&&this['_handleNewSuggestionMarker'](_0x2c4923),null===_0x5c7ab9['newRange'])){const _0x2639da=this['_suggestions']['get'](_0x5207d7);_0x2639da['isInContent']?_0x470434['add'](_0x2639da):this['_removeSuggestion'](_0x2639da);}}for(const {name:_0x19d4a3,data:_0x9d257e}of _0x51f23a){const {group:_0x2e9eb1,id:_0x318d05}=this['_splitMarkerName'](_0x19d4a3);if('suggestion'!==_0x2e9eb1)continue;const _0x1034af=this['_suggestions']['get'](_0x318d05);null!=_0x9d257e['newRange']&&null!=_0x9d257e['oldRange']&&(this['_refreshSuggestionsChain'](_0x1034af),_0x470434['add'](_0x1034af['head']));}for(const _0x42ce35 of _0x470434)this['fire']('suggestionChanged',_0x42ce35);_0x470434['clear']();}),_0x27d9ed['model']['on']('applyOperation',(_0x21e229,_0x3a3dbe)=>{const _0x44f352=_0x3a3dbe[0x0];if(!this['_suggestions']['size'])return;if(!_0x44f352['isDocumentOperation'])return;if(_0x44f352['batch']['isUndo']||!_0x44f352['batch']['isLocal'])return;let _0x267d44,_0x123281;switch(_0x44f352['type']){case'insert':_0x267d44=_0x27d9ed['model']['createPositionAt'](_0x44f352['position']),_0x123281=_0x267d44['getShiftedBy'](_0x44f352['howMany']);break;case'split':_0x267d44=_0x27d9ed['model']['createPositionAt'](_0x44f352['splitPosition']),_0x123281=_0x27d9ed['model']['createPositionAt'](_0x44f352['moveTargetPosition']);break;case'move':_0x267d44=_0x27d9ed['model']['createPositionAt'](_0x44f352['targetPosition']),_0x123281=_0x267d44['getShiftedBy'](_0x44f352['howMany']);break;default:return;}const _0x2040a4=_0x27d9ed['model']['createRange'](_0x267d44,_0x123281);_0x27d9ed['model']['change'](()=>{for(const {suggestion:_0x1bfaa6,meta:_0x4d97e1}of this['_findSuggestions'](_0x2040a4)){if(_0x1bfaa6['isMultiRange'])continue;if('formatInline'==_0x1bfaa6['type'])continue;const _0x3d1297=_0x1bfaa6['data']&&_0x1bfaa6['data']['multipleBlocks'];('formatBlock'!=_0x1bfaa6['type']||'split'==_0x44f352['type']&&!_0x3d1297)&&(_0x4d97e1['containsRangeInObject']||'insertion'==_0x1bfaa6['type']&&_0x4d97e1['isOwn']||_0x1bfaa6['getFirstRange']()['containsRange'](_0x2040a4)&&this['_breakSuggestionMarker'](_0x1bfaa6,_0x267d44,_0x123281));}});},{'priority':'lowest'}),_0x27d9ed['model']['on']('deleteContent',(_0x493640,_0x413341)=>{const _0x260aef=_0x413341[0x0],_0x5036ac=_0x413341[0x1];if(_0x5036ac&&_0x5036ac['forceDefaultExecution'])return;if(this['_isForcedDefaultExecutionBlock'])return;if(!this['trackChangesCommand']['value'])return;if(_0x260aef['isCollapsed'])return;const _0x3d8fd6=_0x27d9ed['model']['schema'],{start:_0x17908d,end:_0xd284ee}=_0x260aef['getFirstRange'](),_0x411c53=_0x17908d['nodeAfter']&&_0x3d8fd6['isObject'](_0x17908d['nodeAfter'])?null:_0x3d8fd6['getNearestSelectionRange'](_0x17908d,'forward'),_0x20c97e=_0xd284ee['nodeBefore']&&_0x3d8fd6['isObject'](_0xd284ee['nodeBefore'])?null:_0x3d8fd6['getNearestSelectionRange'](_0xd284ee,'backward'),_0x3390b6=_0x27d9ed['model']['createRange'](_0x411c53?_0x411c53['start']:_0x17908d,_0x20c97e?_0x20c97e['end']:_0xd284ee);_0x27d9ed['model']['change'](_0x280868=>{this['markDeletion'](_0x3390b6);const _0x42d365=_0x27d9ed['model']['schema']['getNearestSelectionRange'](_0x3390b6['start']);_0x260aef['is']('documentSelection')?_0x280868['setSelection'](_0x42d365):_0x260aef['setTo'](_0x42d365);}),_0x493640['stop']();},{'priority':_0x3a9017['normal']+0xa}),_0x27d9ed['model']['on']('insertContent',(_0x18d65f,_0x5a2aa9)=>{const _0x31573b=_0x5a2aa9[_0x5a2aa9['length']-0x1];_0x31573b&&_0x31573b['forceDefaultExecution']||this['_isForcedDefaultExecutionBlock']||this['trackChangesCommand']['value']&&(_0x27d9ed['model']['change'](()=>{let _0x2325ce=_0x27d9ed['model']['insertContent'](_0x5a2aa9[0x0],_0x5a2aa9[0x1],_0x5a2aa9[0x2],_0x5a2aa9[0x3],{'forceDefaultExecution':!0x0});if(!_0x2325ce)return;_0x18d65f['return']=_0x2325ce['clone']();const _0x326977=_0x2325ce['end']['nodeBefore'],_0x1f98b2=_0x27d9ed['model']['schema'];_0x326977&&_0x1f98b2['isBlock'](_0x326977)&&!_0x1f98b2['isObject'](_0x326977)&&(_0x2325ce=_0x27d9ed['model']['createRange'](_0x2325ce['start'],_0x27d9ed['model']['createPositionAt'](_0x326977,'end'))),this['markInsertion'](_0x2325ce);}),_0x18d65f['stop']());},{'priority':'high'}),this['trackChangesCommand']=new _0x16b873(_0x27d9ed,this['_enabledCommands']),this['editor']['commands']['add']('trackChanges',this['trackChangesCommand']),this['enableCommand']('trackChanges');const _0x285610=new _0x59cb88(_0x27d9ed,this['_suggestions']);_0x27d9ed['commands']['add']('acceptSuggestion',_0x285610),this['enableCommand']('acceptSuggestion');const _0x5a3431=new _0x127336(_0x27d9ed,this['_suggestions']);_0x27d9ed['commands']['add']('discardSuggestion',_0x5a3431),this['enableCommand']('discardSuggestion'),_0x27d9ed['commands']['add']('acceptAllSuggestions',new _0x211d2b(_0x27d9ed,_0x285610,this['_suggestions'])),this['enableCommand']('acceptAllSuggestions'),_0x27d9ed['commands']['add']('discardAllSuggestions',new _0x27c4a0(_0x27d9ed,_0x5a3431,this['_suggestions'])),this['enableCommand']('discardAllSuggestions'),_0x27d9ed['commands']['add']('acceptSelectedSuggestions',new _0x36a34c(_0x27d9ed,_0x285610,this['_suggestions'])),this['enableCommand']('acceptSelectedSuggestions'),_0x27d9ed['commands']['add']('discardSelectedSuggestions',new _0x3132ce(_0x27d9ed,_0x5a3431,this['_suggestions'])),this['enableCommand']('discardSelectedSuggestions');const _0x1ea0b6=_0x27d9ed['plugins']['get']('CommentsRepository');this['listenTo'](_0x1ea0b6,'addComment',(_0x48a700,{threadId:_0x401f29})=>{const _0x43118f=this['_suggestions']['get'](_0x401f29);_0x43118f&&_0x43118f['commentThread']&&0x1===_0x43118f['commentThread']['length']&&this['_updateSuggestionData'](_0x401f29,{'hasComments':!0x0});},{'priority':'low'}),this['listenTo'](_0x1ea0b6,'removeComment',(_0x3b2c9c,{threadId:_0xf4a985})=>{const _0x4e1732=this['_suggestions']['get'](_0xf4a985);_0x4e1732&&_0x4e1732['commentThread']&&!_0x4e1732['commentThread']['length']&&this['_updateSuggestionData'](_0xf4a985,{'hasComments':!0x1});},{'priority':'low'});}set['adapter'](_0x3139f8){if(this['_adapter'])throw new _0x3af4d7('track-changes-adapter-already-set',this);this['_adapter']=_0x3139f8;}get['adapter'](){return this['_adapter'];}['getSuggestions']({skipNotAttached:_0x5b5df5=!0x1,toJSON:_0x199065=!0x1}={}){const _0x34585e=[];for(const _0x1e2295 of this['_suggestions']['values']())_0x5b5df5&&!_0x1e2295['isInContent']||_0x34585e['push'](_0x1e2295);return _0x199065?_0x34585e['map'](_0x23ff55=>_0x23ff55['toJSON']()):_0x34585e;}['getSuggestion'](_0x28f75c){const _0x20c3b0=this['_suggestions']['get'](_0x28f75c);if(!_0x20c3b0)throw new _0x3af4d7('track-changes-suggestion-not-found',this);return _0x20c3b0;}['hasSuggestion'](_0x521616){return this['_suggestions']['has'](_0x521616);}['addSuggestionData'](_0x42cbc5){const {id:_0x508fc,authorId:_0x3a935d}=_0x42cbc5,[_0x1d3071,_0x25e552]=_0x42cbc5['type']['split'](':'),_0x4ce9da=this['_suggestions']['get'](_0x508fc)||this['_createSuggestion'](_0x1d3071,_0x25e552,_0x508fc,_0x3a935d);switch(this['_addThreadToSuggestion'](_0x4ce9da),this['_checkSuggestionCorrectness'](_0x4ce9da,_0x1d3071,_0x25e552||null,_0x3a935d),_0x4ce9da['createdAt']=_0x42cbc5['createdAt'],_0x42cbc5['data']&&(_0x4ce9da['data']=_0x42cbc5['data']),_0x42cbc5['attributes']&&(_0x4ce9da['attributes']=_0x42cbc5['attributes']),this['_adapter']&&this['_adapter']['addSuggestion']||(_0x4ce9da['_saved']=!0x0),this['_suggestionState']['get'](_0x4ce9da)){case'notReady':this['_suggestionState']['set'](_0x4ce9da,'dataReady');break;case'markerReady':_0x4ce9da['isInContent']?(this['_suggestionState']['set'](_0x4ce9da,'ready'),this['fire']('suggestionLoaded',_0x4ce9da)):this['_suggestionState']['set'](_0x4ce9da,'removed');}return _0x4ce9da;}['acceptSuggestion'](_0x35d2d1){this['forceDefaultExecution'](()=>{this['editor']['model']['change'](()=>{for(const _0x314b01 of _0x35d2d1['getAllAdjacentSuggestions']())_0x314b01['accept']();});});}['discardSuggestion'](_0x4f5625){this['forceDefaultExecution'](()=>{this['editor']['model']['change'](()=>{for(const _0xa93ac7 of _0x4f5625['getAllAdjacentSuggestions']())_0xa93ac7['discard']();});});}['enableCommand'](_0x159075,_0x3de1fe){const _0x3420c7=this['editor']['commands']['get'](_0x159075);if(!_0x3420c7)throw new _0x3af4d7('track-changes-command-not-found',this,{'commandName':_0x159075});this['_enabledCommands']['add'](_0x3420c7),_0x3de1fe&&_0x3420c7['on']('execute',(_0x1131c2,_0x5ba66f)=>{this['trackChangesCommand']['value']&&(this['_isForcedDefaultExecutionBlock']||_0x5ba66f['length']>0x0&&_0x5ba66f[_0x5ba66f['length']-0x1]&&_0x5ba66f[_0x5ba66f['length']-0x1]['forceDefaultExecution']||(_0x3de1fe((..._0x8b7ec6)=>_0x3420c7['execute'](..._0x8b7ec6,{'forceDefaultExecution':!0x0}),..._0x5ba66f),_0x1131c2['stop']()));},{'priority':'high'});}['forceDefaultExecution'](_0x131ca9){let _0x3427dc,_0x27f9ea;const _0x278fe4=this['_isForcedDefaultExecutionBlock'];this['_isForcedDefaultExecutionBlock']=!0x0;try{_0x3427dc=_0x131ca9();}catch(_0x2dfb7a){_0x27f9ea=_0x2dfb7a;}return _0x278fe4||(this['_isForcedDefaultExecutionBlock']=!0x1),_0x27f9ea&&_0x3af4d7['rethrowUnexpectedError'](_0x27f9ea,this),_0x3427dc;}['markInsertion'](_0xb1f315,_0x56499a=null,_0x3de86b={}){if(_0xb1f315['isCollapsed'])return null;const _0x47c906=this['editor']['plugins']['get']('Users')['me'];for(const {suggestion:_0x14ceee,meta:_0x21607a}of this['_findSuggestions'](_0xb1f315,'insertion'))if(_0x21607a['isOwn']){if(!_0x21607a['isNextTo'])return _0x14ceee;if(_0x56499a==_0x14ceee['subType']){const _0x912f83=_0x14ceee['getFirstRange']();return _0x912f83['start']['isEqual'](_0xb1f315['end'])?this['_setSuggestionRange'](_0x14ceee,this['_model']['createRange'](_0xb1f315['start'],_0x912f83['end'])):this['_setSuggestionRange'](_0x14ceee,this['_model']['createRange'](_0x912f83['start'],_0xb1f315['end'])),_0x14ceee;}}const _0x4fb6f6=_0x5bd5e5(),_0x8cd5d2=_0x47c906['id'],_0x224a05=_0x56499a?'insertion:'+_0x56499a:'insertion',_0x594c4f=this['_setSuggestionData']({'id':_0x4fb6f6,'type':_0x224a05,'createdAt':new Date(),'authorId':_0x8cd5d2,'attributes':_0x3de86b});return this['_addSuggestionMarker'](_0x224a05,_0x4fb6f6,_0x8cd5d2,_0xb1f315),_0x594c4f;}['markMultiRangeInsertion'](_0x2a966e,_0x2705e4='multi',_0x3a596f={}){const _0x5e83c5=this['editor']['plugins']['get']('Users')['me'],_0x517883=this['_suggestionFactory']['getSuggestionCallback']('insertion',_0x2705e4,'join');for(const _0x1aa7d8 of this['getSuggestions']())if(_0x1aa7d8['author']['id']==_0x5e83c5['id']&&'insertion'==_0x1aa7d8['type']&&_0x1aa7d8['subType']==_0x2705e4&&(_0x517883(_0x1aa7d8['getRanges'](),_0x2a966e)||_0x517883(_0x2a966e,_0x1aa7d8['getRanges']()))){for(const _0x5a2d65 of _0x2a966e)_0x1aa7d8['addRange'](_0x5a2d65);return _0x1aa7d8;}for(const _0x5c15a7 of _0x2a966e)for(const {suggestion:_0x533b76,meta:_0x1689ec}of this['_findSuggestions'](_0x5c15a7,'insertion')){if(!_0x1689ec['isOwn'])continue;let _0x5ad0f8=!0x0;for(const _0x16bdd1 of _0x533b76['getRanges']())for(const _0x3d1a6d of _0x2a966e)if(!_0x16bdd1['containsRange'](_0x3d1a6d)){_0x5ad0f8=!0x1;break;}if(_0x5ad0f8)return _0x533b76;}const _0x3fc35a=_0x5bd5e5(),_0x56ca40=_0x5e83c5['id'],_0x46ed2a='insertion:'+_0x2705e4,_0x3f152f=this['_setSuggestionData']({'id':_0x3fc35a,'type':_0x46ed2a,'createdAt':new Date(),'authorId':_0x56ca40,'attributes':_0x3a596f});for(const _0x33446e of _0x2a966e)this['_addSuggestionMarker'](_0x46ed2a,_0x3fc35a,_0x56ca40,_0x33446e,_0xbeb2bd['getMultiRangeId']());return _0x3f152f;}['markInlineFormat'](_0x574f1c,_0x1edb62,_0xa4ecca=null,_0x21710b={}){if(_0xa4ecca=_0xa4ecca||pt(_0x1edb62),_0x574f1c['isCollapsed'])return;const _0x14819d=this['editor']['plugins']['get']('Users')['me'],_0x1eb190=[];for(const {suggestion:_0x496148,meta:_0x3a698d}of this['_findSuggestions'](_0x574f1c,'insertion'))_0x3a698d['isOwn']&&!_0x3a698d['isInsideObject']&&_0x1eb190['push'](..._0x496148['getRanges']());const _0x220a96=function(_0x5c5452,_0x3010bc){const _0x56dad9=[];for(const _0x172042 of _0x3010bc){const _0xa7d340=_0x5c5452['getIntersection'](_0x172042);_0xa7d340&&_0x56dad9['push'](_0xa7d340);}return _0x56dad9;}(_0x574f1c,_0x1eb190),_0x3ae156=function(_0x2927a7,_0x1bc1ee){const _0x5d0c9a=[_0x2927a7];for(const _0x2714f4 of _0x1bc1ee){let _0x4adf33=0x0;for(;_0x4adf33<_0x5d0c9a['length'];){const _0x2f43c8=_0x5d0c9a[_0x4adf33]['getDifference'](_0x2714f4);_0x5d0c9a['splice'](_0x4adf33,0x1,..._0x2f43c8),_0x4adf33+=_0x2f43c8['length'];}}return _0x5d0c9a;}(_0x574f1c,_0x1eb190);_0x220a96['length']&&this['_model']['change'](()=>{for(const _0x236170 of _0x220a96){const _0x49d232=this['_suggestionFactory']['getSuggestionCallback']('formatInline',_0xa4ecca,'accept');this['forceDefaultExecution'](()=>_0x49d232([_0x236170],_0x1edb62,_0x21710b));}});for(const _0x4b3be5 of _0x3ae156){let _0xb158d6=null,_0x4aa448=_0x4b3be5['start'],_0x33c4f9=_0x4b3be5['end'];for(const {suggestion:_0x40e6da,meta:_0x3d2c31}of this['_findSuggestions'](_0x4b3be5,'formatInline')){if(!_0x3d2c31['isOwn'])continue;if(_0x40e6da['subType']!=_0xa4ecca)continue;const _0x2fca43=_0x40e6da['getFirstRange']();if(_0x2fca43['containsRange'](_0x4b3be5,!0x0))return;_0x4aa448=_0x4aa448['isBefore'](_0x2fca43['start'])?_0x4aa448:_0x2fca43['start'],_0x33c4f9=_0x33c4f9['isAfter'](_0x2fca43['end'])?_0x33c4f9:_0x2fca43['end'],_0xb158d6?_0x2fca43['start']['isBefore'](_0xb158d6['getFirstRange']()['start'])?(_0xb158d6['removeMarkers'](),_0xb158d6=_0x40e6da):_0x40e6da['removeMarkers']():_0xb158d6=_0x40e6da;}const _0x5d8f34=this['_model']['createRange'](_0x4aa448,_0x33c4f9);if(_0xb158d6)this['_setSuggestionRange'](_0xb158d6,_0x5d8f34);else{const _0x30ac39=_0x5bd5e5(),_0x4d11a9=_0x14819d['id'];this['_setSuggestionData']({'id':_0x30ac39,'type':'formatInline:'+_0xa4ecca,'data':_0x1edb62,'createdAt':new Date(),'authorId':_0x4d11a9,'attributes':_0x21710b}),this['_addSuggestionMarker']('formatInline:'+_0xa4ecca,_0x30ac39,_0x4d11a9,_0x5d8f34);}}}['markBlockFormat'](_0x5e26c9,_0x25b85b,_0x2243c6=[],_0x2d3292=null,_0x4255e1={}){_0x25b85b['formatGroupId']||(_0x25b85b['formatGroupId']=_0x25b85b['commandName']),_0x25b85b['multipleBlocks']=_0x5e26c9['is']('range'),_0x2d3292=_0x2d3292||pt(_0x25b85b);const _0x281f85=_0x2243c6['map'](_0x4272ee=>wt(_0x4272ee,this['_model'])),_0x18d908=_0x5e26c9['is']('range')?_0x5e26c9:wt(_0x5e26c9,this['_model']);_0x281f85['push'](_0x18d908);let _0x59bb2b=!0x0;for(const _0x61cc2c of _0x281f85)if(!this['_rangeIsInLocalUserInsertion'](_0x61cc2c)){_0x59bb2b=!0x1;break;}if(_0x59bb2b){const _0x427716=this['_suggestionFactory']['getSuggestionCallback']('formatBlock',_0x2d3292,'accept');return void this['forceDefaultExecution'](()=>_0x427716([_0x18d908],_0x25b85b,_0x4255e1));}let _0xf77f19=null,_0x242955=_0x18d908['start'],_0x1e0ce9=_0x18d908['end'];for(const {suggestion:_0x5ea50f,meta:_0x2a682e}of this['_findSuggestions'](_0x18d908,'formatBlock')){if(!_0x2a682e['isOwn']||_0x2a682e['isNextTo']||_0x2a682e['containsRangeInObject']||_0x2a682e['isInsideObject'])continue;if(_0x5ea50f['data']['formatGroupId']!=_0x25b85b['formatGroupId'])continue;const _0x384802=_0x5ea50f['getFirstRange']();if(_0x5ea50f['subType']==_0x2d3292){if(_0x384802['containsRange'](_0x18d908,!0x0))return;_0x242955=_0x242955['isBefore'](_0x384802['start'])?_0x242955:_0x384802['start'],_0x1e0ce9=_0x1e0ce9['isAfter'](_0x384802['end'])?_0x1e0ce9:_0x384802['end'],_0xf77f19?_0x384802['start']['isBefore'](_0xf77f19['getFirstRange']()['start'])?(_0xf77f19['removeMarkers'](),_0xf77f19=_0x5ea50f):_0x5ea50f['removeMarkers']():_0xf77f19=_0x5ea50f;}else{const _0x56b2ff=_0x18d908['getIntersection'](_0x384802);this['_cutOutSuggestionMarker'](_0x5ea50f,_0x56b2ff);}}const _0x4638b5=this['editor']['plugins']['get']('Users')['me'],_0xec0206=_0x5bd5e5(),_0x49d19b=_0x4638b5['id'];_0xf77f19?this['_setSuggestionRange'](_0xf77f19,this['_model']['createRange'](_0x242955,_0x1e0ce9)):(this['_setSuggestionData']({'id':_0xec0206,'type':'formatBlock:'+_0x2d3292,'data':_0x25b85b,'createdAt':new Date(),'authorId':_0x49d19b,'attributes':_0x4255e1}),this['_addSuggestionMarker']('formatBlock:'+_0x2d3292,_0xec0206,_0x49d19b,this['_model']['createRange'](_0x242955,_0x1e0ce9)));}['markMultiRangeBlockFormat'](_0x505a7f,_0x4b5b49,_0x5444c7=[],_0x4337a0=null,_0x1304ca={}){_0x4b5b49['formatGroupId']||(_0x4b5b49['formatGroupId']=_0x4b5b49['commandName']),_0x4b5b49['multipleBlocks']=!0x1,_0x4337a0=_0x4337a0||pt(_0x4b5b49);const _0x2d0183=_0x5444c7['map'](_0x561ec0=>wt(_0x561ec0,this['_model'])),_0x41f41d=_0x505a7f['map'](_0x446fb3=>wt(_0x446fb3,this['_model']));_0x2d0183['push'](..._0x41f41d);let _0x260173=!0x0;for(const _0x305b91 of _0x2d0183)if(!this['_rangeIsInLocalUserInsertion'](_0x305b91)){_0x260173=!0x1;break;}if(_0x260173){const _0x20fba7=this['_suggestionFactory']['getSuggestionCallback']('formatBlock',_0x4337a0,'accept');return void this['forceDefaultExecution'](()=>_0x20fba7(_0x41f41d,_0x4b5b49,_0x1304ca));}const _0x258a67=this['editor']['plugins']['get']('Users')['me'];for(const _0x18ba85 of this['getSuggestions']()){if(_0x18ba85['author']['id']!=_0x258a67['id'])continue;if('formatBlock'!=_0x18ba85['type']||_0x18ba85['data']['formatGroupId']!=_0x4b5b49['formatGroupId'])continue;const _0x2c15d5=_0x18ba85['subType']==_0x4337a0;for(let _0x13ff79=0x0;_0x13ff79<_0x41f41d['length'];_0x13ff79++){const _0x2227a9=_0x41f41d[_0x13ff79];for(const _0xfd19e0 of _0x18ba85['getMarkers']()){const _0x32e163=_0xfd19e0['getRange']();if(_0x2227a9['isEqual'](_0x32e163)){_0x2c15d5?(_0x41f41d['splice'](_0x13ff79,0x1),_0x13ff79--):_0x18ba85['removeMarker'](_0xfd19e0['name']);break;}}}}if(0x0==_0x41f41d['length'])return;const _0x3f5cf1=this['_suggestionFactory']['getSuggestionCallback']('formatBlock',_0x4337a0,'join');for(const _0x2577d4 of this['getSuggestions']())if(_0x2577d4['author']['id']==_0x258a67['id']&&'formatBlock'==_0x2577d4['type']&&_0x2577d4['data']['formatGroupId']==_0x4b5b49['formatGroupId']&&_0x2577d4['subType']==_0x4337a0&&(_0x3f5cf1(_0x2577d4['getRanges'](),_0x41f41d)||_0x3f5cf1(_0x41f41d,_0x2577d4['getRanges']()))){for(const _0x3f6101 of _0x41f41d)_0x2577d4['addRange'](_0x3f6101);return _0x2577d4;}const _0xac136b=_0x5bd5e5(),_0x15cd49=_0x258a67['id'],_0x499f6f='formatBlock:'+_0x4337a0,_0x4357d7=this['_setSuggestionData']({'id':_0xac136b,'type':_0x499f6f,'data':_0x4b5b49,'createdAt':new Date(),'authorId':_0x15cd49,'attributes':_0x1304ca});for(const _0x2a5405 of _0x41f41d)this['_addSuggestionMarker'](_0x499f6f,_0xac136b,_0x15cd49,_0x2a5405,_0xbeb2bd['getMultiRangeId']());return _0x4357d7;}['markDeletion'](_0x4244b7,_0x4b6f4a=null,_0x3a783e={}){if(_0x4244b7['isCollapsed'])return null;const _0x53e949=this['editor']['plugins']['get']('Users')['me'],_0x2f147e=new _0x31ce06(_0x4244b7['start'],_0x4244b7['end']);for(const {suggestion:_0x3e556b,meta:_0x30516b}of this['_findSuggestions'](_0x2f147e,'insertion'))if(_0x30516b['isOwn']&&!_0x30516b['isNextTo']){if(_0x3e556b['isMultiRange']){const _0x58239a=_0x3e556b['getRanges']()['filter'](_0x1fe050=>'$graveyard'!=_0x1fe050['root']['rootName']);_0x58239a['every'](_0xe619bb=>_0x2f147e['containsRange'](_0xe619bb,!0x0))&&_0x3e556b['discard']();if(_0x58239a['some'](_0x50057f=>_0x50057f['containsRange'](_0x2f147e,!0x0))){const _0x540f59=this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x4b6f4a,'accept');return this['forceDefaultExecution'](()=>_0x540f59([_0x2f147e],null,_0x3a783e)),null;}}else{const _0x2b1ba7=_0x2f147e['getIntersection'](_0x3e556b['getFirstRange']());_0x3e556b['_onDiscard']([_0x2b1ba7],null,_0x3a783e);}}if(_0x2f147e['detach'](),_0x2f147e['isCollapsed']||'$graveyard'==_0x2f147e['root']['rootName'])return null;let _0x5c874c=null,_0x45fe25=_0x2f147e['start'],_0x1930a8=_0x2f147e['end'];for(const {suggestion:_0x200ee8,meta:_0x24eea4}of this['_findSuggestions'](_0x2f147e,'deletion'))if(_0x24eea4['isOwn']){if(_0x200ee8['isMultiRange']){let _0x1fea31=!0x0;for(const _0x1fdfd8 of _0x200ee8['getRanges']()){if(_0x1fdfd8['containsRange'](_0x2f147e,!0x0))return _0x200ee8;_0x2f147e['containsRange'](_0x1fdfd8)||(_0x1fea31=!0x1);}_0x1fea31&&_0x200ee8['discard']();}else{const _0x51ad67=_0x200ee8['getFirstRange']();if(_0x51ad67['containsRange'](_0x2f147e,!0x0))return _0x200ee8;_0x45fe25=_0x45fe25['isBefore'](_0x51ad67['start'])?_0x45fe25:_0x51ad67['start'],_0x1930a8=_0x1930a8['isAfter'](_0x51ad67['end'])?_0x1930a8:_0x51ad67['end'],_0x5c874c?_0x51ad67['start']['isBefore'](_0x5c874c['getFirstRange']()['start'])?(_0x5c874c['removeMarkers'](),_0x5c874c=_0x200ee8):_0x200ee8['removeMarkers']():_0x5c874c=_0x200ee8;}}if(_0x5c874c)return this['_setSuggestionRange'](_0x5c874c,this['_model']['createRange'](_0x45fe25,_0x1930a8)),_0x5c874c;{const _0x1e0816=_0x5bd5e5(),_0x1bd0fc=this['_model']['createRange'](_0x45fe25,_0x1930a8),_0x4e6e28=_0x53e949['id'],_0x14be4e=_0x4b6f4a?'deletion:'+_0x4b6f4a:'deletion',_0x1275ea=this['_setSuggestionData']({'id':_0x1e0816,'type':_0x14be4e,'createdAt':new Date(),'authorId':_0x4e6e28,'attributes':_0x3a783e});return this['_addSuggestionMarker'](_0x14be4e,_0x1e0816,_0x4e6e28,_0x1bd0fc),_0x1275ea;}}['markMultiRangeDeletion'](_0x2127f6,_0x5c6c52='multi',_0x37f01a={}){const _0xd1fbbf=this['editor']['plugins']['get']('Users')['me'],_0x4842c8=_0x2127f6['map'](_0x4e7dae=>new _0x31ce06(_0x4e7dae['start'],_0x4e7dae['end'])),_0x5270d2=new Set();for(const _0x17c47e of _0x4842c8)for(const {suggestion:_0x5a3bdc,meta:_0x1eadb6}of this['_findSuggestions'](_0x17c47e,'insertion'))_0x1eadb6['isOwn']&&!_0x1eadb6['isNextTo']&&_0x5270d2['add'](_0x5a3bdc);for(const _0x55f19c of _0x5270d2)if(_0x55f19c['isMultiRange']){const _0x5d831c=_0x55f19c['getRanges']();(!_0x55f19c['attributes']||!_0x55f19c['attributes']['skipNestingCheck'])&&(_0x5d831c['every'](_0x10ad66=>_0x4842c8['some'](_0x108ae6=>_0x108ae6['containsRange'](_0x10ad66,!0x0)))&&_0x55f19c['discard']());if(_0x4842c8['every'](_0x425e09=>_0x5d831c['some'](_0x3b4ad8=>_0x3b4ad8['containsRange'](_0x425e09,!0x0)))){const _0x32899d=this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x5c6c52,'accept');return this['forceDefaultExecution'](()=>_0x32899d(_0x2127f6,null,_0x37f01a)),null;}}else{const _0x47d5ae=_0x55f19c['getFirstRange']();_0x4842c8['some'](_0x4d95d4=>_0x4d95d4['containsRange'](_0x47d5ae,!0x0))&&_0x55f19c['discard']();if(_0x4842c8['every'](_0x4c0ef9=>_0x47d5ae['containsRange'](_0x4c0ef9,!0x0))){const _0x294465=this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x5c6c52,'accept');return this['forceDefaultExecution'](()=>_0x294465(_0x4842c8,null,_0x37f01a)),null;}}const _0x2c41a8=this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x5c6c52,'join');let _0x2a58fc=null;for(const _0x4d3799 of this['getSuggestions']())if(_0x4d3799['author']['id']==_0xd1fbbf['id']&&_0x4d3799['isInContent']&&'deletion'==_0x4d3799['type']&&_0x4d3799['subType']==_0x5c6c52&&(_0x2c41a8(_0x4d3799['getRanges'](),_0x4842c8)||_0x2c41a8(_0x4842c8,_0x4d3799['getRanges']()))){if(_0x2a58fc){if(_0x4d3799['commentThread']&&_0x4d3799['commentThread']['length'])continue;for(const _0x59c0dd of _0x4d3799['getRanges']())_0x2a58fc['isIntersectingWithRange'](_0x59c0dd)||_0x2a58fc['addRange'](_0x59c0dd);_0x4d3799['removeMarkers']();}else{_0x2a58fc=_0x4d3799;for(const _0x100bc4 of _0x4842c8)_0x4d3799['isIntersectingWithRange'](_0x100bc4)||_0x4d3799['addRange'](_0x100bc4);}}if(_0x2a58fc)return _0x2a58fc;_0x5270d2['clear']();for(const _0x2ac1c8 of _0x4842c8)for(const {suggestion:_0x3e87c0,meta:_0x1d3102}of this['_findSuggestions'](_0x2ac1c8,'deletion'))_0x1d3102['isOwn']&&_0x5270d2['add'](_0x3e87c0);for(const _0x3afd8d of _0x5270d2){const _0x39449f=_0x3afd8d['getRanges']();if(!_0x37f01a||!_0x37f01a['skipNestingCheck']){if(_0x4842c8['every'](_0x3e919c=>_0x39449f['some'](_0x202686=>_0x202686['containsRange'](_0x3e919c,!0x0))))return _0x3afd8d;}(!_0x3afd8d['attributes']||!_0x3afd8d['attributes']['skipNestingCheck'])&&(_0x39449f['every'](_0x59fe36=>_0x4842c8['some'](_0x2f572e=>_0x2f572e['containsRange'](_0x59fe36,!0x0)))&&_0x3afd8d['discard']());}const _0x1c7dc3=_0x5bd5e5(),_0x3aa302=_0xd1fbbf['id'],_0x12a9d5='deletion:'+_0x5c6c52,_0x5a9d60=this['_setSuggestionData']({'id':_0x1c7dc3,'type':_0x12a9d5,'createdAt':new Date(),'authorId':_0x3aa302,'attributes':_0x37f01a});for(const _0x49e429 of _0x4842c8)_0x49e429['detach'](),_0x49e429['isCollapsed']||'$graveyard'==_0x49e429['root']['rootName']||this['_addSuggestionMarker'](_0x12a9d5,_0x1c7dc3,_0x3aa302,_0x49e429,_0xbeb2bd['getMultiRangeId']());return _0x5a9d60;}['_setSuggestionRange'](_0x143899,_0x46ab17){const _0x3a55bf=_0x143899['getFirstMarker']();this['_model']['change'](_0x72b55f=>{_0x72b55f['updateMarker'](_0x3a55bf,{'range':_0x46ab17});});}['_addThreadToSuggestion'](_0x141d83){const _0x4230cc=_0x141d83['id'],_0x37a2e1=this['editor']['config']['get']('collaboration.channelId');this['_commentsRepository']['hasCommentThread'](_0x4230cc)||this['_commentsRepository']['addCommentThread']({'channelId':_0x37a2e1,'threadId':_0x4230cc});const _0x4e6db7=this['_commentsRepository']['getCommentThread'](_0x4230cc);_0x4e6db7['unbind']('isRemovable'),_0x4e6db7['isRemovable']=!0x1,_0x141d83['commentThread']=_0x4e6db7;}['_checkSuggestionCorrectness'](_0x527bbc,_0x44d14e,_0x16a9d6,_0x20ba84){if(_0x527bbc['type']!=_0x44d14e||_0x527bbc['subType']!=_0x16a9d6||_0x527bbc['author']['id']!=_0x20ba84)throw this['editor']['enableReadOnlyMode']('track-changes-suggestion-data-mismatch'),new _0x3af4d7('track-changes-suggestion-data-mismatch',this);}['_cutOutSuggestionMarker'](_0x3c8f99,_0x3dce3c){const _0x2b80e7=_0x3c8f99['getFirstRange']();if(_0x3dce3c['isEqual'](_0x2b80e7))_0x3c8f99['removeMarkers']();else{if(_0x2b80e7['containsRange'](_0x3dce3c)){const _0x51b2a9=this['_model']['createPositionAt'](_0x3dce3c['start']['nodeBefore'],'end');this['_setSuggestionRange'](_0x3c8f99,this['_model']['createRange'](_0x2b80e7['start'],_0x51b2a9));const _0x402f2b=_0x5bd5e5(),_0x5b8fb1=_0x3c8f99['author']['id'],_0x1f805d=_0x3c8f99['type']+':'+_0x3c8f99['subType'];this['_setSuggestionData']({'id':_0x402f2b,'type':_0x1f805d,'createdAt':new Date(),'authorId':_0x5b8fb1,'data':_0x3c8f99['data'],'attributes':_0x3c8f99['attributes']});const _0x538eed=this['_model']['createPositionAt'](_0x3dce3c['end']['parent'],'after'),_0x400b26=this['_model']['createRange'](_0x538eed,_0x2b80e7['end']);this['_addSuggestionMarker'](_0x1f805d,_0x402f2b,_0x5b8fb1,_0x400b26);}else{if(_0x2b80e7['containsPosition'](_0x3dce3c['start'])){const _0x4fb0a2=this['_model']['createPositionAt'](_0x3dce3c['start']['nodeBefore'],'end');this['_setSuggestionRange'](_0x3c8f99,this['_model']['createRange'](_0x2b80e7['start'],_0x4fb0a2));}else{const _0x4d898b=this['_model']['createPositionAt'](_0x3dce3c['end']['parent'],'after');this['_setSuggestionRange'](_0x3c8f99,this['_model']['createRange'](_0x4d898b,_0x2b80e7['end']));}}}}['_rangeIsInLocalUserInsertion'](_0x11cf37){for(const {suggestion:_0x1877d8,meta:_0x817ca9}of this['_findSuggestions'](_0x11cf37,'insertion')){if(!_0x817ca9['isOwn'])continue;const _0x1fb500=_0x1877d8['getRanges']();for(const _0x51ad07 of _0x1fb500)if(!_0x11cf37['getDifference'](_0x51ad07)['length'])return!0x0;}return!0x1;}['_getAuthorFromId'](_0x4e7e6a){const _0x29b434=this['editor']['plugins']['get']('Users')['getUser'](_0x4e7e6a);if(!_0x29b434)throw new _0x3af4d7('track-changes-user-not-found',this);return _0x29b434;}['_createSuggestion'](_0x4139da,_0x5bb773,_0xdbf4df,_0x37f4e5){const _0x1fc061=this['_getAuthorFromId'](_0x37f4e5),_0x39906d=this['_suggestionFactory']['buildSuggestion'](_0x4139da,_0x5bb773,_0xdbf4df,_0x1fc061,_0x133bb1=>this['_updateSuggestionData'](_0xdbf4df,{'attributes':_0x133bb1}));return this['listenTo'](_0x39906d,'accept',()=>{this['_updateSuggestionData'](_0xdbf4df,{'state':'accepted'});},{'priority':'high'}),this['listenTo'](_0x39906d,'discard',()=>{this['_updateSuggestionData'](_0xdbf4df,{'state':'rejected'});},{'priority':'high'}),this['_suggestions']['set'](_0xdbf4df,_0x39906d),this['_suggestionState']['set'](_0x39906d,'notReady'),_0x39906d;}['_splitMarkerName'](_0x560fe5){const _0x547c58=_0x560fe5['split'](':');return{'group':_0x547c58[0x0],'type':_0x547c58[0x1],'subType':_0x547c58['length']>=0x5?_0x547c58[0x2]:null,'id':_0x547c58['length']<0x5?_0x547c58[0x2]:_0x547c58[0x3],'authorId':_0x547c58['length']<0x5?_0x547c58[0x3]:_0x547c58[0x4],'markerCount':0x6==_0x547c58['length']?_0x547c58[0x5]:null};}['_breakSuggestionMarker'](_0x32f8f9,_0x4b64c7,_0x4449fc){const _0x332c41=_0x32f8f9['getFirstRange'](),_0x1a6770=_0x332c41['start'],_0xed8e12=_0x332c41['end'];this['_setSuggestionRange'](_0x32f8f9,this['_model']['createRange'](_0x1a6770,_0x4b64c7));const _0x567272=_0x5bd5e5(),_0x37ff1b=_0x32f8f9['author']['id'],_0x37cd26=_0x32f8f9['type']+(_0x32f8f9['subType']?':'+_0x32f8f9['subType']:'');this['_setSuggestionData']({'id':_0x567272,'type':_0x37cd26,'createdAt':new Date(),'authorId':_0x37ff1b,'originalSuggestionId':_0x32f8f9['id'],'data':_0x32f8f9['data']}),'formatBlock'==_0x32f8f9['type']&&(_0x4449fc=this['_model']['createPositionBefore'](_0x4449fc['parent'])),this['_addSuggestionMarker'](_0x37cd26,_0x567272,_0x37ff1b,this['_model']['createRange'](_0x4449fc,_0xed8e12));}['_findSuggestions'](_0x279887,_0x127fde=null){const _0x148612=[],_0x1e8f28=this['_model']['schema'],_0x69d08d=this['editor']['plugins']['get']('Users')['me'];for(const _0x1fc996 of this['getSuggestions']())if(_0x1fc996['isInContent']&&(!_0x127fde||_0x1fc996['type']==_0x127fde))for(const _0x35dd16 of _0x1fc996['getRanges']()){const _0x26481d=_0x279887['start']['isEqual'](_0x35dd16['end'])||_0x279887['end']['isEqual'](_0x35dd16['start']);if(_0x26481d||_0x279887['getIntersection'](_0x35dd16)){const _0xa94a6b=_0x279887['containsRange'](_0x35dd16)&&lt(_0x1e8f28,_0x35dd16['start'],_0x279887),_0x2c6d7f=_0x35dd16['containsRange'](_0x279887)&&lt(_0x1e8f28,_0x279887['start'],_0x35dd16);_0x148612['push']({'suggestion':_0x1fc996,'meta':{'isOwn':_0x69d08d==_0x1fc996['author'],'isNextTo':_0x26481d,'isInsideObject':_0xa94a6b,'containsRangeInObject':_0x2c6d7f}});break;}}return _0x148612;}['_addSuggestionMarker'](_0x86c9f3,_0x5eb937,_0x3b08bd,_0x5085df,_0xe1b3cc=null){this['_model']['change'](_0x1c7eaa=>{let _0x2c9410='suggestion:'+_0x86c9f3+':'+_0x5eb937+':'+_0x3b08bd;_0xe1b3cc&&(_0x2c9410=_0x2c9410+':'+_0xe1b3cc),_0x1c7eaa['addMarker'](_0x2c9410,{'range':_0x5085df,'usingOperation':!0x0,'affectsData':!0x0});});}['_removeSuggestion'](_0x3cec4b){const _0x555972=_0x3cec4b['previous'],_0x3c5aa1=_0x3cec4b['next'];_0x3cec4b['previous']=null,null!=_0x555972&&(_0x555972['next']=null),_0x3cec4b['next']=null,null!=_0x3c5aa1&&(_0x3c5aa1['previous']=null),'ready'==this['_suggestionState']['get'](_0x3cec4b)&&(this['_suggestionState']['set'](_0x3cec4b,'removed'),this['fire']('suggestionUnloaded',_0x3cec4b,_0x555972,_0x3c5aa1));}['_setSuggestionData'](_0x25975b){const _0x542ed4=_0x25975b['id'],_0x21c6d1=this['addSuggestionData'](_0x25975b);if(this['_adapter']&&this['_adapter']['addSuggestion']){const _0x50ba78=this['editor']['plugins']['get']('PendingActions'),_0x1289a2=_0x21c6d1['hasComments'],_0x4d1a4c=_0x21c6d1['subType']?_0x21c6d1['type']+':'+_0x21c6d1['subType']:_0x21c6d1['type'],t=this['editor']['locale']['t'],_0x2c37df=_0x50ba78['add'](t({'string':'Unsaved\x20change\x20in\x20suggestion.','id':'PENDING_ACTION_SUGGESTION'})),_0x254710={'id':_0x542ed4,'type':_0x4d1a4c,'hasComments':_0x1289a2,'data':_0x25975b['data']||null,'originalSuggestionId':_0x25975b['originalSuggestionId']||null,'attributes':_0x21c6d1['attributes']};this['_adapter']['addSuggestion'](_0x254710)['then'](_0x5121b6=>{_0x21c6d1['_saved']=!0x0,_0x50ba78['remove'](_0x2c37df),_0x5121b6&&_0x5121b6['createdAt']&&(this['_suggestions']['get'](_0x542ed4)['createdAt']=_0x5121b6['createdAt']);});}return _0x21c6d1;}['_updateSuggestionData'](_0x2351c2,_0x23b59f){const _0x34eb39=this['editor']['plugins']['get']('PendingActions'),_0x56644c=this['_suggestions']['get'](_0x2351c2);if(this['_adapter']&&this['_adapter']['updateSuggestion']){if(_0x56644c['_saved']){const t=this['editor']['locale']['t'],_0x1482db=_0x34eb39['add'](t({'string':'Unsaved\x20change\x20in\x20suggestion.','id':'PENDING_ACTION_SUGGESTION'}));this['_adapter']['updateSuggestion'](_0x2351c2,_0x23b59f)['then'](()=>{_0x34eb39['remove'](_0x1482db);});}else _0x56644c['on']('change:_saved',()=>{this['_updateSuggestionData'](_0x2351c2,_0x23b59f);});}}['_getSuggestionData'](_0x4cbad8){if(!this['_adapter']||!this['_adapter']['getSuggestion'])throw new _0x3af4d7('track-changes-adapter-missing-getsuggestion',this);return this['_adapter']['getSuggestion'](_0x4cbad8);}['_handleNewSuggestionMarker'](_0x240389){const {id:_0x5c17fb,type:_0x19dfbf,subType:_0x1e041f,authorId:_0x8c6aba}=this['_splitMarkerName'](_0x240389),_0x2c778e=this['_suggestions']['get'](_0x5c17fb)||this['_createSuggestion'](_0x19dfbf,_0x1e041f,_0x5c17fb,_0x8c6aba);switch(this['_checkSuggestionCorrectness'](_0x2c778e,_0x19dfbf,_0x1e041f,_0x8c6aba),this['_suggestionState']['get'](_0x2c778e)){case'notReady':this['_getSuggestionData'](_0x5c17fb)['then'](_0x59b519=>{let _0x4ed2a9=Promise['resolve']();_0x59b519['hasComments']&&(_0x4ed2a9=this['_commentsRepository']['fetchCommentThread']({'channelId':this['editor']['config']['get']('collaboration.channelId'),'threadId':_0x5c17fb})),_0x4ed2a9['then'](()=>{this['addSuggestionData'](_0x59b519)['_saved']=!0x0;});}),this['_suggestionState']['set'](_0x2c778e,'markerReady');break;case'removed':this['_updateSuggestionData'](_0x5c17fb,{'state':'open'});case'dataReady':this['_suggestionState']['set'](_0x2c778e,'ready'),this['fire']('suggestionLoaded',_0x2c778e);break;case'ready':this['fire']('suggestionChanged',_0x2c778e);}_0x2c778e['addMarkerName'](_0x240389),this['_refreshSuggestionsChain'](_0x2c778e);}['_refreshSuggestionsChain'](_0x27fec4){if(_0x27fec4['isMultiRange'])return;let _0x2d8bdf=!0x0,_0x43fc97=!0x0;for(const _0x35325e of this['getSuggestions']()){if(_0x35325e['isMultiRange'])continue;if(_0x35325e==_0x27fec4||!_0x35325e['isInContent'])continue;if(_0x35325e['author']['id']!=_0x27fec4['author']['id'])continue;const _0x28a224=this['_suggestionFactory']['getSuggestionCallback'](_0x27fec4['type'],_0x27fec4['subType'],'chain'),_0xe28724=this['_suggestionFactory']['getSuggestionCallback'](_0x35325e['type'],_0x35325e['subType'],'chain'),_0x5c5505=_0x28a224(_0x27fec4,_0x35325e),_0x189474=_0xe28724(_0x27fec4,_0x35325e);_0x5c5505&&_0x189474&&(_0x5c5505[0x1]['commentThread']&&_0x5c5505[0x1]['commentThread']['length']||(_0x5c5505[0x0]['next']=_0x5c5505[0x1],_0x5c5505[0x1]['previous']=_0x5c5505[0x0],_0x5c5505[0x0]==_0x27fec4?_0x43fc97=!0x1:_0x2d8bdf=!0x1));}_0x27fec4['previous']&&_0x2d8bdf&&(_0x27fec4['previous']['next']=null,_0x27fec4['previous']=null),_0x27fec4['next']&&_0x43fc97&&(_0x27fec4['next']['previous']=null,_0x27fec4['next']=null);}['_joinWithAdjacentSuggestions'](_0x110553){for(const _0x422430 of this['_suggestions']['values']()){if(_0x422430==_0x110553||!_0x422430['isInContent'])continue;if(_0x422430['type']!=_0x110553['type']||_0x422430['author']['id']!=_0x110553['author']['id']||_0x422430['subType']!=_0x110553['subType'])continue;const _0x3da12a=this['_suggestionFactory']['getSuggestionCallback'](_0x110553['type'],_0x110553['subType'],'join');if(_0x3da12a(_0x422430['getRanges'](),_0x110553['getRanges']())){if(_0x110553['commentThread']&&_0x110553['commentThread']['length'])continue;return this['_joinSuggestions'](_0x422430,_0x110553),!0x0;}if(_0x3da12a(_0x110553['getRanges'](),_0x422430['getRanges']())){if(_0x422430['commentThread']&&_0x422430['commentThread']['length'])continue;return this['_joinSuggestions'](_0x110553,_0x422430),!0x0;}}return!0x1;}['_joinSuggestions'](_0xb203da,_0x46c9ce){if(_0xb203da['isMultiRange'])for(const _0xab860c of _0x46c9ce['getRanges']())_0xb203da['addRange'](_0xab860c);else{const _0x362089=_0x46c9ce['getFirstRange']()['end'];this['_setSuggestionRange'](_0xb203da,this['_model']['createRange'](_0xb203da['getFirstRange']()['start'],_0x362089));}_0x46c9ce['removeMarkers']();}}_0x1aa60c(d,_0x50e452);class gt{constructor(_0x612052){this['_editor']=_0x612052,this['_model']=_0x612052['model'],this['_customCallbacks']=new Map(),this['_defaultCallbacks']=new Map(),this['_registerDefaultCallbacks']();}['buildSuggestion'](_0x304fd5,_0x42241c,_0xbf8c17,_0x569098,_0x4f35a7){return new _0xbeb2bd(this['_model'],{'type':_0x304fd5,'subType':_0x42241c,'id':_0xbf8c17,'author':_0x569098,'onAttributesChange':_0x4f35a7,'onAccept':(..._0x43a293)=>this['getSuggestionCallback'](_0x304fd5,_0x42241c,'accept')(..._0x43a293),'onDiscard':(..._0x172fbb)=>this['getSuggestionCallback'](_0x304fd5,_0x42241c,'discard')(..._0x172fbb)});}['registerCustomCallback'](_0xec5a28,_0x5a8f81,_0xf17096,_0x462667){const _0x3436cf=_0xec5a28+':'+_0x5a8f81+':'+_0xf17096;this['_customCallbacks']['set'](_0x3436cf,_0x462667);}['getSuggestionCallback'](_0x496e7c,_0x562982,_0x468199){const _0x16de6b=_0x496e7c+':'+_0x562982+':'+_0x468199;return this['_customCallbacks']['get'](_0x16de6b)||this['_defaultCallbacks']['get'](_0x496e7c+':'+_0x468199);}['_registerDefaultCallbacks'](){const _0xd9dd=()=>{},_0x31ffe5=_0x1995b0=>{_0x1995b0['sort']((_0x536777,_0x26bee9)=>_0x536777['start']['isBefore'](_0x26bee9['start'])?0x1:-0x1),this['_model']['change'](_0x549050=>{for(const _0x44f2c9 of _0x1995b0){let _0xcb4574;_0xcb4574=_0x44f2c9['end']['isAtEnd']&&_0x44f2c9['end']['parent']==_0x44f2c9['start']['nodeAfter']?_0x549050['createSelection'](_0x44f2c9['start']['nodeAfter'],'on'):_0x549050['createSelection'](_0x44f2c9),this['_model']['deleteContent'](_0xcb4574,{'forceDefaultExecution':!0x0,'doNotAutoparagraph':!0x0});}});},_0x4cdf05=(_0x573cf5,_0x46eeb5)=>{this['_model']['change'](_0x54af97=>{const {commandName:_0x45c392,commandParams:_0x66ed2b=[]}=_0x46eeb5,_0x15bb1d=_0x573cf5[0x0];if('$graveyard'==_0x15bb1d['root']['rootName'])return;const _0x33dd8f=Array['from'](this['_model']['document']['selection']['getRanges']())['map'](_0x1a76e7=>_0x31ce06['fromRange'](_0x1a76e7));dt(_0x15bb1d)?_0x54af97['setSelection'](this['_model']['createRange'](_0x15bb1d['end'])):_0x54af97['setSelection'](_0x15bb1d);for(const _0x44cab7 of this['_editor']['commands']['commands']())_0x44cab7['refresh']();_0x66ed2b['push']({'forceDefaultExecution':!0x0}),this['_editor']['execute'](_0x45c392,..._0x66ed2b);const _0x45bf47=_0x33dd8f['filter'](_0x163587=>'$graveyard'!=_0x163587['root']['rootName']);_0x45bf47['length']>0x0&&_0x54af97['setSelection'](_0x45bf47);for(const _0x52cf37 of _0x33dd8f)_0x52cf37['detach']();});},_0xcce9c3=(_0x268bb4,_0xb7965f)=>0x1==_0x268bb4['length']&&0x1==_0xb7965f['length']&&_0x268bb4[0x0]['end']['isEqual'](_0xb7965f[0x0]['start']),_0x5a91f9=(_0x172cf8,_0x22d2db)=>yt(_0x172cf8,_0x22d2db,this['_model'])?[_0x172cf8,_0x22d2db]:yt(_0x22d2db,_0x172cf8,this['_model'])?[_0x22d2db,_0x172cf8]:null;this['_defaultCallbacks']['set']('insertion:accept',_0xd9dd),this['_defaultCallbacks']['set']('insertion:discard',_0x31ffe5),this['_defaultCallbacks']['set']('insertion:join',_0xcce9c3),this['_defaultCallbacks']['set']('insertion:chain',_0x5a91f9),this['_defaultCallbacks']['set']('deletion:accept',_0x31ffe5),this['_defaultCallbacks']['set']('deletion:discard',_0xd9dd),this['_defaultCallbacks']['set']('deletion:join',_0xcce9c3),this['_defaultCallbacks']['set']('deletion:chain',_0x5a91f9),this['_defaultCallbacks']['set']('formatInline:accept',_0x4cdf05),this['_defaultCallbacks']['set']('formatInline:discard',_0xd9dd),this['_defaultCallbacks']['set']('formatInline:join',_0xcce9c3),this['_defaultCallbacks']['set']('formatInline:chain',_0xd9dd),this['_defaultCallbacks']['set']('formatBlock:accept',_0x4cdf05),this['_defaultCallbacks']['set']('formatBlock:discard',_0xd9dd),this['_defaultCallbacks']['set']('formatBlock:join',_0xcce9c3),this['_defaultCallbacks']['set']('formatBlock:chain',_0xd9dd);}}function lt(_0x1e187b,_0x53f8c6,_0x3e5141){for(const _0x5b35e of _0x53f8c6['parent']['getAncestors']({'includeSelf':!0x0,'parentFirst':!0x0})){if(_0x5b35e['root']==_0x5b35e)return!0x1;if(!_0x3e5141['containsItem'](_0x5b35e))return!0x1;if(_0x1e187b['isObject'](_0x5b35e)||_0x1e187b['isLimit'](_0x5b35e))return!0x0;}}function dt(_0x3a4dc7){return _0x3a4dc7['end']['parent']==_0x3a4dc7['start']['nodeAfter']&&_0x3a4dc7['end']['isAtStart'];}function mt(_0x1ca862,_0x92404a,_0x21217e,_0x536629){const _0x5e38b0=_0x1f7777=>!_0x1f7777['item']['is']('textProxy')&&!_0x536629['isObject'](_0x1f7777['item']),_0x5e73b6=_0x1ca862['start']['getLastMatchingPosition'](_0x5e38b0),_0x5cde55=_0x1ca862['end']['getLastMatchingPosition'](_0x5e38b0,{'direction':'backward'});return(!_0x1ca862['start']['isEqual'](_0x5e73b6)||!_0x1ca862['end']['isEqual'](_0x5cde55))&&(_0x5e73b6['isBefore'](_0x5cde55)?_0x21217e['updateMarker'](_0x92404a,{'range':_0x21217e['createRange'](_0x5e73b6,_0x5cde55)}):_0x21217e['removeMarker'](_0x92404a),!0x0);}function pt(_0x3cdda5){return ft(_0x3cdda5);}function kt(_0x4c82bc){const _0x5d4d51=_0x4c82bc['start']['nodeAfter'];return _0x5d4d51&&_0x5d4d51['is']('element');}function wt(_0x35ca2c,_0x55d5ce){const _0x1e2ba7=_0x55d5ce['schema']['isObject'](_0x35ca2c)||_0x55d5ce['schema']['isSelectable'](_0x35ca2c);return _0x55d5ce['createRange'](_0x55d5ce['createPositionAt'](_0x35ca2c,'before'),_0x1e2ba7?_0x55d5ce['createPositionAfter'](_0x35ca2c):_0x55d5ce['createPositionAt'](_0x35ca2c,'end'));}function yt(_0x13358c,_0x182ee1,_0x19129b){const _0x365631=_0x13358c['getFirstRange'](),_0x4a833=_0x182ee1['getFirstRange']();if(_0x365631['end']['isEqual'](_0x4a833['start']))return!0x0;if(_0x13358c['type']!=_0x182ee1['type'])return!0x1;if(!_0x365631['end']['isTouching'](_0x4a833['start']))return!0x1;const _0xa0b025=_0x19129b['createRange'](_0x365631['end'],_0x4a833['start'])['getWalker']();for(const _0x440670 of _0xa0b025)if(['elementStart','elementEnd']['includes'](_0x440670['type'])&&_0x19129b['schema']['isLimit'](_0x440670['item']))return!0x1;return!0x0;}